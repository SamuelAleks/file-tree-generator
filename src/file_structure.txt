File Structure - C:\Users\SamuelA\source\repos\PaapeConversionKitRefactor\test
Scan Date: 2025-03-13 14:19:40
Extensions: .log, .sln, .xaml, .csproj, .cs, .axaml
================================================================================

DIRECTORY STRUCTURE SUMMARY
--------------------------------------------------------------------------------
ğŸ“ test (root)
â”‚   ğŸ“ Application
â”‚       ğŸ“ Services
â”‚       â”‚   ğŸ“ Parsers
â”‚       â”‚   â””â”€â”€ ğŸ“„ ObjectSetParserImpl.cs
â”‚       â”‚   ğŸ“ Writers
â”‚       â”‚   â””â”€â”€ ğŸ“„ ObjectSetWriterImpl.cs
â”‚       â”œâ”€â”€ ğŸ“„ ComparisonService.cs
â”‚       â”œâ”€â”€ ğŸ“„ ControllerModelService.cs
â”‚       â”œâ”€â”€ ğŸ“„ ControllerService.cs
â”‚       â”œâ”€â”€ ğŸ“„ ExportService.cs
â”‚       â”œâ”€â”€ ğŸ“„ ParsingService.cs
â”‚       â”œâ”€â”€ ğŸ“„ ProjectService.cs
â”‚       â””â”€â”€ ğŸ“„ XmlModificationService.cs
â”‚   ğŸ“ Core
â”‚   â”‚   ğŸ“ Domain
â”‚   â”‚   â”‚   ğŸ“ ObjectSet
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ObjectSetModels.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Controller.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerGroup.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerModelInfo.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerObject.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CustomTypeFile.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ImportedFile.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Project.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Session.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ SharedType.cs
â”‚   â”‚   ğŸ“ Dto
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerGroupDto.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ SimilarityResultDto.cs
â”‚   â”‚   ğŸ“ Exceptions
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ BusinessRuleException.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DataAccessException.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DomainExceptionBase.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ NotFoundException.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ ParsingException.cs
â”‚       ğŸ“ Interfaces
â”‚       â”œâ”€â”€ ğŸ“„ IComparisonService.cs
â”‚       â”œâ”€â”€ ğŸ“„ IControllerModelService.cs
â”‚       â”œâ”€â”€ ğŸ“„ IControllerRepository.cs
â”‚       â”œâ”€â”€ ğŸ“„ IDialogService.cs
â”‚       â”œâ”€â”€ ğŸ“„ IErrorHandler.cs
â”‚       â”œâ”€â”€ ğŸ“„ IExportService.cs
â”‚       â”œâ”€â”€ ğŸ“„ IFileSystem.cs
â”‚       â”œâ”€â”€ ğŸ“„ ILoggingService.cs
â”‚       â”œâ”€â”€ ğŸ“„ INavigationService.cs
â”‚       â”œâ”€â”€ ğŸ“„ IObjectSetParser.cs
â”‚       â”œâ”€â”€ ğŸ“„ IObjectSetWriter.cs
â”‚       â”œâ”€â”€ ğŸ“„ IProjectRepository.cs
â”‚       â”œâ”€â”€ ğŸ“„ IRepository.cs
â”‚       â””â”€â”€ ğŸ“„ IXmlModificationService.cs
â”‚   ğŸ“ Data
â”‚   â”‚   ğŸ“ Mapping
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerGroupMapper.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerMapper.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ObjectMapper.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ParsedController.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ParsedObject.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProjectMapper.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SessionMapper.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ SimilarityResultMapper.cs
â”‚   â”œâ”€â”€ ğŸ“„ ParserDbContext.cs
â”‚   â””â”€â”€ ğŸ“„ SessionInfo.cs
â”‚   ğŸ“ Infrastructure
â”‚   â”‚   ğŸ“ Data
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EfControllerRepository.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ FileProjectRepository.cs
â”‚   â”‚   ğŸ“ FileSystem
â”‚   â”‚   â””â”€â”€ ğŸ“„ PhysicalFileSystem.cs
â”‚   â”‚   ğŸ“ Logging
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ApplicationErrorHandler.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ErrorHandlingExtensions.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ LoggingService.cs
â”‚   â”‚   ğŸ“ Processing
â”‚   â”‚   â””â”€â”€ ğŸ“„ ByteCodeProcessor.cs
â”‚   â”‚   ğŸ“ UI
â”‚   â”‚   â”‚   ğŸ“ Converters
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ BoolToMarginConverter.cs
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AvaloniaDialogService.cs
â”‚   â”‚   â””â”€â”€ ğŸ“„ AvaloniaNavigationService.cs
â”‚   â”œâ”€â”€ ğŸ“„ AppBootstrapper.cs
â”‚   â”œâ”€â”€ ğŸ“„ AppSettings.cs
â”‚   â”œâ”€â”€ ğŸ“„ ServiceCollectionExtensions.cs
â”‚   â”œâ”€â”€ ğŸ“„ SettingsManager.cs
â”‚   â””â”€â”€ ğŸ“„ SukiThemeExtensions.cs
â”‚   ğŸ“ ViewModels
â”‚   â”œâ”€â”€ ğŸ“„ ComparisonDemoViewModel.cs
â”‚   â”œâ”€â”€ ğŸ“„ ExportDemoViewModel.cs
â”‚   â”œâ”€â”€ ğŸ“„ IMenuItem.cs
â”‚   â”œâ”€â”€ ğŸ“„ MainViewModel.cs
â”‚   â”œâ”€â”€ ğŸ“„ ObjectSetViewModel.cs
â”‚   â”œâ”€â”€ ğŸ“„ ProjectViewModel.cs
â”‚   â”œâ”€â”€ ğŸ“„ ProjectsViewModel.cs
â”‚   â”œâ”€â”€ ğŸ“„ SettingsViewModel.cs
â”‚   â””â”€â”€ ğŸ“„ ViewModelBase.cs
â”‚   ğŸ“ Views
â”‚   â”œâ”€â”€ ğŸ“„ BaseViewControl.cs
â”‚   â”œâ”€â”€ ğŸ“„ ConvertersView.xaml
â”‚   â”œâ”€â”€ ğŸ“„ ConvertersView.xaml.cs
â”‚   â”œâ”€â”€ ğŸ“„ SettingsView.xaml
â”‚   â”œâ”€â”€ ğŸ“„ SettingsView.xaml.cs
â”‚   â””â”€â”€ ğŸ“„ TextInputDialog.cs
â”œâ”€â”€ ğŸ“„ App.axaml
â”œâ”€â”€ ğŸ“„ App.axaml.cs
â”œâ”€â”€ ğŸ“„ MainWindow.axaml
â”œâ”€â”€ ğŸ“„ MainWindow.axaml.cs
â”œâ”€â”€ ğŸ“„ Program.cs
â”œâ”€â”€ ğŸ“„ ViewLocator.cs
â””â”€â”€ ğŸ“„ test.csproj

Prioritized Folders (in order):
  1. Views
  2. ViewModels
  3. Models
  4. Services
  5. Helpers
  6. Converters

Prioritized Files (in order):
  1. App.xaml
  2. App.xaml.cs
  3. MainWindow.xaml
  4. MainWindow.xaml.cs

================================================================================

DETAILED FILE TREE WITH CONTENTS
--------------------------------------------------------------------------------
ğŸ“ test (root)
â”‚   ğŸ“ Views
â”‚   â”œâ”€â”€ ğŸ“„ BaseViewControl.cs (833.00 B, 2025-03-12 11:27:51)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: BaseViewControl.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Avalonia;
â”‚   â”‚   â”‚    2 â”‚ using Avalonia.Controls;
â”‚   â”‚   â”‚    3 â”‚ 
â”‚   â”‚   â”‚    4 â”‚ namespace test.Views
â”‚   â”‚   â”‚    5 â”‚ {
â”‚   â”‚   â”‚    6 â”‚     public class BaseViewControl : UserControl
â”‚   â”‚   â”‚    7 â”‚     {
â”‚   â”‚   â”‚    8 â”‚         public BaseViewControl()
â”‚   â”‚   â”‚    9 â”‚         {
â”‚   â”‚   â”‚   10 â”‚             this.Padding = new Thickness(20);
â”‚   â”‚   â”‚   11 â”‚ 
â”‚   â”‚   â”‚   12 â”‚             // You could also make the padding configurable
â”‚   â”‚   â”‚   13 â”‚             var defaultPadding = Avalonia.Application.Current?.Resources["DefaultViewPadding"] as double? ?? 20;
â”‚   â”‚   â”‚   14 â”‚             this.Padding = new Thickness(defaultPadding);
â”‚   â”‚   â”‚   15 â”‚         }
â”‚   â”‚   â”‚   16 â”‚ 
â”‚   â”‚   â”‚   17 â”‚         public static readonly StyledProperty<bool> IsSideMenuExpandedProperty =
â”‚   â”‚   â”‚   18 â”‚         AvaloniaProperty.Register<BaseViewControl, bool>(nameof(IsSideMenuExpanded));
â”‚   â”‚   â”‚   19 â”‚ 
â”‚   â”‚   â”‚   20 â”‚         public bool IsSideMenuExpanded
â”‚   â”‚   â”‚   21 â”‚         {
â”‚   â”‚   â”‚   22 â”‚             get => GetValue(IsSideMenuExpandedProperty);
â”‚   â”‚   â”‚   23 â”‚             set => SetValue(IsSideMenuExpandedProperty, value);
â”‚   â”‚   â”‚   24 â”‚         }
â”‚   â”‚   â”‚   25 â”‚     }
â”‚   â”‚   â”‚   26 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ConvertersView.xaml (757.00 B, 2025-03-11 09:48:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ConvertersView.xaml
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ <UserControl
â”‚   â”‚   â”‚    2 â”‚     x:Class="test.Views.ConvertersView"
â”‚   â”‚   â”‚    3 â”‚     xmlns="https://github.com/avaloniaui"
â”‚   â”‚   â”‚    4 â”‚     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
â”‚   â”‚   â”‚    5 â”‚     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
â”‚   â”‚   â”‚    6 â”‚     xmlns:design="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls"
â”‚   â”‚   â”‚    7 â”‚     xmlns:icons="using:Material.Icons"
â”‚   â”‚   â”‚    8 â”‚     xmlns:local="using:test"
â”‚   â”‚   â”‚    9 â”‚     xmlns:material="using:Material.Icons.Avalonia"
â”‚   â”‚   â”‚   10 â”‚     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
â”‚   â”‚   â”‚   11 â”‚     xmlns:suki="using:SukiUI.Controls"
â”‚   â”‚   â”‚   12 â”‚     xmlns:system="using:System"
â”‚   â”‚   â”‚   13 â”‚     xmlns:theme="clr-namespace:SukiUI.Theme;assembly=SukiUI"
â”‚   â”‚   â”‚   14 â”‚     d:DesignHeight="1500"
â”‚   â”‚   â”‚   15 â”‚     d:DesignWidth="800"
â”‚   â”‚   â”‚   16 â”‚     x:CompileBindings="True"
â”‚   â”‚   â”‚   17 â”‚     mc:Ignorable="d">
â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   19 â”‚ </UserControl>
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ConvertersView.xaml.cs (183.00 B, 2025-03-11 09:48:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ConvertersView.xaml.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚   â”‚   â”‚    2 â”‚ using Avalonia.Markup.Xaml;
â”‚   â”‚   â”‚    3 â”‚ using test.ViewModels;
â”‚   â”‚   â”‚    4 â”‚ 
â”‚   â”‚   â”‚    5 â”‚ namespace test.Views
â”‚   â”‚   â”‚    6 â”‚ {
â”‚   â”‚   â”‚    7 â”‚     public partial class ConvertersView : BaseViewControl
â”‚   â”‚   â”‚    8 â”‚     {
â”‚   â”‚   â”‚    9 â”‚     }
â”‚   â”‚   â”‚   10 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ SettingsView.xaml (10.10 KB, 2025-03-12 15:08:39)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: SettingsView.xaml
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿<UserControl
â”‚   â”‚   â”‚    2 â”‚     x:Class="test.Views.SettingsView"
â”‚   â”‚   â”‚    3 â”‚     xmlns="https://github.com/avaloniaui"
â”‚   â”‚   â”‚    4 â”‚     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
â”‚   â”‚   â”‚    5 â”‚     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
â”‚   â”‚   â”‚    6 â”‚     xmlns:material="using:Material.Icons.Avalonia"
â”‚   â”‚   â”‚    7 â”‚     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
â”‚   â”‚   â”‚    8 â”‚     xmlns:suki="using:SukiUI.Controls"
â”‚   â”‚   â”‚    9 â”‚     xmlns:vm="using:test.ViewModels"
â”‚   â”‚   â”‚   10 â”‚     d:DesignHeight="650"
â”‚   â”‚   â”‚   11 â”‚     d:DesignWidth="800"
â”‚   â”‚   â”‚   12 â”‚     x:DataType="vm:SettingsViewModel"
â”‚   â”‚   â”‚   13 â”‚     Background="Red"
â”‚   â”‚   â”‚   14 â”‚     mc:Ignorable="d">
â”‚   â”‚   â”‚   15 â”‚ 
â”‚   â”‚   â”‚   16 â”‚     <ScrollViewer>
â”‚   â”‚   â”‚   17 â”‚         <Grid RowDefinitions="Auto,*">
â”‚   â”‚   â”‚   18 â”‚             <suki:GlassCard Grid.Row="0" Margin="4">
â”‚   â”‚   â”‚   19 â”‚                 <StackPanel>
â”‚   â”‚   â”‚   20 â”‚                     <Grid ColumnDefinitions="*,Auto">
â”‚   â”‚   â”‚   21 â”‚                         <TextBlock Classes="h1" Text="Settings" />
â”‚   â”‚   â”‚   22 â”‚                         <StackPanel
â”‚   â”‚   â”‚   23 â”‚                             Grid.Column="1"
â”‚   â”‚   â”‚   24 â”‚                             VerticalAlignment="Center"
â”‚   â”‚   â”‚   25 â”‚                             Orientation="Horizontal"
â”‚   â”‚   â”‚   26 â”‚                             Spacing="8">
â”‚   â”‚   â”‚   27 â”‚                             <material:MaterialIcon
â”‚   â”‚   â”‚   28 â”‚                                 Width="24"
â”‚   â”‚   â”‚   29 â”‚                                 Height="24"
â”‚   â”‚   â”‚   30 â”‚                                 Foreground="{DynamicResource SukiPrimaryColor}"
â”‚   â”‚   â”‚   31 â”‚                                 Kind="Cog" />
â”‚   â”‚   â”‚   32 â”‚                         </StackPanel>
â”‚   â”‚   â”‚   33 â”‚                     </Grid>
â”‚   â”‚   â”‚   34 â”‚ 
â”‚   â”‚   â”‚   35 â”‚                     <!--  Theme Settings  -->
â”‚   â”‚   â”‚   36 â”‚                     <suki:GroupBox Margin="0,16,0,0" Header="Appearance">
â”‚   â”‚   â”‚   37 â”‚                         <StackPanel Spacing="12">
â”‚   â”‚   â”‚   38 â”‚                             <Grid ColumnDefinitions="Auto,*,Auto">
â”‚   â”‚   â”‚   39 â”‚                                 <material:MaterialIcon
â”‚   â”‚   â”‚   40 â”‚                                     Grid.Column="0"
â”‚   â”‚   â”‚   41 â”‚                                     Width="24"
â”‚   â”‚   â”‚   42 â”‚                                     Height="24"
â”‚   â”‚   â”‚   43 â”‚                                     Margin="0,0,8,0"
â”‚   â”‚   â”‚   44 â”‚                                     VerticalAlignment="Center"
â”‚   â”‚   â”‚   45 â”‚                                     Foreground="{DynamicResource SukiPrimaryColor}"
â”‚   â”‚   â”‚   46 â”‚                                     Kind="ThemeLightDark" />
â”‚   â”‚   â”‚   47 â”‚                                 <TextBlock
â”‚   â”‚   â”‚   48 â”‚                                     Grid.Column="1"
â”‚   â”‚   â”‚   49 â”‚                                     VerticalAlignment="Center"
â”‚   â”‚   â”‚   50 â”‚                                     Text="Application Theme" />
â”‚   â”‚   â”‚   51 â”‚                                 <CheckBox
â”‚   â”‚   â”‚   52 â”‚                                     Grid.Column="2"
â”‚   â”‚   â”‚   53 â”‚                                     Content="Light Theme"
â”‚   â”‚   â”‚   54 â”‚                                     IsChecked="{Binding IsLightTheme}" />
â”‚   â”‚   â”‚   55 â”‚                             </Grid>
â”‚   â”‚   â”‚   56 â”‚ 
â”‚   â”‚   â”‚   57 â”‚                             <TextBlock
â”‚   â”‚   â”‚   58 â”‚                                 Foreground="{DynamicResource SukiLowEmphasisForeground}"
â”‚   â”‚   â”‚   59 â”‚                                 Opacity="{DynamicResource SukiLowEmphasisOpacity}"
â”‚   â”‚   â”‚   60 â”‚                                 Text="The theme will be applied immediately when changed. This setting will be remembered across application restarts."
â”‚   â”‚   â”‚   61 â”‚                                 TextWrapping="Wrap" />
â”‚   â”‚   â”‚   62 â”‚                         </StackPanel>
â”‚   â”‚   â”‚   63 â”‚                     </suki:GroupBox>
â”‚   â”‚   â”‚   64 â”‚ 
â”‚   â”‚   â”‚   65 â”‚                     <!--  Logging Settings  -->
â”‚   â”‚   â”‚   66 â”‚                     <suki:GroupBox Margin="0,16,0,0" Header="Logging">
â”‚   â”‚   â”‚   67 â”‚                         <StackPanel Spacing="12">
â”‚   â”‚   â”‚   68 â”‚                             <Grid ColumnDefinitions="Auto,*,Auto">
â”‚   â”‚   â”‚   69 â”‚                                 <material:MaterialIcon
â”‚   â”‚   â”‚   70 â”‚                                     Grid.Column="0"
â”‚   â”‚   â”‚   71 â”‚                                     Width="24"
â”‚   â”‚   â”‚   72 â”‚                                     Height="24"
â”‚   â”‚   â”‚   73 â”‚                                     Margin="0,0,8,0"
â”‚   â”‚   â”‚   74 â”‚                                     VerticalAlignment="Center"
â”‚   â”‚   â”‚   75 â”‚                                     Foreground="{DynamicResource SukiPrimaryColor}"
â”‚   â”‚   â”‚   76 â”‚                                     Kind="FileCog" />
â”‚   â”‚   â”‚   77 â”‚                                 <TextBlock
â”‚   â”‚   â”‚   78 â”‚                                     Grid.Column="1"
â”‚   â”‚   â”‚   79 â”‚                                     VerticalAlignment="Center"
â”‚   â”‚   â”‚   80 â”‚                                     Text="Application Logging" />
â”‚   â”‚   â”‚   81 â”‚                                 <CheckBox
â”‚   â”‚   â”‚   82 â”‚                                     Grid.Column="2"
â”‚   â”‚   â”‚   83 â”‚                                     Content="Enable Logging"
â”‚   â”‚   â”‚   84 â”‚                                     IsChecked="{Binding EnableLogging}" />
â”‚   â”‚   â”‚   85 â”‚                             </Grid>
â”‚   â”‚   â”‚   86 â”‚ 
â”‚   â”‚   â”‚   87 â”‚                             <StackPanel IsEnabled="{Binding EnableLogging}" Spacing="8">
â”‚   â”‚   â”‚   88 â”‚                                 <StackPanel Orientation="Horizontal" Spacing="8">
â”‚   â”‚   â”‚   89 â”‚                                     <TextBlock
â”‚   â”‚   â”‚   90 â”‚                                         Width="100"
â”‚   â”‚   â”‚   91 â”‚                                         VerticalAlignment="Center"
â”‚   â”‚   â”‚   92 â”‚                                         Text="Log Level:" />
â”‚   â”‚   â”‚   93 â”‚                                     <ComboBox
â”‚   â”‚   â”‚   94 â”‚                                         Width="200"
â”‚   â”‚   â”‚   95 â”‚                                         HorizontalAlignment="Left"
â”‚   â”‚   â”‚   96 â”‚                                         ItemsSource="{Binding LogLevels}"
â”‚   â”‚   â”‚   97 â”‚                                         SelectedItem="{Binding SelectedLogLevel}" />
â”‚   â”‚   â”‚   98 â”‚                                 </StackPanel>
â”‚   â”‚   â”‚   99 â”‚ 
â”‚   â”‚   â”‚  100 â”‚                                 <CheckBox Content="Delete logs on application exit" IsChecked="{Binding DeleteLogsOnExit}" />
â”‚   â”‚   â”‚  101 â”‚ 
â”‚   â”‚   â”‚  102 â”‚                                 <TextBlock
â”‚   â”‚   â”‚  103 â”‚                                     Foreground="{DynamicResource SukiLowEmphasisForeground}"
â”‚   â”‚   â”‚  104 â”‚                                     Opacity="{DynamicResource SukiLowEmphasisOpacity}"
â”‚   â”‚   â”‚  105 â”‚                                     Text="Higher log levels include more detailed information but may affect performance and use more disk space. Logs are stored in the application data folder."
â”‚   â”‚   â”‚  106 â”‚                                     TextWrapping="Wrap" />
â”‚   â”‚   â”‚  107 â”‚ 
â”‚   â”‚   â”‚  108 â”‚                                 <!--  Log file path display  -->
â”‚   â”‚   â”‚  109 â”‚                                 <StackPanel Margin="0,8,0,0" Spacing="4">
â”‚   â”‚   â”‚  110 â”‚                                     <TextBlock Text="Current log file:" />
â”‚   â”‚   â”‚  111 â”‚                                     <suki:GlassCard Padding="8">
â”‚   â”‚   â”‚  112 â”‚                                         <Grid ColumnDefinitions="*,Auto">
â”‚   â”‚   â”‚  113 â”‚                                             <TextBlock
â”‚   â”‚   â”‚  114 â”‚                                                 Grid.Column="0"
â”‚   â”‚   â”‚  115 â”‚                                                 Classes="caption"
â”‚   â”‚   â”‚  116 â”‚                                                 Text="{Binding LogFilePath}"
â”‚   â”‚   â”‚  117 â”‚                                                 TextWrapping="Wrap" />
â”‚   â”‚   â”‚  118 â”‚                                             <Button
â”‚   â”‚   â”‚  119 â”‚                                                 Grid.Column="1"
â”‚   â”‚   â”‚  120 â”‚                                                 Padding="4"
â”‚   â”‚   â”‚  121 â”‚                                                 VerticalAlignment="Center"
â”‚   â”‚   â”‚  122 â”‚                                                 Classes="Flat"
â”‚   â”‚   â”‚  123 â”‚                                                 ToolTip.Tip="Open logs folder">
â”‚   â”‚   â”‚  124 â”‚                                                 <material:MaterialIcon
â”‚   â”‚   â”‚  125 â”‚                                                     Width="16"
â”‚   â”‚   â”‚  126 â”‚                                                     Height="16"
â”‚   â”‚   â”‚  127 â”‚                                                     Kind="FolderOpen" />
â”‚   â”‚   â”‚  128 â”‚                                             </Button>
â”‚   â”‚   â”‚  129 â”‚                                         </Grid>
â”‚   â”‚   â”‚  130 â”‚                                     </suki:GlassCard>
â”‚   â”‚   â”‚  131 â”‚                                 </StackPanel>
â”‚   â”‚   â”‚  132 â”‚                             </StackPanel>
â”‚   â”‚   â”‚  133 â”‚                         </StackPanel>
â”‚   â”‚   â”‚  134 â”‚                     </suki:GroupBox>
â”‚   â”‚   â”‚  135 â”‚ 
â”‚   â”‚   â”‚  136 â”‚                     <!--  Settings Info  -->
â”‚   â”‚   â”‚  137 â”‚                     <suki:GroupBox Margin="0,16,0,16" Header="Settings Information">
â”‚   â”‚   â”‚  138 â”‚                         <StackPanel Spacing="8">
â”‚   â”‚   â”‚  139 â”‚                             <Grid ColumnDefinitions="Auto,*">
â”‚   â”‚   â”‚  140 â”‚                                 <material:MaterialIcon
â”‚   â”‚   â”‚  141 â”‚                                     Grid.Column="0"
â”‚   â”‚   â”‚  142 â”‚                                     Width="24"
â”‚   â”‚   â”‚  143 â”‚                                     Height="24"
â”‚   â”‚   â”‚  144 â”‚                                     Margin="0,0,8,0"
â”‚   â”‚   â”‚  145 â”‚                                     VerticalAlignment="Top"
â”‚   â”‚   â”‚  146 â”‚                                     Foreground="{DynamicResource SukiPrimaryColor}"
â”‚   â”‚   â”‚  147 â”‚                                     Kind="Information" />
â”‚   â”‚   â”‚  148 â”‚                                 <StackPanel Grid.Column="1" Spacing="8">
â”‚   â”‚   â”‚  149 â”‚                                     <TextBlock Text="Settings are automatically saved when changed and will persist between application restarts." TextWrapping="Wrap" />
â”‚   â”‚   â”‚  150 â”‚ 
â”‚   â”‚   â”‚  151 â”‚                                     <TextBlock Text="Settings file location:" />
â”‚   â”‚   â”‚  152 â”‚ 
â”‚   â”‚   â”‚  153 â”‚                                     <suki:GlassCard Padding="8">
â”‚   â”‚   â”‚  154 â”‚                                         <Grid ColumnDefinitions="*,Auto">
â”‚   â”‚   â”‚  155 â”‚                                             <TextBlock
â”‚   â”‚   â”‚  156 â”‚                                                 Grid.Column="0"
â”‚   â”‚   â”‚  157 â”‚                                                 Classes="caption"
â”‚   â”‚   â”‚  158 â”‚                                                 Text="{Binding SettingsPath}"
â”‚   â”‚   â”‚  159 â”‚                                                 TextWrapping="Wrap" />
â”‚   â”‚   â”‚  160 â”‚                                             <Button
â”‚   â”‚   â”‚  161 â”‚                                                 Grid.Column="1"
â”‚   â”‚   â”‚  162 â”‚                                                 Padding="4"
â”‚   â”‚   â”‚  163 â”‚                                                 VerticalAlignment="Center"
â”‚   â”‚   â”‚  164 â”‚                                                 Classes="Flat"
â”‚   â”‚   â”‚  165 â”‚                                                 ToolTip.Tip="Open settings folder">
â”‚   â”‚   â”‚  166 â”‚                                                 <material:MaterialIcon
â”‚   â”‚   â”‚  167 â”‚                                                     Width="16"
â”‚   â”‚   â”‚  168 â”‚                                                     Height="16"
â”‚   â”‚   â”‚  169 â”‚                                                     Kind="FolderOpen" />
â”‚   â”‚   â”‚  170 â”‚                                             </Button>
â”‚   â”‚   â”‚  171 â”‚                                         </Grid>
â”‚   â”‚   â”‚  172 â”‚                                     </suki:GlassCard>
â”‚   â”‚   â”‚  173 â”‚                                 </StackPanel>
â”‚   â”‚   â”‚  174 â”‚                             </Grid>
â”‚   â”‚   â”‚  175 â”‚                         </StackPanel>
â”‚   â”‚   â”‚  176 â”‚                     </suki:GroupBox>
â”‚   â”‚   â”‚  177 â”‚ 
â”‚   â”‚   â”‚  178 â”‚                     <!--  Save Button  -->
â”‚   â”‚   â”‚  179 â”‚                     <Button
â”‚   â”‚   â”‚  180 â”‚                         Margin="0,0,0,10"
â”‚   â”‚   â”‚  181 â”‚                         HorizontalAlignment="Right"
â”‚   â”‚   â”‚  182 â”‚                         Command="{Binding SaveSettingsCommand}"
â”‚   â”‚   â”‚  183 â”‚                         Content="Save Settings" />
â”‚   â”‚   â”‚  184 â”‚                 </StackPanel>
â”‚   â”‚   â”‚  185 â”‚             </suki:GlassCard>
â”‚   â”‚   â”‚  186 â”‚         </Grid>
â”‚   â”‚   â”‚  187 â”‚     </ScrollViewer>
â”‚   â”‚   â”‚  188 â”‚ </UserControl>
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ SettingsView.xaml.cs (2.41 KB, 2025-03-12 15:03:18)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: SettingsView.xaml.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚   â”‚   â”‚    2 â”‚ using Avalonia.Markup.Xaml;
â”‚   â”‚   â”‚    3 â”‚ using test.ViewModels;
â”‚   â”‚   â”‚    4 â”‚ using System;
â”‚   â”‚   â”‚    5 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚    7 â”‚ namespace test.Views
â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚    9 â”‚     public partial class SettingsView : UserControl
â”‚   â”‚   â”‚   10 â”‚     {
â”‚   â”‚   â”‚   11 â”‚         private readonly ILogger<SettingsView> _logger;
â”‚   â”‚   â”‚   12 â”‚ 
â”‚   â”‚   â”‚   13 â”‚         // Default constructor for XAML designer and when created without DI
â”‚   â”‚   â”‚   14 â”‚         public SettingsView()
â”‚   â”‚   â”‚   15 â”‚         {
â”‚   â”‚   â”‚   16 â”‚             try
â”‚   â”‚   â”‚   17 â”‚             {
â”‚   â”‚   â”‚   18 â”‚                 InitializeComponent();
â”‚   â”‚   â”‚   19 â”‚             }
â”‚   â”‚   â”‚   20 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   21 â”‚             {
â”‚   â”‚   â”‚   22 â”‚                 // Can't log here since logger is null
â”‚   â”‚   â”‚   23 â”‚                 Console.WriteLine($"Error in SettingsView constructor: {ex.Message}");
â”‚   â”‚   â”‚   24 â”‚             }
â”‚   â”‚   â”‚   25 â”‚         }
â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   27 â”‚         // Constructor that accepts a logger and view model
â”‚   â”‚   â”‚   28 â”‚         public SettingsView(SettingsViewModel viewModel, ILogger<SettingsView> logger = null)
â”‚   â”‚   â”‚   29 â”‚         {
â”‚   â”‚   â”‚   30 â”‚             _logger = logger;
â”‚   â”‚   â”‚   31 â”‚ 
â”‚   â”‚   â”‚   32 â”‚             try
â”‚   â”‚   â”‚   33 â”‚             {
â”‚   â”‚   â”‚   34 â”‚                 // Set the DataContext first
â”‚   â”‚   â”‚   35 â”‚                 DataContext = viewModel;
â”‚   â”‚   â”‚   36 â”‚                 _logger?.LogInformation("SettingsView created with ViewModel: {ViewModel}", viewModel != null ? "provided" : "null");
â”‚   â”‚   â”‚   37 â”‚ 
â”‚   â”‚   â”‚   38 â”‚                 InitializeComponent();
â”‚   â”‚   â”‚   39 â”‚             }
â”‚   â”‚   â”‚   40 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   41 â”‚             {
â”‚   â”‚   â”‚   42 â”‚                 _logger?.LogError(ex, "Error in SettingsView constructor");
â”‚   â”‚   â”‚   43 â”‚             }
â”‚   â”‚   â”‚   44 â”‚         }
â”‚   â”‚   â”‚   45 â”‚ 
â”‚   â”‚   â”‚   46 â”‚         private void InitializeComponent()
â”‚   â”‚   â”‚   47 â”‚         {
â”‚   â”‚   â”‚   48 â”‚             try
â”‚   â”‚   â”‚   49 â”‚             {
â”‚   â”‚   â”‚   50 â”‚                 AvaloniaXamlLoader.Load(this);
â”‚   â”‚   â”‚   51 â”‚                 _logger?.LogDebug("SettingsView component initialized successfully");
â”‚   â”‚   â”‚   52 â”‚             }
â”‚   â”‚   â”‚   53 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   54 â”‚             {
â”‚   â”‚   â”‚   55 â”‚                 _logger?.LogError(ex, "Error in InitializeComponent");
â”‚   â”‚   â”‚   56 â”‚                 // Also write to console as a fallback
â”‚   â”‚   â”‚   57 â”‚                 Console.WriteLine($"Error in SettingsView.InitializeComponent: {ex.Message}");
â”‚   â”‚   â”‚   58 â”‚             }
â”‚   â”‚   â”‚   59 â”‚         }
â”‚   â”‚   â”‚   60 â”‚ 
â”‚   â”‚   â”‚   61 â”‚         // Override OnDataContextChanged to log when the DataContext changes
â”‚   â”‚   â”‚   62 â”‚         protected override void OnDataContextChanged(EventArgs e)
â”‚   â”‚   â”‚   63 â”‚         {
â”‚   â”‚   â”‚   64 â”‚             base.OnDataContextChanged(e);
â”‚   â”‚   â”‚   65 â”‚             
â”‚   â”‚   â”‚   66 â”‚             try
â”‚   â”‚   â”‚   67 â”‚             {
â”‚   â”‚   â”‚   68 â”‚                 _logger?.LogDebug("SettingsView DataContext changed to: {Type}", 
â”‚   â”‚   â”‚   69 â”‚                     DataContext?.GetType().Name ?? "null");
â”‚   â”‚   â”‚   70 â”‚             }
â”‚   â”‚   â”‚   71 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   72 â”‚             {
â”‚   â”‚   â”‚   73 â”‚                 _logger?.LogError(ex, "Error in OnDataContextChanged");
â”‚   â”‚   â”‚   74 â”‚             }
â”‚   â”‚   â”‚   75 â”‚         }
â”‚   â”‚   â”‚   76 â”‚     }
â”‚   â”‚   â”‚   77 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â””â”€â”€ ğŸ“„ TextInputDialog.cs (4.89 KB, 2025-03-12 11:45:11)
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚ FILE CONTENT: TextInputDialog.cs
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚    1 â”‚ ï»¿using Avalonia;
â”‚       â”‚    2 â”‚ using Avalonia.Controls;
â”‚       â”‚    3 â”‚ using Avalonia.Layout;
â”‚       â”‚    4 â”‚ using Avalonia.Media;
â”‚       â”‚    5 â”‚ using SukiUI.Controls;
â”‚       â”‚    6 â”‚ using System.Threading.Tasks;
â”‚       â”‚    7 â”‚ 
â”‚       â”‚    8 â”‚ namespace test.Views
â”‚       â”‚    9 â”‚ {
â”‚       â”‚   10 â”‚     /// <summary>
â”‚       â”‚   11 â”‚     /// A dialog for text input with SukiUI styling
â”‚       â”‚   12 â”‚     /// </summary>
â”‚       â”‚   13 â”‚     public class TextInputDialog
â”‚       â”‚   14 â”‚     {
â”‚       â”‚   15 â”‚         /// <summary>
â”‚       â”‚   16 â”‚         /// The dialog title
â”‚       â”‚   17 â”‚         /// </summary>
â”‚       â”‚   18 â”‚         public string Title { get; set; } = "Input";
â”‚       â”‚   19 â”‚ 
â”‚       â”‚   20 â”‚         /// <summary>
â”‚       â”‚   21 â”‚         /// The message to display
â”‚       â”‚   22 â”‚         /// </summary>
â”‚       â”‚   23 â”‚         public string Message { get; set; } = "Please enter a value:";
â”‚       â”‚   24 â”‚ 
â”‚       â”‚   25 â”‚         /// <summary>
â”‚       â”‚   26 â”‚         /// The default value for the input
â”‚       â”‚   27 â”‚         /// </summary>
â”‚       â”‚   28 â”‚         public string DefaultValue { get; set; } = "";
â”‚       â”‚   29 â”‚ 
â”‚       â”‚   30 â”‚         /// <summary>
â”‚       â”‚   31 â”‚         /// The placeholder text for the input field
â”‚       â”‚   32 â”‚         /// </summary>
â”‚       â”‚   33 â”‚         public string Placeholder { get; set; } = "";
â”‚       â”‚   34 â”‚ 
â”‚       â”‚   35 â”‚         /// <summary>
â”‚       â”‚   36 â”‚         /// Whether to enable OK button even when the input is empty
â”‚       â”‚   37 â”‚         /// </summary>
â”‚       â”‚   38 â”‚         public bool AllowEmpty { get; set; } = false;
â”‚       â”‚   39 â”‚ 
â”‚       â”‚   40 â”‚         /// <summary>
â”‚       â”‚   41 â”‚         /// Shows the dialog and waits for user input
â”‚       â”‚   42 â”‚         /// </summary>
â”‚       â”‚   43 â”‚         /// <param name="parent">The parent window</param>
â”‚       â”‚   44 â”‚         /// <returns>The entered value or null if cancelled</returns>
â”‚       â”‚   45 â”‚         public async Task<string> ShowAsync(Window parent)
â”‚       â”‚   46 â”‚         {
â”‚       â”‚   47 â”‚             // Create the dialog window with SukiUI styling
â”‚       â”‚   48 â”‚             var dialog = new SukiWindow
â”‚       â”‚   49 â”‚             {
â”‚       â”‚   50 â”‚                 Title = Title,
â”‚       â”‚   51 â”‚                 Width = 400,
â”‚       â”‚   52 â”‚                 Height = 200,
â”‚       â”‚   53 â”‚                 WindowStartupLocation = WindowStartupLocation.CenterOwner
â”‚       â”‚   54 â”‚             };
â”‚       â”‚   55 â”‚ 
â”‚       â”‚   56 â”‚             var mainPanel = new StackPanel
â”‚       â”‚   57 â”‚             {
â”‚       â”‚   58 â”‚                 Margin = new Thickness(20)
â”‚       â”‚   59 â”‚             };
â”‚       â”‚   60 â”‚ 
â”‚       â”‚   61 â”‚             // Add message
â”‚       â”‚   62 â”‚             if (!string.IsNullOrEmpty(Message))
â”‚       â”‚   63 â”‚             {
â”‚       â”‚   64 â”‚                 mainPanel.Children.Add(new TextBlock
â”‚       â”‚   65 â”‚                 {
â”‚       â”‚   66 â”‚                     Text = Message,
â”‚       â”‚   67 â”‚                     TextWrapping = TextWrapping.Wrap,
â”‚       â”‚   68 â”‚                     Margin = new Thickness(0, 0, 0, 10)
â”‚       â”‚   69 â”‚                 });
â”‚       â”‚   70 â”‚             }
â”‚       â”‚   71 â”‚ 
â”‚       â”‚   72 â”‚             // Add input field
â”‚       â”‚   73 â”‚             var textBox = new TextBox
â”‚       â”‚   74 â”‚             {
â”‚       â”‚   75 â”‚                 Text = DefaultValue,
â”‚       â”‚   76 â”‚                 Watermark = Placeholder,
â”‚       â”‚   77 â”‚                 Margin = new Thickness(0, 0, 0, 20)
â”‚       â”‚   78 â”‚             };
â”‚       â”‚   79 â”‚             mainPanel.Children.Add(textBox);
â”‚       â”‚   80 â”‚ 
â”‚       â”‚   81 â”‚             // Create button panel
â”‚       â”‚   82 â”‚             var buttonPanel = new StackPanel
â”‚       â”‚   83 â”‚             {
â”‚       â”‚   84 â”‚                 Orientation = Orientation.Horizontal,
â”‚       â”‚   85 â”‚                 HorizontalAlignment = HorizontalAlignment.Right,
â”‚       â”‚   86 â”‚                 Spacing = 10
â”‚       â”‚   87 â”‚             };
â”‚       â”‚   88 â”‚ 
â”‚       â”‚   89 â”‚             // Add cancel button
â”‚       â”‚   90 â”‚             var cancelButton = new Button
â”‚       â”‚   91 â”‚             {
â”‚       â”‚   92 â”‚                 Content = "Cancel",
â”‚       â”‚   93 â”‚                 Classes = { "Basic" },
â”‚       â”‚   94 â”‚                 MinWidth = 80
â”‚       â”‚   95 â”‚             };
â”‚       â”‚   96 â”‚ 
â”‚       â”‚   97 â”‚             // Add OK button
â”‚       â”‚   98 â”‚             var okButton = new Button
â”‚       â”‚   99 â”‚             {
â”‚       â”‚  100 â”‚                 Content = "OK",
â”‚       â”‚  101 â”‚                 Classes = { "Accent" },
â”‚       â”‚  102 â”‚                 MinWidth = 80,
â”‚       â”‚  103 â”‚                 IsEnabled = !string.IsNullOrEmpty(DefaultValue) || AllowEmpty
â”‚       â”‚  104 â”‚             };
â”‚       â”‚  105 â”‚ 
â”‚       â”‚  106 â”‚             // Handle text changes to enable/disable OK button
â”‚       â”‚  107 â”‚             if (!AllowEmpty)
â”‚       â”‚  108 â”‚             {
â”‚       â”‚  109 â”‚                 textBox.PropertyChanged += (s, e) =>
â”‚       â”‚  110 â”‚                 {
â”‚       â”‚  111 â”‚                     if (e.Property.Name == nameof(TextBox.Text))
â”‚       â”‚  112 â”‚                     {
â”‚       â”‚  113 â”‚                         okButton.IsEnabled = !string.IsNullOrEmpty(textBox.Text);
â”‚       â”‚  114 â”‚                     }
â”‚       â”‚  115 â”‚                 };
â”‚       â”‚  116 â”‚             }
â”‚       â”‚  117 â”‚ 
â”‚       â”‚  118 â”‚             // Set up result capturing
â”‚       â”‚  119 â”‚             string result = null;
â”‚       â”‚  120 â”‚ 
â”‚       â”‚  121 â”‚             // Set up button handlers
â”‚       â”‚  122 â”‚             okButton.Click += (s, e) =>
â”‚       â”‚  123 â”‚             {
â”‚       â”‚  124 â”‚                 result = textBox.Text;
â”‚       â”‚  125 â”‚                 dialog.Close();
â”‚       â”‚  126 â”‚             };
â”‚       â”‚  127 â”‚ 
â”‚       â”‚  128 â”‚             cancelButton.Click += (s, e) =>
â”‚       â”‚  129 â”‚             {
â”‚       â”‚  130 â”‚                 dialog.Close();
â”‚       â”‚  131 â”‚             };
â”‚       â”‚  132 â”‚ 
â”‚       â”‚  133 â”‚             // Add buttons to panel
â”‚       â”‚  134 â”‚             buttonPanel.Children.Add(cancelButton);
â”‚       â”‚  135 â”‚             buttonPanel.Children.Add(okButton);
â”‚       â”‚  136 â”‚             mainPanel.Children.Add(buttonPanel);
â”‚       â”‚  137 â”‚ 
â”‚       â”‚  138 â”‚             // Add keyboard navigation
â”‚       â”‚  139 â”‚             textBox.KeyDown += (s, e) =>
â”‚       â”‚  140 â”‚             {
â”‚       â”‚  141 â”‚                 if (e.Key == Avalonia.Input.Key.Enter && okButton.IsEnabled)
â”‚       â”‚  142 â”‚                 {
â”‚       â”‚  143 â”‚                     result = textBox.Text;
â”‚       â”‚  144 â”‚                     dialog.Close();
â”‚       â”‚  145 â”‚                 }
â”‚       â”‚  146 â”‚                 else if (e.Key == Avalonia.Input.Key.Escape)
â”‚       â”‚  147 â”‚                 {
â”‚       â”‚  148 â”‚                     dialog.Close();
â”‚       â”‚  149 â”‚                 }
â”‚       â”‚  150 â”‚             };
â”‚       â”‚  151 â”‚ 
â”‚       â”‚  152 â”‚             // Set dialog content
â”‚       â”‚  153 â”‚             dialog.Content = new GlassCard
â”‚       â”‚  154 â”‚             {
â”‚       â”‚  155 â”‚                 Content = mainPanel,
â”‚       â”‚  156 â”‚                 Margin = new Thickness(10)
â”‚       â”‚  157 â”‚             };
â”‚       â”‚  158 â”‚ 
â”‚       â”‚  159 â”‚             // Show dialog
â”‚       â”‚  160 â”‚             await dialog.ShowDialog(parent);
â”‚       â”‚  161 â”‚ 
â”‚       â”‚  162 â”‚             // Return result (null if cancelled)
â”‚       â”‚  163 â”‚             return result;
â”‚       â”‚  164 â”‚         }
â”‚       â”‚  165 â”‚     }
â”‚       â”‚  166 â”‚ }
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   ğŸ“ ViewModels
â”‚   â”œâ”€â”€ ğŸ“„ ComparisonDemoViewModel.cs (14.22 KB, 2025-03-12 07:48:31)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ComparisonDemoViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚    3 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚    4 â”‚ using System.IO;
â”‚   â”‚   â”‚    5 â”‚ using System.Linq;
â”‚   â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    7 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚   â”‚   â”‚    8 â”‚ using test.Application.Services;
â”‚   â”‚   â”‚    9 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   10 â”‚ using test.Core.Dto;
â”‚   â”‚   â”‚   11 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   12 â”‚ using Avalonia.Controls;
â”‚   â”‚   â”‚   13 â”‚ 
â”‚   â”‚   â”‚   14 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   15 â”‚ {
â”‚   â”‚   â”‚   16 â”‚     /// <summary>
â”‚   â”‚   â”‚   17 â”‚     /// A simple view model for demonstrating the use of ComparisonService
â”‚   â”‚   â”‚   18 â”‚     /// This is just a proof of concept, not intended for production use
â”‚   â”‚   â”‚   19 â”‚     /// </summary>
â”‚   â”‚   â”‚   20 â”‚     public class ComparisonDemoViewModel : ViewModelBase
â”‚   â”‚   â”‚   21 â”‚     {
â”‚   â”‚   â”‚   22 â”‚         private readonly IComparisonService _comparisonService;
â”‚   â”‚   â”‚   23 â”‚         private readonly IDialogService _dialogService;
â”‚   â”‚   â”‚   24 â”‚         private readonly ControllerService _controllerService;
â”‚   â”‚   â”‚   25 â”‚ 
â”‚   â”‚   â”‚   26 â”‚         private string _selectedSessionId;
â”‚   â”‚   â”‚   27 â”‚         private string _xmlFilePath;
â”‚   â”‚   â”‚   28 â”‚         private string _comparisonResultSummary;
â”‚   â”‚   â”‚   29 â”‚         private ObservableCollection<string> _availableSessions = new();
â”‚   â”‚   â”‚   30 â”‚         private ObservableCollection<Controller> _controllers = new();
â”‚   â”‚   â”‚   31 â”‚         private ObservableCollection<ComparisonResult> _comparisonResults = new();
â”‚   â”‚   â”‚   32 â”‚         private ObservableCollection<SimilarityResultDto> _similarityResults = new(); // Changed from SimilarityResult to SimilarityResultDto
â”‚   â”‚   â”‚   33 â”‚         private double _minimumSimilarity = 0.7;
â”‚   â”‚   â”‚   34 â”‚         private bool _returnBestMatchesRegardless;
â”‚   â”‚   â”‚   35 â”‚         private int _numberOfGroupsToMatch = 3;
â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   37 â”‚         /// <summary>
â”‚   â”‚   â”‚   38 â”‚         /// Available sessions
â”‚   â”‚   â”‚   39 â”‚         /// </summary>
â”‚   â”‚   â”‚   40 â”‚         public ObservableCollection<string> AvailableSessions
â”‚   â”‚   â”‚   41 â”‚         {
â”‚   â”‚   â”‚   42 â”‚             get => _availableSessions;
â”‚   â”‚   â”‚   43 â”‚             set => SetProperty(ref _availableSessions, value);
â”‚   â”‚   â”‚   44 â”‚         }
â”‚   â”‚   â”‚   45 â”‚ 
â”‚   â”‚   â”‚   46 â”‚         /// <summary>
â”‚   â”‚   â”‚   47 â”‚         /// Selected session ID
â”‚   â”‚   â”‚   48 â”‚         /// </summary>
â”‚   â”‚   â”‚   49 â”‚         public string SelectedSessionId
â”‚   â”‚   â”‚   50 â”‚         {
â”‚   â”‚   â”‚   51 â”‚             get => _selectedSessionId;
â”‚   â”‚   â”‚   52 â”‚             set
â”‚   â”‚   â”‚   53 â”‚             {
â”‚   â”‚   â”‚   54 â”‚                 if (SetProperty(ref _selectedSessionId, value))
â”‚   â”‚   â”‚   55 â”‚                 {
â”‚   â”‚   â”‚   56 â”‚                     LoadSessionDataCommand.ExecuteAsync(null);
â”‚   â”‚   â”‚   57 â”‚                 }
â”‚   â”‚   â”‚   58 â”‚             }
â”‚   â”‚   â”‚   59 â”‚         }
â”‚   â”‚   â”‚   60 â”‚ 
â”‚   â”‚   â”‚   61 â”‚         /// <summary>
â”‚   â”‚   â”‚   62 â”‚         /// Controllers in selected session
â”‚   â”‚   â”‚   63 â”‚         /// </summary>
â”‚   â”‚   â”‚   64 â”‚         public ObservableCollection<Controller> Controllers
â”‚   â”‚   â”‚   65 â”‚         {
â”‚   â”‚   â”‚   66 â”‚             get => _controllers;
â”‚   â”‚   â”‚   67 â”‚             set => SetProperty(ref _controllers, value);
â”‚   â”‚   â”‚   68 â”‚         }
â”‚   â”‚   â”‚   69 â”‚ 
â”‚   â”‚   â”‚   70 â”‚         /// <summary>
â”‚   â”‚   â”‚   71 â”‚         /// XML file path
â”‚   â”‚   â”‚   72 â”‚         /// </summary>
â”‚   â”‚   â”‚   73 â”‚         public string XmlFilePath
â”‚   â”‚   â”‚   74 â”‚         {
â”‚   â”‚   â”‚   75 â”‚             get => _xmlFilePath;
â”‚   â”‚   â”‚   76 â”‚             set => SetProperty(ref _xmlFilePath, value);
â”‚   â”‚   â”‚   77 â”‚         }
â”‚   â”‚   â”‚   78 â”‚ 
â”‚   â”‚   â”‚   79 â”‚         /// <summary>
â”‚   â”‚   â”‚   80 â”‚         /// Comparison results
â”‚   â”‚   â”‚   81 â”‚         /// </summary>
â”‚   â”‚   â”‚   82 â”‚         public ObservableCollection<ComparisonResult> ComparisonResults
â”‚   â”‚   â”‚   83 â”‚         {
â”‚   â”‚   â”‚   84 â”‚             get => _comparisonResults;
â”‚   â”‚   â”‚   85 â”‚             set => SetProperty(ref _comparisonResults, value);
â”‚   â”‚   â”‚   86 â”‚         }
â”‚   â”‚   â”‚   87 â”‚ 
â”‚   â”‚   â”‚   88 â”‚         /// <summary>
â”‚   â”‚   â”‚   89 â”‚         /// Similarity results
â”‚   â”‚   â”‚   90 â”‚         /// </summary>
â”‚   â”‚   â”‚   91 â”‚         public ObservableCollection<SimilarityResultDto> SimilarityResults // Changed from SimilarityResult to SimilarityResultDto
â”‚   â”‚   â”‚   92 â”‚         {
â”‚   â”‚   â”‚   93 â”‚             get => _similarityResults;
â”‚   â”‚   â”‚   94 â”‚             set => SetProperty(ref _similarityResults, value);
â”‚   â”‚   â”‚   95 â”‚         }
â”‚   â”‚   â”‚   96 â”‚ 
â”‚   â”‚   â”‚   97 â”‚         /// <summary>
â”‚   â”‚   â”‚   98 â”‚         /// Summary of comparison results
â”‚   â”‚   â”‚   99 â”‚         /// </summary>
â”‚   â”‚   â”‚  100 â”‚         public string ComparisonResultSummary
â”‚   â”‚   â”‚  101 â”‚         {
â”‚   â”‚   â”‚  102 â”‚             get => _comparisonResultSummary;
â”‚   â”‚   â”‚  103 â”‚             set => SetProperty(ref _comparisonResultSummary, value);
â”‚   â”‚   â”‚  104 â”‚         }
â”‚   â”‚   â”‚  105 â”‚ 
â”‚   â”‚   â”‚  106 â”‚         /// <summary>
â”‚   â”‚   â”‚  107 â”‚         /// Minimum similarity threshold
â”‚   â”‚   â”‚  108 â”‚         /// </summary>
â”‚   â”‚   â”‚  109 â”‚         public double MinimumSimilarity
â”‚   â”‚   â”‚  110 â”‚         {
â”‚   â”‚   â”‚  111 â”‚             get => _minimumSimilarity;
â”‚   â”‚   â”‚  112 â”‚             set => SetProperty(ref _minimumSimilarity, value);
â”‚   â”‚   â”‚  113 â”‚         }
â”‚   â”‚   â”‚  114 â”‚ 
â”‚   â”‚   â”‚  115 â”‚         /// <summary>
â”‚   â”‚   â”‚  116 â”‚         /// Whether to return best matches regardless of threshold
â”‚   â”‚   â”‚  117 â”‚         /// </summary>
â”‚   â”‚   â”‚  118 â”‚         public bool ReturnBestMatchesRegardless
â”‚   â”‚   â”‚  119 â”‚         {
â”‚   â”‚   â”‚  120 â”‚             get => _returnBestMatchesRegardless;
â”‚   â”‚   â”‚  121 â”‚             set => SetProperty(ref _returnBestMatchesRegardless, value);
â”‚   â”‚   â”‚  122 â”‚         }
â”‚   â”‚   â”‚  123 â”‚ 
â”‚   â”‚   â”‚  124 â”‚         /// <summary>
â”‚   â”‚   â”‚  125 â”‚         /// Number of groups to match
â”‚   â”‚   â”‚  126 â”‚         /// </summary>
â”‚   â”‚   â”‚  127 â”‚         public int NumberOfGroupsToMatch
â”‚   â”‚   â”‚  128 â”‚         {
â”‚   â”‚   â”‚  129 â”‚             get => _numberOfGroupsToMatch;
â”‚   â”‚   â”‚  130 â”‚             set => SetProperty(ref _numberOfGroupsToMatch, value);
â”‚   â”‚   â”‚  131 â”‚         }
â”‚   â”‚   â”‚  132 â”‚ 
â”‚   â”‚   â”‚  133 â”‚         /// <summary>
â”‚   â”‚   â”‚  134 â”‚         /// Command to load available sessions
â”‚   â”‚   â”‚  135 â”‚         /// </summary>
â”‚   â”‚   â”‚  136 â”‚         public IAsyncRelayCommand LoadSessionsCommand { get; }
â”‚   â”‚   â”‚  137 â”‚ 
â”‚   â”‚   â”‚  138 â”‚         /// <summary>
â”‚   â”‚   â”‚  139 â”‚         /// Command to load data from selected session
â”‚   â”‚   â”‚  140 â”‚         /// </summary>
â”‚   â”‚   â”‚  141 â”‚         public IAsyncRelayCommand LoadSessionDataCommand { get; }
â”‚   â”‚   â”‚  142 â”‚ 
â”‚   â”‚   â”‚  143 â”‚         /// <summary>
â”‚   â”‚   â”‚  144 â”‚         /// Command to select XML file
â”‚   â”‚   â”‚  145 â”‚         /// </summary>
â”‚   â”‚   â”‚  146 â”‚         public IAsyncRelayCommand SelectXmlFileCommand { get; }
â”‚   â”‚   â”‚  147 â”‚ 
â”‚   â”‚   â”‚  148 â”‚         /// <summary>
â”‚   â”‚   â”‚  149 â”‚         /// Command to compare controllers with XML
â”‚   â”‚   â”‚  150 â”‚         /// </summary>
â”‚   â”‚   â”‚  151 â”‚         public IAsyncRelayCommand CompareWithXmlCommand { get; }
â”‚   â”‚   â”‚  152 â”‚ 
â”‚   â”‚   â”‚  153 â”‚         /// <summary>
â”‚   â”‚   â”‚  154 â”‚         /// Command to find similar controllers
â”‚   â”‚   â”‚  155 â”‚         /// </summary>
â”‚   â”‚   â”‚  156 â”‚         public IAsyncRelayCommand FindSimilarControllersCommand { get; }
â”‚   â”‚   â”‚  157 â”‚ 
â”‚   â”‚   â”‚  158 â”‚         /// <summary>
â”‚   â”‚   â”‚  159 â”‚         /// Command to generate modified XML
â”‚   â”‚   â”‚  160 â”‚         /// </summary>
â”‚   â”‚   â”‚  161 â”‚         public IAsyncRelayCommand<Controller> GenerateModifiedXmlCommand { get; }
â”‚   â”‚   â”‚  162 â”‚ 
â”‚   â”‚   â”‚  163 â”‚         /// <summary>
â”‚   â”‚   â”‚  164 â”‚         /// Creates a new comparison demo view model
â”‚   â”‚   â”‚  165 â”‚         /// </summary>
â”‚   â”‚   â”‚  166 â”‚         /// <param name="comparisonService">The comparison service</param>
â”‚   â”‚   â”‚  167 â”‚         /// <param name="dialogService">The dialog service</param>
â”‚   â”‚   â”‚  168 â”‚         /// <param name="controllerService">The controller service</param>
â”‚   â”‚   â”‚  169 â”‚         public ComparisonDemoViewModel(
â”‚   â”‚   â”‚  170 â”‚             IComparisonService comparisonService,
â”‚   â”‚   â”‚  171 â”‚             IDialogService dialogService,
â”‚   â”‚   â”‚  172 â”‚             ControllerService controllerService)
â”‚   â”‚   â”‚  173 â”‚         {
â”‚   â”‚   â”‚  174 â”‚             _comparisonService = comparisonService ?? throw new ArgumentNullException(nameof(comparisonService));
â”‚   â”‚   â”‚  175 â”‚             _dialogService = dialogService ?? throw new ArgumentNullException(nameof(dialogService));
â”‚   â”‚   â”‚  176 â”‚             _controllerService = controllerService ?? throw new ArgumentNullException(nameof(controllerService));
â”‚   â”‚   â”‚  177 â”‚ 
â”‚   â”‚   â”‚  178 â”‚             // Initialize commands
â”‚   â”‚   â”‚  179 â”‚             LoadSessionsCommand = new AsyncRelayCommand(LoadSessionsAsync);
â”‚   â”‚   â”‚  180 â”‚             LoadSessionDataCommand = new AsyncRelayCommand(LoadSessionDataAsync);
â”‚   â”‚   â”‚  181 â”‚             SelectXmlFileCommand = new AsyncRelayCommand(SelectXmlFileAsync);
â”‚   â”‚   â”‚  182 â”‚             CompareWithXmlCommand = new AsyncRelayCommand(CompareWithXmlAsync, CanCompareWithXml);
â”‚   â”‚   â”‚  183 â”‚             FindSimilarControllersCommand = new AsyncRelayCommand(FindSimilarControllersAsync, CanFindSimilarControllers);
â”‚   â”‚   â”‚  184 â”‚             GenerateModifiedXmlCommand = new AsyncRelayCommand<Controller>(GenerateModifiedXmlAsync, CanGenerateModifiedXml);
â”‚   â”‚   â”‚  185 â”‚ 
â”‚   â”‚   â”‚  186 â”‚             // Load sessions on startup
â”‚   â”‚   â”‚  187 â”‚             LoadSessionsCommand.ExecuteAsync(null);
â”‚   â”‚   â”‚  188 â”‚         }
â”‚   â”‚   â”‚  189 â”‚ 
â”‚   â”‚   â”‚  190 â”‚         /// <summary>
â”‚   â”‚   â”‚  191 â”‚         /// Loads available sessions
â”‚   â”‚   â”‚  192 â”‚         /// </summary>
â”‚   â”‚   â”‚  193 â”‚         private async Task LoadSessionsAsync()
â”‚   â”‚   â”‚  194 â”‚         {
â”‚   â”‚   â”‚  195 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  196 â”‚             {
â”‚   â”‚   â”‚  197 â”‚                 var sessions = await _controllerService.GetAllSessionsAsync();
â”‚   â”‚   â”‚  198 â”‚                 AvailableSessions.Clear();
â”‚   â”‚   â”‚  199 â”‚ 
â”‚   â”‚   â”‚  200 â”‚                 foreach (var session in sessions)
â”‚   â”‚   â”‚  201 â”‚                 {
â”‚   â”‚   â”‚  202 â”‚                     AvailableSessions.Add(session.SessionId);
â”‚   â”‚   â”‚  203 â”‚                 }
â”‚   â”‚   â”‚  204 â”‚ 
â”‚   â”‚   â”‚  205 â”‚                 if (AvailableSessions.Any())
â”‚   â”‚   â”‚  206 â”‚                 {
â”‚   â”‚   â”‚  207 â”‚                     SelectedSessionId = AvailableSessions.First();
â”‚   â”‚   â”‚  208 â”‚                 }
â”‚   â”‚   â”‚  209 â”‚             }, "Sessions loaded successfully", "Failed to load sessions");
â”‚   â”‚   â”‚  210 â”‚         }
â”‚   â”‚   â”‚  211 â”‚ 
â”‚   â”‚   â”‚  212 â”‚         /// <summary>
â”‚   â”‚   â”‚  213 â”‚         /// Loads data from selected session
â”‚   â”‚   â”‚  214 â”‚         /// </summary>
â”‚   â”‚   â”‚  215 â”‚         private async Task LoadSessionDataAsync()
â”‚   â”‚   â”‚  216 â”‚         {
â”‚   â”‚   â”‚  217 â”‚             if (string.IsNullOrEmpty(SelectedSessionId))
â”‚   â”‚   â”‚  218 â”‚                 return;
â”‚   â”‚   â”‚  219 â”‚ 
â”‚   â”‚   â”‚  220 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  221 â”‚             {
â”‚   â”‚   â”‚  222 â”‚                 var controllers = await _controllerService.GetControllersBySessionAsync(SelectedSessionId);
â”‚   â”‚   â”‚  223 â”‚                 Controllers = new ObservableCollection<Controller>(controllers);
â”‚   â”‚   â”‚  224 â”‚             }, "Session data loaded successfully", "Failed to load session data");
â”‚   â”‚   â”‚  225 â”‚         }
â”‚   â”‚   â”‚  226 â”‚ 
â”‚   â”‚   â”‚  227 â”‚         /// <summary>
â”‚   â”‚   â”‚  228 â”‚         /// Selects XML file
â”‚   â”‚   â”‚  229 â”‚         /// </summary>
â”‚   â”‚   â”‚  230 â”‚         private async Task SelectXmlFileAsync()
â”‚   â”‚   â”‚  231 â”‚         {
â”‚   â”‚   â”‚  232 â”‚             var filters = new List<FileDialogFilter>
â”‚   â”‚   â”‚  233 â”‚             {
â”‚   â”‚   â”‚  234 â”‚                 new FileDialogFilter
â”‚   â”‚   â”‚  235 â”‚                 {
â”‚   â”‚   â”‚  236 â”‚                     Name = "XML Files",
â”‚   â”‚   â”‚  237 â”‚                     Extensions = new List<string> { "xml" }
â”‚   â”‚   â”‚  238 â”‚                 }
â”‚   â”‚   â”‚  239 â”‚             };
â”‚   â”‚   â”‚  240 â”‚ 
â”‚   â”‚   â”‚  241 â”‚             var filePath = await _dialogService.ShowOpenFileDialogAsync(
â”‚   â”‚   â”‚  242 â”‚                 "Select XML File",
â”‚   â”‚   â”‚  243 â”‚                 filters);
â”‚   â”‚   â”‚  244 â”‚ 
â”‚   â”‚   â”‚  245 â”‚             if (filePath?.Length > 0)
â”‚   â”‚   â”‚  246 â”‚             {
â”‚   â”‚   â”‚  247 â”‚                 XmlFilePath = filePath[0];
â”‚   â”‚   â”‚  248 â”‚                 CompareWithXmlCommand.NotifyCanExecuteChanged();
â”‚   â”‚   â”‚  249 â”‚                 FindSimilarControllersCommand.NotifyCanExecuteChanged();
â”‚   â”‚   â”‚  250 â”‚             }
â”‚   â”‚   â”‚  251 â”‚         }
â”‚   â”‚   â”‚  252 â”‚ 
â”‚   â”‚   â”‚  253 â”‚         /// <summary>
â”‚   â”‚   â”‚  254 â”‚         /// Compares controllers with XML
â”‚   â”‚   â”‚  255 â”‚         /// </summary>
â”‚   â”‚   â”‚  256 â”‚         private async Task CompareWithXmlAsync()
â”‚   â”‚   â”‚  257 â”‚         {
â”‚   â”‚   â”‚  258 â”‚             if (string.IsNullOrEmpty(XmlFilePath) || !Controllers.Any())
â”‚   â”‚   â”‚  259 â”‚                 return;
â”‚   â”‚   â”‚  260 â”‚ 
â”‚   â”‚   â”‚  261 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  262 â”‚             {
â”‚   â”‚   â”‚  263 â”‚                 // Read XML content
â”‚   â”‚   â”‚  264 â”‚                 var xmlContent = await File.ReadAllTextAsync(XmlFilePath);
â”‚   â”‚   â”‚  265 â”‚ 
â”‚   â”‚   â”‚  266 â”‚                 // Perform comparison
â”‚   â”‚   â”‚  267 â”‚                 var comparisons = await _comparisonService.CompareWithXmlAsync(xmlContent, Controllers);
â”‚   â”‚   â”‚  268 â”‚ 
â”‚   â”‚   â”‚  269 â”‚                 // Update UI
â”‚   â”‚   â”‚  270 â”‚                 ComparisonResults = new ObservableCollection<ComparisonResult>(comparisons);
â”‚   â”‚   â”‚  271 â”‚ 
â”‚   â”‚   â”‚  272 â”‚                 // Generate summary
â”‚   â”‚   â”‚  273 â”‚                 var matchCount = comparisons.Count(c => c.IsMatch);
â”‚   â”‚   â”‚  274 â”‚                 var totalCount = comparisons.Count();
â”‚   â”‚   â”‚  275 â”‚                 var matchPercentage = totalCount > 0 ? (double)matchCount / totalCount * 100 : 0;
â”‚   â”‚   â”‚  276 â”‚ 
â”‚   â”‚   â”‚  277 â”‚                 ComparisonResultSummary = $"Matched {matchCount} of {totalCount} values ({matchPercentage:F1}%)";
â”‚   â”‚   â”‚  278 â”‚             }, "Comparison completed successfully", "Failed to compare with XML");
â”‚   â”‚   â”‚  279 â”‚         }
â”‚   â”‚   â”‚  280 â”‚ 
â”‚   â”‚   â”‚  281 â”‚         /// <summary>
â”‚   â”‚   â”‚  282 â”‚         /// Finds similar controllers
â”‚   â”‚   â”‚  283 â”‚         /// </summary>
â”‚   â”‚   â”‚  284 â”‚         private async Task FindSimilarControllersAsync()
â”‚   â”‚   â”‚  285 â”‚         {
â”‚   â”‚   â”‚  286 â”‚             if (string.IsNullOrEmpty(XmlFilePath) || !Controllers.Any())
â”‚   â”‚   â”‚  287 â”‚                 return;
â”‚   â”‚   â”‚  288 â”‚ 
â”‚   â”‚   â”‚  289 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  290 â”‚             {
â”‚   â”‚   â”‚  291 â”‚                 // Read XML content
â”‚   â”‚   â”‚  292 â”‚                 var xmlContent = await File.ReadAllTextAsync(XmlFilePath);
â”‚   â”‚   â”‚  293 â”‚ 
â”‚   â”‚   â”‚  294 â”‚                 // Configure options
â”‚   â”‚   â”‚  295 â”‚                 var options = new GroupingOptions
â”‚   â”‚   â”‚  296 â”‚                 {
â”‚   â”‚   â”‚  297 â”‚                     MinimumSimilarityThreshold = MinimumSimilarity,
â”‚   â”‚   â”‚  298 â”‚                     ReturnBestMatchesRegardless = ReturnBestMatchesRegardless,
â”‚   â”‚   â”‚  299 â”‚                     NumberOfGroupsToMatch = NumberOfGroupsToMatch
â”‚   â”‚   â”‚  300 â”‚                 };
â”‚   â”‚   â”‚  301 â”‚ 
â”‚   â”‚   â”‚  302 â”‚                 // Find similar controllers
â”‚   â”‚   â”‚  303 â”‚                 var similarities = await _comparisonService.FindSimilarControllersAsync(xmlContent, Controllers, options);
â”‚   â”‚   â”‚  304 â”‚ 
â”‚   â”‚   â”‚  305 â”‚                 // Update UI 
â”‚   â”‚   â”‚  306 â”‚                 SimilarityResults = new ObservableCollection<SimilarityResultDto>(similarities); // Changed from SimilarityResult to SimilarityResultDto
â”‚   â”‚   â”‚  307 â”‚ 
â”‚   â”‚   â”‚  308 â”‚                 // Generate summary
â”‚   â”‚   â”‚  309 â”‚                 if (similarities.Any())
â”‚   â”‚   â”‚  310 â”‚                 {
â”‚   â”‚   â”‚  311 â”‚                     ComparisonResultSummary = $"Found {similarities.Count()} similar controller groups";
â”‚   â”‚   â”‚  312 â”‚                 }
â”‚   â”‚   â”‚  313 â”‚                 else
â”‚   â”‚   â”‚  314 â”‚                 {
â”‚   â”‚   â”‚  315 â”‚                     ComparisonResultSummary = "No similar controllers found";
â”‚   â”‚   â”‚  316 â”‚                 }
â”‚   â”‚   â”‚  317 â”‚             }, "Similarity search completed successfully", "Failed to find similar controllers");
â”‚   â”‚   â”‚  318 â”‚         }
â”‚   â”‚   â”‚  319 â”‚ 
â”‚   â”‚   â”‚  320 â”‚         /// <summary>
â”‚   â”‚   â”‚  321 â”‚         /// Generates modified XML
â”‚   â”‚   â”‚  322 â”‚         /// </summary>
â”‚   â”‚   â”‚  323 â”‚         private async Task GenerateModifiedXmlAsync(Controller controller)
â”‚   â”‚   â”‚  324 â”‚         {
â”‚   â”‚   â”‚  325 â”‚             if (controller == null || string.IsNullOrEmpty(XmlFilePath))
â”‚   â”‚   â”‚  326 â”‚                 return;
â”‚   â”‚   â”‚  327 â”‚ 
â”‚   â”‚   â”‚  328 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  329 â”‚             {
â”‚   â”‚   â”‚  330 â”‚                 // Read XML content
â”‚   â”‚   â”‚  331 â”‚                 var xmlContent = await File.ReadAllTextAsync(XmlFilePath);
â”‚   â”‚   â”‚  332 â”‚ 
â”‚   â”‚   â”‚  333 â”‚                 // Get target name
â”‚   â”‚   â”‚  334 â”‚                 var targetName = await _dialogService.ShowInputDialogAsync(
â”‚   â”‚   â”‚  335 â”‚                     "Target Name",
â”‚   â”‚   â”‚  336 â”‚                     "Enter target name for the modified XML:",
â”‚   â”‚   â”‚  337 â”‚                     controller.Name);
â”‚   â”‚   â”‚  338 â”‚ 
â”‚   â”‚   â”‚  339 â”‚                 if (string.IsNullOrEmpty(targetName))
â”‚   â”‚   â”‚  340 â”‚                     return;
â”‚   â”‚   â”‚  341 â”‚ 
â”‚   â”‚   â”‚  342 â”‚                 // Generate modified XML
â”‚   â”‚   â”‚  343 â”‚                 var modifiedXml = await _comparisonService.GenerateModifiedXmlAsync(xmlContent, controller, targetName);
â”‚   â”‚   â”‚  344 â”‚ 
â”‚   â”‚   â”‚  345 â”‚                 // Save modified XML
â”‚   â”‚   â”‚  346 â”‚                 var filters = new List<FileDialogFilter>
â”‚   â”‚   â”‚  347 â”‚                 {
â”‚   â”‚   â”‚  348 â”‚                     new FileDialogFilter
â”‚   â”‚   â”‚  349 â”‚                     {
â”‚   â”‚   â”‚  350 â”‚                         Name = "XML Files",
â”‚   â”‚   â”‚  351 â”‚                         Extensions = new List<string> { "xml" }
â”‚   â”‚   â”‚  352 â”‚                     }
â”‚   â”‚   â”‚  353 â”‚                 };
â”‚   â”‚   â”‚  354 â”‚ 
â”‚   â”‚   â”‚  355 â”‚                 var savePath = await _dialogService.ShowSaveFileDialogAsync(
â”‚   â”‚   â”‚  356 â”‚                     "Save Modified XML",
â”‚   â”‚   â”‚  357 â”‚                     "xml",
â”‚   â”‚   â”‚  358 â”‚                     filters);
â”‚   â”‚   â”‚  359 â”‚ 
â”‚   â”‚   â”‚  360 â”‚                 if (!string.IsNullOrEmpty(savePath))
â”‚   â”‚   â”‚  361 â”‚                 {
â”‚   â”‚   â”‚  362 â”‚                     await File.WriteAllTextAsync(savePath, modifiedXml);
â”‚   â”‚   â”‚  363 â”‚                     ComparisonResultSummary = $"Modified XML saved to {Path.GetFileName(savePath)}";
â”‚   â”‚   â”‚  364 â”‚                 }
â”‚   â”‚   â”‚  365 â”‚             }, "Modified XML generated successfully", "Failed to generate modified XML");
â”‚   â”‚   â”‚  366 â”‚         }
â”‚   â”‚   â”‚  367 â”‚ 
â”‚   â”‚   â”‚  368 â”‚         /// <summary>
â”‚   â”‚   â”‚  369 â”‚         /// Determines whether comparison is possible
â”‚   â”‚   â”‚  370 â”‚         /// </summary>
â”‚   â”‚   â”‚  371 â”‚         private bool CanCompareWithXml()
â”‚   â”‚   â”‚  372 â”‚         {
â”‚   â”‚   â”‚  373 â”‚             return !string.IsNullOrEmpty(XmlFilePath) && Controllers.Any();
â”‚   â”‚   â”‚  374 â”‚         }
â”‚   â”‚   â”‚  375 â”‚ 
â”‚   â”‚   â”‚  376 â”‚         /// <summary>
â”‚   â”‚   â”‚  377 â”‚         /// Determines whether similarity search is possible
â”‚   â”‚   â”‚  378 â”‚         /// </summary>
â”‚   â”‚   â”‚  379 â”‚         private bool CanFindSimilarControllers()
â”‚   â”‚   â”‚  380 â”‚         {
â”‚   â”‚   â”‚  381 â”‚             return !string.IsNullOrEmpty(XmlFilePath) && Controllers.Any();
â”‚   â”‚   â”‚  382 â”‚         }
â”‚   â”‚   â”‚  383 â”‚ 
â”‚   â”‚   â”‚  384 â”‚         /// <summary>
â”‚   â”‚   â”‚  385 â”‚         /// Determines whether XML modification is possible
â”‚   â”‚   â”‚  386 â”‚         /// </summary>
â”‚   â”‚   â”‚  387 â”‚         private bool CanGenerateModifiedXml(Controller controller)
â”‚   â”‚   â”‚  388 â”‚         {
â”‚   â”‚   â”‚  389 â”‚             return controller != null && !string.IsNullOrEmpty(XmlFilePath);
â”‚   â”‚   â”‚  390 â”‚         }
â”‚   â”‚   â”‚  391 â”‚     }
â”‚   â”‚   â”‚  392 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ExportDemoViewModel.cs (10.15 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ExportDemoViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚    3 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚    4 â”‚ using System.IO;
â”‚   â”‚   â”‚    5 â”‚ using System.Linq;
â”‚   â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    7 â”‚ using Avalonia.Controls;
â”‚   â”‚   â”‚    8 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚   â”‚   â”‚    9 â”‚ using test.Application.Services;
â”‚   â”‚   â”‚   10 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   11 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   12 â”‚ 
â”‚   â”‚   â”‚   13 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   14 â”‚ {
â”‚   â”‚   â”‚   15 â”‚     /// <summary>
â”‚   â”‚   â”‚   16 â”‚     /// A simple view model for demonstrating the use of ExportService
â”‚   â”‚   â”‚   17 â”‚     /// This is just a proof of concept, not intended for production use
â”‚   â”‚   â”‚   18 â”‚     /// </summary>
â”‚   â”‚   â”‚   19 â”‚     public class ExportDemoViewModel : ViewModelBase
â”‚   â”‚   â”‚   20 â”‚     {
â”‚   â”‚   â”‚   21 â”‚         private readonly IExportService _exportService;
â”‚   â”‚   â”‚   22 â”‚         private readonly IDialogService _dialogService;
â”‚   â”‚   â”‚   23 â”‚         private readonly ControllerService _controllerService;
â”‚   â”‚   â”‚   24 â”‚ 
â”‚   â”‚   â”‚   25 â”‚         private string _selectedSessionId;
â”‚   â”‚   â”‚   26 â”‚         private string _exportPath;
â”‚   â”‚   â”‚   27 â”‚         private ObservableCollection<string> _availableSessions = new();
â”‚   â”‚   â”‚   28 â”‚         private ObservableCollection<Controller> _controllers = new();
â”‚   â”‚   â”‚   29 â”‚         private ObservableCollection<ExportFormat> _exportFormats = new();
â”‚   â”‚   â”‚   30 â”‚         private ExportFormat _selectedFormat;
â”‚   â”‚   â”‚   31 â”‚         private int _controllerCount;
â”‚   â”‚   â”‚   32 â”‚         private int _objectCount;
â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   35 â”‚         /// Available sessions
â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   37 â”‚         public ObservableCollection<string> AvailableSessions
â”‚   â”‚   â”‚   38 â”‚         {
â”‚   â”‚   â”‚   39 â”‚             get => _availableSessions;
â”‚   â”‚   â”‚   40 â”‚             set => SetProperty(ref _availableSessions, value);
â”‚   â”‚   â”‚   41 â”‚         }
â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   43 â”‚         /// <summary>
â”‚   â”‚   â”‚   44 â”‚         /// Selected session ID
â”‚   â”‚   â”‚   45 â”‚         /// </summary>
â”‚   â”‚   â”‚   46 â”‚         public string SelectedSessionId
â”‚   â”‚   â”‚   47 â”‚         {
â”‚   â”‚   â”‚   48 â”‚             get => _selectedSessionId;
â”‚   â”‚   â”‚   49 â”‚             set
â”‚   â”‚   â”‚   50 â”‚             {
â”‚   â”‚   â”‚   51 â”‚                 if (SetProperty(ref _selectedSessionId, value))
â”‚   â”‚   â”‚   52 â”‚                 {
â”‚   â”‚   â”‚   53 â”‚                     LoadSessionDataCommand.ExecuteAsync(null);
â”‚   â”‚   â”‚   54 â”‚                 }
â”‚   â”‚   â”‚   55 â”‚             }
â”‚   â”‚   â”‚   56 â”‚         }
â”‚   â”‚   â”‚   57 â”‚ 
â”‚   â”‚   â”‚   58 â”‚         /// <summary>
â”‚   â”‚   â”‚   59 â”‚         /// Controllers in selected session
â”‚   â”‚   â”‚   60 â”‚         /// </summary>
â”‚   â”‚   â”‚   61 â”‚         public ObservableCollection<Controller> Controllers
â”‚   â”‚   â”‚   62 â”‚         {
â”‚   â”‚   â”‚   63 â”‚             get => _controllers;
â”‚   â”‚   â”‚   64 â”‚             set => SetProperty(ref _controllers, value);
â”‚   â”‚   â”‚   65 â”‚         }
â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   67 â”‚         /// <summary>
â”‚   â”‚   â”‚   68 â”‚         /// Count of controllers
â”‚   â”‚   â”‚   69 â”‚         /// </summary>
â”‚   â”‚   â”‚   70 â”‚         public int ControllerCount
â”‚   â”‚   â”‚   71 â”‚         {
â”‚   â”‚   â”‚   72 â”‚             get => _controllerCount;
â”‚   â”‚   â”‚   73 â”‚             set => SetProperty(ref _controllerCount, value);
â”‚   â”‚   â”‚   74 â”‚         }
â”‚   â”‚   â”‚   75 â”‚ 
â”‚   â”‚   â”‚   76 â”‚         /// <summary>
â”‚   â”‚   â”‚   77 â”‚         /// Count of objects
â”‚   â”‚   â”‚   78 â”‚         /// </summary>
â”‚   â”‚   â”‚   79 â”‚         public int ObjectCount
â”‚   â”‚   â”‚   80 â”‚         {
â”‚   â”‚   â”‚   81 â”‚             get => _objectCount;
â”‚   â”‚   â”‚   82 â”‚             set => SetProperty(ref _objectCount, value);
â”‚   â”‚   â”‚   83 â”‚         }
â”‚   â”‚   â”‚   84 â”‚ 
â”‚   â”‚   â”‚   85 â”‚         /// <summary>
â”‚   â”‚   â”‚   86 â”‚         /// Available export formats
â”‚   â”‚   â”‚   87 â”‚         /// </summary>
â”‚   â”‚   â”‚   88 â”‚         public ObservableCollection<ExportFormat> ExportFormats
â”‚   â”‚   â”‚   89 â”‚         {
â”‚   â”‚   â”‚   90 â”‚             get => _exportFormats;
â”‚   â”‚   â”‚   91 â”‚             set => SetProperty(ref _exportFormats, value);
â”‚   â”‚   â”‚   92 â”‚         }
â”‚   â”‚   â”‚   93 â”‚ 
â”‚   â”‚   â”‚   94 â”‚         /// <summary>
â”‚   â”‚   â”‚   95 â”‚         /// Selected export format
â”‚   â”‚   â”‚   96 â”‚         /// </summary>
â”‚   â”‚   â”‚   97 â”‚         public ExportFormat SelectedFormat
â”‚   â”‚   â”‚   98 â”‚         {
â”‚   â”‚   â”‚   99 â”‚             get => _selectedFormat;
â”‚   â”‚   â”‚  100 â”‚             set => SetProperty(ref _selectedFormat, value);
â”‚   â”‚   â”‚  101 â”‚         }
â”‚   â”‚   â”‚  102 â”‚ 
â”‚   â”‚   â”‚  103 â”‚         /// <summary>
â”‚   â”‚   â”‚  104 â”‚         /// Export file path
â”‚   â”‚   â”‚  105 â”‚         /// </summary>
â”‚   â”‚   â”‚  106 â”‚         public string ExportPath
â”‚   â”‚   â”‚  107 â”‚         {
â”‚   â”‚   â”‚  108 â”‚             get => _exportPath;
â”‚   â”‚   â”‚  109 â”‚             set => SetProperty(ref _exportPath, value);
â”‚   â”‚   â”‚  110 â”‚         }
â”‚   â”‚   â”‚  111 â”‚ 
â”‚   â”‚   â”‚  112 â”‚         /// <summary>
â”‚   â”‚   â”‚  113 â”‚         /// Command to load available sessions
â”‚   â”‚   â”‚  114 â”‚         /// </summary>
â”‚   â”‚   â”‚  115 â”‚         public IAsyncRelayCommand LoadSessionsCommand { get; }
â”‚   â”‚   â”‚  116 â”‚ 
â”‚   â”‚   â”‚  117 â”‚         /// <summary>
â”‚   â”‚   â”‚  118 â”‚         /// Command to load data from selected session
â”‚   â”‚   â”‚  119 â”‚         /// </summary>
â”‚   â”‚   â”‚  120 â”‚         public IAsyncRelayCommand LoadSessionDataCommand { get; }
â”‚   â”‚   â”‚  121 â”‚ 
â”‚   â”‚   â”‚  122 â”‚         /// <summary>
â”‚   â”‚   â”‚  123 â”‚         /// Command to select export file path
â”‚   â”‚   â”‚  124 â”‚         /// </summary>
â”‚   â”‚   â”‚  125 â”‚         public IAsyncRelayCommand SelectExportPathCommand { get; }
â”‚   â”‚   â”‚  126 â”‚ 
â”‚   â”‚   â”‚  127 â”‚         /// <summary>
â”‚   â”‚   â”‚  128 â”‚         /// Command to export data
â”‚   â”‚   â”‚  129 â”‚         /// </summary>
â”‚   â”‚   â”‚  130 â”‚         public IAsyncRelayCommand ExportCommand { get; }
â”‚   â”‚   â”‚  131 â”‚ 
â”‚   â”‚   â”‚  132 â”‚         /// <summary>
â”‚   â”‚   â”‚  133 â”‚         /// Creates a new export demo view model
â”‚   â”‚   â”‚  134 â”‚         /// </summary>
â”‚   â”‚   â”‚  135 â”‚         /// <param name="exportService">The export service</param>
â”‚   â”‚   â”‚  136 â”‚         /// <param name="dialogService">The dialog service</param>
â”‚   â”‚   â”‚  137 â”‚         /// <param name="controllerService">The controller service</param>
â”‚   â”‚   â”‚  138 â”‚         public ExportDemoViewModel(
â”‚   â”‚   â”‚  139 â”‚             IExportService exportService,
â”‚   â”‚   â”‚  140 â”‚             IDialogService dialogService,
â”‚   â”‚   â”‚  141 â”‚             ControllerService controllerService)
â”‚   â”‚   â”‚  142 â”‚         {
â”‚   â”‚   â”‚  143 â”‚             _exportService = exportService ?? throw new ArgumentNullException(nameof(exportService));
â”‚   â”‚   â”‚  144 â”‚             _dialogService = dialogService ?? throw new ArgumentNullException(nameof(dialogService));
â”‚   â”‚   â”‚  145 â”‚             _controllerService = controllerService ?? throw new ArgumentNullException(nameof(controllerService));
â”‚   â”‚   â”‚  146 â”‚ 
â”‚   â”‚   â”‚  147 â”‚             // Initialize commands
â”‚   â”‚   â”‚  148 â”‚             LoadSessionsCommand = new AsyncRelayCommand(LoadSessionsAsync);
â”‚   â”‚   â”‚  149 â”‚             LoadSessionDataCommand = new AsyncRelayCommand(LoadSessionDataAsync);
â”‚   â”‚   â”‚  150 â”‚             SelectExportPathCommand = new AsyncRelayCommand(SelectExportPathAsync);
â”‚   â”‚   â”‚  151 â”‚             ExportCommand = new AsyncRelayCommand(ExportDataAsync, CanExport);
â”‚   â”‚   â”‚  152 â”‚ 
â”‚   â”‚   â”‚  153 â”‚             // Load available formats
â”‚   â”‚   â”‚  154 â”‚             ExportFormats = new ObservableCollection<ExportFormat>(_exportService.GetAvailableFormats());
â”‚   â”‚   â”‚  155 â”‚             if (ExportFormats.Any())
â”‚   â”‚   â”‚  156 â”‚             {
â”‚   â”‚   â”‚  157 â”‚                 SelectedFormat = ExportFormats.First();
â”‚   â”‚   â”‚  158 â”‚             }
â”‚   â”‚   â”‚  159 â”‚ 
â”‚   â”‚   â”‚  160 â”‚             // Load sessions on startup
â”‚   â”‚   â”‚  161 â”‚             LoadSessionsCommand.ExecuteAsync(null);
â”‚   â”‚   â”‚  162 â”‚         }
â”‚   â”‚   â”‚  163 â”‚ 
â”‚   â”‚   â”‚  164 â”‚         /// <summary>
â”‚   â”‚   â”‚  165 â”‚         /// Loads available sessions
â”‚   â”‚   â”‚  166 â”‚         /// </summary>
â”‚   â”‚   â”‚  167 â”‚         private async Task LoadSessionsAsync()
â”‚   â”‚   â”‚  168 â”‚         {
â”‚   â”‚   â”‚  169 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  170 â”‚             {
â”‚   â”‚   â”‚  171 â”‚                 var sessions = await _controllerService.GetAllSessionsAsync();
â”‚   â”‚   â”‚  172 â”‚                 AvailableSessions.Clear();
â”‚   â”‚   â”‚  173 â”‚ 
â”‚   â”‚   â”‚  174 â”‚                 foreach (var session in sessions)
â”‚   â”‚   â”‚  175 â”‚                 {
â”‚   â”‚   â”‚  176 â”‚                     AvailableSessions.Add(session.SessionId);
â”‚   â”‚   â”‚  177 â”‚                 }
â”‚   â”‚   â”‚  178 â”‚ 
â”‚   â”‚   â”‚  179 â”‚                 if (AvailableSessions.Any())
â”‚   â”‚   â”‚  180 â”‚                 {
â”‚   â”‚   â”‚  181 â”‚                     SelectedSessionId = AvailableSessions.First();
â”‚   â”‚   â”‚  182 â”‚                 }
â”‚   â”‚   â”‚  183 â”‚             }, "Sessions loaded successfully", "Failed to load sessions");
â”‚   â”‚   â”‚  184 â”‚         }
â”‚   â”‚   â”‚  185 â”‚ 
â”‚   â”‚   â”‚  186 â”‚         /// <summary>
â”‚   â”‚   â”‚  187 â”‚         /// Loads data from selected session
â”‚   â”‚   â”‚  188 â”‚         /// </summary>
â”‚   â”‚   â”‚  189 â”‚         private async Task LoadSessionDataAsync()
â”‚   â”‚   â”‚  190 â”‚         {
â”‚   â”‚   â”‚  191 â”‚             if (string.IsNullOrEmpty(SelectedSessionId))
â”‚   â”‚   â”‚  192 â”‚                 return;
â”‚   â”‚   â”‚  193 â”‚ 
â”‚   â”‚   â”‚  194 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  195 â”‚             {
â”‚   â”‚   â”‚  196 â”‚                 var controllers = await _controllerService.GetControllersBySessionAsync(SelectedSessionId);
â”‚   â”‚   â”‚  197 â”‚                 Controllers = new ObservableCollection<Controller>(controllers);
â”‚   â”‚   â”‚  198 â”‚                 ControllerCount = Controllers.Count;
â”‚   â”‚   â”‚  199 â”‚                 ObjectCount = Controllers.Sum(c => CountObjects(c.Objects));
â”‚   â”‚   â”‚  200 â”‚             }, "Session data loaded successfully", "Failed to load session data");
â”‚   â”‚   â”‚  201 â”‚         }
â”‚   â”‚   â”‚  202 â”‚ 
â”‚   â”‚   â”‚  203 â”‚         /// <summary>
â”‚   â”‚   â”‚  204 â”‚         /// Selects export file path
â”‚   â”‚   â”‚  205 â”‚         /// </summary>
â”‚   â”‚   â”‚  206 â”‚         private async Task SelectExportPathAsync()
â”‚   â”‚   â”‚  207 â”‚         {
â”‚   â”‚   â”‚  208 â”‚             if (SelectedFormat == null)
â”‚   â”‚   â”‚  209 â”‚                 return;
â”‚   â”‚   â”‚  210 â”‚ 
â”‚   â”‚   â”‚  211 â”‚             var filters = new List<FileDialogFilter>
â”‚   â”‚   â”‚  212 â”‚             {
â”‚   â”‚   â”‚  213 â”‚                 new FileDialogFilter
â”‚   â”‚   â”‚  214 â”‚                 {
â”‚   â”‚   â”‚  215 â”‚                     Name = $"{SelectedFormat.DisplayName} Files",
â”‚   â”‚   â”‚  216 â”‚                     Extensions = new List<string> { SelectedFormat.Extension.TrimStart('.') }
â”‚   â”‚   â”‚  217 â”‚                 }
â”‚   â”‚   â”‚  218 â”‚             };
â”‚   â”‚   â”‚  219 â”‚ 
â”‚   â”‚   â”‚  220 â”‚             var path = await _dialogService.ShowSaveFileDialogAsync(
â”‚   â”‚   â”‚  221 â”‚                 "Select Export Location",
â”‚   â”‚   â”‚  222 â”‚                 SelectedFormat.Extension,
â”‚   â”‚   â”‚  223 â”‚                 filters);
â”‚   â”‚   â”‚  224 â”‚ 
â”‚   â”‚   â”‚  225 â”‚             if (!string.IsNullOrEmpty(path))
â”‚   â”‚   â”‚  226 â”‚             {
â”‚   â”‚   â”‚  227 â”‚                 ExportPath = path;
â”‚   â”‚   â”‚  228 â”‚             }
â”‚   â”‚   â”‚  229 â”‚         }
â”‚   â”‚   â”‚  230 â”‚ 
â”‚   â”‚   â”‚  231 â”‚         /// <summary>
â”‚   â”‚   â”‚  232 â”‚         /// Exports data to selected format
â”‚   â”‚   â”‚  233 â”‚         /// </summary>
â”‚   â”‚   â”‚  234 â”‚         private async Task ExportDataAsync()
â”‚   â”‚   â”‚  235 â”‚         {
â”‚   â”‚   â”‚  236 â”‚             if (SelectedFormat == null || string.IsNullOrEmpty(ExportPath) || !Controllers.Any())
â”‚   â”‚   â”‚  237 â”‚                 return;
â”‚   â”‚   â”‚  238 â”‚ 
â”‚   â”‚   â”‚  239 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  240 â”‚             {
â”‚   â”‚   â”‚  241 â”‚                 var options = new ExportOptions
â”‚   â”‚   â”‚  242 â”‚                 {
â”‚   â”‚   â”‚  243 â”‚                     IncludeByteCode = false,
â”‚   â”‚   â”‚  244 â”‚                     IncludeEmptyValues = true,
â”‚   â”‚   â”‚  245 â”‚                     PrettyPrint = true
â”‚   â”‚   â”‚  246 â”‚                 };
â”‚   â”‚   â”‚  247 â”‚ 
â”‚   â”‚   â”‚  248 â”‚                 switch (SelectedFormat.Id)
â”‚   â”‚   â”‚  249 â”‚                 {
â”‚   â”‚   â”‚  250 â”‚                     case "xml":
â”‚   â”‚   â”‚  251 â”‚                         await _exportService.ExportToXmlAsync(Controllers, ExportPath, options);
â”‚   â”‚   â”‚  252 â”‚                         break;
â”‚   â”‚   â”‚  253 â”‚ 
â”‚   â”‚   â”‚  254 â”‚                     case "excel":
â”‚   â”‚   â”‚  255 â”‚                         await _exportService.ExportToExcelAsync(Controllers, ExportPath, options);
â”‚   â”‚   â”‚  256 â”‚                         break;
â”‚   â”‚   â”‚  257 â”‚ 
â”‚   â”‚   â”‚  258 â”‚                     case "csv-grouped":
â”‚   â”‚   â”‚  259 â”‚                         var comparisons = await _exportService.ExportToGroupedCsvAsync(Controllers, ExportPath, options);
â”‚   â”‚   â”‚  260 â”‚                         // Save comparisons to a separate file
â”‚   â”‚   â”‚  261 â”‚                         if (comparisons.Any())
â”‚   â”‚   â”‚  262 â”‚                         {
â”‚   â”‚   â”‚  263 â”‚                             var comparisonPath = Path.ChangeExtension(ExportPath, ".comparisons.txt");
â”‚   â”‚   â”‚  264 â”‚                             await File.WriteAllLinesAsync(comparisonPath, comparisons.Select(c => c.ToString()));
â”‚   â”‚   â”‚  265 â”‚                             SetSuccessMessage($"Exported {Controllers.Count} controllers with {comparisons.Count()} comparisons");
â”‚   â”‚   â”‚  266 â”‚                         }
â”‚   â”‚   â”‚  267 â”‚                         break;
â”‚   â”‚   â”‚  268 â”‚                 }
â”‚   â”‚   â”‚  269 â”‚             }, $"Exported to {Path.GetFileName(ExportPath)} successfully", "Export failed");
â”‚   â”‚   â”‚  270 â”‚         }
â”‚   â”‚   â”‚  271 â”‚ 
â”‚   â”‚   â”‚  272 â”‚         /// <summary>
â”‚   â”‚   â”‚  273 â”‚         /// Determines whether export is possible
â”‚   â”‚   â”‚  274 â”‚         /// </summary>
â”‚   â”‚   â”‚  275 â”‚         private bool CanExport()
â”‚   â”‚   â”‚  276 â”‚         {
â”‚   â”‚   â”‚  277 â”‚             return SelectedFormat != null && !string.IsNullOrEmpty(ExportPath) && Controllers.Any();
â”‚   â”‚   â”‚  278 â”‚         }
â”‚   â”‚   â”‚  279 â”‚ 
â”‚   â”‚   â”‚  280 â”‚         /// <summary>
â”‚   â”‚   â”‚  281 â”‚         /// Counts objects recursively
â”‚   â”‚   â”‚  282 â”‚         /// </summary>
â”‚   â”‚   â”‚  283 â”‚         private int CountObjects(IEnumerable<ControllerObject> objects)
â”‚   â”‚   â”‚  284 â”‚         {
â”‚   â”‚   â”‚  285 â”‚             if (objects == null)
â”‚   â”‚   â”‚  286 â”‚                 return 0;
â”‚   â”‚   â”‚  287 â”‚ 
â”‚   â”‚   â”‚  288 â”‚             int count = objects.Count();
â”‚   â”‚   â”‚  289 â”‚             foreach (var obj in objects)
â”‚   â”‚   â”‚  290 â”‚             {
â”‚   â”‚   â”‚  291 â”‚                 count += CountObjects(obj.Children);
â”‚   â”‚   â”‚  292 â”‚             }
â”‚   â”‚   â”‚  293 â”‚ 
â”‚   â”‚   â”‚  294 â”‚             return count;
â”‚   â”‚   â”‚  295 â”‚         }
â”‚   â”‚   â”‚  296 â”‚     }
â”‚   â”‚   â”‚  297 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ IMenuItem.cs (177.00 B, 2025-03-12 11:26:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: IMenuItem.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Material.Icons;
â”‚   â”‚   â”‚    2 â”‚ 
â”‚   â”‚   â”‚    3 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚    4 â”‚ {
â”‚   â”‚   â”‚    5 â”‚     public interface IMenuItem
â”‚   â”‚   â”‚    6 â”‚     {
â”‚   â”‚   â”‚    7 â”‚         string Header { get; }
â”‚   â”‚   â”‚    8 â”‚         MaterialIconKind Icon { get; }
â”‚   â”‚   â”‚    9 â”‚     }
â”‚   â”‚   â”‚   10 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ MainViewModel.cs (5.86 KB, 2025-03-12 15:13:49)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: MainViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚   â”‚   â”‚    2 â”‚ using CommunityToolkit.Mvvm.ComponentModel;
â”‚   â”‚   â”‚    3 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚   â”‚   â”‚    4 â”‚ using Material.Icons;
â”‚   â”‚   â”‚    5 â”‚ using System;
â”‚   â”‚   â”‚    6 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚    7 â”‚ using System.Linq;
â”‚   â”‚   â”‚    8 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    9 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   10 â”‚ 
â”‚   â”‚   â”‚   11 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   12 â”‚ {
â”‚   â”‚   â”‚   13 â”‚     public partial class MainViewModel : ObservableObject
â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   15 â”‚         private readonly INavigationService _navigationService;
â”‚   â”‚   â”‚   16 â”‚         private readonly ILogger<MainViewModel> _logger;
â”‚   â”‚   â”‚   17 â”‚ 
â”‚   â”‚   â”‚   18 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   19 â”‚         private IMenuItem? _selectedMenuItem;
â”‚   â”‚   â”‚   20 â”‚ 
â”‚   â”‚   â”‚   21 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   22 â”‚         private string _searchText = string.Empty;
â”‚   â”‚   â”‚   23 â”‚ 
â”‚   â”‚   â”‚   24 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   25 â”‚         private Control? _currentView;
â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   27 â”‚         public ObservableCollection<IMenuItem> MenuItems { get; } = new();
â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   29 â”‚         // Constructor for design-time
â”‚   â”‚   â”‚   30 â”‚         public MainViewModel()
â”‚   â”‚   â”‚   31 â”‚         {
â”‚   â”‚   â”‚   32 â”‚             // Design-time constructor
â”‚   â”‚   â”‚   33 â”‚             InitializeMenuItems();
â”‚   â”‚   â”‚   34 â”‚             _logger?.LogDebug("MainViewModel created with design-time constructor");
â”‚   â”‚   â”‚   35 â”‚         }
â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   37 â”‚         // Main constructor used by DI
â”‚   â”‚   â”‚   38 â”‚         public MainViewModel(INavigationService navigationService, ILogger<MainViewModel> logger = null)
â”‚   â”‚   â”‚   39 â”‚         {
â”‚   â”‚   â”‚   40 â”‚             _navigationService = navigationService ?? throw new ArgumentNullException(nameof(navigationService));
â”‚   â”‚   â”‚   41 â”‚             _logger = logger;
â”‚   â”‚   â”‚   42 â”‚             _logger?.LogInformation("MainViewModel created with navigationService");
â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   44 â”‚             InitializeMenuItems();
â”‚   â”‚   â”‚   45 â”‚             _logger?.LogInformation("Menu items initialized: {Count} items", MenuItems.Count);
â”‚   â”‚   â”‚   46 â”‚ 
â”‚   â”‚   â”‚   47 â”‚             // Set initial view
â”‚   â”‚   â”‚   48 â”‚             var defaultView = MenuItems.FirstOrDefault();
â”‚   â”‚   â”‚   49 â”‚             if (defaultView != null)
â”‚   â”‚   â”‚   50 â”‚             {
â”‚   â”‚   â”‚   51 â”‚                 SelectedMenuItem = defaultView;
â”‚   â”‚   â”‚   52 â”‚                 _logger?.LogDebug("Set initial SelectedMenuItem to {MenuItem}", defaultView.Header);
â”‚   â”‚   â”‚   53 â”‚ 
â”‚   â”‚   â”‚   54 â”‚                 if (_navigationService != null)
â”‚   â”‚   â”‚   55 â”‚                 {
â”‚   â”‚   â”‚   56 â”‚                     try
â”‚   â”‚   â”‚   57 â”‚                     {
â”‚   â”‚   â”‚   58 â”‚                         // Navigate to the default view
â”‚   â”‚   â”‚   59 â”‚                         _navigationService.NavigateTo(defaultView.Header);
â”‚   â”‚   â”‚   60 â”‚                         _logger?.LogDebug("Navigated to initial view: {ViewName}", defaultView.Header);
â”‚   â”‚   â”‚   61 â”‚ 
â”‚   â”‚   â”‚   62 â”‚                         // Subscribe to navigation events to update CurrentView
â”‚   â”‚   â”‚   63 â”‚                         _navigationService.Navigated += (s, e) =>
â”‚   â”‚   â”‚   64 â”‚                         {
â”‚   â”‚   â”‚   65 â”‚                             _logger?.LogDebug("Navigation event received for {ViewName}", e.ViewName);
â”‚   â”‚   â”‚   66 â”‚                             if (e.Parameter is Control control)
â”‚   â”‚   â”‚   67 â”‚                             {
â”‚   â”‚   â”‚   68 â”‚                                 CurrentView = control;
â”‚   â”‚   â”‚   69 â”‚                                 _logger?.LogDebug("CurrentView updated to {ViewType}", control.GetType().Name);
â”‚   â”‚   â”‚   70 â”‚                             }
â”‚   â”‚   â”‚   71 â”‚                         };
â”‚   â”‚   â”‚   72 â”‚                     }
â”‚   â”‚   â”‚   73 â”‚                     catch (Exception ex)
â”‚   â”‚   â”‚   74 â”‚                     {
â”‚   â”‚   â”‚   75 â”‚                         _logger?.LogError(ex, "Error during initial navigation");
â”‚   â”‚   â”‚   76 â”‚                     }
â”‚   â”‚   â”‚   77 â”‚                 }
â”‚   â”‚   â”‚   78 â”‚             }
â”‚   â”‚   â”‚   79 â”‚             else
â”‚   â”‚   â”‚   80 â”‚             {
â”‚   â”‚   â”‚   81 â”‚                 _logger?.LogWarning("No default menu item found to select");
â”‚   â”‚   â”‚   82 â”‚             }
â”‚   â”‚   â”‚   83 â”‚         }
â”‚   â”‚   â”‚   84 â”‚ 
â”‚   â”‚   â”‚   85 â”‚         partial void OnSelectedMenuItemChanged(IMenuItem? value)
â”‚   â”‚   â”‚   86 â”‚         {
â”‚   â”‚   â”‚   87 â”‚             try
â”‚   â”‚   â”‚   88 â”‚             {
â”‚   â”‚   â”‚   89 â”‚                 if (value != null && _navigationService != null)
â”‚   â”‚   â”‚   90 â”‚                 {
â”‚   â”‚   â”‚   91 â”‚                     _logger?.LogDebug("SelectedMenuItem changed to {MenuItem}", value.Header);
â”‚   â”‚   â”‚   92 â”‚                     _navigationService.NavigateTo(value.Header);
â”‚   â”‚   â”‚   93 â”‚                 }
â”‚   â”‚   â”‚   94 â”‚             }
â”‚   â”‚   â”‚   95 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   96 â”‚             {
â”‚   â”‚   â”‚   97 â”‚                 _logger?.LogError(ex, "Error in OnSelectedMenuItemChanged");
â”‚   â”‚   â”‚   98 â”‚             }
â”‚   â”‚   â”‚   99 â”‚         }
â”‚   â”‚   â”‚  100 â”‚ 
â”‚   â”‚   â”‚  101 â”‚         private void InitializeMenuItems()
â”‚   â”‚   â”‚  102 â”‚         {
â”‚   â”‚   â”‚  103 â”‚             try
â”‚   â”‚   â”‚  104 â”‚             {
â”‚   â”‚   â”‚  105 â”‚                 MenuItems.Clear();
â”‚   â”‚   â”‚  106 â”‚                 MenuItems.Add(new MenuItem { Header = "Dashboard", Icon = MaterialIconKind.ViewDashboard });
â”‚   â”‚   â”‚  107 â”‚                 MenuItems.Add(new MenuItem { Header = "Projects", Icon = MaterialIconKind.Folder });
â”‚   â”‚   â”‚  108 â”‚                 MenuItems.Add(new MenuItem { Header = "Analysis", Icon = MaterialIconKind.ChartBar });
â”‚   â”‚   â”‚  109 â”‚                 MenuItems.Add(new MenuItem { Header = "Diff", Icon = MaterialIconKind.FileCompare });
â”‚   â”‚   â”‚  110 â”‚                 MenuItems.Add(new MenuItem { Header = "Converters", Icon = MaterialIconKind.FileReplace });
â”‚   â”‚   â”‚  111 â”‚                 MenuItems.Add(new MenuItem { Header = "Databases", Icon = MaterialIconKind.Database });
â”‚   â”‚   â”‚  112 â”‚                 MenuItems.Add(new MenuItem { Header = "Reports", Icon = MaterialIconKind.FileChart });
â”‚   â”‚   â”‚  113 â”‚                 MenuItems.Add(new MenuItem { Header = "Settings", Icon = MaterialIconKind.Cog });
â”‚   â”‚   â”‚  114 â”‚                 MenuItems.Add(new MenuItem { Header = "Help", Icon = MaterialIconKind.HelpCircle });
â”‚   â”‚   â”‚  115 â”‚ 
â”‚   â”‚   â”‚  116 â”‚                 _logger?.LogDebug("Menu items initialized with {Count} items", MenuItems.Count);
â”‚   â”‚   â”‚  117 â”‚             }
â”‚   â”‚   â”‚  118 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  119 â”‚             {
â”‚   â”‚   â”‚  120 â”‚                 _logger?.LogError(ex, "Error initializing menu items");
â”‚   â”‚   â”‚  121 â”‚             }
â”‚   â”‚   â”‚  122 â”‚         }
â”‚   â”‚   â”‚  123 â”‚ 
â”‚   â”‚   â”‚  124 â”‚         [RelayCommand]
â”‚   â”‚   â”‚  125 â”‚         private void MenuItemSelected(IMenuItem menuItem)
â”‚   â”‚   â”‚  126 â”‚         {
â”‚   â”‚   â”‚  127 â”‚             try
â”‚   â”‚   â”‚  128 â”‚             {
â”‚   â”‚   â”‚  129 â”‚                 if (menuItem != null && _navigationService != null)
â”‚   â”‚   â”‚  130 â”‚                 {
â”‚   â”‚   â”‚  131 â”‚                     _logger?.LogDebug("MenuItemSelected command executed for {MenuItem}", menuItem.Header);
â”‚   â”‚   â”‚  132 â”‚                     _navigationService.NavigateTo(menuItem.Header);
â”‚   â”‚   â”‚  133 â”‚                     SelectedMenuItem = menuItem;
â”‚   â”‚   â”‚  134 â”‚                 }
â”‚   â”‚   â”‚  135 â”‚             }
â”‚   â”‚   â”‚  136 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  137 â”‚             {
â”‚   â”‚   â”‚  138 â”‚                 _logger?.LogError(ex, "Error in MenuItemSelected command");
â”‚   â”‚   â”‚  139 â”‚             }
â”‚   â”‚   â”‚  140 â”‚         }
â”‚   â”‚   â”‚  141 â”‚     }
â”‚   â”‚   â”‚  142 â”‚ 
â”‚   â”‚   â”‚  143 â”‚     public class MenuItem : IMenuItem
â”‚   â”‚   â”‚  144 â”‚     {
â”‚   â”‚   â”‚  145 â”‚         public string Header { get; set; } = string.Empty;
â”‚   â”‚   â”‚  146 â”‚         public MaterialIconKind Icon { get; set; }
â”‚   â”‚   â”‚  147 â”‚ 
â”‚   â”‚   â”‚  148 â”‚         public override string ToString()
â”‚   â”‚   â”‚  149 â”‚         {
â”‚   â”‚   â”‚  150 â”‚             return $"MenuItem: {Header}";
â”‚   â”‚   â”‚  151 â”‚         }
â”‚   â”‚   â”‚  152 â”‚     }
â”‚   â”‚   â”‚  153 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ObjectSetViewModel.cs (5.35 KB, 2025-03-11 15:11:59)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ObjectSetViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚    3 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚    4 â”‚ using System.IO;
â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    6 â”‚ using System.Xml.Linq;
â”‚   â”‚   â”‚    7 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚   â”‚   â”‚    8 â”‚ using test.Core.Domain.ObjectSet;
â”‚   â”‚   â”‚    9 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   10 â”‚ 
â”‚   â”‚   â”‚   11 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   12 â”‚ {
â”‚   â”‚   â”‚   13 â”‚     /// <summary>
â”‚   â”‚   â”‚   14 â”‚     /// View model for ObjectSet XML content
â”‚   â”‚   â”‚   15 â”‚     /// </summary>
â”‚   â”‚   â”‚   16 â”‚     public class ObjectSetViewModel : ViewModelBase
â”‚   â”‚   â”‚   17 â”‚     {
â”‚   â”‚   â”‚   18 â”‚         private readonly IObjectSetParser _objectSetParser;
â”‚   â”‚   â”‚   19 â”‚         private readonly IDialogService _dialogService;
â”‚   â”‚   â”‚   20 â”‚ 
â”‚   â”‚   â”‚   21 â”‚         private string _filePath;
â”‚   â”‚   â”‚   22 â”‚         private MetaInformation _metaInfo;
â”‚   â”‚   â”‚   23 â”‚         private ObservableCollection<ObjectTypeDefinition> _typeDefinitions = new();
â”‚   â”‚   â”‚   24 â”‚         private ObservableCollection<ExportedObject> _exportedObjects = new();
â”‚   â”‚   â”‚   25 â”‚         private ObjectTypeDefinition _selectedType;
â”‚   â”‚   â”‚   26 â”‚         private ExportedObject _selectedObject;
â”‚   â”‚   â”‚   27 â”‚ 
â”‚   â”‚   â”‚   28 â”‚         /// <summary>
â”‚   â”‚   â”‚   29 â”‚         /// The file path
â”‚   â”‚   â”‚   30 â”‚         /// </summary>
â”‚   â”‚   â”‚   31 â”‚         public string FilePath
â”‚   â”‚   â”‚   32 â”‚         {
â”‚   â”‚   â”‚   33 â”‚             get => _filePath;
â”‚   â”‚   â”‚   34 â”‚             set => SetProperty(ref _filePath, value);
â”‚   â”‚   â”‚   35 â”‚         }
â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   37 â”‚         /// <summary>
â”‚   â”‚   â”‚   38 â”‚         /// The meta information
â”‚   â”‚   â”‚   39 â”‚         /// </summary>
â”‚   â”‚   â”‚   40 â”‚         public MetaInformation MetaInfo
â”‚   â”‚   â”‚   41 â”‚         {
â”‚   â”‚   â”‚   42 â”‚             get => _metaInfo;
â”‚   â”‚   â”‚   43 â”‚             set => SetProperty(ref _metaInfo, value);
â”‚   â”‚   â”‚   44 â”‚         }
â”‚   â”‚   â”‚   45 â”‚ 
â”‚   â”‚   â”‚   46 â”‚         /// <summary>
â”‚   â”‚   â”‚   47 â”‚         /// The type definitions
â”‚   â”‚   â”‚   48 â”‚         /// </summary>
â”‚   â”‚   â”‚   49 â”‚         public ObservableCollection<ObjectTypeDefinition> TypeDefinitions
â”‚   â”‚   â”‚   50 â”‚         {
â”‚   â”‚   â”‚   51 â”‚             get => _typeDefinitions;
â”‚   â”‚   â”‚   52 â”‚             set => SetProperty(ref _typeDefinitions, value);
â”‚   â”‚   â”‚   53 â”‚         }
â”‚   â”‚   â”‚   54 â”‚ 
â”‚   â”‚   â”‚   55 â”‚         /// <summary>
â”‚   â”‚   â”‚   56 â”‚         /// The exported objects
â”‚   â”‚   â”‚   57 â”‚         /// </summary>
â”‚   â”‚   â”‚   58 â”‚         public ObservableCollection<ExportedObject> ExportedObjects
â”‚   â”‚   â”‚   59 â”‚         {
â”‚   â”‚   â”‚   60 â”‚             get => _exportedObjects;
â”‚   â”‚   â”‚   61 â”‚             set => SetProperty(ref _exportedObjects, value);
â”‚   â”‚   â”‚   62 â”‚         }
â”‚   â”‚   â”‚   63 â”‚ 
â”‚   â”‚   â”‚   64 â”‚         /// <summary>
â”‚   â”‚   â”‚   65 â”‚         /// The selected type definition
â”‚   â”‚   â”‚   66 â”‚         /// </summary>
â”‚   â”‚   â”‚   67 â”‚         public ObjectTypeDefinition SelectedType
â”‚   â”‚   â”‚   68 â”‚         {
â”‚   â”‚   â”‚   69 â”‚             get => _selectedType;
â”‚   â”‚   â”‚   70 â”‚             set => SetProperty(ref _selectedType, value);
â”‚   â”‚   â”‚   71 â”‚         }
â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   73 â”‚         /// <summary>
â”‚   â”‚   â”‚   74 â”‚         /// The selected exported object
â”‚   â”‚   â”‚   75 â”‚         /// </summary>
â”‚   â”‚   â”‚   76 â”‚         public ExportedObject SelectedObject
â”‚   â”‚   â”‚   77 â”‚         {
â”‚   â”‚   â”‚   78 â”‚             get => _selectedObject;
â”‚   â”‚   â”‚   79 â”‚             set => SetProperty(ref _selectedObject, value);
â”‚   â”‚   â”‚   80 â”‚         }
â”‚   â”‚   â”‚   81 â”‚ 
â”‚   â”‚   â”‚   82 â”‚         /// <summary>
â”‚   â”‚   â”‚   83 â”‚         /// Command to load an ObjectSet XML file
â”‚   â”‚   â”‚   84 â”‚         /// </summary>
â”‚   â”‚   â”‚   85 â”‚         public IAsyncRelayCommand LoadFileCommand { get; }
â”‚   â”‚   â”‚   86 â”‚ 
â”‚   â”‚   â”‚   87 â”‚         /// <summary>
â”‚   â”‚   â”‚   88 â”‚         /// Creates a new ObjectSet view model
â”‚   â”‚   â”‚   89 â”‚         /// </summary>
â”‚   â”‚   â”‚   90 â”‚         /// <param name="objectSetParser">The ObjectSet parser</param>
â”‚   â”‚   â”‚   91 â”‚         /// <param name="dialogService">The dialog service</param>
â”‚   â”‚   â”‚   92 â”‚         public ObjectSetViewModel(IObjectSetParser objectSetParser, IDialogService dialogService)
â”‚   â”‚   â”‚   93 â”‚         {
â”‚   â”‚   â”‚   94 â”‚             _objectSetParser = objectSetParser ?? throw new ArgumentNullException(nameof(objectSetParser));
â”‚   â”‚   â”‚   95 â”‚             _dialogService = dialogService ?? throw new ArgumentNullException(nameof(dialogService));
â”‚   â”‚   â”‚   96 â”‚ 
â”‚   â”‚   â”‚   97 â”‚             LoadFileCommand = new AsyncRelayCommand(LoadFileAsync);
â”‚   â”‚   â”‚   98 â”‚         }
â”‚   â”‚   â”‚   99 â”‚ 
â”‚   â”‚   â”‚  100 â”‚         /// <summary>
â”‚   â”‚   â”‚  101 â”‚         /// Loads an ObjectSet XML file
â”‚   â”‚   â”‚  102 â”‚         /// </summary>
â”‚   â”‚   â”‚  103 â”‚         private async Task LoadFileAsync()
â”‚   â”‚   â”‚  104 â”‚         {
â”‚   â”‚   â”‚  105 â”‚             var filters = new List<Avalonia.Controls.FileDialogFilter>
â”‚   â”‚   â”‚  106 â”‚     {
â”‚   â”‚   â”‚  107 â”‚         new Avalonia.Controls.FileDialogFilter
â”‚   â”‚   â”‚  108 â”‚         {
â”‚   â”‚   â”‚  109 â”‚             Name = "XML Files",
â”‚   â”‚   â”‚  110 â”‚             Extensions = new List<string> { "xml" }
â”‚   â”‚   â”‚  111 â”‚         }
â”‚   â”‚   â”‚  112 â”‚     };
â”‚   â”‚   â”‚  113 â”‚ 
â”‚   â”‚   â”‚  114 â”‚             var files = await _dialogService.ShowOpenFileDialogAsync("Select ObjectSet XML File", filters);
â”‚   â”‚   â”‚  115 â”‚             if (files == null || files.Length == 0)
â”‚   â”‚   â”‚  116 â”‚                 return;
â”‚   â”‚   â”‚  117 â”‚ 
â”‚   â”‚   â”‚  118 â”‚             FilePath = files[0];
â”‚   â”‚   â”‚  119 â”‚ 
â”‚   â”‚   â”‚  120 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  121 â”‚             {
â”‚   â”‚   â”‚  122 â”‚                 try
â”‚   â”‚   â”‚  123 â”‚                 {
â”‚   â”‚   â”‚  124 â”‚                     // Load XML content
â”‚   â”‚   â”‚  125 â”‚                     var content = await File.ReadAllTextAsync(FilePath);
â”‚   â”‚   â”‚  126 â”‚                     var document = XDocument.Parse(content);
â”‚   â”‚   â”‚  127 â”‚ 
â”‚   â”‚   â”‚  128 â”‚                     // Use parser to extract components
â”‚   â”‚   â”‚  129 â”‚                     var options = new ObjectSetParsingOptions
â”‚   â”‚   â”‚  130 â”‚                     {
â”‚   â”‚   â”‚  131 â”‚                         IncludeMetaInformation = true,
â”‚   â”‚   â”‚  132 â”‚                         IncludeTypeDefinitions = true,
â”‚   â”‚   â”‚  133 â”‚                         IncludeExportedObjects = true
â”‚   â”‚   â”‚  134 â”‚                     };
â”‚   â”‚   â”‚  135 â”‚ 
â”‚   â”‚   â”‚  136 â”‚                     var result = await _objectSetParser.ParseAsync(document, options);
â”‚   â”‚   â”‚  137 â”‚ 
â”‚   â”‚   â”‚  138 â”‚                     if (result.Success)
â”‚   â”‚   â”‚  139 â”‚                     {
â”‚   â”‚   â”‚  140 â”‚                         MetaInfo = result.MetaInfo;
â”‚   â”‚   â”‚  141 â”‚                         TypeDefinitions = new ObservableCollection<ObjectTypeDefinition>(result.Types);
â”‚   â”‚   â”‚  142 â”‚                         ExportedObjects = new ObservableCollection<ExportedObject>(result.ExportedObjects);
â”‚   â”‚   â”‚  143 â”‚                         return true;
â”‚   â”‚   â”‚  144 â”‚                     }
â”‚   â”‚   â”‚  145 â”‚                     else
â”‚   â”‚   â”‚  146 â”‚                     {
â”‚   â”‚   â”‚  147 â”‚                         SetErrorMessage($"Failed to parse ObjectSet XML: {result.ErrorMessage}");
â”‚   â”‚   â”‚  148 â”‚                         return false;
â”‚   â”‚   â”‚  149 â”‚                     }
â”‚   â”‚   â”‚  150 â”‚                 }
â”‚   â”‚   â”‚  151 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚  152 â”‚                 {
â”‚   â”‚   â”‚  153 â”‚                     SetErrorMessage($"Error loading file: {ex.Message}");
â”‚   â”‚   â”‚  154 â”‚                     return false;
â”‚   â”‚   â”‚  155 â”‚                 }
â”‚   â”‚   â”‚  156 â”‚             }, "ObjectSet XML loaded successfully", "Error loading ObjectSet XML");
â”‚   â”‚   â”‚  157 â”‚         }
â”‚   â”‚   â”‚  158 â”‚     }
â”‚   â”‚   â”‚  159 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ProjectViewModel.cs (10.85 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ProjectViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚    3 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚    4 â”‚ using System.ComponentModel;
â”‚   â”‚   â”‚    5 â”‚ using System.Runtime.CompilerServices;
â”‚   â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    7 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    8 â”‚ using test.Application.Services;
â”‚   â”‚   â”‚    9 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   10 â”‚ 
â”‚   â”‚   â”‚   11 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   12 â”‚ {
â”‚   â”‚   â”‚   13 â”‚ 
â”‚   â”‚   â”‚   14 â”‚     /// <summary>
â”‚   â”‚   â”‚   15 â”‚     /// View model for a project
â”‚   â”‚   â”‚   16 â”‚     /// </summary>
â”‚   â”‚   â”‚   17 â”‚     public class ProjectViewModel : ViewModelBase
â”‚   â”‚   â”‚   18 â”‚     {
â”‚   â”‚   â”‚   19 â”‚         private readonly ProjectService _projectService;
â”‚   â”‚   â”‚   20 â”‚         private readonly IErrorHandler _errorHandler;
â”‚   â”‚   â”‚   21 â”‚         private readonly ILogger<ProjectViewModel> _logger;
â”‚   â”‚   â”‚   22 â”‚         private readonly IDialogService _dialogService;
â”‚   â”‚   â”‚   23 â”‚ 
â”‚   â”‚   â”‚   24 â”‚         // Properties from domain model
â”‚   â”‚   â”‚   25 â”‚         private string _projectId;
â”‚   â”‚   â”‚   26 â”‚         private string _name;
â”‚   â”‚   â”‚   27 â”‚         private string _description;
â”‚   â”‚   â”‚   28 â”‚         private DateTime _created;
â”‚   â”‚   â”‚   29 â”‚         private DateTime _lastModified;
â”‚   â”‚   â”‚   30 â”‚         private string _projectDirectory;
â”‚   â”‚   â”‚   31 â”‚ 
â”‚   â”‚   â”‚   32 â”‚         // Collections
â”‚   â”‚   â”‚   33 â”‚         private ObservableCollection<ImportedFileViewModel> _importedFiles = new();
â”‚   â”‚   â”‚   34 â”‚         private ObservableCollection<SharedTypeViewModel> _sharedTypes = new();
â”‚   â”‚   â”‚   35 â”‚         private ObservableCollection<CustomTypeFileViewModel> _customTypeFiles = new();
â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   37 â”‚         /// <summary>
â”‚   â”‚   â”‚   38 â”‚         /// The project ID
â”‚   â”‚   â”‚   39 â”‚         /// </summary>
â”‚   â”‚   â”‚   40 â”‚         public string ProjectId
â”‚   â”‚   â”‚   41 â”‚         {
â”‚   â”‚   â”‚   42 â”‚             get => _projectId;
â”‚   â”‚   â”‚   43 â”‚             set => SetProperty(ref _projectId, value);
â”‚   â”‚   â”‚   44 â”‚         }
â”‚   â”‚   â”‚   45 â”‚ 
â”‚   â”‚   â”‚   46 â”‚         /// <summary>
â”‚   â”‚   â”‚   47 â”‚         /// The project name
â”‚   â”‚   â”‚   48 â”‚         /// </summary>
â”‚   â”‚   â”‚   49 â”‚         public string Name
â”‚   â”‚   â”‚   50 â”‚         {
â”‚   â”‚   â”‚   51 â”‚             get => _name;
â”‚   â”‚   â”‚   52 â”‚             set => SetProperty(ref _name, value);
â”‚   â”‚   â”‚   53 â”‚         }
â”‚   â”‚   â”‚   54 â”‚ 
â”‚   â”‚   â”‚   55 â”‚         /// <summary>
â”‚   â”‚   â”‚   56 â”‚         /// The project description
â”‚   â”‚   â”‚   57 â”‚         /// </summary>
â”‚   â”‚   â”‚   58 â”‚         public string Description
â”‚   â”‚   â”‚   59 â”‚         {
â”‚   â”‚   â”‚   60 â”‚             get => _description;
â”‚   â”‚   â”‚   61 â”‚             set => SetProperty(ref _description, value);
â”‚   â”‚   â”‚   62 â”‚         }
â”‚   â”‚   â”‚   63 â”‚ 
â”‚   â”‚   â”‚   64 â”‚         /// <summary>
â”‚   â”‚   â”‚   65 â”‚         /// The project directory
â”‚   â”‚   â”‚   66 â”‚         /// </summary>
â”‚   â”‚   â”‚   67 â”‚         public string ProjectDirectory
â”‚   â”‚   â”‚   68 â”‚         {
â”‚   â”‚   â”‚   69 â”‚             get => _projectDirectory;
â”‚   â”‚   â”‚   70 â”‚             set => SetProperty(ref _projectDirectory, value);
â”‚   â”‚   â”‚   71 â”‚         }
â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   73 â”‚         /// <summary>
â”‚   â”‚   â”‚   74 â”‚         /// The date the project was created
â”‚   â”‚   â”‚   75 â”‚         /// </summary>
â”‚   â”‚   â”‚   76 â”‚         public DateTime Created
â”‚   â”‚   â”‚   77 â”‚         {
â”‚   â”‚   â”‚   78 â”‚             get => _created;
â”‚   â”‚   â”‚   79 â”‚             set => SetProperty(ref _created, value);
â”‚   â”‚   â”‚   80 â”‚         }
â”‚   â”‚   â”‚   81 â”‚ 
â”‚   â”‚   â”‚   82 â”‚         /// <summary>
â”‚   â”‚   â”‚   83 â”‚         /// The date the project was last modified
â”‚   â”‚   â”‚   84 â”‚         /// </summary>
â”‚   â”‚   â”‚   85 â”‚         public DateTime LastModified
â”‚   â”‚   â”‚   86 â”‚         {
â”‚   â”‚   â”‚   87 â”‚             get => _lastModified;
â”‚   â”‚   â”‚   88 â”‚             set => SetProperty(ref _lastModified, value);
â”‚   â”‚   â”‚   89 â”‚         }
â”‚   â”‚   â”‚   90 â”‚ 
â”‚   â”‚   â”‚   91 â”‚         /// <summary>
â”‚   â”‚   â”‚   92 â”‚         /// The imported files in this project
â”‚   â”‚   â”‚   93 â”‚         /// </summary>
â”‚   â”‚   â”‚   94 â”‚         public ObservableCollection<ImportedFileViewModel> ImportedFiles
â”‚   â”‚   â”‚   95 â”‚         {
â”‚   â”‚   â”‚   96 â”‚             get => _importedFiles;
â”‚   â”‚   â”‚   97 â”‚             set => SetProperty(ref _importedFiles, value);
â”‚   â”‚   â”‚   98 â”‚         }
â”‚   â”‚   â”‚   99 â”‚ 
â”‚   â”‚   â”‚  100 â”‚         /// <summary>
â”‚   â”‚   â”‚  101 â”‚         /// The shared types in this project
â”‚   â”‚   â”‚  102 â”‚         /// </summary>
â”‚   â”‚   â”‚  103 â”‚         public ObservableCollection<SharedTypeViewModel> SharedTypes
â”‚   â”‚   â”‚  104 â”‚         {
â”‚   â”‚   â”‚  105 â”‚             get => _sharedTypes;
â”‚   â”‚   â”‚  106 â”‚             set => SetProperty(ref _sharedTypes, value);
â”‚   â”‚   â”‚  107 â”‚         }
â”‚   â”‚   â”‚  108 â”‚ 
â”‚   â”‚   â”‚  109 â”‚         /// <summary>
â”‚   â”‚   â”‚  110 â”‚         /// The custom type files in this project
â”‚   â”‚   â”‚  111 â”‚         /// </summary>
â”‚   â”‚   â”‚  112 â”‚         public ObservableCollection<CustomTypeFileViewModel> CustomTypeFiles
â”‚   â”‚   â”‚  113 â”‚         {
â”‚   â”‚   â”‚  114 â”‚             get => _customTypeFiles;
â”‚   â”‚   â”‚  115 â”‚             set => SetProperty(ref _customTypeFiles, value);
â”‚   â”‚   â”‚  116 â”‚         }
â”‚   â”‚   â”‚  117 â”‚ 
â”‚   â”‚   â”‚  118 â”‚         /// <summary>
â”‚   â”‚   â”‚  119 â”‚         /// Creates a new project view model for design time
â”‚   â”‚   â”‚  120 â”‚         /// </summary>
â”‚   â”‚   â”‚  121 â”‚         public ProjectViewModel()
â”‚   â”‚   â”‚  122 â”‚         {
â”‚   â”‚   â”‚  123 â”‚             // Design-time constructor
â”‚   â”‚   â”‚  124 â”‚         }
â”‚   â”‚   â”‚  125 â”‚ 
â”‚   â”‚   â”‚  126 â”‚         /// <summary>
â”‚   â”‚   â”‚  127 â”‚         /// Creates a new project view model
â”‚   â”‚   â”‚  128 â”‚         /// </summary>
â”‚   â”‚   â”‚  129 â”‚         public ProjectViewModel(
â”‚   â”‚   â”‚  130 â”‚             ProjectService projectService,
â”‚   â”‚   â”‚  131 â”‚             IErrorHandler errorHandler,
â”‚   â”‚   â”‚  132 â”‚             ILogger<ProjectViewModel> logger,
â”‚   â”‚   â”‚  133 â”‚             IDialogService dialogService)
â”‚   â”‚   â”‚  134 â”‚         {
â”‚   â”‚   â”‚  135 â”‚             _projectService = projectService;
â”‚   â”‚   â”‚  136 â”‚             _errorHandler = errorHandler;
â”‚   â”‚   â”‚  137 â”‚             _logger = logger;
â”‚   â”‚   â”‚  138 â”‚             _dialogService = dialogService;
â”‚   â”‚   â”‚  139 â”‚         }
â”‚   â”‚   â”‚  140 â”‚ 
â”‚   â”‚   â”‚  141 â”‚         // TODO: Add commands and methods for project operations
â”‚   â”‚   â”‚  142 â”‚     }
â”‚   â”‚   â”‚  143 â”‚ 
â”‚   â”‚   â”‚  144 â”‚     /// <summary>
â”‚   â”‚   â”‚  145 â”‚     /// View model for an imported file
â”‚   â”‚   â”‚  146 â”‚     /// </summary>
â”‚   â”‚   â”‚  147 â”‚     public class ImportedFileViewModel : ViewModelBase
â”‚   â”‚   â”‚  148 â”‚     {
â”‚   â”‚   â”‚  149 â”‚         private string _fileName = string.Empty;
â”‚   â”‚   â”‚  150 â”‚         private string _filePath = string.Empty;
â”‚   â”‚   â”‚  151 â”‚         private string _status = string.Empty;
â”‚   â”‚   â”‚  152 â”‚         private DateTime _importDate = DateTime.UtcNow;
â”‚   â”‚   â”‚  153 â”‚         private long _fileSize;
â”‚   â”‚   â”‚  154 â”‚         private string _fileType = string.Empty;
â”‚   â”‚   â”‚  155 â”‚         private bool _isSelected;
â”‚   â”‚   â”‚  156 â”‚ 
â”‚   â”‚   â”‚  157 â”‚         /// <summary>
â”‚   â”‚   â”‚  158 â”‚         /// The file name
â”‚   â”‚   â”‚  159 â”‚         /// </summary>
â”‚   â”‚   â”‚  160 â”‚         public string FileName
â”‚   â”‚   â”‚  161 â”‚         {
â”‚   â”‚   â”‚  162 â”‚             get => _fileName;
â”‚   â”‚   â”‚  163 â”‚             set => SetProperty(ref _fileName, value);
â”‚   â”‚   â”‚  164 â”‚         }
â”‚   â”‚   â”‚  165 â”‚ 
â”‚   â”‚   â”‚  166 â”‚         /// <summary>
â”‚   â”‚   â”‚  167 â”‚         /// The file path
â”‚   â”‚   â”‚  168 â”‚         /// </summary>
â”‚   â”‚   â”‚  169 â”‚         public string FilePath
â”‚   â”‚   â”‚  170 â”‚         {
â”‚   â”‚   â”‚  171 â”‚             get => _filePath;
â”‚   â”‚   â”‚  172 â”‚             set => SetProperty(ref _filePath, value);
â”‚   â”‚   â”‚  173 â”‚         }
â”‚   â”‚   â”‚  174 â”‚ 
â”‚   â”‚   â”‚  175 â”‚         /// <summary>
â”‚   â”‚   â”‚  176 â”‚         /// The file status
â”‚   â”‚   â”‚  177 â”‚         /// </summary>
â”‚   â”‚   â”‚  178 â”‚         public string Status
â”‚   â”‚   â”‚  179 â”‚         {
â”‚   â”‚   â”‚  180 â”‚             get => _status;
â”‚   â”‚   â”‚  181 â”‚             set => SetProperty(ref _status, value);
â”‚   â”‚   â”‚  182 â”‚         }
â”‚   â”‚   â”‚  183 â”‚ 
â”‚   â”‚   â”‚  184 â”‚         /// <summary>
â”‚   â”‚   â”‚  185 â”‚         /// The date the file was imported
â”‚   â”‚   â”‚  186 â”‚         /// </summary>
â”‚   â”‚   â”‚  187 â”‚         public DateTime ImportDate
â”‚   â”‚   â”‚  188 â”‚         {
â”‚   â”‚   â”‚  189 â”‚             get => _importDate;
â”‚   â”‚   â”‚  190 â”‚             set => SetProperty(ref _importDate, value);
â”‚   â”‚   â”‚  191 â”‚         }
â”‚   â”‚   â”‚  192 â”‚ 
â”‚   â”‚   â”‚  193 â”‚         /// <summary>
â”‚   â”‚   â”‚  194 â”‚         /// The file size in bytes
â”‚   â”‚   â”‚  195 â”‚         /// </summary>
â”‚   â”‚   â”‚  196 â”‚         public long FileSize
â”‚   â”‚   â”‚  197 â”‚         {
â”‚   â”‚   â”‚  198 â”‚             get => _fileSize;
â”‚   â”‚   â”‚  199 â”‚             set => SetProperty(ref _fileSize, value);
â”‚   â”‚   â”‚  200 â”‚         }
â”‚   â”‚   â”‚  201 â”‚ 
â”‚   â”‚   â”‚  202 â”‚         /// <summary>
â”‚   â”‚   â”‚  203 â”‚         /// The file type (e.g., DMP, XML)
â”‚   â”‚   â”‚  204 â”‚         /// </summary>
â”‚   â”‚   â”‚  205 â”‚         public string FileType
â”‚   â”‚   â”‚  206 â”‚         {
â”‚   â”‚   â”‚  207 â”‚             get => _fileType;
â”‚   â”‚   â”‚  208 â”‚             set => SetProperty(ref _fileType, value);
â”‚   â”‚   â”‚  209 â”‚         }
â”‚   â”‚   â”‚  210 â”‚ 
â”‚   â”‚   â”‚  211 â”‚         /// <summary>
â”‚   â”‚   â”‚  212 â”‚         /// Whether the file is selected in the UI
â”‚   â”‚   â”‚  213 â”‚         /// </summary>
â”‚   â”‚   â”‚  214 â”‚         public bool IsSelected
â”‚   â”‚   â”‚  215 â”‚         {
â”‚   â”‚   â”‚  216 â”‚             get => _isSelected;
â”‚   â”‚   â”‚  217 â”‚             set => SetProperty(ref _isSelected, value);
â”‚   â”‚   â”‚  218 â”‚         }
â”‚   â”‚   â”‚  219 â”‚     }
â”‚   â”‚   â”‚  220 â”‚ 
â”‚   â”‚   â”‚  221 â”‚     /// <summary>
â”‚   â”‚   â”‚  222 â”‚     /// View model for a shared type
â”‚   â”‚   â”‚  223 â”‚     /// </summary>
â”‚   â”‚   â”‚  224 â”‚     public class SharedTypeViewModel : ViewModelBase
â”‚   â”‚   â”‚  225 â”‚     {
â”‚   â”‚   â”‚  226 â”‚         private string _typeName = string.Empty;
â”‚   â”‚   â”‚  227 â”‚         private string _fileName = string.Empty;
â”‚   â”‚   â”‚  228 â”‚         private string _filePath = string.Empty;
â”‚   â”‚   â”‚  229 â”‚         private string _category = string.Empty;
â”‚   â”‚   â”‚  230 â”‚         private string _description = string.Empty;
â”‚   â”‚   â”‚  231 â”‚         private DateTime _importDate = DateTime.UtcNow;
â”‚   â”‚   â”‚  232 â”‚         private long _fileSize;
â”‚   â”‚   â”‚  233 â”‚         private int _usageCount;
â”‚   â”‚   â”‚  234 â”‚         private int _variableCount;
â”‚   â”‚   â”‚  235 â”‚         private string _defaultTargetName = string.Empty;
â”‚   â”‚   â”‚  236 â”‚         private bool _isSelected;
â”‚   â”‚   â”‚  237 â”‚ 
â”‚   â”‚   â”‚  238 â”‚         /// <summary>
â”‚   â”‚   â”‚  239 â”‚         /// The type name
â”‚   â”‚   â”‚  240 â”‚         /// </summary>
â”‚   â”‚   â”‚  241 â”‚         public string TypeName
â”‚   â”‚   â”‚  242 â”‚         {
â”‚   â”‚   â”‚  243 â”‚             get => _typeName;
â”‚   â”‚   â”‚  244 â”‚             set => SetProperty(ref _typeName, value);
â”‚   â”‚   â”‚  245 â”‚         }
â”‚   â”‚   â”‚  246 â”‚ 
â”‚   â”‚   â”‚  247 â”‚         /// <summary>
â”‚   â”‚   â”‚  248 â”‚         /// The file name
â”‚   â”‚   â”‚  249 â”‚         /// </summary>
â”‚   â”‚   â”‚  250 â”‚         public string FileName
â”‚   â”‚   â”‚  251 â”‚         {
â”‚   â”‚   â”‚  252 â”‚             get => _fileName;
â”‚   â”‚   â”‚  253 â”‚             set => SetProperty(ref _fileName, value);
â”‚   â”‚   â”‚  254 â”‚         }
â”‚   â”‚   â”‚  255 â”‚ 
â”‚   â”‚   â”‚  256 â”‚         /// <summary>
â”‚   â”‚   â”‚  257 â”‚         /// The file path
â”‚   â”‚   â”‚  258 â”‚         /// </summary>
â”‚   â”‚   â”‚  259 â”‚         public string FilePath
â”‚   â”‚   â”‚  260 â”‚         {
â”‚   â”‚   â”‚  261 â”‚             get => _filePath;
â”‚   â”‚   â”‚  262 â”‚             set => SetProperty(ref _filePath, value);
â”‚   â”‚   â”‚  263 â”‚         }
â”‚   â”‚   â”‚  264 â”‚ 
â”‚   â”‚   â”‚  265 â”‚         /// <summary>
â”‚   â”‚   â”‚  266 â”‚         /// The category
â”‚   â”‚   â”‚  267 â”‚         /// </summary>
â”‚   â”‚   â”‚  268 â”‚         public string Category
â”‚   â”‚   â”‚  269 â”‚         {
â”‚   â”‚   â”‚  270 â”‚             get => _category;
â”‚   â”‚   â”‚  271 â”‚             set => SetProperty(ref _category, value);
â”‚   â”‚   â”‚  272 â”‚         }
â”‚   â”‚   â”‚  273 â”‚ 
â”‚   â”‚   â”‚  274 â”‚         /// <summary>
â”‚   â”‚   â”‚  275 â”‚         /// The description
â”‚   â”‚   â”‚  276 â”‚         /// </summary>
â”‚   â”‚   â”‚  277 â”‚         public string Description
â”‚   â”‚   â”‚  278 â”‚         {
â”‚   â”‚   â”‚  279 â”‚             get => _description;
â”‚   â”‚   â”‚  280 â”‚             set => SetProperty(ref _description, value);
â”‚   â”‚   â”‚  281 â”‚         }
â”‚   â”‚   â”‚  282 â”‚ 
â”‚   â”‚   â”‚  283 â”‚         /// <summary>
â”‚   â”‚   â”‚  284 â”‚         /// The date the type was imported
â”‚   â”‚   â”‚  285 â”‚         /// </summary>
â”‚   â”‚   â”‚  286 â”‚         public DateTime ImportDate
â”‚   â”‚   â”‚  287 â”‚         {
â”‚   â”‚   â”‚  288 â”‚             get => _importDate;
â”‚   â”‚   â”‚  289 â”‚             set => SetProperty(ref _importDate, value);
â”‚   â”‚   â”‚  290 â”‚         }
â”‚   â”‚   â”‚  291 â”‚ 
â”‚   â”‚   â”‚  292 â”‚         /// <summary>
â”‚   â”‚   â”‚  293 â”‚         /// The file size in bytes
â”‚   â”‚   â”‚  294 â”‚         /// </summary>
â”‚   â”‚   â”‚  295 â”‚         public long FileSize
â”‚   â”‚   â”‚  296 â”‚         {
â”‚   â”‚   â”‚  297 â”‚             get => _fileSize;
â”‚   â”‚   â”‚  298 â”‚             set => SetProperty(ref _fileSize, value);
â”‚   â”‚   â”‚  299 â”‚         }
â”‚   â”‚   â”‚  300 â”‚ 
â”‚   â”‚   â”‚  301 â”‚         /// <summary>
â”‚   â”‚   â”‚  302 â”‚         /// The number of times the type has been used
â”‚   â”‚   â”‚  303 â”‚         /// </summary>
â”‚   â”‚   â”‚  304 â”‚         public int UsageCount
â”‚   â”‚   â”‚  305 â”‚         {
â”‚   â”‚   â”‚  306 â”‚             get => _usageCount;
â”‚   â”‚   â”‚  307 â”‚             set => SetProperty(ref _usageCount, value);
â”‚   â”‚   â”‚  308 â”‚         }
â”‚   â”‚   â”‚  309 â”‚ 
â”‚   â”‚   â”‚  310 â”‚         /// <summary>
â”‚   â”‚   â”‚  311 â”‚         /// The number of variables in the type
â”‚   â”‚   â”‚  312 â”‚         /// </summary>
â”‚   â”‚   â”‚  313 â”‚         public int VariableCount
â”‚   â”‚   â”‚  314 â”‚         {
â”‚   â”‚   â”‚  315 â”‚             get => _variableCount;
â”‚   â”‚   â”‚  316 â”‚             set => SetProperty(ref _variableCount, value);
â”‚   â”‚   â”‚  317 â”‚         }
â”‚   â”‚   â”‚  318 â”‚ 
â”‚   â”‚   â”‚  319 â”‚         /// <summary>
â”‚   â”‚   â”‚  320 â”‚         /// The default target name
â”‚   â”‚   â”‚  321 â”‚         /// </summary>
â”‚   â”‚   â”‚  322 â”‚         public string DefaultTargetName
â”‚   â”‚   â”‚  323 â”‚         {
â”‚   â”‚   â”‚  324 â”‚             get => _defaultTargetName;
â”‚   â”‚   â”‚  325 â”‚             set => SetProperty(ref _defaultTargetName, value);
â”‚   â”‚   â”‚  326 â”‚         }
â”‚   â”‚   â”‚  327 â”‚ 
â”‚   â”‚   â”‚  328 â”‚         /// <summary>
â”‚   â”‚   â”‚  329 â”‚         /// Whether the type is selected in the UI
â”‚   â”‚   â”‚  330 â”‚         /// </summary>
â”‚   â”‚   â”‚  331 â”‚         public bool IsSelected
â”‚   â”‚   â”‚  332 â”‚         {
â”‚   â”‚   â”‚  333 â”‚             get => _isSelected;
â”‚   â”‚   â”‚  334 â”‚             set => SetProperty(ref _isSelected, value);
â”‚   â”‚   â”‚  335 â”‚         }
â”‚   â”‚   â”‚  336 â”‚     }
â”‚   â”‚   â”‚  337 â”‚ 
â”‚   â”‚   â”‚  338 â”‚     /// <summary>
â”‚   â”‚   â”‚  339 â”‚     /// View model for a custom type file
â”‚   â”‚   â”‚  340 â”‚     /// </summary>
â”‚   â”‚   â”‚  341 â”‚     public class CustomTypeFileViewModel : ViewModelBase
â”‚   â”‚   â”‚  342 â”‚     {
â”‚   â”‚   â”‚  343 â”‚         private string _fileName = string.Empty;
â”‚   â”‚   â”‚  344 â”‚         private int _typeCount;
â”‚   â”‚   â”‚  345 â”‚         private DateTime _lastModified = DateTime.UtcNow;
â”‚   â”‚   â”‚  346 â”‚         private string _description = string.Empty;
â”‚   â”‚   â”‚  347 â”‚         private bool _isSelected;
â”‚   â”‚   â”‚  348 â”‚ 
â”‚   â”‚   â”‚  349 â”‚         /// <summary>
â”‚   â”‚   â”‚  350 â”‚         /// The file name
â”‚   â”‚   â”‚  351 â”‚         /// </summary>
â”‚   â”‚   â”‚  352 â”‚         public string FileName
â”‚   â”‚   â”‚  353 â”‚         {
â”‚   â”‚   â”‚  354 â”‚             get => _fileName;
â”‚   â”‚   â”‚  355 â”‚             set => SetProperty(ref _fileName, value);
â”‚   â”‚   â”‚  356 â”‚         }
â”‚   â”‚   â”‚  357 â”‚ 
â”‚   â”‚   â”‚  358 â”‚         /// <summary>
â”‚   â”‚   â”‚  359 â”‚         /// The number of types in the file
â”‚   â”‚   â”‚  360 â”‚         /// </summary>
â”‚   â”‚   â”‚  361 â”‚         public int TypeCount
â”‚   â”‚   â”‚  362 â”‚         {
â”‚   â”‚   â”‚  363 â”‚             get => _typeCount;
â”‚   â”‚   â”‚  364 â”‚             set => SetProperty(ref _typeCount, value);
â”‚   â”‚   â”‚  365 â”‚         }
â”‚   â”‚   â”‚  366 â”‚ 
â”‚   â”‚   â”‚  367 â”‚         /// <summary>
â”‚   â”‚   â”‚  368 â”‚         /// The date the file was last modified
â”‚   â”‚   â”‚  369 â”‚         /// </summary>
â”‚   â”‚   â”‚  370 â”‚         public DateTime LastModified
â”‚   â”‚   â”‚  371 â”‚         {
â”‚   â”‚   â”‚  372 â”‚             get => _lastModified;
â”‚   â”‚   â”‚  373 â”‚             set => SetProperty(ref _lastModified, value);
â”‚   â”‚   â”‚  374 â”‚         }
â”‚   â”‚   â”‚  375 â”‚ 
â”‚   â”‚   â”‚  376 â”‚         /// <summary>
â”‚   â”‚   â”‚  377 â”‚         /// The description
â”‚   â”‚   â”‚  378 â”‚         /// </summary>
â”‚   â”‚   â”‚  379 â”‚         public string Description
â”‚   â”‚   â”‚  380 â”‚         {
â”‚   â”‚   â”‚  381 â”‚             get => _description;
â”‚   â”‚   â”‚  382 â”‚             set => SetProperty(ref _description, value);
â”‚   â”‚   â”‚  383 â”‚         }
â”‚   â”‚   â”‚  384 â”‚ 
â”‚   â”‚   â”‚  385 â”‚         /// <summary>
â”‚   â”‚   â”‚  386 â”‚         /// Whether the file is selected in the UI
â”‚   â”‚   â”‚  387 â”‚         /// </summary>
â”‚   â”‚   â”‚  388 â”‚         public bool IsSelected
â”‚   â”‚   â”‚  389 â”‚         {
â”‚   â”‚   â”‚  390 â”‚             get => _isSelected;
â”‚   â”‚   â”‚  391 â”‚             set => SetProperty(ref _isSelected, value);
â”‚   â”‚   â”‚  392 â”‚         }
â”‚   â”‚   â”‚  393 â”‚     }
â”‚   â”‚   â”‚  394 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ProjectsViewModel.cs (7.22 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ProjectsViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚    4 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    5 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚   â”‚   â”‚    6 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    7 â”‚ using test.Application.Services;
â”‚   â”‚   â”‚    8 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚    9 â”‚ 
â”‚   â”‚   â”‚   10 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   11 â”‚ {
â”‚   â”‚   â”‚   12 â”‚     /// <summary>
â”‚   â”‚   â”‚   13 â”‚     /// View model for the projects view
â”‚   â”‚   â”‚   14 â”‚     /// </summary>
â”‚   â”‚   â”‚   15 â”‚     public class ProjectsViewModel : ViewModelBase
â”‚   â”‚   â”‚   16 â”‚     {
â”‚   â”‚   â”‚   17 â”‚         private readonly ProjectService _projectService;
â”‚   â”‚   â”‚   18 â”‚         private readonly IErrorHandler _errorHandler;
â”‚   â”‚   â”‚   19 â”‚         private readonly IDialogService _dialogService;
â”‚   â”‚   â”‚   20 â”‚         private readonly ILogger<ProjectsViewModel> _logger;
â”‚   â”‚   â”‚   21 â”‚ 
â”‚   â”‚   â”‚   22 â”‚         private ObservableCollection<ProjectViewModel> _projects = new();
â”‚   â”‚   â”‚   23 â”‚         private ProjectViewModel _selectedProject;
â”‚   â”‚   â”‚   24 â”‚ 
â”‚   â”‚   â”‚   25 â”‚         /// <summary>
â”‚   â”‚   â”‚   26 â”‚         /// The collection of projects
â”‚   â”‚   â”‚   27 â”‚         /// </summary>
â”‚   â”‚   â”‚   28 â”‚         public ObservableCollection<ProjectViewModel> Projects
â”‚   â”‚   â”‚   29 â”‚         {
â”‚   â”‚   â”‚   30 â”‚             get => _projects;
â”‚   â”‚   â”‚   31 â”‚             set => SetProperty(ref _projects, value);
â”‚   â”‚   â”‚   32 â”‚         }
â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   35 â”‚         /// The currently selected project
â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   37 â”‚         public ProjectViewModel SelectedProject
â”‚   â”‚   â”‚   38 â”‚         {
â”‚   â”‚   â”‚   39 â”‚             get => _selectedProject;
â”‚   â”‚   â”‚   40 â”‚             set => SetProperty(ref _selectedProject, value);
â”‚   â”‚   â”‚   41 â”‚         }
â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   43 â”‚         /// <summary>
â”‚   â”‚   â”‚   44 â”‚         /// Command to add a new project
â”‚   â”‚   â”‚   45 â”‚         /// </summary>
â”‚   â”‚   â”‚   46 â”‚         public IRelayCommand AddProjectCommand { get; }
â”‚   â”‚   â”‚   47 â”‚ 
â”‚   â”‚   â”‚   48 â”‚         /// <summary>
â”‚   â”‚   â”‚   49 â”‚         /// Command to delete a project
â”‚   â”‚   â”‚   50 â”‚         /// </summary>
â”‚   â”‚   â”‚   51 â”‚         public IRelayCommand<ProjectViewModel> DeleteProjectCommand { get; }
â”‚   â”‚   â”‚   52 â”‚ 
â”‚   â”‚   â”‚   53 â”‚         /// <summary>
â”‚   â”‚   â”‚   54 â”‚         /// Command to refresh the projects list
â”‚   â”‚   â”‚   55 â”‚         /// </summary>
â”‚   â”‚   â”‚   56 â”‚         public IAsyncRelayCommand RefreshProjectsCommand { get; }
â”‚   â”‚   â”‚   57 â”‚ 
â”‚   â”‚   â”‚   58 â”‚         /// <summary>
â”‚   â”‚   â”‚   59 â”‚         /// Creates a design-time projects view model
â”‚   â”‚   â”‚   60 â”‚         /// </summary>
â”‚   â”‚   â”‚   61 â”‚         public ProjectsViewModel()
â”‚   â”‚   â”‚   62 â”‚         {
â”‚   â”‚   â”‚   63 â”‚             // Design-time constructor
â”‚   â”‚   â”‚   64 â”‚             try
â”‚   â”‚   â”‚   65 â”‚             {
â”‚   â”‚   â”‚   66 â”‚                 // Add some design-time data for tooling
â”‚   â”‚   â”‚   67 â”‚                 Projects.Add(new ProjectViewModel
â”‚   â”‚   â”‚   68 â”‚                 {
â”‚   â”‚   â”‚   69 â”‚                     ProjectId = "project1",
â”‚   â”‚   â”‚   70 â”‚                     Name = "Sample Project",
â”‚   â”‚   â”‚   71 â”‚                     Description = "This is a sample project for design-time"
â”‚   â”‚   â”‚   72 â”‚                 });
â”‚   â”‚   â”‚   73 â”‚             }
â”‚   â”‚   â”‚   74 â”‚             catch
â”‚   â”‚   â”‚   75 â”‚             {
â”‚   â”‚   â”‚   76 â”‚                 // Ignore any errors in design mode
â”‚   â”‚   â”‚   77 â”‚             }
â”‚   â”‚   â”‚   78 â”‚         }
â”‚   â”‚   â”‚   79 â”‚ 
â”‚   â”‚   â”‚   80 â”‚         /// <summary>
â”‚   â”‚   â”‚   81 â”‚         /// Creates a new projects view model
â”‚   â”‚   â”‚   82 â”‚         /// </summary>
â”‚   â”‚   â”‚   83 â”‚         public ProjectsViewModel(
â”‚   â”‚   â”‚   84 â”‚             ProjectService projectService,
â”‚   â”‚   â”‚   85 â”‚             IErrorHandler errorHandler,
â”‚   â”‚   â”‚   86 â”‚             IDialogService dialogService,
â”‚   â”‚   â”‚   87 â”‚             ILogger<ProjectsViewModel> logger)
â”‚   â”‚   â”‚   88 â”‚         {
â”‚   â”‚   â”‚   89 â”‚             _projectService = projectService ?? throw new ArgumentNullException(nameof(projectService));
â”‚   â”‚   â”‚   90 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚   â”‚   â”‚   91 â”‚             _dialogService = dialogService ?? throw new ArgumentNullException(nameof(dialogService));
â”‚   â”‚   â”‚   92 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚   â”‚   â”‚   93 â”‚ 
â”‚   â”‚   â”‚   94 â”‚             // Initialize commands using CommunityToolkit.Mvvm commands
â”‚   â”‚   â”‚   95 â”‚             AddProjectCommand = new AsyncRelayCommand(AddProjectAsync);
â”‚   â”‚   â”‚   96 â”‚             DeleteProjectCommand = new AsyncRelayCommand<ProjectViewModel>(DeleteProjectAsync, CanDeleteProject);
â”‚   â”‚   â”‚   97 â”‚             RefreshProjectsCommand = new AsyncRelayCommand(LoadProjectsAsync);
â”‚   â”‚   â”‚   98 â”‚ 
â”‚   â”‚   â”‚   99 â”‚             // Load projects on startup
â”‚   â”‚   â”‚  100 â”‚             LoadProjectsAsync().ConfigureAwait(false);
â”‚   â”‚   â”‚  101 â”‚         }
â”‚   â”‚   â”‚  102 â”‚ 
â”‚   â”‚   â”‚  103 â”‚         /// <summary>
â”‚   â”‚   â”‚  104 â”‚         /// Loads projects from the service
â”‚   â”‚   â”‚  105 â”‚         /// </summary>
â”‚   â”‚   â”‚  106 â”‚         private async Task LoadProjectsAsync()
â”‚   â”‚   â”‚  107 â”‚         {
â”‚   â”‚   â”‚  108 â”‚             await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  109 â”‚             {
â”‚   â”‚   â”‚  110 â”‚                 var projectVms = await _projectService.GetAllProjectsAsync();
â”‚   â”‚   â”‚  111 â”‚                 Projects.Clear();
â”‚   â”‚   â”‚  112 â”‚ 
â”‚   â”‚   â”‚  113 â”‚                 foreach (var project in projectVms)
â”‚   â”‚   â”‚  114 â”‚                 {
â”‚   â”‚   â”‚  115 â”‚                     Projects.Add(project);
â”‚   â”‚   â”‚  116 â”‚                 }
â”‚   â”‚   â”‚  117 â”‚ 
â”‚   â”‚   â”‚  118 â”‚                 return true;
â”‚   â”‚   â”‚  119 â”‚             }, $"Loaded {Projects.Count} projects", "Error loading projects");
â”‚   â”‚   â”‚  120 â”‚         }
â”‚   â”‚   â”‚  121 â”‚ 
â”‚   â”‚   â”‚  122 â”‚         /// <summary>
â”‚   â”‚   â”‚  123 â”‚         /// Adds a new project
â”‚   â”‚   â”‚  124 â”‚         /// </summary>
â”‚   â”‚   â”‚  125 â”‚         private async Task AddProjectAsync()
â”‚   â”‚   â”‚  126 â”‚         {
â”‚   â”‚   â”‚  127 â”‚             try
â”‚   â”‚   â”‚  128 â”‚             {
â”‚   â”‚   â”‚  129 â”‚                 string projectName = await _dialogService.ShowInputDialogAsync(
â”‚   â”‚   â”‚  130 â”‚                     "New Project",
â”‚   â”‚   â”‚  131 â”‚                     "Enter project name:",
â”‚   â”‚   â”‚  132 â”‚                     "New Project");
â”‚   â”‚   â”‚  133 â”‚ 
â”‚   â”‚   â”‚  134 â”‚                 if (string.IsNullOrWhiteSpace(projectName))
â”‚   â”‚   â”‚  135 â”‚                     return;
â”‚   â”‚   â”‚  136 â”‚ 
â”‚   â”‚   â”‚  137 â”‚                 string description = await _dialogService.ShowInputDialogAsync(
â”‚   â”‚   â”‚  138 â”‚                     "Project Description",
â”‚   â”‚   â”‚  139 â”‚                     "Enter project description (optional):",
â”‚   â”‚   â”‚  140 â”‚                     "");
â”‚   â”‚   â”‚  141 â”‚ 
â”‚   â”‚   â”‚  142 â”‚                 await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  143 â”‚                 {
â”‚   â”‚   â”‚  144 â”‚                     var project = await _projectService.CreateProjectAsync(projectName, description);
â”‚   â”‚   â”‚  145 â”‚                     Projects.Add(project);
â”‚   â”‚   â”‚  146 â”‚                     SelectedProject = project;
â”‚   â”‚   â”‚  147 â”‚                     return true;
â”‚   â”‚   â”‚  148 â”‚                 }, $"Created project: {projectName}", "Error creating project");
â”‚   â”‚   â”‚  149 â”‚             }
â”‚   â”‚   â”‚  150 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  151 â”‚             {
â”‚   â”‚   â”‚  152 â”‚                 await _errorHandler.HandleExceptionWithUIAsync(ex, "AddProject");
â”‚   â”‚   â”‚  153 â”‚                 SetErrorMessage($"Error creating project: {ex.Message}");
â”‚   â”‚   â”‚  154 â”‚             }
â”‚   â”‚   â”‚  155 â”‚         }
â”‚   â”‚   â”‚  156 â”‚ 
â”‚   â”‚   â”‚  157 â”‚         /// <summary>
â”‚   â”‚   â”‚  158 â”‚         /// Deletes a project
â”‚   â”‚   â”‚  159 â”‚         /// </summary>
â”‚   â”‚   â”‚  160 â”‚         private async Task DeleteProjectAsync(ProjectViewModel project)
â”‚   â”‚   â”‚  161 â”‚         {
â”‚   â”‚   â”‚  162 â”‚             if (project == null)
â”‚   â”‚   â”‚  163 â”‚                 return;
â”‚   â”‚   â”‚  164 â”‚ 
â”‚   â”‚   â”‚  165 â”‚             try
â”‚   â”‚   â”‚  166 â”‚             {
â”‚   â”‚   â”‚  167 â”‚                 bool confirm = await _dialogService.ShowConfirmDialogAsync(
â”‚   â”‚   â”‚  168 â”‚                     "Delete Project",
â”‚   â”‚   â”‚  169 â”‚                     $"Are you sure you want to delete project '{project.Name}'? This action cannot be undone.");
â”‚   â”‚   â”‚  170 â”‚ 
â”‚   â”‚   â”‚  171 â”‚                 if (!confirm)
â”‚   â”‚   â”‚  172 â”‚                     return;
â”‚   â”‚   â”‚  173 â”‚ 
â”‚   â”‚   â”‚  174 â”‚                 await ExecuteWithBusyIndicationAsync(async () =>
â”‚   â”‚   â”‚  175 â”‚                 {
â”‚   â”‚   â”‚  176 â”‚                     bool success = await _projectService.DeleteProjectAsync(project.ProjectId);
â”‚   â”‚   â”‚  177 â”‚                     if (success)
â”‚   â”‚   â”‚  178 â”‚                     {
â”‚   â”‚   â”‚  179 â”‚                         Projects.Remove(project);
â”‚   â”‚   â”‚  180 â”‚                         if (SelectedProject == project)
â”‚   â”‚   â”‚  181 â”‚                         {
â”‚   â”‚   â”‚  182 â”‚                             SelectedProject = Projects.FirstOrDefault();
â”‚   â”‚   â”‚  183 â”‚                         }
â”‚   â”‚   â”‚  184 â”‚                         return true;
â”‚   â”‚   â”‚  185 â”‚                     }
â”‚   â”‚   â”‚  186 â”‚                     else
â”‚   â”‚   â”‚  187 â”‚                     {
â”‚   â”‚   â”‚  188 â”‚                         SetErrorMessage($"Failed to delete project: {project.Name}");
â”‚   â”‚   â”‚  189 â”‚                         return false;
â”‚   â”‚   â”‚  190 â”‚                     }
â”‚   â”‚   â”‚  191 â”‚                 }, $"Deleted project: {project.Name}", "Error deleting project");
â”‚   â”‚   â”‚  192 â”‚             }
â”‚   â”‚   â”‚  193 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  194 â”‚             {
â”‚   â”‚   â”‚  195 â”‚                 await _errorHandler.HandleExceptionWithUIAsync(ex, "DeleteProject");
â”‚   â”‚   â”‚  196 â”‚                 SetErrorMessage($"Error deleting project: {ex.Message}");
â”‚   â”‚   â”‚  197 â”‚             }
â”‚   â”‚   â”‚  198 â”‚         }
â”‚   â”‚   â”‚  199 â”‚ 
â”‚   â”‚   â”‚  200 â”‚         /// <summary>
â”‚   â”‚   â”‚  201 â”‚         /// Determines whether a project can be deleted
â”‚   â”‚   â”‚  202 â”‚         /// </summary>
â”‚   â”‚   â”‚  203 â”‚         private bool CanDeleteProject(ProjectViewModel project)
â”‚   â”‚   â”‚  204 â”‚         {
â”‚   â”‚   â”‚  205 â”‚             return project != null;
â”‚   â”‚   â”‚  206 â”‚         }
â”‚   â”‚   â”‚  207 â”‚     }
â”‚   â”‚   â”‚  208 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ SettingsViewModel.cs (10.42 KB, 2025-03-12 14:46:55)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: SettingsViewModel.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚    3 â”‚ using System.Threading;
â”‚   â”‚   â”‚    4 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    5 â”‚ using Avalonia.Controls;
â”‚   â”‚   â”‚    6 â”‚ using Avalonia.Styling;
â”‚   â”‚   â”‚    7 â”‚ using CommunityToolkit.Mvvm.ComponentModel;
â”‚   â”‚   â”‚    8 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚   â”‚   â”‚    9 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚   10 â”‚ using Serilog.Events;
â”‚   â”‚   â”‚   11 â”‚ using SukiUI;
â”‚   â”‚   â”‚   12 â”‚ using SukiUI.Theme;
â”‚   â”‚   â”‚   13 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   14 â”‚ using test.Infrastructure;
â”‚   â”‚   â”‚   15 â”‚ 
â”‚   â”‚   â”‚   16 â”‚ namespace test.ViewModels
â”‚   â”‚   â”‚   17 â”‚ {
â”‚   â”‚   â”‚   18 â”‚     public partial class SettingsViewModel : ViewModelBase
â”‚   â”‚   â”‚   19 â”‚     {
â”‚   â”‚   â”‚   20 â”‚         private readonly ISettingsManager _settingsManager;
â”‚   â”‚   â”‚   21 â”‚         private readonly ILoggingService _loggingService;
â”‚   â”‚   â”‚   22 â”‚         private readonly ILogger<SettingsViewModel> _logger;
â”‚   â”‚   â”‚   23 â”‚         private readonly SukiTheme _theme;
â”‚   â”‚   â”‚   24 â”‚         private bool _isDesignMode;
â”‚   â”‚   â”‚   25 â”‚ 
â”‚   â”‚   â”‚   26 â”‚         // Prevent multiple concurrent theme changes
â”‚   â”‚   â”‚   27 â”‚         private readonly SemaphoreSlim _themeSwitchSemaphore = new SemaphoreSlim(1, 1);
â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   29 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   30 â”‚         private bool _enableLogging;
â”‚   â”‚   â”‚   31 â”‚ 
â”‚   â”‚   â”‚   32 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   33 â”‚         private string _selectedLogLevel = "Information";
â”‚   â”‚   â”‚   34 â”‚ 
â”‚   â”‚   â”‚   35 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   36 â”‚         private bool _deleteLogsOnExit;
â”‚   â”‚   â”‚   37 â”‚ 
â”‚   â”‚   â”‚   38 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   39 â”‚         private string _settingsPath = string.Empty;
â”‚   â”‚   â”‚   40 â”‚ 
â”‚   â”‚   â”‚   41 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   42 â”‚         private string _logFilePath = string.Empty;
â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   44 â”‚         [ObservableProperty]
â”‚   â”‚   â”‚   45 â”‚         private bool _isLightTheme;
â”‚   â”‚   â”‚   46 â”‚ 
â”‚   â”‚   â”‚   47 â”‚         public List<string> LogLevels { get; } = new()
â”‚   â”‚   â”‚   48 â”‚         {
â”‚   â”‚   â”‚   49 â”‚             "Verbose",
â”‚   â”‚   â”‚   50 â”‚             "Debug",
â”‚   â”‚   â”‚   51 â”‚             "Information",
â”‚   â”‚   â”‚   52 â”‚             "Warning",
â”‚   â”‚   â”‚   53 â”‚             "Error",
â”‚   â”‚   â”‚   54 â”‚             "Fatal"
â”‚   â”‚   â”‚   55 â”‚         };
â”‚   â”‚   â”‚   56 â”‚ 
â”‚   â”‚   â”‚   57 â”‚         public SettingsViewModel()
â”‚   â”‚   â”‚   58 â”‚         {
â”‚   â”‚   â”‚   59 â”‚             // Design-time constructor
â”‚   â”‚   â”‚   60 â”‚             _isDesignMode = Design.IsDesignMode;
â”‚   â”‚   â”‚   61 â”‚             IsLightTheme = true;
â”‚   â”‚   â”‚   62 â”‚             EnableLogging = true;
â”‚   â”‚   â”‚   63 â”‚             SelectedLogLevel = "Information";
â”‚   â”‚   â”‚   64 â”‚             SettingsPath = "C:\\AppData\\Settings.json"; // Fake path for design-time
â”‚   â”‚   â”‚   65 â”‚             LogFilePath = "C:\\AppData\\Logs\\app_20250312.log"; // Fake path for design-time
â”‚   â”‚   â”‚   66 â”‚         }
â”‚   â”‚   â”‚   67 â”‚ 
â”‚   â”‚   â”‚   68 â”‚         public SettingsViewModel(ISettingsManager settingsManager, ILoggingService loggingService = null, ILogger<SettingsViewModel> logger = null)
â”‚   â”‚   â”‚   69 â”‚         {
â”‚   â”‚   â”‚   70 â”‚             // Detect design mode
â”‚   â”‚   â”‚   71 â”‚             _isDesignMode = Design.IsDesignMode;
â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   73 â”‚             // Store services, allowing nulls for design mode
â”‚   â”‚   â”‚   74 â”‚             _settingsManager = settingsManager ?? throw new ArgumentNullException(nameof(settingsManager));
â”‚   â”‚   â”‚   75 â”‚             _loggingService = loggingService;
â”‚   â”‚   â”‚   76 â”‚             _logger = logger;
â”‚   â”‚   â”‚   77 â”‚ 
â”‚   â”‚   â”‚   78 â”‚             try
â”‚   â”‚   â”‚   79 â”‚             {
â”‚   â”‚   â”‚   80 â”‚                 // Get theme instance safely
â”‚   â”‚   â”‚   81 â”‚                 _theme = SukiTheme.GetInstance();
â”‚   â”‚   â”‚   82 â”‚             }
â”‚   â”‚   â”‚   83 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   84 â”‚             {
â”‚   â”‚   â”‚   85 â”‚                 // In design mode or if theme can't be accessed, just continue
â”‚   â”‚   â”‚   86 â”‚                 if (!_isDesignMode)
â”‚   â”‚   â”‚   87 â”‚                 {
â”‚   â”‚   â”‚   88 â”‚                     _logger?.LogError(ex, "Error getting theme instance");
â”‚   â”‚   â”‚   89 â”‚                 }
â”‚   â”‚   â”‚   90 â”‚             }
â”‚   â”‚   â”‚   91 â”‚ 
â”‚   â”‚   â”‚   92 â”‚             // Set initial values safely
â”‚   â”‚   â”‚   93 â”‚             if (_settingsManager != null)
â”‚   â”‚   â”‚   94 â”‚             {
â”‚   â”‚   â”‚   95 â”‚                 try
â”‚   â”‚   â”‚   96 â”‚                 {
â”‚   â”‚   â”‚   97 â”‚                     SettingsPath = _settingsManager.GetSettingsPath();
â”‚   â”‚   â”‚   98 â”‚ 
â”‚   â”‚   â”‚   99 â”‚                     // Get current settings
â”‚   â”‚   â”‚  100 â”‚                     var settings = _settingsManager.GetCurrentSettings();
â”‚   â”‚   â”‚  101 â”‚                     if (settings != null)
â”‚   â”‚   â”‚  102 â”‚                     {
â”‚   â”‚   â”‚  103 â”‚                         EnableLogging = settings.EnableLogging;
â”‚   â”‚   â”‚  104 â”‚                         SelectedLogLevel = settings.LogLevel ?? "Information";
â”‚   â”‚   â”‚  105 â”‚                         DeleteLogsOnExit = settings.DeleteLogsOnExit;
â”‚   â”‚   â”‚  106 â”‚                         IsLightTheme = settings.IsLightTheme;
â”‚   â”‚   â”‚  107 â”‚                     }
â”‚   â”‚   â”‚  108 â”‚                 }
â”‚   â”‚   â”‚  109 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚  110 â”‚                 {
â”‚   â”‚   â”‚  111 â”‚                     // Ignore errors in design mode
â”‚   â”‚   â”‚  112 â”‚                     if (!_isDesignMode)
â”‚   â”‚   â”‚  113 â”‚                     {
â”‚   â”‚   â”‚  114 â”‚                         _logger?.LogError(ex, "Error getting settings path");
â”‚   â”‚   â”‚  115 â”‚                     }
â”‚   â”‚   â”‚  116 â”‚                 }
â”‚   â”‚   â”‚  117 â”‚             }
â”‚   â”‚   â”‚  118 â”‚ 
â”‚   â”‚   â”‚  119 â”‚             // Set log file path
â”‚   â”‚   â”‚  120 â”‚             if (_loggingService != null)
â”‚   â”‚   â”‚  121 â”‚             {
â”‚   â”‚   â”‚  122 â”‚                 try
â”‚   â”‚   â”‚  123 â”‚                 {
â”‚   â”‚   â”‚  124 â”‚                     LogFilePath = _loggingService.LogFilePath;
â”‚   â”‚   â”‚  125 â”‚                     _logger?.LogDebug("Log file path set to: {LogFilePath}", LogFilePath);
â”‚   â”‚   â”‚  126 â”‚                 }
â”‚   â”‚   â”‚  127 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚  128 â”‚                 {
â”‚   â”‚   â”‚  129 â”‚                     if (!_isDesignMode)
â”‚   â”‚   â”‚  130 â”‚                     {
â”‚   â”‚   â”‚  131 â”‚                         _logger?.LogError(ex, "Error getting log file path");
â”‚   â”‚   â”‚  132 â”‚                     }
â”‚   â”‚   â”‚  133 â”‚                 }
â”‚   â”‚   â”‚  134 â”‚             }
â”‚   â”‚   â”‚  135 â”‚ 
â”‚   â”‚   â”‚  136 â”‚             // Try to get the current theme state safely
â”‚   â”‚   â”‚  137 â”‚             if (_theme != null)
â”‚   â”‚   â”‚  138 â”‚             {
â”‚   â”‚   â”‚  139 â”‚                 try
â”‚   â”‚   â”‚  140 â”‚                 {
â”‚   â”‚   â”‚  141 â”‚                     IsLightTheme = _theme.ActiveBaseTheme == ThemeVariant.Light;
â”‚   â”‚   â”‚  142 â”‚                     _logger?.LogDebug("Detected theme from SukiTheme: {Theme}", IsLightTheme ? "Light" : "Dark");
â”‚   â”‚   â”‚  143 â”‚ 
â”‚   â”‚   â”‚  144 â”‚                     // Only subscribe to theme changes if we're not in design mode
â”‚   â”‚   â”‚  145 â”‚                     if (!_isDesignMode)
â”‚   â”‚   â”‚  146 â”‚                     {
â”‚   â”‚   â”‚  147 â”‚                         _theme.OnBaseThemeChanged += OnThemeChanged;
â”‚   â”‚   â”‚  148 â”‚                     }
â”‚   â”‚   â”‚  149 â”‚                 }
â”‚   â”‚   â”‚  150 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚  151 â”‚                 {
â”‚   â”‚   â”‚  152 â”‚                     // Ignore errors in design mode
â”‚   â”‚   â”‚  153 â”‚                     if (!_isDesignMode)
â”‚   â”‚   â”‚  154 â”‚                     {
â”‚   â”‚   â”‚  155 â”‚                         _logger?.LogError(ex, "Error detecting current theme");
â”‚   â”‚   â”‚  156 â”‚                     }
â”‚   â”‚   â”‚  157 â”‚                 }
â”‚   â”‚   â”‚  158 â”‚             }
â”‚   â”‚   â”‚  159 â”‚ 
â”‚   â”‚   â”‚  160 â”‚             // Only set up property change handlers if we're not in design mode
â”‚   â”‚   â”‚  161 â”‚             if (!_isDesignMode)
â”‚   â”‚   â”‚  162 â”‚             {
â”‚   â”‚   â”‚  163 â”‚                 PropertyChanged += async (s, e) =>
â”‚   â”‚   â”‚  164 â”‚                 {
â”‚   â”‚   â”‚  165 â”‚                     switch (e.PropertyName)
â”‚   â”‚   â”‚  166 â”‚                     {
â”‚   â”‚   â”‚  167 â”‚                         case nameof(EnableLogging):
â”‚   â”‚   â”‚  168 â”‚                             if (_loggingService != null)
â”‚   â”‚   â”‚  169 â”‚                             {
â”‚   â”‚   â”‚  170 â”‚                                 _loggingService.EnableLogging(EnableLogging);
â”‚   â”‚   â”‚  171 â”‚                                 _logger?.LogDebug("Logging enabled set to {EnableLogging}", EnableLogging);
â”‚   â”‚   â”‚  172 â”‚                             }
â”‚   â”‚   â”‚  173 â”‚                             await SaveSettingsAsync();
â”‚   â”‚   â”‚  174 â”‚                             break;
â”‚   â”‚   â”‚  175 â”‚ 
â”‚   â”‚   â”‚  176 â”‚                         case nameof(SelectedLogLevel):
â”‚   â”‚   â”‚  177 â”‚                             if (_loggingService != null && Enum.TryParse<LogEventLevel>(SelectedLogLevel, out var level))
â”‚   â”‚   â”‚  178 â”‚                             {
â”‚   â”‚   â”‚  179 â”‚                                 _loggingService.SetLogLevel(level);
â”‚   â”‚   â”‚  180 â”‚                                 _logger?.LogDebug("Log level set to {Level}", level);
â”‚   â”‚   â”‚  181 â”‚                             }
â”‚   â”‚   â”‚  182 â”‚                             await SaveSettingsAsync();
â”‚   â”‚   â”‚  183 â”‚                             break;
â”‚   â”‚   â”‚  184 â”‚ 
â”‚   â”‚   â”‚  185 â”‚                         case nameof(IsLightTheme):
â”‚   â”‚   â”‚  186 â”‚                             await ApplyThemeChangeAsync();
â”‚   â”‚   â”‚  187 â”‚                             await SaveSettingsAsync();
â”‚   â”‚   â”‚  188 â”‚                             break;
â”‚   â”‚   â”‚  189 â”‚ 
â”‚   â”‚   â”‚  190 â”‚                         case nameof(DeleteLogsOnExit):
â”‚   â”‚   â”‚  191 â”‚                             await SaveSettingsAsync();
â”‚   â”‚   â”‚  192 â”‚                             break;
â”‚   â”‚   â”‚  193 â”‚                     }
â”‚   â”‚   â”‚  194 â”‚                 };
â”‚   â”‚   â”‚  195 â”‚             }
â”‚   â”‚   â”‚  196 â”‚         }
â”‚   â”‚   â”‚  197 â”‚ 
â”‚   â”‚   â”‚  198 â”‚         // Handle theme changes from external sources
â”‚   â”‚   â”‚  199 â”‚         private void OnThemeChanged(ThemeVariant variant)
â”‚   â”‚   â”‚  200 â”‚         {
â”‚   â”‚   â”‚  201 â”‚             try
â”‚   â”‚   â”‚  202 â”‚             {
â”‚   â”‚   â”‚  203 â”‚                 // Avoid overwriting the same value to prevent loops
â”‚   â”‚   â”‚  204 â”‚                 if (IsLightTheme != (variant == ThemeVariant.Light))
â”‚   â”‚   â”‚  205 â”‚                 {
â”‚   â”‚   â”‚  206 â”‚                     _logger?.LogDebug("Theme changed externally to {Theme}", variant);
â”‚   â”‚   â”‚  207 â”‚                     IsLightTheme = variant == ThemeVariant.Light;
â”‚   â”‚   â”‚  208 â”‚                 }
â”‚   â”‚   â”‚  209 â”‚             }
â”‚   â”‚   â”‚  210 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  211 â”‚             {
â”‚   â”‚   â”‚  212 â”‚                 _logger?.LogError(ex, "Error handling theme change event");
â”‚   â”‚   â”‚  213 â”‚             }
â”‚   â”‚   â”‚  214 â”‚         }
â”‚   â”‚   â”‚  215 â”‚ 
â”‚   â”‚   â”‚  216 â”‚         [RelayCommand]
â”‚   â”‚   â”‚  217 â”‚         private async Task SaveSettingsAsync()
â”‚   â”‚   â”‚  218 â”‚         {
â”‚   â”‚   â”‚  219 â”‚             if (_settingsManager == null || _isDesignMode) return;
â”‚   â”‚   â”‚  220 â”‚ 
â”‚   â”‚   â”‚  221 â”‚             try
â”‚   â”‚   â”‚  222 â”‚             {
â”‚   â”‚   â”‚  223 â”‚                 _logger?.LogDebug("Saving settings: IsLightTheme={IsLightTheme}, EnableLogging={EnableLogging}, LogLevel={LogLevel}",
â”‚   â”‚   â”‚  224 â”‚                     IsLightTheme, EnableLogging, SelectedLogLevel);
â”‚   â”‚   â”‚  225 â”‚ 
â”‚   â”‚   â”‚  226 â”‚                 var settings = new AppSettings
â”‚   â”‚   â”‚  227 â”‚                 {
â”‚   â”‚   â”‚  228 â”‚                     EnableLogging = EnableLogging,
â”‚   â”‚   â”‚  229 â”‚                     LogLevel = SelectedLogLevel,
â”‚   â”‚   â”‚  230 â”‚                     DeleteLogsOnExit = DeleteLogsOnExit,
â”‚   â”‚   â”‚  231 â”‚                     IsLightTheme = IsLightTheme
â”‚   â”‚   â”‚  232 â”‚                 };
â”‚   â”‚   â”‚  233 â”‚ 
â”‚   â”‚   â”‚  234 â”‚                 await _settingsManager.SaveSettingsAsync(settings);
â”‚   â”‚   â”‚  235 â”‚                 SetSuccessMessage("Settings saved successfully");
â”‚   â”‚   â”‚  236 â”‚             }
â”‚   â”‚   â”‚  237 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  238 â”‚             {
â”‚   â”‚   â”‚  239 â”‚                 _logger?.LogError(ex, "Error saving settings");
â”‚   â”‚   â”‚  240 â”‚                 SetErrorMessage($"Error saving settings: {ex.Message}");
â”‚   â”‚   â”‚  241 â”‚             }
â”‚   â”‚   â”‚  242 â”‚         }
â”‚   â”‚   â”‚  243 â”‚ 
â”‚   â”‚   â”‚  244 â”‚         private async Task ApplyThemeChangeAsync()
â”‚   â”‚   â”‚  245 â”‚         {
â”‚   â”‚   â”‚  246 â”‚             if (_theme == null || _isDesignMode) return;
â”‚   â”‚   â”‚  247 â”‚ 
â”‚   â”‚   â”‚  248 â”‚             try
â”‚   â”‚   â”‚  249 â”‚             {
â”‚   â”‚   â”‚  250 â”‚                 // Use semaphore to prevent multiple concurrent theme changes
â”‚   â”‚   â”‚  251 â”‚                 await _themeSwitchSemaphore.WaitAsync();
â”‚   â”‚   â”‚  252 â”‚ 
â”‚   â”‚   â”‚  253 â”‚                 try
â”‚   â”‚   â”‚  254 â”‚                 {
â”‚   â”‚   â”‚  255 â”‚                     _logger?.LogDebug("Applying theme change to {Theme}", IsLightTheme ? "Light" : "Dark");
â”‚   â”‚   â”‚  256 â”‚ 
â”‚   â”‚   â”‚  257 â”‚                     // Temporarily unsubscribe from theme changes to prevent feedback loops
â”‚   â”‚   â”‚  258 â”‚                     _theme.OnBaseThemeChanged -= OnThemeChanged;
â”‚   â”‚   â”‚  259 â”‚ 
â”‚   â”‚   â”‚  260 â”‚                     // Apply the theme change
â”‚   â”‚   â”‚  261 â”‚                     _theme.ChangeBaseTheme(IsLightTheme ? ThemeVariant.Light : ThemeVariant.Dark);
â”‚   â”‚   â”‚  262 â”‚ 
â”‚   â”‚   â”‚  263 â”‚                     // Also set at application level
â”‚   â”‚   â”‚  264 â”‚                     if (Avalonia.Application.Current != null)
â”‚   â”‚   â”‚  265 â”‚                     {
â”‚   â”‚   â”‚  266 â”‚                         Avalonia.Application.Current.RequestedThemeVariant =
â”‚   â”‚   â”‚  267 â”‚                             IsLightTheme ? ThemeVariant.Light : ThemeVariant.Dark;
â”‚   â”‚   â”‚  268 â”‚                     }
â”‚   â”‚   â”‚  269 â”‚ 
â”‚   â”‚   â”‚  270 â”‚                     // Small delay to ensure the theme change has been applied
â”‚   â”‚   â”‚  271 â”‚                     await Task.Delay(50);
â”‚   â”‚   â”‚  272 â”‚                 }
â”‚   â”‚   â”‚  273 â”‚                 finally
â”‚   â”‚   â”‚  274 â”‚                 {
â”‚   â”‚   â”‚  275 â”‚                     // Re-subscribe to theme changes
â”‚   â”‚   â”‚  276 â”‚                     _theme.OnBaseThemeChanged += OnThemeChanged;
â”‚   â”‚   â”‚  277 â”‚                     _themeSwitchSemaphore.Release();
â”‚   â”‚   â”‚  278 â”‚                 }
â”‚   â”‚   â”‚  279 â”‚             }
â”‚   â”‚   â”‚  280 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  281 â”‚             {
â”‚   â”‚   â”‚  282 â”‚                 _logger?.LogError(ex, "Error applying theme change");
â”‚   â”‚   â”‚  283 â”‚                 SetErrorMessage($"Error applying theme change: {ex.Message}");
â”‚   â”‚   â”‚  284 â”‚                 // Ignore exceptions in design mode
â”‚   â”‚   â”‚  285 â”‚                 if (!_isDesignMode) throw;
â”‚   â”‚   â”‚  286 â”‚             }
â”‚   â”‚   â”‚  287 â”‚         }
â”‚   â”‚   â”‚  288 â”‚     }
â”‚   â”‚   â”‚  289 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â””â”€â”€ ğŸ“„ ViewModelBase.cs (5.01 KB, 2025-03-12 07:48:23)
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚ FILE CONTENT: ViewModelBase.cs
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚    3 â”‚ using System.Threading.Tasks;
â”‚       â”‚    4 â”‚ using System.Windows.Input;
â”‚       â”‚    5 â”‚ using CommunityToolkit.Mvvm.ComponentModel;
â”‚       â”‚    6 â”‚ using CommunityToolkit.Mvvm.Input;
â”‚       â”‚    7 â”‚ 
â”‚       â”‚    8 â”‚ namespace test.ViewModels
â”‚       â”‚    9 â”‚ {
â”‚       â”‚   10 â”‚     /// <summary>
â”‚       â”‚   11 â”‚     /// Base class for all view models in the application
â”‚       â”‚   12 â”‚     /// Inherits from ObservableObject to provide property change notification
â”‚       â”‚   13 â”‚     /// Adds common functionality needed across view models
â”‚       â”‚   14 â”‚     /// </summary>
â”‚       â”‚   15 â”‚     public abstract class ViewModelBase : ObservableObject
â”‚       â”‚   16 â”‚     {
â”‚       â”‚   17 â”‚         private bool _isBusy;
â”‚       â”‚   18 â”‚         private string _statusMessage = string.Empty;
â”‚       â”‚   19 â”‚         private bool _hasErrors;
â”‚       â”‚   20 â”‚         private string _errorMessage = string.Empty;
â”‚       â”‚   21 â”‚ 
â”‚       â”‚   22 â”‚         /// <summary>
â”‚       â”‚   23 â”‚         /// Indicates if the view model is currently performing a long-running operation
â”‚       â”‚   24 â”‚         /// </summary>
â”‚       â”‚   25 â”‚         public bool IsBusy
â”‚       â”‚   26 â”‚         {
â”‚       â”‚   27 â”‚             get => _isBusy;
â”‚       â”‚   28 â”‚             protected set => SetProperty(ref _isBusy, value);
â”‚       â”‚   29 â”‚         }
â”‚       â”‚   30 â”‚ 
â”‚       â”‚   31 â”‚         /// <summary>
â”‚       â”‚   32 â”‚         /// Status message to display to the user
â”‚       â”‚   33 â”‚         /// </summary>
â”‚       â”‚   34 â”‚         public string StatusMessage
â”‚       â”‚   35 â”‚         {
â”‚       â”‚   36 â”‚             get => _statusMessage;
â”‚       â”‚   37 â”‚             protected set => SetProperty(ref _statusMessage, value);
â”‚       â”‚   38 â”‚         }
â”‚       â”‚   39 â”‚ 
â”‚       â”‚   40 â”‚         /// <summary>
â”‚       â”‚   41 â”‚         /// Indicates if the view model has errors
â”‚       â”‚   42 â”‚         /// </summary>
â”‚       â”‚   43 â”‚         public bool HasErrors
â”‚       â”‚   44 â”‚         {
â”‚       â”‚   45 â”‚             get => _hasErrors;
â”‚       â”‚   46 â”‚             protected set => SetProperty(ref _hasErrors, value);
â”‚       â”‚   47 â”‚         }
â”‚       â”‚   48 â”‚ 
â”‚       â”‚   49 â”‚         /// <summary>
â”‚       â”‚   50 â”‚         /// Error message to display to the user
â”‚       â”‚   51 â”‚         /// </summary>
â”‚       â”‚   52 â”‚         public string ErrorMessage
â”‚       â”‚   53 â”‚         {
â”‚       â”‚   54 â”‚             get => _errorMessage;
â”‚       â”‚   55 â”‚             protected set => SetProperty(ref _errorMessage, value);
â”‚       â”‚   56 â”‚         }
â”‚       â”‚   57 â”‚ 
â”‚       â”‚   58 â”‚         /// <summary>
â”‚       â”‚   59 â”‚         /// Sets a success status message
â”‚       â”‚   60 â”‚         /// </summary>
â”‚       â”‚   61 â”‚         /// <param name="message">The message to display</param>
â”‚       â”‚   62 â”‚         protected void SetSuccessMessage(string message)
â”‚       â”‚   63 â”‚         {
â”‚       â”‚   64 â”‚             StatusMessage = message;
â”‚       â”‚   65 â”‚             HasErrors = false;
â”‚       â”‚   66 â”‚             ErrorMessage = string.Empty;
â”‚       â”‚   67 â”‚         }
â”‚       â”‚   68 â”‚ 
â”‚       â”‚   69 â”‚         /// <summary>
â”‚       â”‚   70 â”‚         /// Sets an error message
â”‚       â”‚   71 â”‚         /// </summary>
â”‚       â”‚   72 â”‚         /// <param name="message">The error message to display</param>
â”‚       â”‚   73 â”‚         protected void SetErrorMessage(string message)
â”‚       â”‚   74 â”‚         {
â”‚       â”‚   75 â”‚             ErrorMessage = message;
â”‚       â”‚   76 â”‚             HasErrors = true;
â”‚       â”‚   77 â”‚             StatusMessage = string.Empty;
â”‚       â”‚   78 â”‚         }
â”‚       â”‚   79 â”‚ 
â”‚       â”‚   80 â”‚         /// <summary>
â”‚       â”‚   81 â”‚         /// Executes an async operation with busy indication and error handling
â”‚       â”‚   82 â”‚         /// </summary>
â”‚       â”‚   83 â”‚         /// <typeparam name="T">The result type</typeparam>
â”‚       â”‚   84 â”‚         /// <param name="operation">The operation to execute</param>
â”‚       â”‚   85 â”‚         /// <param name="successMessage">The success message to display</param>
â”‚       â”‚   86 â”‚         /// <param name="errorMessage">The error message prefix to display</param>
â”‚       â”‚   87 â”‚         /// <returns>The operation result or default value if an error occurred</returns>
â”‚       â”‚   88 â”‚         protected async Task<T> ExecuteWithBusyIndicationAsync<T>(
â”‚       â”‚   89 â”‚             Func<Task<T>> operation,
â”‚       â”‚   90 â”‚             string successMessage = null,
â”‚       â”‚   91 â”‚             string errorMessage = "Operation failed")
â”‚       â”‚   92 â”‚         {
â”‚       â”‚   93 â”‚             IsBusy = true;
â”‚       â”‚   94 â”‚             HasErrors = false;
â”‚       â”‚   95 â”‚             StatusMessage = "Working...";
â”‚       â”‚   96 â”‚ 
â”‚       â”‚   97 â”‚             try
â”‚       â”‚   98 â”‚             {
â”‚       â”‚   99 â”‚                 var result = await operation();
â”‚       â”‚  100 â”‚                 if (!string.IsNullOrEmpty(successMessage))
â”‚       â”‚  101 â”‚                 {
â”‚       â”‚  102 â”‚                     SetSuccessMessage(successMessage);
â”‚       â”‚  103 â”‚                 }
â”‚       â”‚  104 â”‚                 return result;
â”‚       â”‚  105 â”‚             }
â”‚       â”‚  106 â”‚             catch (Exception ex)
â”‚       â”‚  107 â”‚             {
â”‚       â”‚  108 â”‚                 SetErrorMessage($"{errorMessage}: {ex.Message}");
â”‚       â”‚  109 â”‚                 return default;
â”‚       â”‚  110 â”‚             }
â”‚       â”‚  111 â”‚             finally
â”‚       â”‚  112 â”‚             {
â”‚       â”‚  113 â”‚                 IsBusy = false;
â”‚       â”‚  114 â”‚             }
â”‚       â”‚  115 â”‚         }
â”‚       â”‚  116 â”‚ 
â”‚       â”‚  117 â”‚         /// <summary>
â”‚       â”‚  118 â”‚         /// Executes an async operation with busy indication and error handling
â”‚       â”‚  119 â”‚         /// </summary>
â”‚       â”‚  120 â”‚         /// <param name="operation">The operation to execute</param>
â”‚       â”‚  121 â”‚         /// <param name="successMessage">The success message to display</param>
â”‚       â”‚  122 â”‚         /// <param name="errorMessage">The error message prefix to display</param>
â”‚       â”‚  123 â”‚         /// <returns>True if the operation succeeded, false otherwise</returns>
â”‚       â”‚  124 â”‚         protected async Task<bool> ExecuteWithBusyIndicationAsync(
â”‚       â”‚  125 â”‚             Func<Task> operation,
â”‚       â”‚  126 â”‚             string successMessage = null,
â”‚       â”‚  127 â”‚             string errorMessage = "Operation failed")
â”‚       â”‚  128 â”‚         {
â”‚       â”‚  129 â”‚             IsBusy = true;
â”‚       â”‚  130 â”‚             HasErrors = false;
â”‚       â”‚  131 â”‚             StatusMessage = "Working...";
â”‚       â”‚  132 â”‚ 
â”‚       â”‚  133 â”‚             try
â”‚       â”‚  134 â”‚             {
â”‚       â”‚  135 â”‚                 await operation();
â”‚       â”‚  136 â”‚                 if (!string.IsNullOrEmpty(successMessage))
â”‚       â”‚  137 â”‚                 {
â”‚       â”‚  138 â”‚                     SetSuccessMessage(successMessage);
â”‚       â”‚  139 â”‚                 }
â”‚       â”‚  140 â”‚                 return true;
â”‚       â”‚  141 â”‚             }
â”‚       â”‚  142 â”‚             catch (Exception ex)
â”‚       â”‚  143 â”‚             {
â”‚       â”‚  144 â”‚                 SetErrorMessage($"{errorMessage}: {ex.Message}");
â”‚       â”‚  145 â”‚                 return false;
â”‚       â”‚  146 â”‚             }
â”‚       â”‚  147 â”‚             finally
â”‚       â”‚  148 â”‚             {
â”‚       â”‚  149 â”‚                 IsBusy = false;
â”‚       â”‚  150 â”‚             }
â”‚       â”‚  151 â”‚         }
â”‚       â”‚  152 â”‚     }
â”‚       â”‚  153 â”‚ }
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   ğŸ“ Application
â”‚       ğŸ“ Services
â”‚       â”‚   ğŸ“ Parsers
â”‚       â”‚   â””â”€â”€ ğŸ“„ ObjectSetParserImpl.cs (9.82 KB, 2025-03-11 14:56:55)
â”‚       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚       â”‚ FILE CONTENT: ObjectSetParserImpl.cs
â”‚       â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚       â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚       â”‚       â”‚    2 â”‚ using System;
â”‚       â”‚       â”‚    3 â”‚ using System.Collections.Generic;
â”‚       â”‚       â”‚    4 â”‚ using System.Linq;
â”‚       â”‚       â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚       â”‚    6 â”‚ using System.Xml.Linq;
â”‚       â”‚       â”‚    7 â”‚ using test.Core.Domain.ObjectSet;
â”‚       â”‚       â”‚    8 â”‚ using test.Core.Interfaces;
â”‚       â”‚       â”‚    9 â”‚ 
â”‚       â”‚       â”‚   10 â”‚ namespace test.Application.Services.Parsers
â”‚       â”‚       â”‚   11 â”‚ {
â”‚       â”‚       â”‚   12 â”‚     /// <summary>
â”‚       â”‚       â”‚   13 â”‚     /// Implementation of the ObjectSet parser
â”‚       â”‚       â”‚   14 â”‚     /// </summary>
â”‚       â”‚       â”‚   15 â”‚     public class ObjectSetParserImpl : IObjectSetParser
â”‚       â”‚       â”‚   16 â”‚     {
â”‚       â”‚       â”‚   17 â”‚         private readonly ILogger<ObjectSetParserImpl> _logger;
â”‚       â”‚       â”‚   18 â”‚ 
â”‚       â”‚       â”‚   19 â”‚         /// <summary>
â”‚       â”‚       â”‚   20 â”‚         /// Creates a new ObjectSet parser
â”‚       â”‚       â”‚   21 â”‚         /// </summary>
â”‚       â”‚       â”‚   22 â”‚         /// <param name="logger">Logger</param>
â”‚       â”‚       â”‚   23 â”‚         public ObjectSetParserImpl(ILogger<ObjectSetParserImpl> logger)
â”‚       â”‚       â”‚   24 â”‚         {
â”‚       â”‚       â”‚   25 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚       â”‚   26 â”‚         }
â”‚       â”‚       â”‚   27 â”‚ 
â”‚       â”‚       â”‚   28 â”‚         /// <inheritdoc/>
â”‚       â”‚       â”‚   29 â”‚         public async Task<ObjectSetParseResult> ParseAsync(XDocument document, ObjectSetParsingOptions options)
â”‚       â”‚       â”‚   30 â”‚         {
â”‚       â”‚       â”‚   31 â”‚             var result = new ObjectSetParseResult();
â”‚       â”‚       â”‚   32 â”‚ 
â”‚       â”‚       â”‚   33 â”‚             try
â”‚       â”‚       â”‚   34 â”‚             {
â”‚       â”‚       â”‚   35 â”‚                 if (options.IncludeMetaInformation)
â”‚       â”‚       â”‚   36 â”‚                 {
â”‚       â”‚       â”‚   37 â”‚                     result.MetaInfo = ParseMetaInformation(document);
â”‚       â”‚       â”‚   38 â”‚                 }
â”‚       â”‚       â”‚   39 â”‚ 
â”‚       â”‚       â”‚   40 â”‚                 if (options.IncludeTypeDefinitions)
â”‚       â”‚       â”‚   41 â”‚                 {
â”‚       â”‚       â”‚   42 â”‚                     result.Types = ParseTypeDefinitions(document, options.TypeWhitelist);
â”‚       â”‚       â”‚   43 â”‚                 }
â”‚       â”‚       â”‚   44 â”‚ 
â”‚       â”‚       â”‚   45 â”‚                 if (options.IncludeExportedObjects)
â”‚       â”‚       â”‚   46 â”‚                 {
â”‚       â”‚       â”‚   47 â”‚                     result.ExportedObjects = ParseExportedObjects(document);
â”‚       â”‚       â”‚   48 â”‚                 }
â”‚       â”‚       â”‚   49 â”‚ 
â”‚       â”‚       â”‚   50 â”‚                 result.Success = true;
â”‚       â”‚       â”‚   51 â”‚             }
â”‚       â”‚       â”‚   52 â”‚             catch (Exception ex)
â”‚       â”‚       â”‚   53 â”‚             {
â”‚       â”‚       â”‚   54 â”‚                 result.Success = false;
â”‚       â”‚       â”‚   55 â”‚                 result.ErrorMessage = ex.Message;
â”‚       â”‚       â”‚   56 â”‚                 _logger.LogError(ex, "Error parsing ObjectSet XML");
â”‚       â”‚       â”‚   57 â”‚             }
â”‚       â”‚       â”‚   58 â”‚ 
â”‚       â”‚       â”‚   59 â”‚             return result;
â”‚       â”‚       â”‚   60 â”‚         }
â”‚       â”‚       â”‚   61 â”‚ 
â”‚       â”‚       â”‚   62 â”‚         /// <inheritdoc/>
â”‚       â”‚       â”‚   63 â”‚         public MetaInformation ParseMetaInformation(XDocument doc)
â”‚       â”‚       â”‚   64 â”‚         {
â”‚       â”‚       â”‚   65 â”‚             var metaElement = doc.Root?.Element("MetaInformation");
â”‚       â”‚       â”‚   66 â”‚             if (metaElement == null) return null;
â”‚       â”‚       â”‚   67 â”‚ 
â”‚       â”‚       â”‚   68 â”‚             return new MetaInformation
â”‚       â”‚       â”‚   69 â”‚             {
â”‚       â”‚       â”‚   70 â”‚                 ExportMode = metaElement.Element("ExportMode")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚   71 â”‚                 SemanticsFilter = metaElement.Element("SemanticsFilter")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚   72 â”‚                 RuntimeVersion = metaElement.Element("RuntimeVersion")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚   73 â”‚                 SourceVersion = metaElement.Element("SourceVersion")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚   74 â”‚                 ServerFullPath = metaElement.Element("ServerFullPath")?.Attribute("Value")?.Value
â”‚       â”‚       â”‚   75 â”‚             };
â”‚       â”‚       â”‚   76 â”‚         }
â”‚       â”‚       â”‚   77 â”‚ 
â”‚       â”‚       â”‚   78 â”‚         /// <inheritdoc/>
â”‚       â”‚       â”‚   79 â”‚         public List<ObjectTypeDefinition> ParseTypeDefinitions(XDocument doc, HashSet<string> typeWhitelist = null)
â”‚       â”‚       â”‚   80 â”‚         {
â”‚       â”‚       â”‚   81 â”‚             var types = new List<ObjectTypeDefinition>();
â”‚       â”‚       â”‚   82 â”‚             var typesElement = doc.Root?.Element("Types");
â”‚       â”‚       â”‚   83 â”‚             if (typesElement == null) return types;
â”‚       â”‚       â”‚   84 â”‚ 
â”‚       â”‚       â”‚   85 â”‚             foreach (var typeElement in typesElement.Elements("ObjectType"))
â”‚       â”‚       â”‚   86 â”‚             {
â”‚       â”‚       â”‚   87 â”‚                 var name = typeElement.Attribute("Name")?.Value;
â”‚       â”‚       â”‚   88 â”‚                 if (string.IsNullOrEmpty(name) || (typeWhitelist?.Any() == true && !typeWhitelist.Contains(name)))
â”‚       â”‚       â”‚   89 â”‚                     continue;
â”‚       â”‚       â”‚   90 â”‚ 
â”‚       â”‚       â”‚   91 â”‚                 var type = new ObjectTypeDefinition
â”‚       â”‚       â”‚   92 â”‚                 {
â”‚       â”‚       â”‚   93 â”‚                     Name = name,
â”‚       â”‚       â”‚   94 â”‚                     DisplayName = typeElement.Attribute("DisplayName")?.Value,
â”‚       â”‚       â”‚   95 â”‚                     Description = typeElement.Attribute("Description")?.Value,
â”‚       â”‚       â”‚   96 â”‚                     PropertyTabs = ParsePropertyTabs(typeElement)
â”‚       â”‚       â”‚   97 â”‚                 };
â”‚       â”‚       â”‚   98 â”‚ 
â”‚       â”‚       â”‚   99 â”‚                 types.Add(type);
â”‚       â”‚       â”‚  100 â”‚             }
â”‚       â”‚       â”‚  101 â”‚ 
â”‚       â”‚       â”‚  102 â”‚             return types;
â”‚       â”‚       â”‚  103 â”‚         }
â”‚       â”‚       â”‚  104 â”‚ 
â”‚       â”‚       â”‚  105 â”‚         /// <inheritdoc/>
â”‚       â”‚       â”‚  106 â”‚         public List<ExportedObject> ParseExportedObjects(XDocument doc)
â”‚       â”‚       â”‚  107 â”‚         {
â”‚       â”‚       â”‚  108 â”‚             var objects = new List<ExportedObject>();
â”‚       â”‚       â”‚  109 â”‚             var exportedElement = doc.Root?.Element("ExportedObjects");
â”‚       â”‚       â”‚  110 â”‚             if (exportedElement == null) return objects;
â”‚       â”‚       â”‚  111 â”‚ 
â”‚       â”‚       â”‚  112 â”‚             foreach (var objElement in exportedElement.Elements("OI"))
â”‚       â”‚       â”‚  113 â”‚             {
â”‚       â”‚       â”‚  114 â”‚                 objects.Add(ParseExportedObject(objElement));
â”‚       â”‚       â”‚  115 â”‚             }
â”‚       â”‚       â”‚  116 â”‚ 
â”‚       â”‚       â”‚  117 â”‚             return objects;
â”‚       â”‚       â”‚  118 â”‚         }
â”‚       â”‚       â”‚  119 â”‚ 
â”‚       â”‚       â”‚  120 â”‚         /// <summary>
â”‚       â”‚       â”‚  121 â”‚         /// Parses property tabs from an object type element
â”‚       â”‚       â”‚  122 â”‚         /// </summary>
â”‚       â”‚       â”‚  123 â”‚         private List<PropertyTab> ParsePropertyTabs(XElement typeElement)
â”‚       â”‚       â”‚  124 â”‚         {
â”‚       â”‚       â”‚  125 â”‚             var tabs = new List<PropertyTab>();
â”‚       â”‚       â”‚  126 â”‚ 
â”‚       â”‚       â”‚  127 â”‚             foreach (var tabElement in typeElement.Elements("PropertyTab"))
â”‚       â”‚       â”‚  128 â”‚             {
â”‚       â”‚       â”‚  129 â”‚                 var tab = new PropertyTab
â”‚       â”‚       â”‚  130 â”‚                 {
â”‚       â”‚       â”‚  131 â”‚                     Name = tabElement.Attribute("Name")?.Value,
â”‚       â”‚       â”‚  132 â”‚                     PropertyGroups = ParsePropertyGroups(tabElement)
â”‚       â”‚       â”‚  133 â”‚                 };
â”‚       â”‚       â”‚  134 â”‚                 tabs.Add(tab);
â”‚       â”‚       â”‚  135 â”‚             }
â”‚       â”‚       â”‚  136 â”‚ 
â”‚       â”‚       â”‚  137 â”‚             return tabs;
â”‚       â”‚       â”‚  138 â”‚         }
â”‚       â”‚       â”‚  139 â”‚ 
â”‚       â”‚       â”‚  140 â”‚         /// <summary>
â”‚       â”‚       â”‚  141 â”‚         /// Parses property groups from a property tab element
â”‚       â”‚       â”‚  142 â”‚         /// </summary>
â”‚       â”‚       â”‚  143 â”‚         private List<PropertyGroup> ParsePropertyGroups(XElement tabElement)
â”‚       â”‚       â”‚  144 â”‚         {
â”‚       â”‚       â”‚  145 â”‚             var groups = new List<PropertyGroup>();
â”‚       â”‚       â”‚  146 â”‚ 
â”‚       â”‚       â”‚  147 â”‚             foreach (var groupElement in tabElement.Elements("PropertyGroup"))
â”‚       â”‚       â”‚  148 â”‚             {
â”‚       â”‚       â”‚  149 â”‚                 var group = new PropertyGroup
â”‚       â”‚       â”‚  150 â”‚                 {
â”‚       â”‚       â”‚  151 â”‚                     Name = groupElement.Attribute("Name")?.Value,
â”‚       â”‚       â”‚  152 â”‚                     Parameters = ParseParameters(groupElement),
â”‚       â”‚       â”‚  153 â”‚                     Variables = ParseVariables(groupElement)
â”‚       â”‚       â”‚  154 â”‚                 };
â”‚       â”‚       â”‚  155 â”‚                 groups.Add(group);
â”‚       â”‚       â”‚  156 â”‚             }
â”‚       â”‚       â”‚  157 â”‚ 
â”‚       â”‚       â”‚  158 â”‚             return groups;
â”‚       â”‚       â”‚  159 â”‚         }
â”‚       â”‚       â”‚  160 â”‚ 
â”‚       â”‚       â”‚  161 â”‚         /// <summary>
â”‚       â”‚       â”‚  162 â”‚         /// Parses parameters from a property group element
â”‚       â”‚       â”‚  163 â”‚         /// </summary>
â”‚       â”‚       â”‚  164 â”‚         private List<Parameter> ParseParameters(XElement groupElement)
â”‚       â”‚       â”‚  165 â”‚         {
â”‚       â”‚       â”‚  166 â”‚             var parameters = new List<Parameter>();
â”‚       â”‚       â”‚  167 â”‚ 
â”‚       â”‚       â”‚  168 â”‚             foreach (var paramElement in groupElement.Elements("Parameter"))
â”‚       â”‚       â”‚  169 â”‚             {
â”‚       â”‚       â”‚  170 â”‚                 var param = new Parameter
â”‚       â”‚       â”‚  171 â”‚                 {
â”‚       â”‚       â”‚  172 â”‚                     Name = paramElement.Attribute("Name")?.Value,
â”‚       â”‚       â”‚  173 â”‚                     DisplayName = paramElement.Attribute("DisplayName")?.Value,
â”‚       â”‚       â”‚  174 â”‚                     Description = paramElement.Attribute("Description")?.Value,
â”‚       â”‚       â”‚  175 â”‚                     Type = new ParameterType { Value = paramElement.Element("Type")?.Attribute("Value")?.Value },
â”‚       â”‚       â”‚  176 â”‚                     Unit = paramElement.Element("Unit")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚  177 â”‚                     InitValue = paramElement.Element("InitValue")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚  178 â”‚                     FileContents = paramElement.Element("InitValue")?.Element("FileContents")?.Value
â”‚       â”‚       â”‚  179 â”‚                 };
â”‚       â”‚       â”‚  180 â”‚                 parameters.Add(param);
â”‚       â”‚       â”‚  181 â”‚             }
â”‚       â”‚       â”‚  182 â”‚ 
â”‚       â”‚       â”‚  183 â”‚             return parameters;
â”‚       â”‚       â”‚  184 â”‚         }
â”‚       â”‚       â”‚  185 â”‚ 
â”‚       â”‚       â”‚  186 â”‚         /// <summary>
â”‚       â”‚       â”‚  187 â”‚         /// Parses variables from a property group element
â”‚       â”‚       â”‚  188 â”‚         /// </summary>
â”‚       â”‚       â”‚  189 â”‚         private List<Variable> ParseVariables(XElement groupElement)
â”‚       â”‚       â”‚  190 â”‚         {
â”‚       â”‚       â”‚  191 â”‚             var variables = new List<Variable>();
â”‚       â”‚       â”‚  192 â”‚ 
â”‚       â”‚       â”‚  193 â”‚             foreach (var varElement in groupElement.Elements("Variable"))
â”‚       â”‚       â”‚  194 â”‚             {
â”‚       â”‚       â”‚  195 â”‚                 var variable = new Variable
â”‚       â”‚       â”‚  196 â”‚                 {
â”‚       â”‚       â”‚  197 â”‚                     Name = varElement.Attribute("Name")?.Value,
â”‚       â”‚       â”‚  198 â”‚                     DisplayName = varElement.Attribute("DisplayName")?.Value,
â”‚       â”‚       â”‚  199 â”‚                     Description = varElement.Attribute("Description")?.Value,
â”‚       â”‚       â”‚  200 â”‚                     Type = new ParameterType { Value = varElement.Element("Type")?.Attribute("Value")?.Value },
â”‚       â”‚       â”‚  201 â”‚                     Unit = varElement.Element("Unit")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚  202 â”‚                     Runtime = ParseRuntime(varElement.Element("Runtime"))
â”‚       â”‚       â”‚  203 â”‚                 };
â”‚       â”‚       â”‚  204 â”‚                 variables.Add(variable);
â”‚       â”‚       â”‚  205 â”‚             }
â”‚       â”‚       â”‚  206 â”‚ 
â”‚       â”‚       â”‚  207 â”‚             return variables;
â”‚       â”‚       â”‚  208 â”‚         }
â”‚       â”‚       â”‚  209 â”‚ 
â”‚       â”‚       â”‚  210 â”‚         /// <summary>
â”‚       â”‚       â”‚  211 â”‚         /// Parses runtime properties from a runtime element
â”‚       â”‚       â”‚  212 â”‚         /// </summary>
â”‚       â”‚       â”‚  213 â”‚         private Runtime ParseRuntime(XElement runtimeElement)
â”‚       â”‚       â”‚  214 â”‚         {
â”‚       â”‚       â”‚  215 â”‚             if (runtimeElement == null) return null;
â”‚       â”‚       â”‚  216 â”‚ 
â”‚       â”‚       â”‚  217 â”‚             return new Runtime
â”‚       â”‚       â”‚  218 â”‚             {
â”‚       â”‚       â”‚  219 â”‚                 ReadOnly = runtimeElement.Element("ReadOnly")?.Attribute("Value")?.Value == "1",
â”‚       â”‚       â”‚  220 â”‚                 RetainLevel = runtimeElement.Element("RetainLevel")?.Attribute("Value")?.Value,
â”‚       â”‚       â”‚  221 â”‚                 Forceable = runtimeElement.Element("Forceable")?.Attribute("Value")?.Value == "1",
â”‚       â”‚       â”‚  222 â”‚                 InitValue = runtimeElement.Element("InitValue")?.Value
â”‚       â”‚       â”‚  223 â”‚             };
â”‚       â”‚       â”‚  224 â”‚         }
â”‚       â”‚       â”‚  225 â”‚ 
â”‚       â”‚       â”‚  226 â”‚         /// <summary>
â”‚       â”‚       â”‚  227 â”‚         /// Parses an exported object from an OI element
â”‚       â”‚       â”‚  228 â”‚         /// </summary>
â”‚       â”‚       â”‚  229 â”‚         private ExportedObject ParseExportedObject(XElement element)
â”‚       â”‚       â”‚  230 â”‚         {
â”‚       â”‚       â”‚  231 â”‚             var obj = new ExportedObject
â”‚       â”‚       â”‚  232 â”‚             {
â”‚       â”‚       â”‚  233 â”‚                 Name = element.Attribute("NAME")?.Value,
â”‚       â”‚       â”‚  234 â”‚                 Children = new List<ExportedObject>(),
â”‚       â”‚       â”‚  235 â”‚                 Properties = new Dictionary<string, string>()
â”‚       â”‚       â”‚  236 â”‚             };
â”‚       â”‚       â”‚  237 â”‚ 
â”‚       â”‚       â”‚  238 â”‚             // Add TYPE as a property
â”‚       â”‚       â”‚  239 â”‚             var type = element.Attribute("TYPE")?.Value;
â”‚       â”‚       â”‚  240 â”‚             if (!string.IsNullOrEmpty(type))
â”‚       â”‚       â”‚  241 â”‚             {
â”‚       â”‚       â”‚  242 â”‚                 obj.Properties["TYPE"] = type;
â”‚       â”‚       â”‚  243 â”‚             }
â”‚       â”‚       â”‚  244 â”‚ 
â”‚       â”‚       â”‚  245 â”‚             // Add DESCR as a property if present
â”‚       â”‚       â”‚  246 â”‚             var descr = element.Attribute("DESCR")?.Value;
â”‚       â”‚       â”‚  247 â”‚             if (!string.IsNullOrEmpty(descr))
â”‚       â”‚       â”‚  248 â”‚             {
â”‚       â”‚       â”‚  249 â”‚                 obj.Properties["DESCR"] = descr;
â”‚       â”‚       â”‚  250 â”‚             }
â”‚       â”‚       â”‚  251 â”‚ 
â”‚       â”‚       â”‚  252 â”‚             // Parse all PI elements
â”‚       â”‚       â”‚  253 â”‚             foreach (var pi in element.Elements("PI"))
â”‚       â”‚       â”‚  254 â”‚             {
â”‚       â”‚       â”‚  255 â”‚                 var name = pi.Attribute("Name")?.Value;
â”‚       â”‚       â”‚  256 â”‚                 var value = pi.Attribute("Value")?.Value;
â”‚       â”‚       â”‚  257 â”‚                 if (!string.IsNullOrEmpty(name))
â”‚       â”‚       â”‚  258 â”‚                 {
â”‚       â”‚       â”‚  259 â”‚                     obj.Properties[name] = value ?? string.Empty;
â”‚       â”‚       â”‚  260 â”‚                 }
â”‚       â”‚       â”‚  261 â”‚             }
â”‚       â”‚       â”‚  262 â”‚ 
â”‚       â”‚       â”‚  263 â”‚             // Recursively parse child objects
â”‚       â”‚       â”‚  264 â”‚             foreach (var childElement in element.Elements("OI"))
â”‚       â”‚       â”‚  265 â”‚             {
â”‚       â”‚       â”‚  266 â”‚                 obj.Children.Add(ParseExportedObject(childElement));
â”‚       â”‚       â”‚  267 â”‚             }
â”‚       â”‚       â”‚  268 â”‚ 
â”‚       â”‚       â”‚  269 â”‚             return obj;
â”‚       â”‚       â”‚  270 â”‚         }
â”‚       â”‚       â”‚  271 â”‚     }
â”‚       â”‚       â”‚  272 â”‚ }
â”‚       â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   ğŸ“ Writers
â”‚       â”‚   â””â”€â”€ ğŸ“„ ObjectSetWriterImpl.cs (12.22 KB, 2025-03-11 14:57:20)
â”‚       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚       â”‚ FILE CONTENT: ObjectSetWriterImpl.cs
â”‚       â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚       â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚       â”‚       â”‚    2 â”‚ using System;
â”‚       â”‚       â”‚    3 â”‚ using System.Collections.Generic;
â”‚       â”‚       â”‚    4 â”‚ using System.Linq;
â”‚       â”‚       â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚       â”‚    6 â”‚ using System.Xml.Linq;
â”‚       â”‚       â”‚    7 â”‚ using test.Core.Domain;
â”‚       â”‚       â”‚    8 â”‚ using test.Core.Domain.ObjectSet;
â”‚       â”‚       â”‚    9 â”‚ using test.Core.Interfaces;
â”‚       â”‚       â”‚   10 â”‚ 
â”‚       â”‚       â”‚   11 â”‚ namespace test.Application.Services.Writers
â”‚       â”‚       â”‚   12 â”‚ {
â”‚       â”‚       â”‚   13 â”‚     /// <summary>
â”‚       â”‚       â”‚   14 â”‚     /// Implementation of the ObjectSet writer
â”‚       â”‚       â”‚   15 â”‚     /// </summary>
â”‚       â”‚       â”‚   16 â”‚     public class ObjectSetWriterImpl : IObjectSetWriter
â”‚       â”‚       â”‚   17 â”‚     {
â”‚       â”‚       â”‚   18 â”‚         private readonly ILogger<ObjectSetWriterImpl> _logger;
â”‚       â”‚       â”‚   19 â”‚ 
â”‚       â”‚       â”‚   20 â”‚         /// <summary>
â”‚       â”‚       â”‚   21 â”‚         /// Creates a new ObjectSet writer
â”‚       â”‚       â”‚   22 â”‚         /// </summary>
â”‚       â”‚       â”‚   23 â”‚         /// <param name="logger">Logger</param>
â”‚       â”‚       â”‚   24 â”‚         public ObjectSetWriterImpl(ILogger<ObjectSetWriterImpl> logger)
â”‚       â”‚       â”‚   25 â”‚         {
â”‚       â”‚       â”‚   26 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚       â”‚   27 â”‚         }
â”‚       â”‚       â”‚   28 â”‚ 
â”‚       â”‚       â”‚   29 â”‚         /// <inheritdoc/>
â”‚       â”‚       â”‚   30 â”‚         public async Task<XDocument> WriteAsync(IEnumerable<Controller> controllers, ObjectSetWriteOptions options = null)
â”‚       â”‚       â”‚   31 â”‚         {
â”‚       â”‚       â”‚   32 â”‚             options ??= new ObjectSetWriteOptions();
â”‚       â”‚       â”‚   33 â”‚ 
â”‚       â”‚       â”‚   34 â”‚             try
â”‚       â”‚       â”‚   35 â”‚             {
â”‚       â”‚       â”‚   36 â”‚                 // Create root element
â”‚       â”‚       â”‚   37 â”‚                 var root = new XElement("ObjectSet");
â”‚       â”‚       â”‚   38 â”‚                 var doc = new XDocument(new XDeclaration("1.0", "utf-8", null), root);
â”‚       â”‚       â”‚   39 â”‚ 
â”‚       â”‚       â”‚   40 â”‚                 // Add meta information if provided
â”‚       â”‚       â”‚   41 â”‚                 if (options.MetaInformation != null)
â”‚       â”‚       â”‚   42 â”‚                 {
â”‚       â”‚       â”‚   43 â”‚                     root.Add(CreateMetaInformationElement(options.MetaInformation));
â”‚       â”‚       â”‚   44 â”‚                 }
â”‚       â”‚       â”‚   45 â”‚ 
â”‚       â”‚       â”‚   46 â”‚                 // Add type definitions if provided
â”‚       â”‚       â”‚   47 â”‚                 if (options.TypeDefinitions != null && options.TypeDefinitions.Any())
â”‚       â”‚       â”‚   48 â”‚                 {
â”‚       â”‚       â”‚   49 â”‚                     root.Add(CreateTypesElement(options.TypeDefinitions));
â”‚       â”‚       â”‚   50 â”‚                 }
â”‚       â”‚       â”‚   51 â”‚ 
â”‚       â”‚       â”‚   52 â”‚                 // Add exported objects from controllers
â”‚       â”‚       â”‚   53 â”‚                 root.Add(CreateExportedObjectsElement(controllers, options.IncludeByteCode));
â”‚       â”‚       â”‚   54 â”‚ 
â”‚       â”‚       â”‚   55 â”‚                 return doc;
â”‚       â”‚       â”‚   56 â”‚             }
â”‚       â”‚       â”‚   57 â”‚             catch (Exception ex)
â”‚       â”‚       â”‚   58 â”‚             {
â”‚       â”‚       â”‚   59 â”‚                 _logger.LogError(ex, "Error creating ObjectSet XML");
â”‚       â”‚       â”‚   60 â”‚                 throw;
â”‚       â”‚       â”‚   61 â”‚             }
â”‚       â”‚       â”‚   62 â”‚         }
â”‚       â”‚       â”‚   63 â”‚ 
â”‚       â”‚       â”‚   64 â”‚         /// <summary>
â”‚       â”‚       â”‚   65 â”‚         /// Creates the meta information element
â”‚       â”‚       â”‚   66 â”‚         /// </summary>
â”‚       â”‚       â”‚   67 â”‚         private XElement CreateMetaInformationElement(MetaInformation metaInfo)
â”‚       â”‚       â”‚   68 â”‚         {
â”‚       â”‚       â”‚   69 â”‚             var element = new XElement("MetaInformation");
â”‚       â”‚       â”‚   70 â”‚ 
â”‚       â”‚       â”‚   71 â”‚             if (!string.IsNullOrEmpty(metaInfo.ExportMode))
â”‚       â”‚       â”‚   72 â”‚             {
â”‚       â”‚       â”‚   73 â”‚                 element.Add(new XElement("ExportMode", new XAttribute("Value", metaInfo.ExportMode)));
â”‚       â”‚       â”‚   74 â”‚             }
â”‚       â”‚       â”‚   75 â”‚ 
â”‚       â”‚       â”‚   76 â”‚             if (!string.IsNullOrEmpty(metaInfo.SemanticsFilter))
â”‚       â”‚       â”‚   77 â”‚             {
â”‚       â”‚       â”‚   78 â”‚                 element.Add(new XElement("SemanticsFilter", new XAttribute("Value", metaInfo.SemanticsFilter)));
â”‚       â”‚       â”‚   79 â”‚             }
â”‚       â”‚       â”‚   80 â”‚ 
â”‚       â”‚       â”‚   81 â”‚             if (!string.IsNullOrEmpty(metaInfo.RuntimeVersion))
â”‚       â”‚       â”‚   82 â”‚             {
â”‚       â”‚       â”‚   83 â”‚                 element.Add(new XElement("RuntimeVersion", new XAttribute("Value", metaInfo.RuntimeVersion)));
â”‚       â”‚       â”‚   84 â”‚             }
â”‚       â”‚       â”‚   85 â”‚ 
â”‚       â”‚       â”‚   86 â”‚             if (!string.IsNullOrEmpty(metaInfo.SourceVersion))
â”‚       â”‚       â”‚   87 â”‚             {
â”‚       â”‚       â”‚   88 â”‚                 element.Add(new XElement("SourceVersion", new XAttribute("Value", metaInfo.SourceVersion)));
â”‚       â”‚       â”‚   89 â”‚             }
â”‚       â”‚       â”‚   90 â”‚ 
â”‚       â”‚       â”‚   91 â”‚             if (!string.IsNullOrEmpty(metaInfo.ServerFullPath))
â”‚       â”‚       â”‚   92 â”‚             {
â”‚       â”‚       â”‚   93 â”‚                 element.Add(new XElement("ServerFullPath", new XAttribute("Value", metaInfo.ServerFullPath)));
â”‚       â”‚       â”‚   94 â”‚             }
â”‚       â”‚       â”‚   95 â”‚ 
â”‚       â”‚       â”‚   96 â”‚             return element;
â”‚       â”‚       â”‚   97 â”‚         }
â”‚       â”‚       â”‚   98 â”‚ 
â”‚       â”‚       â”‚   99 â”‚         /// <summary>
â”‚       â”‚       â”‚  100 â”‚         /// Creates the types element containing type definitions
â”‚       â”‚       â”‚  101 â”‚         /// </summary>
â”‚       â”‚       â”‚  102 â”‚         private XElement CreateTypesElement(IEnumerable<ObjectTypeDefinition> typeDefinitions)
â”‚       â”‚       â”‚  103 â”‚         {
â”‚       â”‚       â”‚  104 â”‚             var element = new XElement("Types");
â”‚       â”‚       â”‚  105 â”‚ 
â”‚       â”‚       â”‚  106 â”‚             foreach (var typeDef in typeDefinitions)
â”‚       â”‚       â”‚  107 â”‚             {
â”‚       â”‚       â”‚  108 â”‚                 var typeElement = new XElement("ObjectType",
â”‚       â”‚       â”‚  109 â”‚                     new XAttribute("Name", typeDef.Name ?? string.Empty));
â”‚       â”‚       â”‚  110 â”‚ 
â”‚       â”‚       â”‚  111 â”‚                 if (!string.IsNullOrEmpty(typeDef.DisplayName))
â”‚       â”‚       â”‚  112 â”‚                 {
â”‚       â”‚       â”‚  113 â”‚                     typeElement.Add(new XAttribute("DisplayName", typeDef.DisplayName));
â”‚       â”‚       â”‚  114 â”‚                 }
â”‚       â”‚       â”‚  115 â”‚ 
â”‚       â”‚       â”‚  116 â”‚                 if (!string.IsNullOrEmpty(typeDef.Description))
â”‚       â”‚       â”‚  117 â”‚                 {
â”‚       â”‚       â”‚  118 â”‚                     typeElement.Add(new XAttribute("Description", typeDef.Description));
â”‚       â”‚       â”‚  119 â”‚                 }
â”‚       â”‚       â”‚  120 â”‚ 
â”‚       â”‚       â”‚  121 â”‚                 // Add property tabs
â”‚       â”‚       â”‚  122 â”‚                 foreach (var tab in typeDef.PropertyTabs)
â”‚       â”‚       â”‚  123 â”‚                 {
â”‚       â”‚       â”‚  124 â”‚                     typeElement.Add(CreatePropertyTabElement(tab));
â”‚       â”‚       â”‚  125 â”‚                 }
â”‚       â”‚       â”‚  126 â”‚ 
â”‚       â”‚       â”‚  127 â”‚                 element.Add(typeElement);
â”‚       â”‚       â”‚  128 â”‚             }
â”‚       â”‚       â”‚  129 â”‚ 
â”‚       â”‚       â”‚  130 â”‚             return element;
â”‚       â”‚       â”‚  131 â”‚         }
â”‚       â”‚       â”‚  132 â”‚ 
â”‚       â”‚       â”‚  133 â”‚         /// <summary>
â”‚       â”‚       â”‚  134 â”‚         /// Creates a property tab element
â”‚       â”‚       â”‚  135 â”‚         /// </summary>
â”‚       â”‚       â”‚  136 â”‚         private XElement CreatePropertyTabElement(PropertyTab tab)
â”‚       â”‚       â”‚  137 â”‚         {
â”‚       â”‚       â”‚  138 â”‚             var element = new XElement("PropertyTab",
â”‚       â”‚       â”‚  139 â”‚                 new XAttribute("Name", tab.Name ?? string.Empty));
â”‚       â”‚       â”‚  140 â”‚ 
â”‚       â”‚       â”‚  141 â”‚             // Add property groups
â”‚       â”‚       â”‚  142 â”‚             foreach (var group in tab.PropertyGroups)
â”‚       â”‚       â”‚  143 â”‚             {
â”‚       â”‚       â”‚  144 â”‚                 element.Add(CreatePropertyGroupElement(group));
â”‚       â”‚       â”‚  145 â”‚             }
â”‚       â”‚       â”‚  146 â”‚ 
â”‚       â”‚       â”‚  147 â”‚             return element;
â”‚       â”‚       â”‚  148 â”‚         }
â”‚       â”‚       â”‚  149 â”‚ 
â”‚       â”‚       â”‚  150 â”‚         /// <summary>
â”‚       â”‚       â”‚  151 â”‚         /// Creates a property group element
â”‚       â”‚       â”‚  152 â”‚         /// </summary>
â”‚       â”‚       â”‚  153 â”‚         private XElement CreatePropertyGroupElement(PropertyGroup group)
â”‚       â”‚       â”‚  154 â”‚         {
â”‚       â”‚       â”‚  155 â”‚             var element = new XElement("PropertyGroup",
â”‚       â”‚       â”‚  156 â”‚                 new XAttribute("Name", group.Name ?? string.Empty));
â”‚       â”‚       â”‚  157 â”‚ 
â”‚       â”‚       â”‚  158 â”‚             // Add parameters
â”‚       â”‚       â”‚  159 â”‚             foreach (var param in group.Parameters)
â”‚       â”‚       â”‚  160 â”‚             {
â”‚       â”‚       â”‚  161 â”‚                 element.Add(CreateParameterElement(param));
â”‚       â”‚       â”‚  162 â”‚             }
â”‚       â”‚       â”‚  163 â”‚ 
â”‚       â”‚       â”‚  164 â”‚             // Add variables
â”‚       â”‚       â”‚  165 â”‚             foreach (var variable in group.Variables)
â”‚       â”‚       â”‚  166 â”‚             {
â”‚       â”‚       â”‚  167 â”‚                 element.Add(CreateVariableElement(variable));
â”‚       â”‚       â”‚  168 â”‚             }
â”‚       â”‚       â”‚  169 â”‚ 
â”‚       â”‚       â”‚  170 â”‚             return element;
â”‚       â”‚       â”‚  171 â”‚         }
â”‚       â”‚       â”‚  172 â”‚ 
â”‚       â”‚       â”‚  173 â”‚         /// <summary>
â”‚       â”‚       â”‚  174 â”‚         /// Creates a parameter element
â”‚       â”‚       â”‚  175 â”‚         /// </summary>
â”‚       â”‚       â”‚  176 â”‚         private XElement CreateParameterElement(Parameter param)
â”‚       â”‚       â”‚  177 â”‚         {
â”‚       â”‚       â”‚  178 â”‚             var element = new XElement("Parameter",
â”‚       â”‚       â”‚  179 â”‚                 new XAttribute("Name", param.Name ?? string.Empty));
â”‚       â”‚       â”‚  180 â”‚ 
â”‚       â”‚       â”‚  181 â”‚             if (!string.IsNullOrEmpty(param.DisplayName))
â”‚       â”‚       â”‚  182 â”‚             {
â”‚       â”‚       â”‚  183 â”‚                 element.Add(new XAttribute("DisplayName", param.DisplayName));
â”‚       â”‚       â”‚  184 â”‚             }
â”‚       â”‚       â”‚  185 â”‚ 
â”‚       â”‚       â”‚  186 â”‚             if (!string.IsNullOrEmpty(param.Description))
â”‚       â”‚       â”‚  187 â”‚             {
â”‚       â”‚       â”‚  188 â”‚                 element.Add(new XAttribute("Description", param.Description));
â”‚       â”‚       â”‚  189 â”‚             }
â”‚       â”‚       â”‚  190 â”‚ 
â”‚       â”‚       â”‚  191 â”‚             if (param.Type != null)
â”‚       â”‚       â”‚  192 â”‚             {
â”‚       â”‚       â”‚  193 â”‚                 element.Add(new XElement("Type",
â”‚       â”‚       â”‚  194 â”‚                     new XAttribute("Value", param.Type.Value ?? string.Empty)));
â”‚       â”‚       â”‚  195 â”‚             }
â”‚       â”‚       â”‚  196 â”‚ 
â”‚       â”‚       â”‚  197 â”‚             if (!string.IsNullOrEmpty(param.Unit))
â”‚       â”‚       â”‚  198 â”‚             {
â”‚       â”‚       â”‚  199 â”‚                 element.Add(new XElement("Unit",
â”‚       â”‚       â”‚  200 â”‚                     new XAttribute("Value", param.Unit)));
â”‚       â”‚       â”‚  201 â”‚             }
â”‚       â”‚       â”‚  202 â”‚ 
â”‚       â”‚       â”‚  203 â”‚             if (!string.IsNullOrEmpty(param.InitValue) || !string.IsNullOrEmpty(param.FileContents))
â”‚       â”‚       â”‚  204 â”‚             {
â”‚       â”‚       â”‚  205 â”‚                 var initValueElement = new XElement("InitValue");
â”‚       â”‚       â”‚  206 â”‚ 
â”‚       â”‚       â”‚  207 â”‚                 if (!string.IsNullOrEmpty(param.InitValue))
â”‚       â”‚       â”‚  208 â”‚                 {
â”‚       â”‚       â”‚  209 â”‚                     initValueElement.Add(new XAttribute("Value", param.InitValue));
â”‚       â”‚       â”‚  210 â”‚                 }
â”‚       â”‚       â”‚  211 â”‚ 
â”‚       â”‚       â”‚  212 â”‚                 if (!string.IsNullOrEmpty(param.FileContents))
â”‚       â”‚       â”‚  213 â”‚                 {
â”‚       â”‚       â”‚  214 â”‚                     initValueElement.Add(new XElement("FileContents", param.FileContents));
â”‚       â”‚       â”‚  215 â”‚                 }
â”‚       â”‚       â”‚  216 â”‚ 
â”‚       â”‚       â”‚  217 â”‚                 element.Add(initValueElement);
â”‚       â”‚       â”‚  218 â”‚             }
â”‚       â”‚       â”‚  219 â”‚ 
â”‚       â”‚       â”‚  220 â”‚             return element;
â”‚       â”‚       â”‚  221 â”‚         }
â”‚       â”‚       â”‚  222 â”‚ 
â”‚       â”‚       â”‚  223 â”‚         /// <summary>
â”‚       â”‚       â”‚  224 â”‚         /// Creates a variable element
â”‚       â”‚       â”‚  225 â”‚         /// </summary>
â”‚       â”‚       â”‚  226 â”‚         private XElement CreateVariableElement(Variable variable)
â”‚       â”‚       â”‚  227 â”‚         {
â”‚       â”‚       â”‚  228 â”‚             var element = new XElement("Variable",
â”‚       â”‚       â”‚  229 â”‚                 new XAttribute("Name", variable.Name ?? string.Empty));
â”‚       â”‚       â”‚  230 â”‚ 
â”‚       â”‚       â”‚  231 â”‚             if (!string.IsNullOrEmpty(variable.DisplayName))
â”‚       â”‚       â”‚  232 â”‚             {
â”‚       â”‚       â”‚  233 â”‚                 element.Add(new XAttribute("DisplayName", variable.DisplayName));
â”‚       â”‚       â”‚  234 â”‚             }
â”‚       â”‚       â”‚  235 â”‚ 
â”‚       â”‚       â”‚  236 â”‚             if (!string.IsNullOrEmpty(variable.Description))
â”‚       â”‚       â”‚  237 â”‚             {
â”‚       â”‚       â”‚  238 â”‚                 element.Add(new XAttribute("Description", variable.Description));
â”‚       â”‚       â”‚  239 â”‚             }
â”‚       â”‚       â”‚  240 â”‚ 
â”‚       â”‚       â”‚  241 â”‚             if (variable.Type != null)
â”‚       â”‚       â”‚  242 â”‚             {
â”‚       â”‚       â”‚  243 â”‚                 element.Add(new XElement("Type",
â”‚       â”‚       â”‚  244 â”‚                     new XAttribute("Value", variable.Type.Value ?? string.Empty)));
â”‚       â”‚       â”‚  245 â”‚             }
â”‚       â”‚       â”‚  246 â”‚ 
â”‚       â”‚       â”‚  247 â”‚             if (!string.IsNullOrEmpty(variable.Unit))
â”‚       â”‚       â”‚  248 â”‚             {
â”‚       â”‚       â”‚  249 â”‚                 element.Add(new XElement("Unit",
â”‚       â”‚       â”‚  250 â”‚                     new XAttribute("Value", variable.Unit)));
â”‚       â”‚       â”‚  251 â”‚             }
â”‚       â”‚       â”‚  252 â”‚ 
â”‚       â”‚       â”‚  253 â”‚             if (variable.Runtime != null)
â”‚       â”‚       â”‚  254 â”‚             {
â”‚       â”‚       â”‚  255 â”‚                 element.Add(CreateRuntimeElement(variable.Runtime));
â”‚       â”‚       â”‚  256 â”‚             }
â”‚       â”‚       â”‚  257 â”‚ 
â”‚       â”‚       â”‚  258 â”‚             return element;
â”‚       â”‚       â”‚  259 â”‚         }
â”‚       â”‚       â”‚  260 â”‚ 
â”‚       â”‚       â”‚  261 â”‚         /// <summary>
â”‚       â”‚       â”‚  262 â”‚         /// Creates a runtime element
â”‚       â”‚       â”‚  263 â”‚         /// </summary>
â”‚       â”‚       â”‚  264 â”‚         private XElement CreateRuntimeElement(Runtime runtime)
â”‚       â”‚       â”‚  265 â”‚         {
â”‚       â”‚       â”‚  266 â”‚             var element = new XElement("Runtime");
â”‚       â”‚       â”‚  267 â”‚ 
â”‚       â”‚       â”‚  268 â”‚             element.Add(new XElement("ReadOnly",
â”‚       â”‚       â”‚  269 â”‚                 new XAttribute("Value", runtime.ReadOnly ? "1" : "0")));
â”‚       â”‚       â”‚  270 â”‚ 
â”‚       â”‚       â”‚  271 â”‚             if (!string.IsNullOrEmpty(runtime.RetainLevel))
â”‚       â”‚       â”‚  272 â”‚             {
â”‚       â”‚       â”‚  273 â”‚                 element.Add(new XElement("RetainLevel",
â”‚       â”‚       â”‚  274 â”‚                     new XAttribute("Value", runtime.RetainLevel)));
â”‚       â”‚       â”‚  275 â”‚             }
â”‚       â”‚       â”‚  276 â”‚ 
â”‚       â”‚       â”‚  277 â”‚             element.Add(new XElement("Forceable",
â”‚       â”‚       â”‚  278 â”‚                 new XAttribute("Value", runtime.Forceable ? "1" : "0")));
â”‚       â”‚       â”‚  279 â”‚ 
â”‚       â”‚       â”‚  280 â”‚             if (!string.IsNullOrEmpty(runtime.InitValue))
â”‚       â”‚       â”‚  281 â”‚             {
â”‚       â”‚       â”‚  282 â”‚                 element.Add(new XElement("InitValue", runtime.InitValue));
â”‚       â”‚       â”‚  283 â”‚             }
â”‚       â”‚       â”‚  284 â”‚ 
â”‚       â”‚       â”‚  285 â”‚             return element;
â”‚       â”‚       â”‚  286 â”‚         }
â”‚       â”‚       â”‚  287 â”‚ 
â”‚       â”‚       â”‚  288 â”‚         /// <summary>
â”‚       â”‚       â”‚  289 â”‚         /// Creates the exported objects element from controllers
â”‚       â”‚       â”‚  290 â”‚         /// </summary>
â”‚       â”‚       â”‚  291 â”‚         private XElement CreateExportedObjectsElement(IEnumerable<Controller> controllers, bool includeByteCode)
â”‚       â”‚       â”‚  292 â”‚         {
â”‚       â”‚       â”‚  293 â”‚             var element = new XElement("ExportedObjects");
â”‚       â”‚       â”‚  294 â”‚ 
â”‚       â”‚       â”‚  295 â”‚             foreach (var controller in controllers)
â”‚       â”‚       â”‚  296 â”‚             {
â”‚       â”‚       â”‚  297 â”‚                 var controllerElement = new XElement("OI",
â”‚       â”‚       â”‚  298 â”‚                     new XAttribute("NAME", controller.Name),
â”‚       â”‚       â”‚  299 â”‚                     new XAttribute("TYPE", "InfinityInfinetCtlr"));
â”‚       â”‚       â”‚  300 â”‚ 
â”‚       â”‚       â”‚  301 â”‚                 // Add controller properties
â”‚       â”‚       â”‚  302 â”‚                 foreach (var prop in controller.Properties)
â”‚       â”‚       â”‚  303 â”‚                 {
â”‚       â”‚       â”‚  304 â”‚                     controllerElement.Add(new XElement("PI",
â”‚       â”‚       â”‚  305 â”‚                         new XAttribute("Name", prop.Key),
â”‚       â”‚       â”‚  306 â”‚                         new XAttribute("Value", prop.Value ?? string.Empty)));
â”‚       â”‚       â”‚  307 â”‚                 }
â”‚       â”‚       â”‚  308 â”‚ 
â”‚       â”‚       â”‚  309 â”‚                 // Add controller objects
â”‚       â”‚       â”‚  310 â”‚                 foreach (var obj in controller.Objects)
â”‚       â”‚       â”‚  311 â”‚                 {
â”‚       â”‚       â”‚  312 â”‚                     controllerElement.Add(CreateObjectElement(obj, includeByteCode));
â”‚       â”‚       â”‚  313 â”‚                 }
â”‚       â”‚       â”‚  314 â”‚ 
â”‚       â”‚       â”‚  315 â”‚                 element.Add(controllerElement);
â”‚       â”‚       â”‚  316 â”‚             }
â”‚       â”‚       â”‚  317 â”‚ 
â”‚       â”‚       â”‚  318 â”‚             return element;
â”‚       â”‚       â”‚  319 â”‚         }
â”‚       â”‚       â”‚  320 â”‚ 
â”‚       â”‚       â”‚  321 â”‚         /// <summary>
â”‚       â”‚       â”‚  322 â”‚         /// Creates an object element
â”‚       â”‚       â”‚  323 â”‚         /// </summary>
â”‚       â”‚       â”‚  324 â”‚         private XElement CreateObjectElement(ControllerObject obj, bool includeByteCode)
â”‚       â”‚       â”‚  325 â”‚         {
â”‚       â”‚       â”‚  326 â”‚             var element = new XElement("OI",
â”‚       â”‚       â”‚  327 â”‚                 new XAttribute("NAME", obj.Name),
â”‚       â”‚       â”‚  328 â”‚                 new XAttribute("TYPE", obj.Type));
â”‚       â”‚       â”‚  329 â”‚ 
â”‚       â”‚       â”‚  330 â”‚             if (!string.IsNullOrEmpty(obj.Alias))
â”‚       â”‚       â”‚  331 â”‚             {
â”‚       â”‚       â”‚  332 â”‚                 element.Add(new XElement("PI",
â”‚       â”‚       â”‚  333 â”‚                     new XAttribute("Name", "Alias"),
â”‚       â”‚       â”‚  334 â”‚                     new XAttribute("Value", obj.Alias)));
â”‚       â”‚       â”‚  335 â”‚             }
â”‚       â”‚       â”‚  336 â”‚ 
â”‚       â”‚       â”‚  337 â”‚             // Add value if not bytecode or if including bytecode
â”‚       â”‚       â”‚  338 â”‚             if (!obj.HasByteCode || includeByteCode)
â”‚       â”‚       â”‚  339 â”‚             {
â”‚       â”‚       â”‚  340 â”‚                 element.Add(new XElement("PI",
â”‚       â”‚       â”‚  341 â”‚                     new XAttribute("Name", "Value"),
â”‚       â”‚       â”‚  342 â”‚                     new XAttribute("Value", obj.Value ?? string.Empty)));
â”‚       â”‚       â”‚  343 â”‚             }
â”‚       â”‚       â”‚  344 â”‚ 
â”‚       â”‚       â”‚  345 â”‚             // Add other properties
â”‚       â”‚       â”‚  346 â”‚             foreach (var prop in obj.Properties)
â”‚       â”‚       â”‚  347 â”‚             {
â”‚       â”‚       â”‚  348 â”‚                 // Skip Alias since we already added it
â”‚       â”‚       â”‚  349 â”‚                 if (prop.Key == "Alias") continue;
â”‚       â”‚       â”‚  350 â”‚ 
â”‚       â”‚       â”‚  351 â”‚                 element.Add(new XElement("PI",
â”‚       â”‚       â”‚  352 â”‚                     new XAttribute("Name", prop.Key),
â”‚       â”‚       â”‚  353 â”‚                     new XAttribute("Value", prop.Value ?? string.Empty)));
â”‚       â”‚       â”‚  354 â”‚             }
â”‚       â”‚       â”‚  355 â”‚ 
â”‚       â”‚       â”‚  356 â”‚             // Add child objects
â”‚       â”‚       â”‚  357 â”‚             foreach (var child in obj.Children)
â”‚       â”‚       â”‚  358 â”‚             {
â”‚       â”‚       â”‚  359 â”‚                 element.Add(CreateObjectElement(child, includeByteCode));
â”‚       â”‚       â”‚  360 â”‚             }
â”‚       â”‚       â”‚  361 â”‚ 
â”‚       â”‚       â”‚  362 â”‚             return element;
â”‚       â”‚       â”‚  363 â”‚         }
â”‚       â”‚       â”‚  364 â”‚     }
â”‚       â”‚       â”‚  365 â”‚ }
â”‚       â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ComparisonService.cs (21.68 KB, 2025-03-11 13:29:45)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ComparisonService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚       â”‚   â”‚    2 â”‚ using System;
â”‚       â”‚   â”‚    3 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    4 â”‚ using System.Linq;
â”‚       â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    6 â”‚ using System.Xml.Linq;
â”‚       â”‚   â”‚    7 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    8 â”‚ using test.Core.Dto;
â”‚       â”‚   â”‚    9 â”‚ using test.Core.Exceptions;
â”‚       â”‚   â”‚   10 â”‚ using test.Core.Interfaces;
â”‚       â”‚   â”‚   11 â”‚ using test.Data.Mapping;
â”‚       â”‚   â”‚   12 â”‚ using test.Infrastructure.Logging;
â”‚       â”‚   â”‚   13 â”‚ 
â”‚       â”‚   â”‚   14 â”‚ namespace test.Application.Services
â”‚       â”‚   â”‚   15 â”‚ {
â”‚       â”‚   â”‚   16 â”‚     /// <summary>
â”‚       â”‚   â”‚   17 â”‚     /// Implementation of the comparison service for controller data
â”‚       â”‚   â”‚   18 â”‚     /// </summary>
â”‚       â”‚   â”‚   19 â”‚     public class ComparisonService : IComparisonService
â”‚       â”‚   â”‚   20 â”‚     {
â”‚       â”‚   â”‚   21 â”‚         private readonly IErrorHandler _errorHandler;
â”‚       â”‚   â”‚   22 â”‚         private readonly ILogger<ComparisonService> _logger;
â”‚       â”‚   â”‚   23 â”‚ 
â”‚       â”‚   â”‚   24 â”‚         /// <summary>
â”‚       â”‚   â”‚   25 â”‚         /// Creates a new comparison service
â”‚       â”‚   â”‚   26 â”‚         /// </summary>
â”‚       â”‚   â”‚   27 â”‚         /// <param name="errorHandler">The error handler</param>
â”‚       â”‚   â”‚   28 â”‚         /// <param name="logger">The logger</param>
â”‚       â”‚   â”‚   29 â”‚         public ComparisonService(IErrorHandler errorHandler, ILogger<ComparisonService> logger)
â”‚       â”‚   â”‚   30 â”‚         {
â”‚       â”‚   â”‚   31 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚       â”‚   â”‚   32 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚   â”‚   33 â”‚         }
â”‚       â”‚   â”‚   34 â”‚ 
â”‚       â”‚   â”‚   35 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚   36 â”‚         public async Task<IEnumerable<ComparisonResult>> CompareWithXmlAsync(string xmlContent, IEnumerable<Controller> controllers)
â”‚       â”‚   â”‚   37 â”‚         {
â”‚       â”‚   â”‚   38 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   39 â”‚             {
â”‚       â”‚   â”‚   40 â”‚                 if (string.IsNullOrWhiteSpace(xmlContent))
â”‚       â”‚   â”‚   41 â”‚                     throw new ArgumentException("XML content cannot be empty", nameof(xmlContent));
â”‚       â”‚   â”‚   42 â”‚ 
â”‚       â”‚   â”‚   43 â”‚                 if (controllers == null || !controllers.Any())
â”‚       â”‚   â”‚   44 â”‚                     throw new ArgumentException("Controllers collection cannot be empty", nameof(controllers));
â”‚       â”‚   â”‚   45 â”‚ 
â”‚       â”‚   â”‚   46 â”‚                 _logger.LogInformation("Comparing {ControllerCount} controllers with XML content", controllers.Count());
â”‚       â”‚   â”‚   47 â”‚ 
â”‚       â”‚   â”‚   48 â”‚                 var comparisons = new List<ComparisonResult>();
â”‚       â”‚   â”‚   49 â”‚                 var doc = XDocument.Parse(xmlContent);
â”‚       â”‚   â”‚   50 â”‚ 
â”‚       â”‚   â”‚   51 â”‚                 // Find the Values folder in XML
â”‚       â”‚   â”‚   52 â”‚                 var valuesFolder = doc.Descendants("OI")
â”‚       â”‚   â”‚   53 â”‚                     .Where(oi => oi.Attribute("NAME")?.Value == "Values")
â”‚       â”‚   â”‚   54 â”‚                     .FirstOrDefault();
â”‚       â”‚   â”‚   55 â”‚ 
â”‚       â”‚   â”‚   56 â”‚                 if (valuesFolder == null)
â”‚       â”‚   â”‚   57 â”‚                 {
â”‚       â”‚   â”‚   58 â”‚                     _logger.LogWarning("No Values folder found in XML content");
â”‚       â”‚   â”‚   59 â”‚                     return Enumerable.Empty<ComparisonResult>();
â”‚       â”‚   â”‚   60 â”‚                 }
â”‚       â”‚   â”‚   61 â”‚ 
â”‚       â”‚   â”‚   62 â”‚                 // Track all values found in XML
â”‚       â”‚   â”‚   63 â”‚                 var xmlValues = new Dictionary<string, (string Value, string Address)>(StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚   64 â”‚ 
â”‚       â”‚   â”‚   65 â”‚                 // Process all analog and digital values
â”‚       â”‚   â”‚   66 â”‚                 foreach (var valueObj in valuesFolder.Descendants("OI"))
â”‚       â”‚   â”‚   67 â”‚                 {
â”‚       â”‚   â”‚   68 â”‚                     var name = valueObj.Attribute("NAME")?.Value;
â”‚       â”‚   â”‚   69 â”‚                     if (string.IsNullOrEmpty(name)) continue;
â”‚       â”‚   â”‚   70 â”‚ 
â”‚       â”‚   â”‚   71 â”‚                     var address = valueObj.Descendants("PI")
â”‚       â”‚   â”‚   72 â”‚                         .FirstOrDefault(pi => pi.Attribute("Name")?.Value == "ForeignAddress")?
â”‚       â”‚   â”‚   73 â”‚                         .Attribute("Value")?.Value ?? "";
â”‚       â”‚   â”‚   74 â”‚ 
â”‚       â”‚   â”‚   75 â”‚                     var value = valueObj.Descendants("PI")
â”‚       â”‚   â”‚   76 â”‚                         .FirstOrDefault(pi => pi.Attribute("Name")?.Value == "Value")?
â”‚       â”‚   â”‚   77 â”‚                         .Attribute("Value")?.Value ?? "";
â”‚       â”‚   â”‚   78 â”‚ 
â”‚       â”‚   â”‚   79 â”‚                     if (!string.IsNullOrEmpty(value))
â”‚       â”‚   â”‚   80 â”‚                     {
â”‚       â”‚   â”‚   81 â”‚                         xmlValues[name] = (value, address);
â”‚       â”‚   â”‚   82 â”‚                     }
â”‚       â”‚   â”‚   83 â”‚                 }
â”‚       â”‚   â”‚   84 â”‚ 
â”‚       â”‚   â”‚   85 â”‚                 // Compare controllers with XML values
â”‚       â”‚   â”‚   86 â”‚                 foreach (var controller in controllers)
â”‚       â”‚   â”‚   87 â”‚                 {
â”‚       â”‚   â”‚   88 â”‚                     CompareControllerWithXml(controller, xmlValues, comparisons);
â”‚       â”‚   â”‚   89 â”‚                 }
â”‚       â”‚   â”‚   90 â”‚ 
â”‚       â”‚   â”‚   91 â”‚                 _logger.LogInformation("Comparison complete. Found {ComparisonCount} value comparisons", comparisons.Count);
â”‚       â”‚   â”‚   92 â”‚                 return comparisons;
â”‚       â”‚   â”‚   93 â”‚             }, "CompareWithXml");
â”‚       â”‚   â”‚   94 â”‚         }
â”‚       â”‚   â”‚   95 â”‚ 
â”‚       â”‚   â”‚   96 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚   97 â”‚         public async Task<string> GenerateModifiedXmlAsync(string originalXmlContent, Controller controller, string targetName = null)
â”‚       â”‚   â”‚   98 â”‚         {
â”‚       â”‚   â”‚   99 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  100 â”‚             {
â”‚       â”‚   â”‚  101 â”‚                 if (string.IsNullOrWhiteSpace(originalXmlContent))
â”‚       â”‚   â”‚  102 â”‚                     throw new ArgumentException("Original XML content cannot be empty", nameof(originalXmlContent));
â”‚       â”‚   â”‚  103 â”‚ 
â”‚       â”‚   â”‚  104 â”‚                 if (controller == null)
â”‚       â”‚   â”‚  105 â”‚                     throw new ArgumentNullException(nameof(controller));
â”‚       â”‚   â”‚  106 â”‚ 
â”‚       â”‚   â”‚  107 â”‚                 _logger.LogInformation("Generating modified XML for controller {ControllerName}", controller.Name);
â”‚       â”‚   â”‚  108 â”‚ 
â”‚       â”‚   â”‚  109 â”‚                 // Parse the XML document
â”‚       â”‚   â”‚  110 â”‚                 var doc = XDocument.Parse(originalXmlContent);
â”‚       â”‚   â”‚  111 â”‚ 
â”‚       â”‚   â”‚  112 â”‚                 // Find the controller name from ExportedObjects section
â”‚       â”‚   â”‚  113 â”‚                 var exportedObject = doc.Descendants("ExportedObjects")
â”‚       â”‚   â”‚  114 â”‚                     .FirstOrDefault()
â”‚       â”‚   â”‚  115 â”‚                     ?.Elements("OI")
â”‚       â”‚   â”‚  116 â”‚                     .FirstOrDefault();
â”‚       â”‚   â”‚  117 â”‚ 
â”‚       â”‚   â”‚  118 â”‚                 var originalControllerName = exportedObject?.Attribute("NAME")?.Value;
â”‚       â”‚   â”‚  119 â”‚ 
â”‚       â”‚   â”‚  120 â”‚                 // Use the specified target name or the controller name
â”‚       â”‚   â”‚  121 â”‚                 var newName = targetName ?? controller.Name;
â”‚       â”‚   â”‚  122 â”‚ 
â”‚       â”‚   â”‚  123 â”‚                 if (!string.IsNullOrEmpty(originalControllerName) && originalControllerName != newName)
â”‚       â”‚   â”‚  124 â”‚                 {
â”‚       â”‚   â”‚  125 â”‚                     // Replace all instances of the original controller name with the new one
â”‚       â”‚   â”‚  126 â”‚                     originalXmlContent = originalXmlContent.Replace(originalControllerName, newName);
â”‚       â”‚   â”‚  127 â”‚                     // Re-parse the modified content
â”‚       â”‚   â”‚  128 â”‚                     doc = XDocument.Parse(originalXmlContent);
â”‚       â”‚   â”‚  129 â”‚                 }
â”‚       â”‚   â”‚  130 â”‚ 
â”‚       â”‚   â”‚  131 â”‚                 // Find the Values folder
â”‚       â”‚   â”‚  132 â”‚                 var valuesFolder = doc.Descendants("OI")
â”‚       â”‚   â”‚  133 â”‚                     .Where(oi => oi.Attribute("NAME")?.Value == "Values")
â”‚       â”‚   â”‚  134 â”‚                     .FirstOrDefault();
â”‚       â”‚   â”‚  135 â”‚ 
â”‚       â”‚   â”‚  136 â”‚                 if (valuesFolder != null)
â”‚       â”‚   â”‚  137 â”‚                 {
â”‚       â”‚   â”‚  138 â”‚                     // Extract controller values into a dictionary for efficient lookup
â”‚       â”‚   â”‚  139 â”‚                     var controllerValues = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚  140 â”‚                     ExtractControllerValues(controller.Objects, controllerValues);
â”‚       â”‚   â”‚  141 â”‚ 
â”‚       â”‚   â”‚  142 â”‚                     // Update XML values
â”‚       â”‚   â”‚  143 â”‚                     foreach (var valueObj in valuesFolder.Descendants("OI"))
â”‚       â”‚   â”‚  144 â”‚                     {
â”‚       â”‚   â”‚  145 â”‚                         var name = valueObj.Attribute("NAME")?.Value;
â”‚       â”‚   â”‚  146 â”‚                         if (string.IsNullOrEmpty(name)) continue;
â”‚       â”‚   â”‚  147 â”‚ 
â”‚       â”‚   â”‚  148 â”‚                         // Check if we have a value for this name in the controller
â”‚       â”‚   â”‚  149 â”‚                         if (controllerValues.TryGetValue(name, out var newValue))
â”‚       â”‚   â”‚  150 â”‚                         {
â”‚       â”‚   â”‚  151 â”‚                             var valueElement = valueObj.Descendants("PI")
â”‚       â”‚   â”‚  152 â”‚                                 .FirstOrDefault(pi => pi.Attribute("Name")?.Value == "Value");
â”‚       â”‚   â”‚  153 â”‚ 
â”‚       â”‚   â”‚  154 â”‚                             if (valueElement != null)
â”‚       â”‚   â”‚  155 â”‚                             {
â”‚       â”‚   â”‚  156 â”‚                                 valueElement.SetAttributeValue("Value", newValue);
â”‚       â”‚   â”‚  157 â”‚                             }
â”‚       â”‚   â”‚  158 â”‚                         }
â”‚       â”‚   â”‚  159 â”‚                     }
â”‚       â”‚   â”‚  160 â”‚                 }
â”‚       â”‚   â”‚  161 â”‚ 
â”‚       â”‚   â”‚  162 â”‚                 _logger.LogInformation("XML modification complete for controller {ControllerName}", controller.Name);
â”‚       â”‚   â”‚  163 â”‚                 return doc.ToString();
â”‚       â”‚   â”‚  164 â”‚             }, "GenerateModifiedXml");
â”‚       â”‚   â”‚  165 â”‚         }
â”‚       â”‚   â”‚  166 â”‚ 
â”‚       â”‚   â”‚  167 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚  168 â”‚         public async Task<IEnumerable<ControllerGroup>> GroupControllersAsync(IEnumerable<Controller> controllers, GroupingOptions options = null)
â”‚       â”‚   â”‚  169 â”‚         {
â”‚       â”‚   â”‚  170 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  171 â”‚             {
â”‚       â”‚   â”‚  172 â”‚                 if (controllers == null || !controllers.Any())
â”‚       â”‚   â”‚  173 â”‚                     throw new ArgumentException("Controllers collection cannot be empty", nameof(controllers));
â”‚       â”‚   â”‚  174 â”‚ 
â”‚       â”‚   â”‚  175 â”‚                 options ??= new GroupingOptions();
â”‚       â”‚   â”‚  176 â”‚                 _logger.LogInformation("Grouping {ControllerCount} controllers", controllers.Count());
â”‚       â”‚   â”‚  177 â”‚ 
â”‚       â”‚   â”‚  178 â”‚                 var groups = new List<ControllerGroup>();
â”‚       â”‚   â”‚  179 â”‚ 
â”‚       â”‚   â”‚  180 â”‚                 // Process each controller
â”‚       â”‚   â”‚  181 â”‚                 foreach (var controller in controllers)
â”‚       â”‚   â”‚  182 â”‚                 {
â”‚       â”‚   â”‚  183 â”‚                     // Compute a signature for the controller
â”‚       â”‚   â”‚  184 â”‚                     var signature = ComputeControllerSignature(controller, options);
â”‚       â”‚   â”‚  185 â”‚ 
â”‚       â”‚   â”‚  186 â”‚                     // Look for an existing group with the same signature
â”‚       â”‚   â”‚  187 â”‚                     var group = groups.FirstOrDefault(g => g.GroupIdentifier == signature);
â”‚       â”‚   â”‚  188 â”‚ 
â”‚       â”‚   â”‚  189 â”‚                     if (group == null)
â”‚       â”‚   â”‚  190 â”‚                     {
â”‚       â”‚   â”‚  191 â”‚                         // Create a new group
â”‚       â”‚   â”‚  192 â”‚                         group = new ControllerGroup(signature);
â”‚       â”‚   â”‚  193 â”‚ 
â”‚       â”‚   â”‚  194 â”‚                         // Add controller name to the list
â”‚       â”‚   â”‚  195 â”‚                         group.AddControllerName(controller.Name);
â”‚       â”‚   â”‚  196 â”‚ 
â”‚       â”‚   â”‚  197 â”‚                         // Extract values from the controller's objects
â”‚       â”‚   â”‚  198 â”‚                         ExtractControllerValuesWithProcessing(
â”‚       â”‚   â”‚  199 â”‚                             controller.Objects,
â”‚       â”‚   â”‚  200 â”‚                             group.OriginalValues,
â”‚       â”‚   â”‚  201 â”‚                             group.ProcessedValues,
â”‚       â”‚   â”‚  202 â”‚                             group.NameMapping,
â”‚       â”‚   â”‚  203 â”‚                             options.ReplacementRules);
â”‚       â”‚   â”‚  204 â”‚ 
â”‚       â”‚   â”‚  205 â”‚                         groups.Add(group);
â”‚       â”‚   â”‚  206 â”‚                     }
â”‚       â”‚   â”‚  207 â”‚                     else
â”‚       â”‚   â”‚  208 â”‚                     {
â”‚       â”‚   â”‚  209 â”‚                         // Add the controller to the existing group
â”‚       â”‚   â”‚  210 â”‚                         group.AddControllerName(controller.Name);
â”‚       â”‚   â”‚  211 â”‚                     }
â”‚       â”‚   â”‚  212 â”‚                 }
â”‚       â”‚   â”‚  213 â”‚ 
â”‚       â”‚   â”‚  214 â”‚                 _logger.LogInformation("Controller grouping complete. Found {GroupCount} distinct groups", groups.Count);
â”‚       â”‚   â”‚  215 â”‚                 return groups;
â”‚       â”‚   â”‚  216 â”‚             }, "GroupControllers");
â”‚       â”‚   â”‚  217 â”‚         }
â”‚       â”‚   â”‚  218 â”‚ 
â”‚       â”‚   â”‚  219 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚  220 â”‚         public async Task<IEnumerable<SimilarityResultDto>> FindSimilarControllersAsync(
â”‚       â”‚   â”‚  221 â”‚             string xmlContent,
â”‚       â”‚   â”‚  222 â”‚             IEnumerable<Controller> controllers,
â”‚       â”‚   â”‚  223 â”‚             GroupingOptions options = null)
â”‚       â”‚   â”‚  224 â”‚         {
â”‚       â”‚   â”‚  225 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  226 â”‚             {
â”‚       â”‚   â”‚  227 â”‚                 if (string.IsNullOrWhiteSpace(xmlContent))
â”‚       â”‚   â”‚  228 â”‚                     throw new ArgumentException("XML content cannot be empty", nameof(xmlContent));
â”‚       â”‚   â”‚  229 â”‚ 
â”‚       â”‚   â”‚  230 â”‚                 if (controllers == null || !controllers.Any())
â”‚       â”‚   â”‚  231 â”‚                     throw new ArgumentException("Controllers collection cannot be empty", nameof(controllers));
â”‚       â”‚   â”‚  232 â”‚ 
â”‚       â”‚   â”‚  233 â”‚                 options ??= new GroupingOptions();
â”‚       â”‚   â”‚  234 â”‚                 _logger.LogInformation("Finding similar controllers in XML content for {ControllerCount} controllers",
â”‚       â”‚   â”‚  235 â”‚                     controllers.Count());
â”‚       â”‚   â”‚  236 â”‚ 
â”‚       â”‚   â”‚  237 â”‚                 // Extract values from XML
â”‚       â”‚   â”‚  238 â”‚                 var xmlValues = ExtractXmlValues(xmlContent);
â”‚       â”‚   â”‚  239 â”‚                 _logger.LogInformation("Extracted {ValueCount} values from XML content", xmlValues.Count);
â”‚       â”‚   â”‚  240 â”‚ 
â”‚       â”‚   â”‚  241 â”‚                 // Group controllers
â”‚       â”‚   â”‚  242 â”‚                 var controllerGroups = await GroupControllersAsync(controllers, options);
â”‚       â”‚   â”‚  243 â”‚                 _logger.LogInformation("Created {GroupCount} controller groups", controllerGroups.Count());
â”‚       â”‚   â”‚  244 â”‚ 
â”‚       â”‚   â”‚  245 â”‚                 var results = new List<SimilarityResultDto>();
â”‚       â”‚   â”‚  246 â”‚ 
â”‚       â”‚   â”‚  247 â”‚                 // Calculate similarity for each group
â”‚       â”‚   â”‚  248 â”‚                 foreach (var group in controllerGroups)
â”‚       â”‚   â”‚  249 â”‚                 {
â”‚       â”‚   â”‚  250 â”‚                     var similarity = CalculateSimilarity(group.ProcessedValues, xmlValues);
â”‚       â”‚   â”‚  251 â”‚ 
â”‚       â”‚   â”‚  252 â”‚                     // Create similarity result
â”‚       â”‚   â”‚  253 â”‚                     var result = SimilarityResultMapper.FromControllerGroup(group, similarity);
â”‚       â”‚   â”‚  254 â”‚                     results.Add(result);
â”‚       â”‚   â”‚  255 â”‚                 }
â”‚       â”‚   â”‚  256 â”‚ 
â”‚       â”‚   â”‚  257 â”‚                 // Sort by similarity score and apply threshold
â”‚       â”‚   â”‚  258 â”‚                 var sortedResults = results
â”‚       â”‚   â”‚  259 â”‚                     .OrderByDescending(r => r.SimilarityScore)
â”‚       â”‚   â”‚  260 â”‚                     .ToList();
â”‚       â”‚   â”‚  261 â”‚ 
â”‚       â”‚   â”‚  262 â”‚                 if (!options.ReturnBestMatchesRegardless)
â”‚       â”‚   â”‚  263 â”‚                 {
â”‚       â”‚   â”‚  264 â”‚                     sortedResults = sortedResults
â”‚       â”‚   â”‚  265 â”‚                         .Where(r => r.SimilarityScore >= options.MinimumSimilarityThreshold)
â”‚       â”‚   â”‚  266 â”‚                         .ToList();
â”‚       â”‚   â”‚  267 â”‚                 }
â”‚       â”‚   â”‚  268 â”‚ 
â”‚       â”‚   â”‚  269 â”‚                 // Limit to requested number of groups
â”‚       â”‚   â”‚  270 â”‚                 if (options.NumberOfGroupsToMatch > 0 && sortedResults.Count > options.NumberOfGroupsToMatch)
â”‚       â”‚   â”‚  271 â”‚                 {
â”‚       â”‚   â”‚  272 â”‚                     sortedResults = sortedResults.Take(options.NumberOfGroupsToMatch).ToList();
â”‚       â”‚   â”‚  273 â”‚                 }
â”‚       â”‚   â”‚  274 â”‚ 
â”‚       â”‚   â”‚  275 â”‚                 _logger.LogInformation("Found {ResultCount} similar controller groups", sortedResults.Count);
â”‚       â”‚   â”‚  276 â”‚                 return sortedResults;
â”‚       â”‚   â”‚  277 â”‚             }, "FindSimilarControllers");
â”‚       â”‚   â”‚  278 â”‚         }
â”‚       â”‚   â”‚  279 â”‚ 
â”‚       â”‚   â”‚  280 â”‚         #region Helper Methods
â”‚       â”‚   â”‚  281 â”‚ 
â”‚       â”‚   â”‚  282 â”‚         /// <summary>
â”‚       â”‚   â”‚  283 â”‚         /// Compares a controller with XML values and adds results to the comparisons list
â”‚       â”‚   â”‚  284 â”‚         /// </summary>
â”‚       â”‚   â”‚  285 â”‚         private void CompareControllerWithXml(
â”‚       â”‚   â”‚  286 â”‚             Controller controller,
â”‚       â”‚   â”‚  287 â”‚             Dictionary<string, (string Value, string Address)> xmlValues,
â”‚       â”‚   â”‚  288 â”‚             List<ComparisonResult> comparisons)
â”‚       â”‚   â”‚  289 â”‚         {
â”‚       â”‚   â”‚  290 â”‚             // Process all objects in the controller
â”‚       â”‚   â”‚  291 â”‚             foreach (var obj in controller.Objects)
â”‚       â”‚   â”‚  292 â”‚             {
â”‚       â”‚   â”‚  293 â”‚                 CompareObjectWithXml(obj, xmlValues, comparisons);
â”‚       â”‚   â”‚  294 â”‚             }
â”‚       â”‚   â”‚  295 â”‚         }
â”‚       â”‚   â”‚  296 â”‚ 
â”‚       â”‚   â”‚  297 â”‚         /// <summary>
â”‚       â”‚   â”‚  298 â”‚         /// Compares an object with XML values and adds results to the comparisons list
â”‚       â”‚   â”‚  299 â”‚         /// </summary>
â”‚       â”‚   â”‚  300 â”‚         private void CompareObjectWithXml(
â”‚       â”‚   â”‚  301 â”‚             ControllerObject obj,
â”‚       â”‚   â”‚  302 â”‚             Dictionary<string, (string Value, string Address)> xmlValues,
â”‚       â”‚   â”‚  303 â”‚             List<ComparisonResult> comparisons)
â”‚       â”‚   â”‚  304 â”‚         {
â”‚       â”‚   â”‚  305 â”‚             if (!string.IsNullOrEmpty(obj.Value))
â”‚       â”‚   â”‚  306 â”‚             {
â”‚       â”‚   â”‚  307 â”‚                 var xmlData = xmlValues.TryGetValue(obj.Name, out var data) ? data : (null, null);
â”‚       â”‚   â”‚  308 â”‚ 
â”‚       â”‚   â”‚  309 â”‚                 comparisons.Add(new ComparisonResult
â”‚       â”‚   â”‚  310 â”‚                 {
â”‚       â”‚   â”‚  311 â”‚                     Name = obj.Name,
â”‚       â”‚   â”‚  312 â”‚                     ControllerValue = obj.Value,
â”‚       â”‚   â”‚  313 â”‚                     XmlValue = xmlData.Value,
â”‚       â”‚   â”‚  314 â”‚                     XmlAddress = xmlData.Address,
â”‚       â”‚   â”‚  315 â”‚                     IsMatch = obj.Value == xmlData.Value
â”‚       â”‚   â”‚  316 â”‚                 });
â”‚       â”‚   â”‚  317 â”‚             }
â”‚       â”‚   â”‚  318 â”‚ 
â”‚       â”‚   â”‚  319 â”‚             // Process children recursively
â”‚       â”‚   â”‚  320 â”‚             foreach (var child in obj.Children)
â”‚       â”‚   â”‚  321 â”‚             {
â”‚       â”‚   â”‚  322 â”‚                 CompareObjectWithXml(child, xmlValues, comparisons);
â”‚       â”‚   â”‚  323 â”‚             }
â”‚       â”‚   â”‚  324 â”‚         }
â”‚       â”‚   â”‚  325 â”‚ 
â”‚       â”‚   â”‚  326 â”‚         /// <summary>
â”‚       â”‚   â”‚  327 â”‚         /// Extracts values from controller objects
â”‚       â”‚   â”‚  328 â”‚         /// </summary>
â”‚       â”‚   â”‚  329 â”‚         private void ExtractControllerValues(IEnumerable<ControllerObject> objects, Dictionary<string, string> values)
â”‚       â”‚   â”‚  330 â”‚         {
â”‚       â”‚   â”‚  331 â”‚             foreach (var obj in objects)
â”‚       â”‚   â”‚  332 â”‚             {
â”‚       â”‚   â”‚  333 â”‚                 if (!string.IsNullOrEmpty(obj.Value))
â”‚       â”‚   â”‚  334 â”‚                 {
â”‚       â”‚   â”‚  335 â”‚                     values[obj.Name] = obj.Value;
â”‚       â”‚   â”‚  336 â”‚                 }
â”‚       â”‚   â”‚  337 â”‚ 
â”‚       â”‚   â”‚  338 â”‚                 // Process children recursively
â”‚       â”‚   â”‚  339 â”‚                 ExtractControllerValues(obj.Children, values);
â”‚       â”‚   â”‚  340 â”‚             }
â”‚       â”‚   â”‚  341 â”‚         }
â”‚       â”‚   â”‚  342 â”‚ 
â”‚       â”‚   â”‚  343 â”‚         /// <summary>
â”‚       â”‚   â”‚  344 â”‚         /// Extracts values from controller objects with name processing
â”‚       â”‚   â”‚  345 â”‚         /// </summary>
â”‚       â”‚   â”‚  346 â”‚         private void ExtractControllerValuesWithProcessing(
â”‚       â”‚   â”‚  347 â”‚             IEnumerable<ControllerObject> objects,
â”‚       â”‚   â”‚  348 â”‚             IDictionary<string, string> originalValues,
â”‚       â”‚   â”‚  349 â”‚             IDictionary<string, string> processedValues,
â”‚       â”‚   â”‚  350 â”‚             IDictionary<string, string> nameMapping,
â”‚       â”‚   â”‚  351 â”‚             IEnumerable<ReplacementRule> replacementRules)
â”‚       â”‚   â”‚  352 â”‚         {
â”‚       â”‚   â”‚  353 â”‚             foreach (var obj in objects)
â”‚       â”‚   â”‚  354 â”‚             {
â”‚       â”‚   â”‚  355 â”‚                 if (!string.IsNullOrEmpty(obj.Value))
â”‚       â”‚   â”‚  356 â”‚                 {
â”‚       â”‚   â”‚  357 â”‚                     // Store original value
â”‚       â”‚   â”‚  358 â”‚                     originalValues[obj.Name] = obj.Value;
â”‚       â”‚   â”‚  359 â”‚ 
â”‚       â”‚   â”‚  360 â”‚                     // Process name
â”‚       â”‚   â”‚  361 â”‚                     var processedName = ProcessName(obj.Name, replacementRules);
â”‚       â”‚   â”‚  362 â”‚                     nameMapping[obj.Name] = processedName;
â”‚       â”‚   â”‚  363 â”‚ 
â”‚       â”‚   â”‚  364 â”‚                     // Store processed value
â”‚       â”‚   â”‚  365 â”‚                     processedValues[processedName] = obj.Value;
â”‚       â”‚   â”‚  366 â”‚                 }
â”‚       â”‚   â”‚  367 â”‚ 
â”‚       â”‚   â”‚  368 â”‚                 // Process children recursively
â”‚       â”‚   â”‚  369 â”‚                 if (obj.Children.Any())
â”‚       â”‚   â”‚  370 â”‚                 {
â”‚       â”‚   â”‚  371 â”‚                     ExtractControllerValuesWithProcessing(
â”‚       â”‚   â”‚  372 â”‚                         obj.Children,
â”‚       â”‚   â”‚  373 â”‚                         originalValues,
â”‚       â”‚   â”‚  374 â”‚                         processedValues,
â”‚       â”‚   â”‚  375 â”‚                         nameMapping,
â”‚       â”‚   â”‚  376 â”‚                         replacementRules);
â”‚       â”‚   â”‚  377 â”‚                 }
â”‚       â”‚   â”‚  378 â”‚             }
â”‚       â”‚   â”‚  379 â”‚         }
â”‚       â”‚   â”‚  380 â”‚ 
â”‚       â”‚   â”‚  381 â”‚         /// <summary>
â”‚       â”‚   â”‚  382 â”‚         /// Processes a name using replacement rules
â”‚       â”‚   â”‚  383 â”‚         /// </summary>
â”‚       â”‚   â”‚  384 â”‚         private string ProcessName(string name, IEnumerable<ReplacementRule> replacementRules)
â”‚       â”‚   â”‚  385 â”‚         {
â”‚       â”‚   â”‚  386 â”‚             if (string.IsNullOrEmpty(name) || replacementRules == null || !replacementRules.Any())
â”‚       â”‚   â”‚  387 â”‚                 return name;
â”‚       â”‚   â”‚  388 â”‚ 
â”‚       â”‚   â”‚  389 â”‚             var result = name;
â”‚       â”‚   â”‚  390 â”‚ 
â”‚       â”‚   â”‚  391 â”‚             // Apply prefix rules first
â”‚       â”‚   â”‚  392 â”‚             foreach (var rule in replacementRules.Where(r => r.IsPrefix).OrderByDescending(r => r.Priority))
â”‚       â”‚   â”‚  393 â”‚             {
â”‚       â”‚   â”‚  394 â”‚                 if (result.StartsWith(rule.Pattern, StringComparison.OrdinalIgnoreCase))
â”‚       â”‚   â”‚  395 â”‚                 {
â”‚       â”‚   â”‚  396 â”‚                     result = rule.Replacement + result.Substring(rule.Pattern.Length);
â”‚       â”‚   â”‚  397 â”‚                     break; // Only apply one prefix rule
â”‚       â”‚   â”‚  398 â”‚                 }
â”‚       â”‚   â”‚  399 â”‚             }
â”‚       â”‚   â”‚  400 â”‚ 
â”‚       â”‚   â”‚  401 â”‚             // Then apply suffix rules
â”‚       â”‚   â”‚  402 â”‚             foreach (var rule in replacementRules.Where(r => !r.IsPrefix).OrderByDescending(r => r.Priority))
â”‚       â”‚   â”‚  403 â”‚             {
â”‚       â”‚   â”‚  404 â”‚                 if (result.EndsWith(rule.Pattern, StringComparison.OrdinalIgnoreCase))
â”‚       â”‚   â”‚  405 â”‚                 {
â”‚       â”‚   â”‚  406 â”‚                     result = result.Substring(0, result.Length - rule.Pattern.Length) + rule.Replacement;
â”‚       â”‚   â”‚  407 â”‚                     break; // Only apply one suffix rule
â”‚       â”‚   â”‚  408 â”‚                 }
â”‚       â”‚   â”‚  409 â”‚             }
â”‚       â”‚   â”‚  410 â”‚ 
â”‚       â”‚   â”‚  411 â”‚             return result;
â”‚       â”‚   â”‚  412 â”‚         }
â”‚       â”‚   â”‚  413 â”‚ 
â”‚       â”‚   â”‚  414 â”‚         /// <summary>
â”‚       â”‚   â”‚  415 â”‚         /// Extracts values from XML content
â”‚       â”‚   â”‚  416 â”‚         /// </summary>
â”‚       â”‚   â”‚  417 â”‚         private Dictionary<string, string> ExtractXmlValues(string xmlContent)
â”‚       â”‚   â”‚  418 â”‚         {
â”‚       â”‚   â”‚  419 â”‚             var values = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚  420 â”‚             var doc = XDocument.Parse(xmlContent);
â”‚       â”‚   â”‚  421 â”‚ 
â”‚       â”‚   â”‚  422 â”‚             try
â”‚       â”‚   â”‚  423 â”‚             {
â”‚       â”‚   â”‚  424 â”‚                 var exportedObjects = doc.Root?.Element("ExportedObjects");
â”‚       â”‚   â”‚  425 â”‚                 if (exportedObjects != null)
â”‚       â”‚   â”‚  426 â”‚                 {
â”‚       â”‚   â”‚  427 â”‚                     ProcessOIElements(exportedObjects, values);
â”‚       â”‚   â”‚  428 â”‚                 }
â”‚       â”‚   â”‚  429 â”‚             }
â”‚       â”‚   â”‚  430 â”‚             catch (Exception ex)
â”‚       â”‚   â”‚  431 â”‚             {
â”‚       â”‚   â”‚  432 â”‚                 _logger.LogError(ex, "Error extracting XML values");
â”‚       â”‚   â”‚  433 â”‚             }
â”‚       â”‚   â”‚  434 â”‚ 
â”‚       â”‚   â”‚  435 â”‚             return values;
â”‚       â”‚   â”‚  436 â”‚         }
â”‚       â”‚   â”‚  437 â”‚ 
â”‚       â”‚   â”‚  438 â”‚         /// <summary>
â”‚       â”‚   â”‚  439 â”‚         /// Processes OI elements recursively
â”‚       â”‚   â”‚  440 â”‚         /// </summary>
â”‚       â”‚   â”‚  441 â”‚         private void ProcessOIElements(XElement element, Dictionary<string, string> values)
â”‚       â”‚   â”‚  442 â”‚         {
â”‚       â”‚   â”‚  443 â”‚             foreach (var oi in element.Elements("OI"))
â”‚       â”‚   â”‚  444 â”‚             {
â”‚       â”‚   â”‚  445 â”‚                 var name = oi.Attribute("NAME")?.Value;
â”‚       â”‚   â”‚  446 â”‚                 var type = oi.Attribute("TYPE")?.Value;
â”‚       â”‚   â”‚  447 â”‚ 
â”‚       â”‚   â”‚  448 â”‚                 if (!string.IsNullOrEmpty(name))
â”‚       â”‚   â”‚  449 â”‚                 {
â”‚       â”‚   â”‚  450 â”‚                     bool shouldProcess = false;
â”‚       â”‚   â”‚  451 â”‚                     if (type != null)
â”‚       â”‚   â”‚  452 â”‚                     {
â”‚       â”‚   â”‚  453 â”‚                         var typeLower = type.ToLowerInvariant();
â”‚       â”‚   â”‚  454 â”‚                         shouldProcess = typeLower.Contains("value") ||
â”‚       â”‚   â”‚  455 â”‚                                         typeLower.Contains("input") ||
â”‚       â”‚   â”‚  456 â”‚                                         typeLower.Contains("output");
â”‚       â”‚   â”‚  457 â”‚                     }
â”‚       â”‚   â”‚  458 â”‚ 
â”‚       â”‚   â”‚  459 â”‚                     if (shouldProcess)
â”‚       â”‚   â”‚  460 â”‚                     {
â”‚       â”‚   â”‚  461 â”‚                         // Get the value
â”‚       â”‚   â”‚  462 â”‚                         var valuePi = oi.Elements("PI")
â”‚       â”‚   â”‚  463 â”‚                             .FirstOrDefault(pi => pi.Attribute("Name")?.Value?.Equals("Value", StringComparison.OrdinalIgnoreCase) == true);
â”‚       â”‚   â”‚  464 â”‚ 
â”‚       â”‚   â”‚  465 â”‚                         if (valuePi != null)
â”‚       â”‚   â”‚  466 â”‚                         {
â”‚       â”‚   â”‚  467 â”‚                             var value = valuePi.Attribute("Value")?.Value ?? "";
â”‚       â”‚   â”‚  468 â”‚                             values[name] = value;
â”‚       â”‚   â”‚  469 â”‚                         }
â”‚       â”‚   â”‚  470 â”‚                     }
â”‚       â”‚   â”‚  471 â”‚                 }
â”‚       â”‚   â”‚  472 â”‚ 
â”‚       â”‚   â”‚  473 â”‚                 // Process children recursively
â”‚       â”‚   â”‚  474 â”‚                 ProcessOIElements(oi, values);
â”‚       â”‚   â”‚  475 â”‚             }
â”‚       â”‚   â”‚  476 â”‚         }
â”‚       â”‚   â”‚  477 â”‚ 
â”‚       â”‚   â”‚  478 â”‚         /// <summary>
â”‚       â”‚   â”‚  479 â”‚         /// Computes a signature for a controller
â”‚       â”‚   â”‚  480 â”‚         /// </summary>
â”‚       â”‚   â”‚  481 â”‚         private string ComputeControllerSignature(Controller controller, GroupingOptions options)
â”‚       â”‚   â”‚  482 â”‚         {
â”‚       â”‚   â”‚  483 â”‚             // Get model
â”‚       â”‚   â”‚  484 â”‚             var model = controller.Model;
â”‚       â”‚   â”‚  485 â”‚ 
â”‚       â”‚   â”‚  486 â”‚             // Extract values
â”‚       â”‚   â”‚  487 â”‚             var values = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚  488 â”‚             ExtractControllerValues(controller.Objects, values);
â”‚       â”‚   â”‚  489 â”‚ 
â”‚       â”‚   â”‚  490 â”‚             // Hash based on objects types, names, and values
â”‚       â”‚   â”‚  491 â”‚             var objSigs = values.OrderBy(o => o.Key)
â”‚       â”‚   â”‚  492 â”‚                                 .Select(o => $"{o.Key}|{o.Value}");
â”‚       â”‚   â”‚  493 â”‚ 
â”‚       â”‚   â”‚  494 â”‚             return $"{model}_{string.Join("_", objSigs.Take(5))}";
â”‚       â”‚   â”‚  495 â”‚         }
â”‚       â”‚   â”‚  496 â”‚ 
â”‚       â”‚   â”‚  497 â”‚         /// <summary>
â”‚       â”‚   â”‚  498 â”‚         /// Calculates similarity between two value sets
â”‚       â”‚   â”‚  499 â”‚         /// </summary>
â”‚       â”‚   â”‚  500 â”‚         private double CalculateSimilarity(
â”‚       â”‚   â”‚  501 â”‚             IDictionary<string, string> groupValues,
â”‚       â”‚   â”‚  502 â”‚             Dictionary<string, string> xmlValues)
â”‚       â”‚   â”‚  503 â”‚         {
â”‚       â”‚   â”‚  504 â”‚             if (!groupValues.Any() || !xmlValues.Any())
â”‚       â”‚   â”‚  505 â”‚                 return 0;
â”‚       â”‚   â”‚  506 â”‚ 
â”‚       â”‚   â”‚  507 â”‚             // Create case-insensitive dictionaries for comparison
â”‚       â”‚   â”‚  508 â”‚             var caseInsensitiveGroup = new Dictionary<string, string>(groupValues, StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚  509 â”‚             var caseInsensitiveXml = new Dictionary<string, string>(xmlValues, StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚  510 â”‚ 
â”‚       â”‚   â”‚  511 â”‚             // Get all unique keys using case-insensitive comparison
â”‚       â”‚   â”‚  512 â”‚             var allKeys = new HashSet<string>(
â”‚       â”‚   â”‚  513 â”‚                 caseInsensitiveGroup.Keys.Concat(caseInsensitiveXml.Keys),
â”‚       â”‚   â”‚  514 â”‚                 StringComparer.OrdinalIgnoreCase
â”‚       â”‚   â”‚  515 â”‚             );
â”‚       â”‚   â”‚  516 â”‚ 
â”‚       â”‚   â”‚  517 â”‚             // Count matching keys
â”‚       â”‚   â”‚  518 â”‚             int matchingKeys = 0;
â”‚       â”‚   â”‚  519 â”‚             foreach (var key in allKeys)
â”‚       â”‚   â”‚  520 â”‚             {
â”‚       â”‚   â”‚  521 â”‚                 bool inGroup = caseInsensitiveGroup.ContainsKey(key);
â”‚       â”‚   â”‚  522 â”‚                 bool inXml = caseInsensitiveXml.ContainsKey(key);
â”‚       â”‚   â”‚  523 â”‚ 
â”‚       â”‚   â”‚  524 â”‚                 if (inGroup && inXml)
â”‚       â”‚   â”‚  525 â”‚                 {
â”‚       â”‚   â”‚  526 â”‚                     matchingKeys++;
â”‚       â”‚   â”‚  527 â”‚                 }
â”‚       â”‚   â”‚  528 â”‚             }
â”‚       â”‚   â”‚  529 â”‚ 
â”‚       â”‚   â”‚  530 â”‚             return (double)matchingKeys / allKeys.Count;
â”‚       â”‚   â”‚  531 â”‚         }
â”‚       â”‚   â”‚  532 â”‚ 
â”‚       â”‚   â”‚  533 â”‚         #endregion
â”‚       â”‚   â”‚  534 â”‚     }
â”‚       â”‚   â”‚  535 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ControllerModelService.cs (2.47 KB, 2025-03-11 13:54:58)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ControllerModelService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚       â”‚   â”‚    2 â”‚ using System;
â”‚       â”‚   â”‚    3 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    4 â”‚ using System.Linq;
â”‚       â”‚   â”‚    5 â”‚ using System.Text;
â”‚       â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    7 â”‚ using test.Core.Interfaces;
â”‚       â”‚   â”‚    8 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    9 â”‚ 
â”‚       â”‚   â”‚   10 â”‚ namespace test.Application.Services
â”‚       â”‚   â”‚   11 â”‚ {
â”‚       â”‚   â”‚   12 â”‚     /// <summary>
â”‚       â”‚   â”‚   13 â”‚     /// Implementation of controller model service
â”‚       â”‚   â”‚   14 â”‚     /// </summary>
â”‚       â”‚   â”‚   15 â”‚     public class ControllerModelService : IControllerModelService
â”‚       â”‚   â”‚   16 â”‚     {
â”‚       â”‚   â”‚   17 â”‚         private readonly ILogger<ControllerModelService> _logger;
â”‚       â”‚   â”‚   18 â”‚ 
â”‚       â”‚   â”‚   19 â”‚         public ControllerModelService(ILogger<ControllerModelService> logger)
â”‚       â”‚   â”‚   20 â”‚         {
â”‚       â”‚   â”‚   21 â”‚             _logger = logger;
â”‚       â”‚   â”‚   22 â”‚         }
â”‚       â”‚   â”‚   23 â”‚ 
â”‚       â”‚   â”‚   24 â”‚         public ControllerModelInfo.ControllerFamily DetermineFamily(string modelNumber)
â”‚       â”‚   â”‚   25 â”‚         {
â”‚       â”‚   â”‚   26 â”‚             var family = ControllerModelInfo.DetermineControllerFamily(modelNumber);
â”‚       â”‚   â”‚   27 â”‚             _logger.LogDebug("Determined family {Family} for model {ModelNumber}", family, modelNumber);
â”‚       â”‚   â”‚   28 â”‚             return family;
â”‚       â”‚   â”‚   29 â”‚         }
â”‚       â”‚   â”‚   30 â”‚ 
â”‚       â”‚   â”‚   31 â”‚         public ControllerModelInfo.ModelProperties GetModelProperties(string modelNumber)
â”‚       â”‚   â”‚   32 â”‚         {
â”‚       â”‚   â”‚   33 â”‚             return ControllerModelInfo.GetModelProperties(modelNumber);
â”‚       â”‚   â”‚   34 â”‚         }
â”‚       â”‚   â”‚   35 â”‚ 
â”‚       â”‚   â”‚   36 â”‚         public void SetModelProperties(string modelNumber, ControllerModelInfo.ModelProperties properties)
â”‚       â”‚   â”‚   37 â”‚         {
â”‚       â”‚   â”‚   38 â”‚             ControllerModelInfo.SetModelProperties(modelNumber, properties);
â”‚       â”‚   â”‚   39 â”‚             _logger.LogInformation("Updated model properties for {ModelNumber}", modelNumber);
â”‚       â”‚   â”‚   40 â”‚         }
â”‚       â”‚   â”‚   41 â”‚ 
â”‚       â”‚   â”‚   42 â”‚         public IEnumerable<string> GetAllKnownModels()
â”‚       â”‚   â”‚   43 â”‚         {
â”‚       â”‚   â”‚   44 â”‚             // Combine both model lists
â”‚       â”‚   â”‚   45 â”‚             var models = new List<string>();
â”‚       â”‚   â”‚   46 â”‚ 
â”‚       â”‚   â”‚   47 â”‚             // Access these via reflection since they're private fields in ControllerModelInfo
â”‚       â”‚   â”‚   48 â”‚             // Alternative: Make them accessible methods in ControllerModelInfo
â”‚       â”‚   â”‚   49 â”‚             var infinityModelsField = typeof(ControllerModelInfo).GetField("InfinityModels",
â”‚       â”‚   â”‚   50 â”‚                 System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static);
â”‚       â”‚   â”‚   51 â”‚ 
â”‚       â”‚   â”‚   52 â”‚             var i2ModelsField = typeof(ControllerModelInfo).GetField("I2Models",
â”‚       â”‚   â”‚   53 â”‚                 System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static);
â”‚       â”‚   â”‚   54 â”‚ 
â”‚       â”‚   â”‚   55 â”‚             if (infinityModelsField?.GetValue(null) is HashSet<string> infinityModels)
â”‚       â”‚   â”‚   56 â”‚             {
â”‚       â”‚   â”‚   57 â”‚                 models.AddRange(infinityModels);
â”‚       â”‚   â”‚   58 â”‚             }
â”‚       â”‚   â”‚   59 â”‚ 
â”‚       â”‚   â”‚   60 â”‚             if (i2ModelsField?.GetValue(null) is HashSet<string> i2Models)
â”‚       â”‚   â”‚   61 â”‚             {
â”‚       â”‚   â”‚   62 â”‚                 models.AddRange(i2Models);
â”‚       â”‚   â”‚   63 â”‚             }
â”‚       â”‚   â”‚   64 â”‚ 
â”‚       â”‚   â”‚   65 â”‚             return models;
â”‚       â”‚   â”‚   66 â”‚         }
â”‚       â”‚   â”‚   67 â”‚     }
â”‚       â”‚   â”‚   68 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ControllerService.cs (11.99 KB, 2025-03-11 15:09:39)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ControllerService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚       â”‚   â”‚    2 â”‚ using System;
â”‚       â”‚   â”‚    3 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    4 â”‚ using System.Diagnostics;
â”‚       â”‚   â”‚    5 â”‚ using System.Linq;
â”‚       â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    7 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    8 â”‚ using test.Core.Interfaces;
â”‚       â”‚   â”‚    9 â”‚ using test.Data;
â”‚       â”‚   â”‚   10 â”‚ using test.Infrastructure.Logging;
â”‚       â”‚   â”‚   11 â”‚ 
â”‚       â”‚   â”‚   12 â”‚ namespace test.Application.Services
â”‚       â”‚   â”‚   13 â”‚ {
â”‚       â”‚   â”‚   14 â”‚     /// <summary>
â”‚       â”‚   â”‚   15 â”‚     /// Service for controller-related operations
â”‚       â”‚   â”‚   16 â”‚     /// </summary>
â”‚       â”‚   â”‚   17 â”‚     public class ControllerService
â”‚       â”‚   â”‚   18 â”‚     {
â”‚       â”‚   â”‚   19 â”‚         private readonly IControllerRepository _controllerRepository;
â”‚       â”‚   â”‚   20 â”‚         private readonly IErrorHandler _errorHandler;
â”‚       â”‚   â”‚   21 â”‚         private readonly ILogger<ControllerService> _logger;
â”‚       â”‚   â”‚   22 â”‚ 
â”‚       â”‚   â”‚   23 â”‚         /// <summary>
â”‚       â”‚   â”‚   24 â”‚         /// Creates a new controller service
â”‚       â”‚   â”‚   25 â”‚         /// </summary>
â”‚       â”‚   â”‚   26 â”‚         /// <param name="controllerRepository">The controller repository</param>
â”‚       â”‚   â”‚   27 â”‚         /// <param name="errorHandler">The error handler</param>
â”‚       â”‚   â”‚   28 â”‚         /// <param name="logger">The logger</param>
â”‚       â”‚   â”‚   29 â”‚         public ControllerService(
â”‚       â”‚   â”‚   30 â”‚             IControllerRepository controllerRepository,
â”‚       â”‚   â”‚   31 â”‚             IErrorHandler errorHandler,
â”‚       â”‚   â”‚   32 â”‚             ILogger<ControllerService> logger)
â”‚       â”‚   â”‚   33 â”‚         {
â”‚       â”‚   â”‚   34 â”‚             _controllerRepository = controllerRepository ?? throw new ArgumentNullException(nameof(controllerRepository));
â”‚       â”‚   â”‚   35 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚       â”‚   â”‚   36 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚   â”‚   37 â”‚         }
â”‚       â”‚   â”‚   38 â”‚ 
â”‚       â”‚   â”‚   39 â”‚         /// <summary>
â”‚       â”‚   â”‚   40 â”‚         /// Gets controllers by session ID
â”‚       â”‚   â”‚   41 â”‚         /// </summary>
â”‚       â”‚   â”‚   42 â”‚         /// <param name="sessionId">The session ID</param>
â”‚       â”‚   â”‚   43 â”‚         /// <param name="page">The page number (0-based)</param>
â”‚       â”‚   â”‚   44 â”‚         /// <param name="pageSize">The page size</param>
â”‚       â”‚   â”‚   45 â”‚         /// <returns>A list of controllers</returns>
â”‚       â”‚   â”‚   46 â”‚         public async Task<List<Controller>> GetControllersBySessionAsync(string sessionId, int page = 0, int pageSize = 50)
â”‚       â”‚   â”‚   47 â”‚         {
â”‚       â”‚   â”‚   48 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   49 â”‚             {
â”‚       â”‚   â”‚   50 â”‚                 var skip = page * pageSize;
â”‚       â”‚   â”‚   51 â”‚                 var controllers = await _controllerRepository.GetControllersBySessionAsync(sessionId, skip, pageSize);
â”‚       â”‚   â”‚   52 â”‚                 return controllers.ToList();
â”‚       â”‚   â”‚   53 â”‚             }, "GetControllersBySession");
â”‚       â”‚   â”‚   54 â”‚         }
â”‚       â”‚   â”‚   55 â”‚ 
â”‚       â”‚   â”‚   56 â”‚         /// <summary>
â”‚       â”‚   â”‚   57 â”‚         /// Gets all sessions
â”‚       â”‚   â”‚   58 â”‚         /// </summary>
â”‚       â”‚   â”‚   59 â”‚         /// <returns>A list of session information</returns>
â”‚       â”‚   â”‚   60 â”‚         public async Task<List<SessionInfo>> GetAllSessionsAsync()
â”‚       â”‚   â”‚   61 â”‚         {
â”‚       â”‚   â”‚   62 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   63 â”‚             {
â”‚       â”‚   â”‚   64 â”‚                 var sessions = await _controllerRepository.GetAllSessionsAsync();
â”‚       â”‚   â”‚   65 â”‚                 return sessions.ToList();
â”‚       â”‚   â”‚   66 â”‚             }, "GetAllSessions");
â”‚       â”‚   â”‚   67 â”‚         }
â”‚       â”‚   â”‚   68 â”‚ 
â”‚       â”‚   â”‚   69 â”‚         /// <summary>
â”‚       â”‚   â”‚   70 â”‚         /// Gets session information
â”‚       â”‚   â”‚   71 â”‚         /// </summary>
â”‚       â”‚   â”‚   72 â”‚         /// <param name="sessionId">The session ID</param>
â”‚       â”‚   â”‚   73 â”‚         /// <returns>The session information</returns>
â”‚       â”‚   â”‚   74 â”‚         public async Task<SessionInfo> GetSessionInfoAsync(string sessionId)
â”‚       â”‚   â”‚   75 â”‚         {
â”‚       â”‚   â”‚   76 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   77 â”‚             {
â”‚       â”‚   â”‚   78 â”‚                 return await _controllerRepository.GetSessionInfoAsync(sessionId);
â”‚       â”‚   â”‚   79 â”‚             }, "GetSessionInfo");
â”‚       â”‚   â”‚   80 â”‚         }
â”‚       â”‚   â”‚   81 â”‚ 
â”‚       â”‚   â”‚   82 â”‚         /// <summary>
â”‚       â”‚   â”‚   83 â”‚         /// Gets sessions by project ID
â”‚       â”‚   â”‚   84 â”‚         /// </summary>
â”‚       â”‚   â”‚   85 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   86 â”‚         /// <returns>A list of session information</returns>
â”‚       â”‚   â”‚   87 â”‚         public async Task<List<SessionInfo>> GetSessionsByProjectAsync(string projectId)
â”‚       â”‚   â”‚   88 â”‚         {
â”‚       â”‚   â”‚   89 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   90 â”‚             {
â”‚       â”‚   â”‚   91 â”‚                 var sessions = await _controllerRepository.GetSessionsByProjectAsync(projectId);
â”‚       â”‚   â”‚   92 â”‚                 return sessions.ToList();
â”‚       â”‚   â”‚   93 â”‚             }, "GetSessionsByProject");
â”‚       â”‚   â”‚   94 â”‚         }
â”‚       â”‚   â”‚   95 â”‚ 
â”‚       â”‚   â”‚   96 â”‚         /// <summary>
â”‚       â”‚   â”‚   97 â”‚         /// Deletes a session
â”‚       â”‚   â”‚   98 â”‚         /// </summary>
â”‚       â”‚   â”‚   99 â”‚         /// <param name="sessionId">The session ID</param>
â”‚       â”‚   â”‚  100 â”‚         /// <returns>True if deleted, false if not found</returns>
â”‚       â”‚   â”‚  101 â”‚         public async Task<bool> DeleteSessionAsync(string sessionId)
â”‚       â”‚   â”‚  102 â”‚         {
â”‚       â”‚   â”‚  103 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  104 â”‚             {
â”‚       â”‚   â”‚  105 â”‚                 return await _controllerRepository.DeleteSessionAsync(sessionId);
â”‚       â”‚   â”‚  106 â”‚             }, "DeleteSession");
â”‚       â”‚   â”‚  107 â”‚         }
â”‚       â”‚   â”‚  108 â”‚ 
â”‚       â”‚   â”‚  109 â”‚         /// <summary>
â”‚       â”‚   â”‚  110 â”‚         /// Cleans up old sessions
â”‚       â”‚   â”‚  111 â”‚         /// </summary>
â”‚       â”‚   â”‚  112 â”‚         /// <param name="maxAgeDays">The maximum age in days</param>
â”‚       â”‚   â”‚  113 â”‚         /// <returns>The number of sessions deleted</returns>
â”‚       â”‚   â”‚  114 â”‚         public async Task<int> CleanupOldSessionsAsync(int maxAgeDays)
â”‚       â”‚   â”‚  115 â”‚         {
â”‚       â”‚   â”‚  116 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  117 â”‚             {
â”‚       â”‚   â”‚  118 â”‚                 var maxAge = TimeSpan.FromDays(maxAgeDays);
â”‚       â”‚   â”‚  119 â”‚                 return await _controllerRepository.CleanupOldSessionsAsync(maxAge);
â”‚       â”‚   â”‚  120 â”‚             }, "CleanupOldSessions");
â”‚       â”‚   â”‚  121 â”‚         }
â”‚       â”‚   â”‚  122 â”‚ 
â”‚       â”‚   â”‚  123 â”‚         /// <summary>
â”‚       â”‚   â”‚  124 â”‚         /// Optimizes the database
â”‚       â”‚   â”‚  125 â”‚         /// </summary>
â”‚       â”‚   â”‚  126 â”‚         public async Task OptimizeDatabaseAsync()
â”‚       â”‚   â”‚  127 â”‚         {
â”‚       â”‚   â”‚  128 â”‚             await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  129 â”‚             {
â”‚       â”‚   â”‚  130 â”‚                 await _controllerRepository.OptimizeDatabaseAsync();
â”‚       â”‚   â”‚  131 â”‚             }, "OptimizeDatabase");
â”‚       â”‚   â”‚  132 â”‚         }
â”‚       â”‚   â”‚  133 â”‚ 
â”‚       â”‚   â”‚  134 â”‚         /// <summary>
â”‚       â”‚   â”‚  135 â”‚         /// Gets a database health report
â”‚       â”‚   â”‚  136 â”‚         /// </summary>
â”‚       â”‚   â”‚  137 â”‚         /// <returns>A health report string</returns>
â”‚       â”‚   â”‚  138 â”‚         public async Task<string> GetDatabaseHealthReportAsync()
â”‚       â”‚   â”‚  139 â”‚         {
â”‚       â”‚   â”‚  140 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  141 â”‚             {
â”‚       â”‚   â”‚  142 â”‚                 return await _controllerRepository.GetDatabaseHealthReportAsync();
â”‚       â”‚   â”‚  143 â”‚             }, "GetDatabaseHealthReport");
â”‚       â”‚   â”‚  144 â”‚         }
â”‚       â”‚   â”‚  145 â”‚ 
â”‚       â”‚   â”‚  146 â”‚         /// <summary>
â”‚       â”‚   â”‚  147 â”‚         /// Filters controllers based on specified criteria
â”‚       â”‚   â”‚  148 â”‚         /// </summary>
â”‚       â”‚   â”‚  149 â”‚         /// <param name="controllers">The controllers to filter</param>
â”‚       â”‚   â”‚  150 â”‚         /// <param name="typeWhitelist">Types to include</param>
â”‚       â”‚   â”‚  151 â”‚         /// <param name="nameFilters">Name filters</param>
â”‚       â”‚   â”‚  152 â”‚         /// <param name="isWhitelist">Whether name filters are a whitelist (true) or blacklist (false)</param>
â”‚       â”‚   â”‚  153 â”‚         /// <param name="ignoreEmptyValues">Whether to ignore empty values</param>
â”‚       â”‚   â”‚  154 â”‚         /// <param name="includeByteCode">Whether to include byte code</param>
â”‚       â”‚   â”‚  155 â”‚         /// <returns>A filtered list of controllers</returns>
â”‚       â”‚   â”‚  156 â”‚         public List<Controller> FilterControllers(
â”‚       â”‚   â”‚  157 â”‚             IEnumerable<Controller> controllers,
â”‚       â”‚   â”‚  158 â”‚             HashSet<string> typeWhitelist = null,
â”‚       â”‚   â”‚  159 â”‚             HashSet<string> nameFilters = null,
â”‚       â”‚   â”‚  160 â”‚             bool isWhitelist = true,
â”‚       â”‚   â”‚  161 â”‚             bool ignoreEmptyValues = false,
â”‚       â”‚   â”‚  162 â”‚             bool includeByteCode = true)
â”‚       â”‚   â”‚  163 â”‚         {
â”‚       â”‚   â”‚  164 â”‚             return _errorHandler.WithErrorHandlingAsync(() =>
â”‚       â”‚   â”‚  165 â”‚             {
â”‚       â”‚   â”‚  166 â”‚                 var filteredControllers = new List<Controller>();
â”‚       â”‚   â”‚  167 â”‚                 var sw = Stopwatch.StartNew();
â”‚       â”‚   â”‚  168 â”‚ 
â”‚       â”‚   â”‚  169 â”‚                 foreach (var controller in controllers)
â”‚       â”‚   â”‚  170 â”‚                 {
â”‚       â”‚   â”‚  171 â”‚                     var filteredObjects = FilterObjects(
â”‚       â”‚   â”‚  172 â”‚                         controller.Objects,
â”‚       â”‚   â”‚  173 â”‚                         typeWhitelist,
â”‚       â”‚   â”‚  174 â”‚                         nameFilters,
â”‚       â”‚   â”‚  175 â”‚                         isWhitelist,
â”‚       â”‚   â”‚  176 â”‚                         ignoreEmptyValues,
â”‚       â”‚   â”‚  177 â”‚                         includeByteCode);
â”‚       â”‚   â”‚  178 â”‚ 
â”‚       â”‚   â”‚  179 â”‚                     if (filteredObjects.Count > 0)
â”‚       â”‚   â”‚  180 â”‚                     {
â”‚       â”‚   â”‚  181 â”‚                         // Create a new controller with filtered objects
â”‚       â”‚   â”‚  182 â”‚                         var newController = new Controller(controller.Name, controller.Model);
â”‚       â”‚   â”‚  183 â”‚ 
â”‚       â”‚   â”‚  184 â”‚                         // Copy properties
â”‚       â”‚   â”‚  185 â”‚                         foreach (var prop in controller.Properties)
â”‚       â”‚   â”‚  186 â”‚                         {
â”‚       â”‚   â”‚  187 â”‚                             newController.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  188 â”‚                         }
â”‚       â”‚   â”‚  189 â”‚ 
â”‚       â”‚   â”‚  190 â”‚                         // Set connection info
â”‚       â”‚   â”‚  191 â”‚                         newController.SetConnectionInfo(
â”‚       â”‚   â”‚  192 â”‚                             controller.Port,
â”‚       â”‚   â”‚  193 â”‚                             controller.SerialNumber,
â”‚       â”‚   â”‚  194 â”‚                             controller.InfinetId);
â”‚       â”‚   â”‚  195 â”‚ 
â”‚       â”‚   â”‚  196 â”‚                         // Add filtered objects
â”‚       â”‚   â”‚  197 â”‚                         foreach (var obj in filteredObjects)
â”‚       â”‚   â”‚  198 â”‚                         {
â”‚       â”‚   â”‚  199 â”‚                             newController.AddObject(obj);
â”‚       â”‚   â”‚  200 â”‚                         }
â”‚       â”‚   â”‚  201 â”‚ 
â”‚       â”‚   â”‚  202 â”‚                         filteredControllers.Add(newController);
â”‚       â”‚   â”‚  203 â”‚                     }
â”‚       â”‚   â”‚  204 â”‚                 }
â”‚       â”‚   â”‚  205 â”‚ 
â”‚       â”‚   â”‚  206 â”‚                 sw.Stop();
â”‚       â”‚   â”‚  207 â”‚                 _logger.LogDebug("Filtered {ControllerCount} controllers in {ElapsedMs}ms",
â”‚       â”‚   â”‚  208 â”‚                     filteredControllers.Count, sw.ElapsedMilliseconds);
â”‚       â”‚   â”‚  209 â”‚ 
â”‚       â”‚   â”‚  210 â”‚                 return Task.FromResult(filteredControllers);
â”‚       â”‚   â”‚  211 â”‚             }, "FilterControllers").GetAwaiter().GetResult();
â”‚       â”‚   â”‚  212 â”‚         }
â”‚       â”‚   â”‚  213 â”‚ 
â”‚       â”‚   â”‚  214 â”‚         #region Private Helper Methods
â”‚       â”‚   â”‚  215 â”‚ 
â”‚       â”‚   â”‚  216 â”‚         private List<ControllerObject> FilterObjects(
â”‚       â”‚   â”‚  217 â”‚             IEnumerable<ControllerObject> objects,
â”‚       â”‚   â”‚  218 â”‚             HashSet<string> typeWhitelist,
â”‚       â”‚   â”‚  219 â”‚             HashSet<string> nameFilters,
â”‚       â”‚   â”‚  220 â”‚             bool isWhitelist,
â”‚       â”‚   â”‚  221 â”‚             bool ignoreEmptyValues,
â”‚       â”‚   â”‚  222 â”‚             bool includeByteCode)
â”‚       â”‚   â”‚  223 â”‚         {
â”‚       â”‚   â”‚  224 â”‚             if (objects == null)
â”‚       â”‚   â”‚  225 â”‚                 return new List<ControllerObject>();
â”‚       â”‚   â”‚  226 â”‚ 
â”‚       â”‚   â”‚  227 â”‚             var filteredObjects = new List<ControllerObject>();
â”‚       â”‚   â”‚  228 â”‚ 
â”‚       â”‚   â”‚  229 â”‚             foreach (var obj in objects)
â”‚       â”‚   â”‚  230 â”‚             {
â”‚       â”‚   â”‚  231 â”‚                 bool shouldInclude = ShouldIncludeObject(
â”‚       â”‚   â”‚  232 â”‚                     obj, typeWhitelist, nameFilters, isWhitelist, ignoreEmptyValues);
â”‚       â”‚   â”‚  233 â”‚ 
â”‚       â”‚   â”‚  234 â”‚                 if (shouldInclude)
â”‚       â”‚   â”‚  235 â”‚                 {
â”‚       â”‚   â”‚  236 â”‚                     // Create a filtered copy of the object
â”‚       â”‚   â”‚  237 â”‚                     var newObject = new ControllerObject(
â”‚       â”‚   â”‚  238 â”‚                         obj.Type,
â”‚       â”‚   â”‚  239 â”‚                         obj.Name,
â”‚       â”‚   â”‚  240 â”‚                         includeByteCode || !obj.HasByteCode ? obj.Value : string.Empty);
â”‚       â”‚   â”‚  241 â”‚ 
â”‚       â”‚   â”‚  242 â”‚                     // Set properties
â”‚       â”‚   â”‚  243 â”‚                     if (!string.IsNullOrEmpty(obj.Alias))
â”‚       â”‚   â”‚  244 â”‚                     {
â”‚       â”‚   â”‚  245 â”‚                         newObject.SetAlias(obj.Alias);
â”‚       â”‚   â”‚  246 â”‚                     }
â”‚       â”‚   â”‚  247 â”‚ 
â”‚       â”‚   â”‚  248 â”‚                     newObject.SetHasByteCode(obj.HasByteCode);
â”‚       â”‚   â”‚  249 â”‚ 
â”‚       â”‚   â”‚  250 â”‚                     foreach (var prop in obj.Properties)
â”‚       â”‚   â”‚  251 â”‚                     {
â”‚       â”‚   â”‚  252 â”‚                         newObject.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  253 â”‚                     }
â”‚       â”‚   â”‚  254 â”‚ 
â”‚       â”‚   â”‚  255 â”‚                     // Recursively filter children
â”‚       â”‚   â”‚  256 â”‚                     if (obj.Children.Any())
â”‚       â”‚   â”‚  257 â”‚                     {
â”‚       â”‚   â”‚  258 â”‚                         var filteredChildren = FilterObjects(
â”‚       â”‚   â”‚  259 â”‚                             obj.Children,
â”‚       â”‚   â”‚  260 â”‚                             typeWhitelist,
â”‚       â”‚   â”‚  261 â”‚                             nameFilters,
â”‚       â”‚   â”‚  262 â”‚                             isWhitelist,
â”‚       â”‚   â”‚  263 â”‚                             ignoreEmptyValues,
â”‚       â”‚   â”‚  264 â”‚                             includeByteCode);
â”‚       â”‚   â”‚  265 â”‚ 
â”‚       â”‚   â”‚  266 â”‚                         foreach (var child in filteredChildren)
â”‚       â”‚   â”‚  267 â”‚                         {
â”‚       â”‚   â”‚  268 â”‚                             newObject.AddChild(child);
â”‚       â”‚   â”‚  269 â”‚                         }
â”‚       â”‚   â”‚  270 â”‚                     }
â”‚       â”‚   â”‚  271 â”‚ 
â”‚       â”‚   â”‚  272 â”‚                     filteredObjects.Add(newObject);
â”‚       â”‚   â”‚  273 â”‚                 }
â”‚       â”‚   â”‚  274 â”‚             }
â”‚       â”‚   â”‚  275 â”‚ 
â”‚       â”‚   â”‚  276 â”‚             return filteredObjects;
â”‚       â”‚   â”‚  277 â”‚         }
â”‚       â”‚   â”‚  278 â”‚ 
â”‚       â”‚   â”‚  279 â”‚         private bool ShouldIncludeObject(
â”‚       â”‚   â”‚  280 â”‚             ControllerObject obj,
â”‚       â”‚   â”‚  281 â”‚             HashSet<string> typeWhitelist,
â”‚       â”‚   â”‚  282 â”‚             HashSet<string> nameFilters,
â”‚       â”‚   â”‚  283 â”‚             bool isWhitelist,
â”‚       â”‚   â”‚  284 â”‚             bool ignoreEmptyValues)
â”‚       â”‚   â”‚  285 â”‚         {
â”‚       â”‚   â”‚  286 â”‚             // Check if we should ignore empty values
â”‚       â”‚   â”‚  287 â”‚             if (ignoreEmptyValues && string.IsNullOrWhiteSpace(obj.Value))
â”‚       â”‚   â”‚  288 â”‚                 return false;
â”‚       â”‚   â”‚  289 â”‚ 
â”‚       â”‚   â”‚  290 â”‚             // Check type whitelist
â”‚       â”‚   â”‚  291 â”‚             if (typeWhitelist?.Count > 0 && !typeWhitelist.Contains(obj.Type))
â”‚       â”‚   â”‚  292 â”‚                 return false;
â”‚       â”‚   â”‚  293 â”‚ 
â”‚       â”‚   â”‚  294 â”‚             // If no name filters, include the object
â”‚       â”‚   â”‚  295 â”‚             if (nameFilters == null || nameFilters.Count == 0)
â”‚       â”‚   â”‚  296 â”‚                 return true;
â”‚       â”‚   â”‚  297 â”‚ 
â”‚       â”‚   â”‚  298 â”‚             // Check if the object's name or alias matches any filter
â”‚       â”‚   â”‚  299 â”‚             bool nameMatches = nameFilters.Contains(obj.Name, StringComparer.OrdinalIgnoreCase) ||
â”‚       â”‚   â”‚  300 â”‚                               (!string.IsNullOrEmpty(obj.Alias) &&
â”‚       â”‚   â”‚  301 â”‚                                nameFilters.Contains(obj.Alias, StringComparer.OrdinalIgnoreCase));
â”‚       â”‚   â”‚  302 â”‚ 
â”‚       â”‚   â”‚  303 â”‚             // For whitelist, include if name matches; for blacklist, include if name doesn't match
â”‚       â”‚   â”‚  304 â”‚             return isWhitelist ? nameMatches : !nameMatches;
â”‚       â”‚   â”‚  305 â”‚         }
â”‚       â”‚   â”‚  306 â”‚ 
â”‚       â”‚   â”‚  307 â”‚         #endregion
â”‚       â”‚   â”‚  308 â”‚     }
â”‚       â”‚   â”‚  309 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ExportService.cs (23.47 KB, 2025-03-11 15:06:06)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ExportService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.IO;
â”‚       â”‚   â”‚    4 â”‚ using System.Linq;
â”‚       â”‚   â”‚    5 â”‚ using System.Text;
â”‚       â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    7 â”‚ using System.Xml.Linq;
â”‚       â”‚   â”‚    8 â”‚ using ClosedXML.Excel;
â”‚       â”‚   â”‚    9 â”‚ using Microsoft.Extensions.DependencyInjection;
â”‚       â”‚   â”‚   10 â”‚ using Microsoft.Extensions.Logging;
â”‚       â”‚   â”‚   11 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚   12 â”‚ using test.Core.Exceptions;
â”‚       â”‚   â”‚   13 â”‚ using test.Core.Interfaces;
â”‚       â”‚   â”‚   14 â”‚ using test.Infrastructure.Logging;
â”‚       â”‚   â”‚   15 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚   16 â”‚ using Domain = test.Core.Domain;
â”‚       â”‚   â”‚   17 â”‚ 
â”‚       â”‚   â”‚   18 â”‚ namespace test.Application.Services
â”‚       â”‚   â”‚   19 â”‚ {
â”‚       â”‚   â”‚   20 â”‚     /// <summary>
â”‚       â”‚   â”‚   21 â”‚     /// Implementation of export service for controller data
â”‚       â”‚   â”‚   22 â”‚     /// </summary>
â”‚       â”‚   â”‚   23 â”‚     public class ExportService : IExportService
â”‚       â”‚   â”‚   24 â”‚     {
â”‚       â”‚   â”‚   25 â”‚         private readonly IErrorHandler _errorHandler;
â”‚       â”‚   â”‚   26 â”‚         private readonly ILogger<ExportService> _logger;
â”‚       â”‚   â”‚   27 â”‚         private readonly IFileSystem _fileSystem;
â”‚       â”‚   â”‚   28 â”‚         private readonly IServiceProvider _serviceProvider; 
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         // Pre-defined formats
â”‚       â”‚   â”‚   31 â”‚         private readonly List<ExportFormat> _formats = new List<ExportFormat>
â”‚       â”‚   â”‚   32 â”‚         {
â”‚       â”‚   â”‚   33 â”‚             new ExportFormat
â”‚       â”‚   â”‚   34 â”‚             {
â”‚       â”‚   â”‚   35 â”‚                 Id = "xml",
â”‚       â”‚   â”‚   36 â”‚                 DisplayName = "XML",
â”‚       â”‚   â”‚   37 â”‚                 Extension = ".xml",
â”‚       â”‚   â”‚   38 â”‚                 MimeType = "application/xml",
â”‚       â”‚   â”‚   39 â”‚                 SupportsById = true,
â”‚       â”‚   â”‚   40 â”‚                 Description = "Industry-standard XML format."
â”‚       â”‚   â”‚   41 â”‚             },
â”‚       â”‚   â”‚   42 â”‚             new ExportFormat
â”‚       â”‚   â”‚   43 â”‚             {
â”‚       â”‚   â”‚   44 â”‚                 Id = "excel",
â”‚       â”‚   â”‚   45 â”‚                 DisplayName = "Excel Workbook",
â”‚       â”‚   â”‚   46 â”‚                 Extension = ".xlsx",
â”‚       â”‚   â”‚   47 â”‚                 MimeType = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
â”‚       â”‚   â”‚   48 â”‚                 SupportsById = false,
â”‚       â”‚   â”‚   49 â”‚                 Description = "Microsoft Excel workbook with multiple sheets."
â”‚       â”‚   â”‚   50 â”‚             },
â”‚       â”‚   â”‚   51 â”‚             new ExportFormat
â”‚       â”‚   â”‚   52 â”‚             {
â”‚       â”‚   â”‚   53 â”‚                 Id = "csv-grouped",
â”‚       â”‚   â”‚   54 â”‚                 DisplayName = "Grouped CSV",
â”‚       â”‚   â”‚   55 â”‚                 Extension = ".csv",
â”‚       â”‚   â”‚   56 â”‚                 MimeType = "text/csv",
â”‚       â”‚   â”‚   57 â”‚                 SupportsById = false,
â”‚       â”‚   â”‚   58 â”‚                 Description = "CSV with controller grouping for similarity comparison."
â”‚       â”‚   â”‚   59 â”‚             },
â”‚       â”‚   â”‚   60 â”‚             new ExportFormat
â”‚       â”‚   â”‚   61 â”‚             {
â”‚       â”‚   â”‚   62 â”‚                 Id = "objectset",
â”‚       â”‚   â”‚   63 â”‚                 DisplayName = "ObjectSet XML",
â”‚       â”‚   â”‚   64 â”‚                 Extension = ".xml",
â”‚       â”‚   â”‚   65 â”‚                 MimeType = "application/xml",
â”‚       â”‚   â”‚   66 â”‚                 SupportsById = true,
â”‚       â”‚   â”‚   67 â”‚                 Description = "Vendor-specific ObjectSet XML format."
â”‚       â”‚   â”‚   68 â”‚             }
â”‚       â”‚   â”‚   69 â”‚         };
â”‚       â”‚   â”‚   70 â”‚ 
â”‚       â”‚   â”‚   71 â”‚         /// <summary>
â”‚       â”‚   â”‚   72 â”‚         /// Creates a new export service
â”‚       â”‚   â”‚   73 â”‚         /// </summary>
â”‚       â”‚   â”‚   74 â”‚         /// <param name="errorHandler">The error handler</param>
â”‚       â”‚   â”‚   75 â”‚         /// <param name="logger">The logger</param>
â”‚       â”‚   â”‚   76 â”‚         /// <param name="fileSystem">The file system</param>
â”‚       â”‚   â”‚   77 â”‚         public ExportService(IErrorHandler errorHandler, ILogger<ExportService> logger, IFileSystem fileSystem)
â”‚       â”‚   â”‚   78 â”‚         {
â”‚       â”‚   â”‚   79 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚       â”‚   â”‚   80 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚   â”‚   81 â”‚             _fileSystem = fileSystem ?? throw new ArgumentNullException(nameof(fileSystem));
â”‚       â”‚   â”‚   82 â”‚         }
â”‚       â”‚   â”‚   83 â”‚         /// <summary>
â”‚       â”‚   â”‚   84 â”‚         /// Exports controllers to ObjectSet XML format
â”‚       â”‚   â”‚   85 â”‚         /// </summary>
â”‚       â”‚   â”‚   86 â”‚         /// <param name="controllers">The controllers to export</param>
â”‚       â”‚   â”‚   87 â”‚         /// <param name="filePath">The output file path</param>
â”‚       â”‚   â”‚   88 â”‚         /// <param name="options">Export options</param>
â”‚       â”‚   â”‚   89 â”‚         /// <returns>True if successful, false otherwise</returns>
â”‚       â”‚   â”‚   90 â”‚         public async Task<bool> ExportToObjectSetXmlAsync(
â”‚       â”‚   â”‚   91 â”‚             IEnumerable<Controller> controllers,
â”‚       â”‚   â”‚   92 â”‚             string filePath,
â”‚       â”‚   â”‚   93 â”‚             ExportOptions options = null)
â”‚       â”‚   â”‚   94 â”‚         {
â”‚       â”‚   â”‚   95 â”‚             return await _errorHandler.WithErrorHandlingAsync<bool>(async () =>
â”‚       â”‚   â”‚   96 â”‚             {
â”‚       â”‚   â”‚   97 â”‚                 options ??= new ExportOptions();
â”‚       â”‚   â”‚   98 â”‚                 _logger.LogInformation("Exporting {ControllerCount} controllers to ObjectSet XML at {FilePath}",
â”‚       â”‚   â”‚   99 â”‚                     controllers.Count(), filePath);
â”‚       â”‚   â”‚  100 â”‚ 
â”‚       â”‚   â”‚  101 â”‚                 // Get the ObjectSet writer
â”‚       â”‚   â”‚  102 â”‚                 var objectSetWriter = _serviceProvider.GetRequiredService<IObjectSetWriter>();
â”‚       â”‚   â”‚  103 â”‚ 
â”‚       â”‚   â”‚  104 â”‚                 // Configure writer options
â”‚       â”‚   â”‚  105 â”‚                 var writerOptions = new ObjectSetWriteOptions
â”‚       â”‚   â”‚  106 â”‚                 {
â”‚       â”‚   â”‚  107 â”‚                     IncludeByteCode = options.IncludeByteCode,
â”‚       â”‚   â”‚  108 â”‚                     PrettyPrint = options.PrettyPrint,
â”‚       â”‚   â”‚  109 â”‚                     // Create basic meta information
â”‚       â”‚   â”‚  110 â”‚                     MetaInformation = new Domain.ObjectSet.MetaInformation
â”‚       â”‚   â”‚  111 â”‚                     {
â”‚       â”‚   â”‚  112 â”‚                         ExportMode = "Manual",
â”‚       â”‚   â”‚  113 â”‚                         RuntimeVersion = "4.0",
â”‚       â”‚   â”‚  114 â”‚                         SourceVersion = "3.0"
â”‚       â”‚   â”‚  115 â”‚                     }
â”‚       â”‚   â”‚  116 â”‚                 };
â”‚       â”‚   â”‚  117 â”‚ 
â”‚       â”‚   â”‚  118 â”‚                 // Generate the XML document
â”‚       â”‚   â”‚  119 â”‚                 var document = await objectSetWriter.WriteAsync(controllers, writerOptions);
â”‚       â”‚   â”‚  120 â”‚ 
â”‚       â”‚   â”‚  121 â”‚                 // Save to file
â”‚       â”‚   â”‚  122 â”‚                 using (var stream = _fileSystem.OpenWrite(filePath))
â”‚       â”‚   â”‚  123 â”‚                 {
â”‚       â”‚   â”‚  124 â”‚                     if (options.PrettyPrint)
â”‚       â”‚   â”‚  125 â”‚                     {
â”‚       â”‚   â”‚  126 â”‚                         await document.SaveAsync(stream, System.Xml.Linq.SaveOptions.None, default);
â”‚       â”‚   â”‚  127 â”‚                     }
â”‚       â”‚   â”‚  128 â”‚                     else
â”‚       â”‚   â”‚  129 â”‚                     {
â”‚       â”‚   â”‚  130 â”‚                         await document.SaveAsync(stream,System.Xml.Linq.SaveOptions.DisableFormatting, default);
â”‚       â”‚   â”‚  131 â”‚                     }
â”‚       â”‚   â”‚  132 â”‚                 }
â”‚       â”‚   â”‚  133 â”‚ 
â”‚       â”‚   â”‚  134 â”‚                 _logger.LogInformation("ObjectSet XML export completed successfully");
â”‚       â”‚   â”‚  135 â”‚                 return true;
â”‚       â”‚   â”‚  136 â”‚             }, "ExportToObjectSetXml", (filePath != null && !string.IsNullOrWhiteSpace(filePath)));
â”‚       â”‚   â”‚  137 â”‚         }
â”‚       â”‚   â”‚  138 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚  139 â”‚         public async Task<bool> ExportToXmlAsync(IEnumerable<Controller> controllers, string filePath, ExportOptions options = null)
â”‚       â”‚   â”‚  140 â”‚         {
â”‚       â”‚   â”‚  141 â”‚             return await _errorHandler.WithErrorHandlingAsync<bool>(async () =>
â”‚       â”‚   â”‚  142 â”‚             {
â”‚       â”‚   â”‚  143 â”‚                 options ??= new ExportOptions();
â”‚       â”‚   â”‚  144 â”‚                 _logger.LogInformation("Exporting {ControllerCount} controllers to XML at {FilePath}",
â”‚       â”‚   â”‚  145 â”‚                     controllers.Count(), filePath);
â”‚       â”‚   â”‚  146 â”‚ 
â”‚       â”‚   â”‚  147 â”‚                 // Create root element
â”‚       â”‚   â”‚  148 â”‚                 var root = new XElement("Controllers");
â”‚       â”‚   â”‚  149 â”‚ 
â”‚       â”‚   â”‚  150 â”‚                 // Add controllers
â”‚       â”‚   â”‚  151 â”‚                 foreach (var controller in controllers)
â”‚       â”‚   â”‚  152 â”‚                 {
â”‚       â”‚   â”‚  153 â”‚                     var controllerElement = new XElement("Controller",
â”‚       â”‚   â”‚  154 â”‚                         new XAttribute("Name", controller.Name),
â”‚       â”‚   â”‚  155 â”‚                         new XAttribute("Model", controller.Model));
â”‚       â”‚   â”‚  156 â”‚ 
â”‚       â”‚   â”‚  157 â”‚                     // Add controller properties
â”‚       â”‚   â”‚  158 â”‚                     foreach (var property in controller.Properties)
â”‚       â”‚   â”‚  159 â”‚                     {
â”‚       â”‚   â”‚  160 â”‚                         controllerElement.Add(new XElement("Property",
â”‚       â”‚   â”‚  161 â”‚                             new XAttribute("Name", property.Key),
â”‚       â”‚   â”‚  162 â”‚                             new XAttribute("Value", property.Value ?? string.Empty)));
â”‚       â”‚   â”‚  163 â”‚                     }
â”‚       â”‚   â”‚  164 â”‚ 
â”‚       â”‚   â”‚  165 â”‚                     // Add controller objects
â”‚       â”‚   â”‚  166 â”‚                     var filteredObjects = FilterObjects(controller.Objects, options);
â”‚       â”‚   â”‚  167 â”‚                     foreach (var obj in filteredObjects)
â”‚       â”‚   â”‚  168 â”‚                     {
â”‚       â”‚   â”‚  169 â”‚                         controllerElement.Add(CreateObjectElement(obj, options));
â”‚       â”‚   â”‚  170 â”‚                     }
â”‚       â”‚   â”‚  171 â”‚ 
â”‚       â”‚   â”‚  172 â”‚                     root.Add(controllerElement);
â”‚       â”‚   â”‚  173 â”‚                 }
â”‚       â”‚   â”‚  174 â”‚ 
â”‚       â”‚   â”‚  175 â”‚                 // Create document
â”‚       â”‚   â”‚  176 â”‚                 var document = new XDocument(
â”‚       â”‚   â”‚  177 â”‚                     new XDeclaration("1.0", "utf-8", null),
â”‚       â”‚   â”‚  178 â”‚                     root);
â”‚       â”‚   â”‚  179 â”‚ 
â”‚       â”‚   â”‚  180 â”‚                 // Save document
â”‚       â”‚   â”‚  181 â”‚                 using (var stream = _fileSystem.OpenWrite(filePath))
â”‚       â”‚   â”‚  182 â”‚                 {
â”‚       â”‚   â”‚  183 â”‚                     await Task.Run(() => {
â”‚       â”‚   â”‚  184 â”‚                         document.Save(stream, options.PrettyPrint ? System.Xml.Linq.SaveOptions.None : System.Xml.Linq.SaveOptions.DisableFormatting);
â”‚       â”‚   â”‚  185 â”‚                         return Task.CompletedTask;
â”‚       â”‚   â”‚  186 â”‚                     });
â”‚       â”‚   â”‚  187 â”‚                 }
â”‚       â”‚   â”‚  188 â”‚ 
â”‚       â”‚   â”‚  189 â”‚                 _logger.LogInformation("XML export completed successfully");
â”‚       â”‚   â”‚  190 â”‚                 return true;
â”‚       â”‚   â”‚  191 â”‚             }, "ExportToXml", (filePath != null && !string.IsNullOrWhiteSpace(filePath)));
â”‚       â”‚   â”‚  192 â”‚         }
â”‚       â”‚   â”‚  193 â”‚ 
â”‚       â”‚   â”‚  194 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚  195 â”‚         public async Task<bool> ExportToExcelAsync(IEnumerable<Controller> controllers, string filePath, ExportOptions options = null)
â”‚       â”‚   â”‚  196 â”‚         {
â”‚       â”‚   â”‚  197 â”‚             return await _errorHandler.WithErrorHandlingAsync<bool>(async () =>
â”‚       â”‚   â”‚  198 â”‚             {
â”‚       â”‚   â”‚  199 â”‚                 options ??= new ExportOptions();
â”‚       â”‚   â”‚  200 â”‚                 _logger.LogInformation("Exporting {ControllerCount} controllers to Excel at {FilePath}",
â”‚       â”‚   â”‚  201 â”‚                     controllers.Count(), filePath);
â”‚       â”‚   â”‚  202 â”‚ 
â”‚       â”‚   â”‚  203 â”‚                 using (var workbook = new XLWorkbook())
â”‚       â”‚   â”‚  204 â”‚                 {
â”‚       â”‚   â”‚  205 â”‚                     // Create summary sheet
â”‚       â”‚   â”‚  206 â”‚                     var summarySheet = workbook.Worksheets.Add("Summary");
â”‚       â”‚   â”‚  207 â”‚ 
â”‚       â”‚   â”‚  208 â”‚                     // Add headers
â”‚       â”‚   â”‚  209 â”‚                     summarySheet.Cell(1, 1).Value = "Controller Name";
â”‚       â”‚   â”‚  210 â”‚                     summarySheet.Cell(1, 2).Value = "Model";
â”‚       â”‚   â”‚  211 â”‚                     summarySheet.Cell(1, 3).Value = "Object Count";
â”‚       â”‚   â”‚  212 â”‚ 
â”‚       â”‚   â”‚  213 â”‚                     // Add data
â”‚       â”‚   â”‚  214 â”‚                     int row = 2;
â”‚       â”‚   â”‚  215 â”‚                     foreach (var controller in controllers)
â”‚       â”‚   â”‚  216 â”‚                     {
â”‚       â”‚   â”‚  217 â”‚                         summarySheet.Cell(row, 1).Value = controller.Name;
â”‚       â”‚   â”‚  218 â”‚                         summarySheet.Cell(row, 2).Value = controller.Model;
â”‚       â”‚   â”‚  219 â”‚ 
â”‚       â”‚   â”‚  220 â”‚                         var filteredObjects = FilterObjects(controller.Objects, options);
â”‚       â”‚   â”‚  221 â”‚                         summarySheet.Cell(row, 3).Value = filteredObjects.Count;
â”‚       â”‚   â”‚  222 â”‚ 
â”‚       â”‚   â”‚  223 â”‚                         // Create controller sheet
â”‚       â”‚   â”‚  224 â”‚                         var controllerName = SanitizeSheetName(controller.Name);
â”‚       â”‚   â”‚  225 â”‚                         if (workbook.Worksheets.Contains(controllerName))
â”‚       â”‚   â”‚  226 â”‚                         {
â”‚       â”‚   â”‚  227 â”‚                             // Append numeric suffix for duplicates
â”‚       â”‚   â”‚  228 â”‚                             int suffix = 1;
â”‚       â”‚   â”‚  229 â”‚                             while (workbook.Worksheets.Contains($"{controllerName}_{suffix}"))
â”‚       â”‚   â”‚  230 â”‚                             {
â”‚       â”‚   â”‚  231 â”‚                                 suffix++;
â”‚       â”‚   â”‚  232 â”‚                             }
â”‚       â”‚   â”‚  233 â”‚                             controllerName = $"{controllerName}_{suffix}";
â”‚       â”‚   â”‚  234 â”‚                         }
â”‚       â”‚   â”‚  235 â”‚ 
â”‚       â”‚   â”‚  236 â”‚                         var controllerSheet = workbook.Worksheets.Add(controllerName);
â”‚       â”‚   â”‚  237 â”‚ 
â”‚       â”‚   â”‚  238 â”‚                         // Add headers
â”‚       â”‚   â”‚  239 â”‚                         controllerSheet.Cell(1, 1).Value = "Type";
â”‚       â”‚   â”‚  240 â”‚                         controllerSheet.Cell(1, 2).Value = "Name";
â”‚       â”‚   â”‚  241 â”‚                         controllerSheet.Cell(1, 3).Value = "Alias";
â”‚       â”‚   â”‚  242 â”‚                         controllerSheet.Cell(1, 4).Value = "Value";
â”‚       â”‚   â”‚  243 â”‚ 
â”‚       â”‚   â”‚  244 â”‚                         // Add objects
â”‚       â”‚   â”‚  245 â”‚                         int objRow = 2;
â”‚       â”‚   â”‚  246 â”‚                         AddControllerObjectsToSheet(controllerSheet, ref objRow, filteredObjects, options);
â”‚       â”‚   â”‚  247 â”‚ 
â”‚       â”‚   â”‚  248 â”‚                         row++;
â”‚       â”‚   â”‚  249 â”‚                     }
â”‚       â”‚   â”‚  250 â”‚ 
â”‚       â”‚   â”‚  251 â”‚                     // Auto-fit columns
â”‚       â”‚   â”‚  252 â”‚                     summarySheet.Columns().AdjustToContents();
â”‚       â”‚   â”‚  253 â”‚ 
â”‚       â”‚   â”‚  254 â”‚                     // Save workbook
â”‚       â”‚   â”‚  255 â”‚                     await Task.Run(() => {
â”‚       â”‚   â”‚  256 â”‚                         workbook.SaveAs(filePath);
â”‚       â”‚   â”‚  257 â”‚                         return Task.CompletedTask;
â”‚       â”‚   â”‚  258 â”‚                     });
â”‚       â”‚   â”‚  259 â”‚                 }
â”‚       â”‚   â”‚  260 â”‚ 
â”‚       â”‚   â”‚  261 â”‚                 _logger.LogInformation("Excel export completed successfully");
â”‚       â”‚   â”‚  262 â”‚                 return true;
â”‚       â”‚   â”‚  263 â”‚             }, "ExportToExcel", (filePath != null && !string.IsNullOrWhiteSpace(filePath)));
â”‚       â”‚   â”‚  264 â”‚         }
â”‚       â”‚   â”‚  265 â”‚ 
â”‚       â”‚   â”‚  266 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚  267 â”‚         public async Task<IEnumerable<GroupComparison>> ExportToGroupedCsvAsync(IEnumerable<Controller> controllers, string filePath, ExportOptions options = null)
â”‚       â”‚   â”‚  268 â”‚         {
â”‚       â”‚   â”‚  269 â”‚             return await _errorHandler.WithErrorHandlingAsync<IEnumerable<GroupComparison>>(async () =>
â”‚       â”‚   â”‚  270 â”‚             {
â”‚       â”‚   â”‚  271 â”‚                 options ??= new ExportOptions();
â”‚       â”‚   â”‚  272 â”‚                 _logger.LogInformation("Exporting {ControllerCount} controllers to grouped CSV at {FilePath}",
â”‚       â”‚   â”‚  273 â”‚                     controllers.Count(), filePath);
â”‚       â”‚   â”‚  274 â”‚ 
â”‚       â”‚   â”‚  275 â”‚                 // Filter objects based on options
â”‚       â”‚   â”‚  276 â”‚                 var groupedControllers = new List<ControllerGroup>();
â”‚       â”‚   â”‚  277 â”‚                 foreach (var controller in controllers)
â”‚       â”‚   â”‚  278 â”‚                 {
â”‚       â”‚   â”‚  279 â”‚                     var filteredObjects = FilterObjects(controller.Objects, options);
â”‚       â”‚   â”‚  280 â”‚ 
â”‚       â”‚   â”‚  281 â”‚                     // Find or create group
â”‚       â”‚   â”‚  282 â”‚                     var signature = ComputeControllerSignature(controller, filteredObjects);
â”‚       â”‚   â”‚  283 â”‚                     var group = groupedControllers.FirstOrDefault(g => g.GroupIdentifier == signature);
â”‚       â”‚   â”‚  284 â”‚ 
â”‚       â”‚   â”‚  285 â”‚                     if (group == null)
â”‚       â”‚   â”‚  286 â”‚                     {
â”‚       â”‚   â”‚  287 â”‚                         group = new ControllerGroup(signature);
â”‚       â”‚   â”‚  288 â”‚                         groupedControllers.Add(group);
â”‚       â”‚   â”‚  289 â”‚                     }
â”‚       â”‚   â”‚  290 â”‚ 
â”‚       â”‚   â”‚  291 â”‚                     // Add controller to group
â”‚       â”‚   â”‚  292 â”‚                     group.AddControllerName(controller.Name);
â”‚       â”‚   â”‚  293 â”‚ 
â”‚       â”‚   â”‚  294 â”‚                     // Extract and store values
â”‚       â”‚   â”‚  295 â”‚                     ExtractObjectValues(filteredObjects, group.OriginalValues, group.ProcessedValues, group.NameMapping);
â”‚       â”‚   â”‚  296 â”‚                 }
â”‚       â”‚   â”‚  297 â”‚ 
â”‚       â”‚   â”‚  298 â”‚                 _logger.LogInformation("Found {GroupCount} distinct controller groups", groupedControllers.Count);
â”‚       â”‚   â”‚  299 â”‚ 
â”‚       â”‚   â”‚  300 â”‚                 // Create CSV content
â”‚       â”‚   â”‚  301 â”‚                 var sb = new StringBuilder();
â”‚       â”‚   â”‚  302 â”‚ 
â”‚       â”‚   â”‚  303 â”‚                 // Write headers
â”‚       â”‚   â”‚  304 â”‚                 sb.AppendLine("Group,Controller,Type,Name,Alias,Value");
â”‚       â”‚   â”‚  305 â”‚ 
â”‚       â”‚   â”‚  306 â”‚                 // Write data
â”‚       â”‚   â”‚  307 â”‚                 foreach (var group in groupedControllers)
â”‚       â”‚   â”‚  308 â”‚                 {
â”‚       â”‚   â”‚  309 â”‚                     int groupIndex = groupedControllers.IndexOf(group) + 1;
â”‚       â”‚   â”‚  310 â”‚ 
â”‚       â”‚   â”‚  311 â”‚                     foreach (var controllerName in group.ControllerNames)
â”‚       â”‚   â”‚  312 â”‚                     {
â”‚       â”‚   â”‚  313 â”‚                         foreach (var value in group.OriginalValues)
â”‚       â”‚   â”‚  314 â”‚                         {
â”‚       â”‚   â”‚  315 â”‚                             sb.AppendLine($"{groupIndex},{EscapeCsvValue(controllerName)},Object,{EscapeCsvValue(value.Key)},,{EscapeCsvValue(value.Value)}");
â”‚       â”‚   â”‚  316 â”‚                         }
â”‚       â”‚   â”‚  317 â”‚                     }
â”‚       â”‚   â”‚  318 â”‚                 }
â”‚       â”‚   â”‚  319 â”‚ 
â”‚       â”‚   â”‚  320 â”‚                 // Save file
â”‚       â”‚   â”‚  321 â”‚                 await _fileSystem.WriteAllTextAsync(filePath, sb.ToString());
â”‚       â”‚   â”‚  322 â”‚ 
â”‚       â”‚   â”‚  323 â”‚                 // Generate comparisons
â”‚       â”‚   â”‚  324 â”‚                 var comparisons = GenerateGroupComparisons(groupedControllers);
â”‚       â”‚   â”‚  325 â”‚ 
â”‚       â”‚   â”‚  326 â”‚                 _logger.LogInformation("CSV export completed successfully with {ComparisonCount} group comparisons",
â”‚       â”‚   â”‚  327 â”‚                     comparisons.Count);
â”‚       â”‚   â”‚  328 â”‚ 
â”‚       â”‚   â”‚  329 â”‚                 return comparisons;
â”‚       â”‚   â”‚  330 â”‚             }, "ExportToGroupedCsv", (filePath != null && !string.IsNullOrWhiteSpace(filePath)));
â”‚       â”‚   â”‚  331 â”‚         }
â”‚       â”‚   â”‚  332 â”‚ 
â”‚       â”‚   â”‚  333 â”‚         /// <inheritdoc/>
â”‚       â”‚   â”‚  334 â”‚         public IEnumerable<ExportFormat> GetAvailableFormats()
â”‚       â”‚   â”‚  335 â”‚         {
â”‚       â”‚   â”‚  336 â”‚             return _formats;
â”‚       â”‚   â”‚  337 â”‚         }
â”‚       â”‚   â”‚  338 â”‚ 
â”‚       â”‚   â”‚  339 â”‚         #region Helper Methods
â”‚       â”‚   â”‚  340 â”‚ 
â”‚       â”‚   â”‚  341 â”‚         /// <summary>
â”‚       â”‚   â”‚  342 â”‚         /// Filters objects based on export options
â”‚       â”‚   â”‚  343 â”‚         /// </summary>
â”‚       â”‚   â”‚  344 â”‚         private List<ControllerObject> FilterObjects(IEnumerable<ControllerObject> objects, ExportOptions options)
â”‚       â”‚   â”‚  345 â”‚         {
â”‚       â”‚   â”‚  346 â”‚             if (objects == null)
â”‚       â”‚   â”‚  347 â”‚                 return new List<ControllerObject>();
â”‚       â”‚   â”‚  348 â”‚ 
â”‚       â”‚   â”‚  349 â”‚             var result = new List<ControllerObject>();
â”‚       â”‚   â”‚  350 â”‚ 
â”‚       â”‚   â”‚  351 â”‚             foreach (var obj in objects)
â”‚       â”‚   â”‚  352 â”‚             {
â”‚       â”‚   â”‚  353 â”‚                 // Check type filter
â”‚       â”‚   â”‚  354 â”‚                 if (options.IncludedTypes.Count > 0 && !options.IncludedTypes.Contains(obj.Type))
â”‚       â”‚   â”‚  355 â”‚                     continue;
â”‚       â”‚   â”‚  356 â”‚ 
â”‚       â”‚   â”‚  357 â”‚                 // Check name filter
â”‚       â”‚   â”‚  358 â”‚                 if (options.ExcludedNames.Contains(obj.Name))
â”‚       â”‚   â”‚  359 â”‚                     continue;
â”‚       â”‚   â”‚  360 â”‚ 
â”‚       â”‚   â”‚  361 â”‚                 // Check empty value filter
â”‚       â”‚   â”‚  362 â”‚                 if (!options.IncludeEmptyValues && string.IsNullOrWhiteSpace(obj.Value))
â”‚       â”‚   â”‚  363 â”‚                     continue;
â”‚       â”‚   â”‚  364 â”‚ 
â”‚       â”‚   â”‚  365 â”‚                 // Check byte code filter
â”‚       â”‚   â”‚  366 â”‚                 if (!options.IncludeByteCode && obj.HasByteCode)
â”‚       â”‚   â”‚  367 â”‚                     continue;
â”‚       â”‚   â”‚  368 â”‚ 
â”‚       â”‚   â”‚  369 â”‚                 // Clone object (to avoid modifying original)
â”‚       â”‚   â”‚  370 â”‚                 var clonedObj = new ControllerObject(obj.Type, obj.Name, obj.Value);
â”‚       â”‚   â”‚  371 â”‚                 if (!string.IsNullOrEmpty(obj.Alias))
â”‚       â”‚   â”‚  372 â”‚                     clonedObj.SetAlias(obj.Alias);
â”‚       â”‚   â”‚  373 â”‚ 
â”‚       â”‚   â”‚  374 â”‚                 clonedObj.SetHasByteCode(obj.HasByteCode);
â”‚       â”‚   â”‚  375 â”‚ 
â”‚       â”‚   â”‚  376 â”‚                 // Add properties
â”‚       â”‚   â”‚  377 â”‚                 foreach (var prop in obj.Properties)
â”‚       â”‚   â”‚  378 â”‚                 {
â”‚       â”‚   â”‚  379 â”‚                     clonedObj.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  380 â”‚                 }
â”‚       â”‚   â”‚  381 â”‚ 
â”‚       â”‚   â”‚  382 â”‚                 // Add filtered children
â”‚       â”‚   â”‚  383 â”‚                 foreach (var child in FilterObjects(obj.Children, options))
â”‚       â”‚   â”‚  384 â”‚                 {
â”‚       â”‚   â”‚  385 â”‚                     clonedObj.AddChild(child);
â”‚       â”‚   â”‚  386 â”‚                 }
â”‚       â”‚   â”‚  387 â”‚ 
â”‚       â”‚   â”‚  388 â”‚                 result.Add(clonedObj);
â”‚       â”‚   â”‚  389 â”‚             }
â”‚       â”‚   â”‚  390 â”‚ 
â”‚       â”‚   â”‚  391 â”‚             return result;
â”‚       â”‚   â”‚  392 â”‚         }
â”‚       â”‚   â”‚  393 â”‚ 
â”‚       â”‚   â”‚  394 â”‚         /// <summary>
â”‚       â”‚   â”‚  395 â”‚         /// Creates XML element for an object
â”‚       â”‚   â”‚  396 â”‚         /// </summary>
â”‚       â”‚   â”‚  397 â”‚         private XElement CreateObjectElement(ControllerObject obj, ExportOptions options)
â”‚       â”‚   â”‚  398 â”‚         {
â”‚       â”‚   â”‚  399 â”‚             var element = new XElement("Object",
â”‚       â”‚   â”‚  400 â”‚                 new XAttribute("Type", obj.Type),
â”‚       â”‚   â”‚  401 â”‚                 new XAttribute("Name", obj.Name));
â”‚       â”‚   â”‚  402 â”‚ 
â”‚       â”‚   â”‚  403 â”‚             if (!string.IsNullOrEmpty(obj.Alias))
â”‚       â”‚   â”‚  404 â”‚                 element.Add(new XAttribute("Alias", obj.Alias));
â”‚       â”‚   â”‚  405 â”‚ 
â”‚       â”‚   â”‚  406 â”‚             element.Add(new XAttribute("Value", obj.Value ?? string.Empty));
â”‚       â”‚   â”‚  407 â”‚ 
â”‚       â”‚   â”‚  408 â”‚             // Add properties
â”‚       â”‚   â”‚  409 â”‚             foreach (var property in obj.Properties)
â”‚       â”‚   â”‚  410 â”‚             {
â”‚       â”‚   â”‚  411 â”‚                 element.Add(new XElement("Property",
â”‚       â”‚   â”‚  412 â”‚                     new XAttribute("Name", property.Key),
â”‚       â”‚   â”‚  413 â”‚                     new XAttribute("Value", property.Value ?? string.Empty)));
â”‚       â”‚   â”‚  414 â”‚             }
â”‚       â”‚   â”‚  415 â”‚ 
â”‚       â”‚   â”‚  416 â”‚             // Add children recursively
â”‚       â”‚   â”‚  417 â”‚             foreach (var child in obj.Children)
â”‚       â”‚   â”‚  418 â”‚             {
â”‚       â”‚   â”‚  419 â”‚                 element.Add(CreateObjectElement(child, options));
â”‚       â”‚   â”‚  420 â”‚             }
â”‚       â”‚   â”‚  421 â”‚ 
â”‚       â”‚   â”‚  422 â”‚             return element;
â”‚       â”‚   â”‚  423 â”‚         }
â”‚       â”‚   â”‚  424 â”‚ 
â”‚       â”‚   â”‚  425 â”‚         /// <summary>
â”‚       â”‚   â”‚  426 â”‚         /// Adds objects to an Excel sheet recursively
â”‚       â”‚   â”‚  427 â”‚         /// </summary>
â”‚       â”‚   â”‚  428 â”‚         private void AddControllerObjectsToSheet(IXLWorksheet sheet, ref int row, IEnumerable<ControllerObject> objects, ExportOptions options, int depth = 0)
â”‚       â”‚   â”‚  429 â”‚         {
â”‚       â”‚   â”‚  430 â”‚             foreach (var obj in objects)
â”‚       â”‚   â”‚  431 â”‚             {
â”‚       â”‚   â”‚  432 â”‚                 string indent = new string(' ', depth * 2);
â”‚       â”‚   â”‚  433 â”‚ 
â”‚       â”‚   â”‚  434 â”‚                 sheet.Cell(row, 1).Value = obj.Type;
â”‚       â”‚   â”‚  435 â”‚                 sheet.Cell(row, 2).Value = indent + obj.Name;
â”‚       â”‚   â”‚  436 â”‚                 sheet.Cell(row, 3).Value = obj.Alias;
â”‚       â”‚   â”‚  437 â”‚                 sheet.Cell(row, 4).Value = obj.Value;
â”‚       â”‚   â”‚  438 â”‚ 
â”‚       â”‚   â”‚  439 â”‚                 row++;
â”‚       â”‚   â”‚  440 â”‚ 
â”‚       â”‚   â”‚  441 â”‚                 // Add children recursively
â”‚       â”‚   â”‚  442 â”‚                 if (obj.Children.Any())
â”‚       â”‚   â”‚  443 â”‚                 {
â”‚       â”‚   â”‚  444 â”‚                     AddControllerObjectsToSheet(sheet, ref row, obj.Children, options, depth + 1);
â”‚       â”‚   â”‚  445 â”‚                 }
â”‚       â”‚   â”‚  446 â”‚             }
â”‚       â”‚   â”‚  447 â”‚         }
â”‚       â”‚   â”‚  448 â”‚ 
â”‚       â”‚   â”‚  449 â”‚         /// <summary>
â”‚       â”‚   â”‚  450 â”‚         /// Sanitizes a sheet name to be valid in Excel
â”‚       â”‚   â”‚  451 â”‚         /// </summary>
â”‚       â”‚   â”‚  452 â”‚         private string SanitizeSheetName(string name)
â”‚       â”‚   â”‚  453 â”‚         {
â”‚       â”‚   â”‚  454 â”‚             if (string.IsNullOrEmpty(name))
â”‚       â”‚   â”‚  455 â”‚                 return "Sheet";
â”‚       â”‚   â”‚  456 â”‚ 
â”‚       â”‚   â”‚  457 â”‚             // Remove invalid characters
â”‚       â”‚   â”‚  458 â”‚             var invalidChars = new char[] { ':', '\\', '/', '?', '*', '[', ']' };
â”‚       â”‚   â”‚  459 â”‚             string sanitized = new string(name.Where(c => !invalidChars.Contains(c)).ToArray());
â”‚       â”‚   â”‚  460 â”‚ 
â”‚       â”‚   â”‚  461 â”‚             // Truncate to max length (31 characters for Excel)
â”‚       â”‚   â”‚  462 â”‚             if (sanitized.Length > 31)
â”‚       â”‚   â”‚  463 â”‚                 sanitized = sanitized.Substring(0, 31);
â”‚       â”‚   â”‚  464 â”‚ 
â”‚       â”‚   â”‚  465 â”‚             // Ensure it's not empty
â”‚       â”‚   â”‚  466 â”‚             if (string.IsNullOrWhiteSpace(sanitized))
â”‚       â”‚   â”‚  467 â”‚                 return "Sheet";
â”‚       â”‚   â”‚  468 â”‚ 
â”‚       â”‚   â”‚  469 â”‚             return sanitized;
â”‚       â”‚   â”‚  470 â”‚         }
â”‚       â”‚   â”‚  471 â”‚ 
â”‚       â”‚   â”‚  472 â”‚         /// <summary>
â”‚       â”‚   â”‚  473 â”‚         /// Computes a signature for a controller based on its objects
â”‚       â”‚   â”‚  474 â”‚         /// </summary>
â”‚       â”‚   â”‚  475 â”‚         private string ComputeControllerSignature(Controller controller, IEnumerable<ControllerObject> objects)
â”‚       â”‚   â”‚  476 â”‚         {
â”‚       â”‚   â”‚  477 â”‚             // Get model and fixed properties
â”‚       â”‚   â”‚  478 â”‚             var model = controller.Model;
â”‚       â”‚   â”‚  479 â”‚ 
â”‚       â”‚   â”‚  480 â”‚             // Hash based on objects types, names, and values
â”‚       â”‚   â”‚  481 â”‚             var objSigs = objects
â”‚       â”‚   â”‚  482 â”‚                 .OrderBy(o => o.Type)
â”‚       â”‚   â”‚  483 â”‚                 .ThenBy(o => o.Name)
â”‚       â”‚   â”‚  484 â”‚                 .Select(o => $"{o.Type}|{o.Name}|{o.Value}");
â”‚       â”‚   â”‚  485 â”‚ 
â”‚       â”‚   â”‚  486 â”‚             return $"{model}_{string.Join("_", objSigs.Take(5))}";
â”‚       â”‚   â”‚  487 â”‚         }
â”‚       â”‚   â”‚  488 â”‚ 
â”‚       â”‚   â”‚  489 â”‚         /// <summary>
â”‚       â”‚   â”‚  490 â”‚         /// Extracts values from objects and adds them to value dictionaries
â”‚       â”‚   â”‚  491 â”‚         /// </summary>
â”‚       â”‚   â”‚  492 â”‚         private void ExtractObjectValues(
â”‚       â”‚   â”‚  493 â”‚             IEnumerable<ControllerObject> objects,
â”‚       â”‚   â”‚  494 â”‚             IDictionary<string, string> originalValues,
â”‚       â”‚   â”‚  495 â”‚             IDictionary<string, string> processedValues,
â”‚       â”‚   â”‚  496 â”‚             IDictionary<string, string> nameMapping)
â”‚       â”‚   â”‚  497 â”‚         {
â”‚       â”‚   â”‚  498 â”‚             foreach (var obj in objects)
â”‚       â”‚   â”‚  499 â”‚             {
â”‚       â”‚   â”‚  500 â”‚                 // Store original mapping
â”‚       â”‚   â”‚  501 â”‚                 originalValues[obj.Name] = obj.Value ?? string.Empty;
â”‚       â”‚   â”‚  502 â”‚ 
â”‚       â”‚   â”‚  503 â”‚                 // Store processed name mapping
â”‚       â”‚   â”‚  504 â”‚                 string processedName = obj.Name;
â”‚       â”‚   â”‚  505 â”‚                 nameMapping[obj.Name] = processedName;
â”‚       â”‚   â”‚  506 â”‚ 
â”‚       â”‚   â”‚  507 â”‚                 // Add to processed values with processed name
â”‚       â”‚   â”‚  508 â”‚                 processedValues[processedName] = obj.Value ?? string.Empty;
â”‚       â”‚   â”‚  509 â”‚ 
â”‚       â”‚   â”‚  510 â”‚                 // Process children recursively
â”‚       â”‚   â”‚  511 â”‚                 if (obj.Children.Any())
â”‚       â”‚   â”‚  512 â”‚                 {
â”‚       â”‚   â”‚  513 â”‚                     ExtractObjectValues(obj.Children, originalValues, processedValues, nameMapping);
â”‚       â”‚   â”‚  514 â”‚                 }
â”‚       â”‚   â”‚  515 â”‚             }
â”‚       â”‚   â”‚  516 â”‚         }
â”‚       â”‚   â”‚  517 â”‚ 
â”‚       â”‚   â”‚  518 â”‚         /// <summary>
â”‚       â”‚   â”‚  519 â”‚         /// Generates group comparisons between all groups
â”‚       â”‚   â”‚  520 â”‚         /// </summary>
â”‚       â”‚   â”‚  521 â”‚         private List<GroupComparison> GenerateGroupComparisons(List<ControllerGroup> groups)
â”‚       â”‚   â”‚  522 â”‚         {
â”‚       â”‚   â”‚  523 â”‚             var comparisons = new List<GroupComparison>();
â”‚       â”‚   â”‚  524 â”‚ 
â”‚       â”‚   â”‚  525 â”‚             // Compare each group with every other group
â”‚       â”‚   â”‚  526 â”‚             for (int i = 0; i < groups.Count; i++)
â”‚       â”‚   â”‚  527 â”‚             {
â”‚       â”‚   â”‚  528 â”‚                 var group1 = groups[i];
â”‚       â”‚   â”‚  529 â”‚ 
â”‚       â”‚   â”‚  530 â”‚                 for (int j = i + 1; j < groups.Count; j++)
â”‚       â”‚   â”‚  531 â”‚                 {
â”‚       â”‚   â”‚  532 â”‚                     var group2 = groups[j];
â”‚       â”‚   â”‚  533 â”‚ 
â”‚       â”‚   â”‚  534 â”‚                     // Skip if identical
â”‚       â”‚   â”‚  535 â”‚                     if (group1.GroupIdentifier == group2.GroupIdentifier)
â”‚       â”‚   â”‚  536 â”‚                         continue;
â”‚       â”‚   â”‚  537 â”‚ 
â”‚       â”‚   â”‚  538 â”‚                     // Find differences
â”‚       â”‚   â”‚  539 â”‚                     var allKeys = new HashSet<string>(
â”‚       â”‚   â”‚  540 â”‚                         group1.SharedValues.Keys.Concat(group2.SharedValues.Keys),
â”‚       â”‚   â”‚  541 â”‚                         StringComparer.OrdinalIgnoreCase);
â”‚       â”‚   â”‚  542 â”‚ 
â”‚       â”‚   â”‚  543 â”‚                     var differences = new List<string>();
â”‚       â”‚   â”‚  544 â”‚ 
â”‚       â”‚   â”‚  545 â”‚                     foreach (var key in allKeys)
â”‚       â”‚   â”‚  546 â”‚                     {
â”‚       â”‚   â”‚  547 â”‚                         string value1 = group1.SharedValues.TryGetValue(key, out var v1) ? v1 : null;
â”‚       â”‚   â”‚  548 â”‚                         string value2 = group2.SharedValues.TryGetValue(key, out var v2) ? v2 : null;
â”‚       â”‚   â”‚  549 â”‚ 
â”‚       â”‚   â”‚  550 â”‚                         if (value1 != value2)
â”‚       â”‚   â”‚  551 â”‚                         {
â”‚       â”‚   â”‚  552 â”‚                             differences.Add(key);
â”‚       â”‚   â”‚  553 â”‚                         }
â”‚       â”‚   â”‚  554 â”‚                     }
â”‚       â”‚   â”‚  555 â”‚ 
â”‚       â”‚   â”‚  556 â”‚                     // Create comparison
â”‚       â”‚   â”‚  557 â”‚                     if (differences.Count > 0)
â”‚       â”‚   â”‚  558 â”‚                     {
â”‚       â”‚   â”‚  559 â”‚                         var comparison = new GroupComparison
â”‚       â”‚   â”‚  560 â”‚                         {
â”‚       â”‚   â”‚  561 â”‚                             Group1Key = group1.GroupIdentifier,
â”‚       â”‚   â”‚  562 â”‚                             Group2Key = group2.GroupIdentifier,
â”‚       â”‚   â”‚  563 â”‚                             ControllersInGroup1 = group1.ControllerNames.Count,
â”‚       â”‚   â”‚  564 â”‚                             ControllersInGroup2 = group2.ControllerNames.Count,
â”‚       â”‚   â”‚  565 â”‚                             DifferentProperties = differences,
â”‚       â”‚   â”‚  566 â”‚                             FirstControllerGroup1 = group1.ControllerNames.FirstOrDefault(),
â”‚       â”‚   â”‚  567 â”‚                             FirstControllerGroup2 = group2.ControllerNames.FirstOrDefault()
â”‚       â”‚   â”‚  568 â”‚                         };
â”‚       â”‚   â”‚  569 â”‚ 
â”‚       â”‚   â”‚  570 â”‚                         comparisons.Add(comparison);
â”‚       â”‚   â”‚  571 â”‚                     }
â”‚       â”‚   â”‚  572 â”‚                 }
â”‚       â”‚   â”‚  573 â”‚             }
â”‚       â”‚   â”‚  574 â”‚ 
â”‚       â”‚   â”‚  575 â”‚             return comparisons;
â”‚       â”‚   â”‚  576 â”‚         }
â”‚       â”‚   â”‚  577 â”‚ 
â”‚       â”‚   â”‚  578 â”‚         /// <summary>
â”‚       â”‚   â”‚  579 â”‚         /// Escapes a value for CSV format
â”‚       â”‚   â”‚  580 â”‚         /// </summary>
â”‚       â”‚   â”‚  581 â”‚         private string EscapeCsvValue(string value)
â”‚       â”‚   â”‚  582 â”‚         {
â”‚       â”‚   â”‚  583 â”‚             if (string.IsNullOrEmpty(value))
â”‚       â”‚   â”‚  584 â”‚                 return string.Empty;
â”‚       â”‚   â”‚  585 â”‚ 
â”‚       â”‚   â”‚  586 â”‚             bool needsQuoting = value.Contains(',') || value.Contains('"') ||
â”‚       â”‚   â”‚  587 â”‚                                 value.Contains('\r') || value.Contains('\n');
â”‚       â”‚   â”‚  588 â”‚ 
â”‚       â”‚   â”‚  589 â”‚             if (needsQuoting)
â”‚       â”‚   â”‚  590 â”‚                 return $"\"{value.Replace("\"", "\"\"")}\"";
â”‚       â”‚   â”‚  591 â”‚ 
â”‚       â”‚   â”‚  592 â”‚             return value;
â”‚       â”‚   â”‚  593 â”‚         }
â”‚       â”‚   â”‚  594 â”‚ 
â”‚       â”‚   â”‚  595 â”‚         #endregion
â”‚       â”‚   â”‚  596 â”‚     }
â”‚       â”‚   â”‚  597 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ParsingService.cs (59.43 KB, 2025-03-11 17:45:01)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ParsingService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.DependencyInjection;
â”‚       â”‚   â”‚    2 â”‚ using Microsoft.Extensions.Logging;
â”‚       â”‚   â”‚    3 â”‚ using System;
â”‚       â”‚   â”‚    4 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    5 â”‚ using System.IO;
â”‚       â”‚   â”‚    6 â”‚ using System.Linq;
â”‚       â”‚   â”‚    7 â”‚ using System.Text;
â”‚       â”‚   â”‚    8 â”‚ using System.Text.RegularExpressions;
â”‚       â”‚   â”‚    9 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚   10 â”‚ using System.Xml.Linq;
â”‚       â”‚   â”‚   11 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚   12 â”‚ using test.Core.Exceptions;
â”‚       â”‚   â”‚   13 â”‚ using test.Core.Interfaces;
â”‚       â”‚   â”‚   14 â”‚ using test.Infrastructure.Logging;
â”‚       â”‚   â”‚   15 â”‚ using test.ViewModels;
â”‚       â”‚   â”‚   16 â”‚ using test.Core.Domain.ObjectSet;
â”‚       â”‚   â”‚   17 â”‚ 
â”‚       â”‚   â”‚   18 â”‚ 
â”‚       â”‚   â”‚   19 â”‚ // Using domain model ControllerGroup, not the interface version
â”‚       â”‚   â”‚   20 â”‚ using ControllerGroup = test.Core.Domain.ControllerGroup;
â”‚       â”‚   â”‚   21 â”‚ 
â”‚       â”‚   â”‚   22 â”‚ namespace test.Application.Services
â”‚       â”‚   â”‚   23 â”‚ {
â”‚       â”‚   â”‚   24 â”‚     /// <summary>
â”‚       â”‚   â”‚   25 â”‚     /// Enhanced service for parsing controller files
â”‚       â”‚   â”‚   26 â”‚     /// </summary>
â”‚       â”‚   â”‚   27 â”‚     public class ParsingService
â”‚       â”‚   â”‚   28 â”‚     {
â”‚       â”‚   â”‚   29 â”‚         private readonly IControllerRepository _controllerRepository;
â”‚       â”‚   â”‚   30 â”‚         private readonly IFileSystem _fileSystem;
â”‚       â”‚   â”‚   31 â”‚         private readonly IErrorHandler _errorHandler;
â”‚       â”‚   â”‚   32 â”‚         private readonly ILogger<ParsingService> _logger;
â”‚       â”‚   â”‚   33 â”‚         private readonly ILoggerFactory _loggerFactory;
â”‚       â”‚   â”‚   34 â”‚         private readonly IServiceProvider _serviceProvider;
â”‚       â”‚   â”‚   35 â”‚ 
â”‚       â”‚   â”‚   36 â”‚         // Static collections for controller type identification
â”‚       â”‚   â”‚   37 â”‚         private static readonly HashSet<string> InfinityModels = new HashSet<string>
â”‚       â”‚   â”‚   38 â”‚         {
â”‚       â”‚   â”‚   39 â”‚             "800", "810", "843", "846", "850", "851", "853", "890",
â”‚       â”‚   â”‚   40 â”‚             "700", "891", "892", "920", "780", "865", "866", "867",
â”‚       â”‚   â”‚   41 â”‚             "701", "781"
â”‚       â”‚   â”‚   42 â”‚         };
â”‚       â”‚   â”‚   43 â”‚ 
â”‚       â”‚   â”‚   44 â”‚         private static readonly HashSet<string> I2Models = new HashSet<string>
â”‚       â”‚   â”‚   45 â”‚         {
â”‚       â”‚   â”‚   46 â”‚             "i2624", "i2608", "i2800", "i2804", "i2850", "i2851",
â”‚       â”‚   â”‚   47 â”‚             "i2853", "i2865", "i2866", "i2885", "i2867", "i2920"
â”‚       â”‚   â”‚   48 â”‚         };
â”‚       â”‚   â”‚   49 â”‚ 
â”‚       â”‚   â”‚   50 â”‚         // Static collections for bytecode identification and reserved types
â”‚       â”‚   â”‚   51 â”‚         private static readonly HashSet<string> ByteCodeTypes = new HashSet<string>
â”‚       â”‚   â”‚   52 â”‚         {
â”‚       â”‚   â”‚   53 â”‚             "InfinityProgram",
â”‚       â”‚   â”‚   54 â”‚             "InfinityFunction"
â”‚       â”‚   â”‚   55 â”‚         };
â”‚       â”‚   â”‚   56 â”‚ 
â”‚       â”‚   â”‚   57 â”‚         private static readonly HashSet<string> ReservedTypes = new HashSet<string>
â”‚       â”‚   â”‚   58 â”‚         {
â”‚       â”‚   â”‚   59 â”‚             "InfinitySystemVariable",
â”‚       â”‚   â”‚   60 â”‚             "Group"
â”‚       â”‚   â”‚   61 â”‚         };
â”‚       â”‚   â”‚   62 â”‚ 
â”‚       â”‚   â”‚   63 â”‚         /// <summary>
â”‚       â”‚   â”‚   64 â”‚         /// Creates a new parsing service
â”‚       â”‚   â”‚   65 â”‚         /// </summary>
â”‚       â”‚   â”‚   66 â”‚         /// <param name="controllerRepository">The controller repository</param>
â”‚       â”‚   â”‚   67 â”‚         /// <param name="fileSystem">The file system</param>
â”‚       â”‚   â”‚   68 â”‚         /// <param name="errorHandler">The error handler</param>
â”‚       â”‚   â”‚   69 â”‚         /// <param name="logger">The logger</param>
â”‚       â”‚   â”‚   70 â”‚         // Update the constructor:
â”‚       â”‚   â”‚   71 â”‚         public ParsingService(
â”‚       â”‚   â”‚   72 â”‚             IControllerRepository controllerRepository,
â”‚       â”‚   â”‚   73 â”‚             IFileSystem fileSystem,
â”‚       â”‚   â”‚   74 â”‚             IErrorHandler errorHandler,
â”‚       â”‚   â”‚   75 â”‚             ILogger<ParsingService> logger,
â”‚       â”‚   â”‚   76 â”‚             IServiceProvider serviceProvider)  // Add this parameter
â”‚       â”‚   â”‚   77 â”‚         {
â”‚       â”‚   â”‚   78 â”‚             _controllerRepository = controllerRepository ?? throw new ArgumentNullException(nameof(controllerRepository));
â”‚       â”‚   â”‚   79 â”‚             _fileSystem = fileSystem ?? throw new ArgumentNullException(nameof(fileSystem));
â”‚       â”‚   â”‚   80 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚       â”‚   â”‚   81 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚   â”‚   82 â”‚             _serviceProvider = serviceProvider ?? throw new ArgumentNullException(nameof(serviceProvider));
â”‚       â”‚   â”‚   83 â”‚         }
â”‚       â”‚   â”‚   84 â”‚ 
â”‚       â”‚   â”‚   85 â”‚         /// <summary>
â”‚       â”‚   â”‚   86 â”‚         /// Parses a file and saves the controllers to the repository
â”‚       â”‚   â”‚   87 â”‚         /// </summary>
â”‚       â”‚   â”‚   88 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚   89 â”‚         /// <param name="options">The parsing options</param>
â”‚       â”‚   â”‚   90 â”‚         /// <returns>The session ID and the number of controllers parsed</returns>
â”‚       â”‚   â”‚   91 â”‚         public async Task<(string SessionId, int ControllerCount)> ParseFileAsync(string filePath, ParsingOptions options = null)
â”‚       â”‚   â”‚   92 â”‚         {
â”‚       â”‚   â”‚   93 â”‚             return await _errorHandler.WithTimingAsync(async () =>
â”‚       â”‚   â”‚   94 â”‚             {
â”‚       â”‚   â”‚   95 â”‚                 if (!_fileSystem.FileExists(filePath))
â”‚       â”‚   â”‚   96 â”‚                     throw new ParsingException($"File not found: {filePath}", filePath);
â”‚       â”‚   â”‚   97 â”‚ 
â”‚       â”‚   â”‚   98 â”‚                 options ??= new ParsingOptions();
â”‚       â”‚   â”‚   99 â”‚                 _logger.LogInformation("Parsing file {FilePath} with options: {Options}", filePath, options);
â”‚       â”‚   â”‚  100 â”‚ 
â”‚       â”‚   â”‚  101 â”‚                 // Read the file content
â”‚       â”‚   â”‚  102 â”‚                 string content = await _fileSystem.ReadAllTextAsync(filePath);
â”‚       â”‚   â”‚  103 â”‚                 if (string.IsNullOrWhiteSpace(content))
â”‚       â”‚   â”‚  104 â”‚                     throw new ParsingException("File is empty", filePath);
â”‚       â”‚   â”‚  105 â”‚ 
â”‚       â”‚   â”‚  106 â”‚                 // Determine the file type based on extension
â”‚       â”‚   â”‚  107 â”‚                 string extension = Path.GetExtension(filePath).ToLowerInvariant();
â”‚       â”‚   â”‚  108 â”‚                 var controllers = extension switch
â”‚       â”‚   â”‚  109 â”‚                 {
â”‚       â”‚   â”‚  110 â”‚                     ".dmp" => ParseDmpFile(content, options),
â”‚       â”‚   â”‚  111 â”‚                     ".xml" => await ParseXmlFile(content, options),
â”‚       â”‚   â”‚  112 â”‚                     _ => throw new ParsingException($"Unsupported file type: {extension}", filePath)
â”‚       â”‚   â”‚  113 â”‚                 };
â”‚       â”‚   â”‚  114 â”‚ 
â”‚       â”‚   â”‚  115 â”‚                 if (controllers.Count == 0)
â”‚       â”‚   â”‚  116 â”‚                     throw new ParsingException("No controllers found in file", filePath);
â”‚       â”‚   â”‚  117 â”‚ 
â”‚       â”‚   â”‚  118 â”‚                 _logger.LogInformation("Parsed {ControllerCount} controllers from {FilePath}", controllers.Count, filePath);
â”‚       â”‚   â”‚  119 â”‚ 
â”‚       â”‚   â”‚  120 â”‚                 // Generate a session prefix if project ID is provided
â”‚       â”‚   â”‚  121 â”‚                 string sessionPrefix = null;
â”‚       â”‚   â”‚  122 â”‚                 if (!string.IsNullOrEmpty(options.ProjectId))
â”‚       â”‚   â”‚  123 â”‚                 {
â”‚       â”‚   â”‚  124 â”‚                     sessionPrefix = $"project_{options.ProjectId}_";
â”‚       â”‚   â”‚  125 â”‚                 }
â”‚       â”‚   â”‚  126 â”‚ 
â”‚       â”‚   â”‚  127 â”‚                 // Save to repository
â”‚       â”‚   â”‚  128 â”‚                 string sessionId = await _controllerRepository.SaveControllerBatchAsync(controllers, filePath, sessionPrefix);
â”‚       â”‚   â”‚  129 â”‚                 return (sessionId, controllers.Count);
â”‚       â”‚   â”‚  130 â”‚             }, "ParseFile");
â”‚       â”‚   â”‚  131 â”‚         }
â”‚       â”‚   â”‚  132 â”‚ 
â”‚       â”‚   â”‚  133 â”‚         /// <summary>
â”‚       â”‚   â”‚  134 â”‚         /// Parses multiple files for a project
â”‚       â”‚   â”‚  135 â”‚         /// </summary>
â”‚       â”‚   â”‚  136 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚  137 â”‚         /// <param name="filePaths">The file paths</param>
â”‚       â”‚   â”‚  138 â”‚         /// <param name="options">The parsing options</param>
â”‚       â”‚   â”‚  139 â”‚         /// <returns>A list of parsing results</returns>
â”‚       â”‚   â”‚  140 â”‚         public async Task<List<ParsingResult>> ParseProjectFilesAsync(string projectId, IEnumerable<string> filePaths, ParsingOptions options = null)
â”‚       â”‚   â”‚  141 â”‚         {
â”‚       â”‚   â”‚  142 â”‚             var results = new List<ParsingResult>();
â”‚       â”‚   â”‚  143 â”‚             options ??= new ParsingOptions { ProjectId = projectId };
â”‚       â”‚   â”‚  144 â”‚             options.ProjectId = projectId; // Ensure project ID is set
â”‚       â”‚   â”‚  145 â”‚ 
â”‚       â”‚   â”‚  146 â”‚             foreach (var filePath in filePaths)
â”‚       â”‚   â”‚  147 â”‚             {
â”‚       â”‚   â”‚  148 â”‚                 try
â”‚       â”‚   â”‚  149 â”‚                 {
â”‚       â”‚   â”‚  150 â”‚                     var (sessionId, controllerCount) = await ParseFileAsync(filePath, options);
â”‚       â”‚   â”‚  151 â”‚                     results.Add(new ParsingResult
â”‚       â”‚   â”‚  152 â”‚                     {
â”‚       â”‚   â”‚  153 â”‚                         FilePath = filePath,
â”‚       â”‚   â”‚  154 â”‚                         FileName = Path.GetFileName(filePath),
â”‚       â”‚   â”‚  155 â”‚                         Success = true,
â”‚       â”‚   â”‚  156 â”‚                         SessionId = sessionId,
â”‚       â”‚   â”‚  157 â”‚                         ControllerCount = controllerCount
â”‚       â”‚   â”‚  158 â”‚                     });
â”‚       â”‚   â”‚  159 â”‚                 }
â”‚       â”‚   â”‚  160 â”‚                 catch (Exception ex)
â”‚       â”‚   â”‚  161 â”‚                 {
â”‚       â”‚   â”‚  162 â”‚                     _errorHandler.HandleException(ex, "ParseProjectFiles");
â”‚       â”‚   â”‚  163 â”‚                     results.Add(new ParsingResult
â”‚       â”‚   â”‚  164 â”‚                     {
â”‚       â”‚   â”‚  165 â”‚                         FilePath = filePath,
â”‚       â”‚   â”‚  166 â”‚                         FileName = Path.GetFileName(filePath),
â”‚       â”‚   â”‚  167 â”‚                         Success = false,
â”‚       â”‚   â”‚  168 â”‚                         ErrorMessage = ex.Message
â”‚       â”‚   â”‚  169 â”‚                     });
â”‚       â”‚   â”‚  170 â”‚                 }
â”‚       â”‚   â”‚  171 â”‚             }
â”‚       â”‚   â”‚  172 â”‚ 
â”‚       â”‚   â”‚  173 â”‚             return results;
â”‚       â”‚   â”‚  174 â”‚         }
â”‚       â”‚   â”‚  175 â”‚ 
â”‚       â”‚   â”‚  176 â”‚         /// <summary>
â”‚       â”‚   â”‚  177 â”‚         /// Groups controllers based on their signature
â”‚       â”‚   â”‚  178 â”‚         /// </summary>
â”‚       â”‚   â”‚  179 â”‚         /// <param name="controllers">The controllers to group</param>
â”‚       â”‚   â”‚  180 â”‚         /// <param name="nameTemplate">Optional name replacement template</param>
â”‚       â”‚   â”‚  181 â”‚         /// <returns>A list of controller groups</returns>
â”‚       â”‚   â”‚  182 â”‚         public List<ControllerGroup> CreateControllerGroups(IEnumerable<Controller> controllers, NameReplacementTemplate nameTemplate = null)
â”‚       â”‚   â”‚  183 â”‚         {
â”‚       â”‚   â”‚  184 â”‚             _logger.LogInformation("Creating controller groups from {ControllerCount} controllers", controllers.Count());
â”‚       â”‚   â”‚  185 â”‚ 
â”‚       â”‚   â”‚  186 â”‚             var groups = new Dictionary<string, ControllerGroup>();
â”‚       â”‚   â”‚  187 â”‚ 
â”‚       â”‚   â”‚  188 â”‚             foreach (var controller in controllers)
â”‚       â”‚   â”‚  189 â”‚             {
â”‚       â”‚   â”‚  190 â”‚                 // Compute a signature for the controller
â”‚       â”‚   â”‚  191 â”‚                 var signature = ComputeControllerSignature(controller);
â”‚       â”‚   â”‚  192 â”‚ 
â”‚       â”‚   â”‚  193 â”‚                 // Look for an existing group with the same signature
â”‚       â”‚   â”‚  194 â”‚                 if (!groups.TryGetValue(signature, out var group))
â”‚       â”‚   â”‚  195 â”‚                 {
â”‚       â”‚   â”‚  196 â”‚                     group = new ControllerGroup(signature);
â”‚       â”‚   â”‚  197 â”‚                     groups[signature] = group;
â”‚       â”‚   â”‚  198 â”‚                 }
â”‚       â”‚   â”‚  199 â”‚ 
â”‚       â”‚   â”‚  200 â”‚                 // Add controller to group
â”‚       â”‚   â”‚  201 â”‚                 group.ControllerNames.Add(controller.Name);
â”‚       â”‚   â”‚  202 â”‚ 
â”‚       â”‚   â”‚  203 â”‚                 // Extract values with name replacements
â”‚       â”‚   â”‚  204 â”‚                 ExtractControllerValuesWithProcessing(
â”‚       â”‚   â”‚  205 â”‚                     controller.Objects,
â”‚       â”‚   â”‚  206 â”‚                     group.OriginalValues,
â”‚       â”‚   â”‚  207 â”‚                     group.SharedValues,
â”‚       â”‚   â”‚  208 â”‚                     group.NameMapping,
â”‚       â”‚   â”‚  209 â”‚                     nameTemplate?.Replacements);
â”‚       â”‚   â”‚  210 â”‚             }
â”‚       â”‚   â”‚  211 â”‚ 
â”‚       â”‚   â”‚  212 â”‚             return groups.Values.ToList();
â”‚       â”‚   â”‚  213 â”‚         }
â”‚       â”‚   â”‚  214 â”‚ 
â”‚       â”‚   â”‚  215 â”‚         /// <summary>
â”‚       â”‚   â”‚  216 â”‚         /// Extracts available types from controllers
â”‚       â”‚   â”‚  217 â”‚         /// </summary>
â”‚       â”‚   â”‚  218 â”‚         /// <param name="controllers">The controllers to examine</param>
â”‚       â”‚   â”‚  219 â”‚         /// <returns>A set of type names</returns>
â”‚       â”‚   â”‚  220 â”‚         public HashSet<string> GetAvailableTypes(IEnumerable<Controller> controllers)
â”‚       â”‚   â”‚  221 â”‚         {
â”‚       â”‚   â”‚  222 â”‚             var types = new HashSet<string>();
â”‚       â”‚   â”‚  223 â”‚ 
â”‚       â”‚   â”‚  224 â”‚             foreach (var controller in controllers)
â”‚       â”‚   â”‚  225 â”‚             {
â”‚       â”‚   â”‚  226 â”‚                 foreach (var obj in controller.Objects)
â”‚       â”‚   â”‚  227 â”‚                 {
â”‚       â”‚   â”‚  228 â”‚                     ExtractTypes(obj, types);
â”‚       â”‚   â”‚  229 â”‚                 }
â”‚       â”‚   â”‚  230 â”‚             }
â”‚       â”‚   â”‚  231 â”‚ 
â”‚       â”‚   â”‚  232 â”‚             return types;
â”‚       â”‚   â”‚  233 â”‚         }
â”‚       â”‚   â”‚  234 â”‚ 
â”‚       â”‚   â”‚  235 â”‚         /// <summary>
â”‚       â”‚   â”‚  236 â”‚         /// Applies filtering to controllers
â”‚       â”‚   â”‚  237 â”‚         /// </summary>
â”‚       â”‚   â”‚  238 â”‚         /// <param name="controllers">The controllers to filter</param>
â”‚       â”‚   â”‚  239 â”‚         /// <param name="options">The filter options</param>
â”‚       â”‚   â”‚  240 â”‚         /// <returns>A filtered list of controllers</returns>
â”‚       â”‚   â”‚  241 â”‚         public List<Controller> FilterControllers(IEnumerable<Controller> controllers, FilterOptions options)
â”‚       â”‚   â”‚  242 â”‚         {
â”‚       â”‚   â”‚  243 â”‚             _logger.LogInformation("Filtering controllers with options: {Options}", options);
â”‚       â”‚   â”‚  244 â”‚ 
â”‚       â”‚   â”‚  245 â”‚             if (controllers == null || !controllers.Any())
â”‚       â”‚   â”‚  246 â”‚                 return new List<Controller>();
â”‚       â”‚   â”‚  247 â”‚ 
â”‚       â”‚   â”‚  248 â”‚             var result = new List<Controller>();
â”‚       â”‚   â”‚  249 â”‚ 
â”‚       â”‚   â”‚  250 â”‚             foreach (var controller in controllers)
â”‚       â”‚   â”‚  251 â”‚             {
â”‚       â”‚   â”‚  252 â”‚                 // Create a new controller with filtered objects
â”‚       â”‚   â”‚  253 â”‚                 var filteredObjects = FilterObjects(
â”‚       â”‚   â”‚  254 â”‚                     controller.Objects,
â”‚       â”‚   â”‚  255 â”‚                     options.IncludedTypes,
â”‚       â”‚   â”‚  256 â”‚                     options.NameFilters,
â”‚       â”‚   â”‚  257 â”‚                     options.IsWhitelist,
â”‚       â”‚   â”‚  258 â”‚                     options.IgnoreEmptyValues,
â”‚       â”‚   â”‚  259 â”‚                     options.IncludeByteCode);
â”‚       â”‚   â”‚  260 â”‚ 
â”‚       â”‚   â”‚  261 â”‚                 if (filteredObjects.Any())
â”‚       â”‚   â”‚  262 â”‚                 {
â”‚       â”‚   â”‚  263 â”‚                     // Create a new controller with filtered objects
â”‚       â”‚   â”‚  264 â”‚                     var newController = new Controller(controller.Name, controller.Model);
â”‚       â”‚   â”‚  265 â”‚ 
â”‚       â”‚   â”‚  266 â”‚                     // Copy properties
â”‚       â”‚   â”‚  267 â”‚                     foreach (var prop in controller.Properties)
â”‚       â”‚   â”‚  268 â”‚                     {
â”‚       â”‚   â”‚  269 â”‚                         newController.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  270 â”‚                     }
â”‚       â”‚   â”‚  271 â”‚ 
â”‚       â”‚   â”‚  272 â”‚                     // Set connection info
â”‚       â”‚   â”‚  273 â”‚                     newController.SetConnectionInfo(
â”‚       â”‚   â”‚  274 â”‚                         controller.Port,
â”‚       â”‚   â”‚  275 â”‚                         controller.SerialNumber,
â”‚       â”‚   â”‚  276 â”‚                         controller.InfinetId);
â”‚       â”‚   â”‚  277 â”‚ 
â”‚       â”‚   â”‚  278 â”‚                     // Add filtered objects
â”‚       â”‚   â”‚  279 â”‚                     foreach (var obj in filteredObjects)
â”‚       â”‚   â”‚  280 â”‚                     {
â”‚       â”‚   â”‚  281 â”‚                         newController.AddObject(obj);
â”‚       â”‚   â”‚  282 â”‚                     }
â”‚       â”‚   â”‚  283 â”‚ 
â”‚       â”‚   â”‚  284 â”‚                     result.Add(newController);
â”‚       â”‚   â”‚  285 â”‚                 }
â”‚       â”‚   â”‚  286 â”‚             }
â”‚       â”‚   â”‚  287 â”‚ 
â”‚       â”‚   â”‚  288 â”‚             return result;
â”‚       â”‚   â”‚  289 â”‚         }
â”‚       â”‚   â”‚  290 â”‚ 
â”‚       â”‚   â”‚  291 â”‚         #region DMP File Parsing
â”‚       â”‚   â”‚  292 â”‚ 
â”‚       â”‚   â”‚  293 â”‚         /// <summary>
â”‚       â”‚   â”‚  294 â”‚         /// Parses a DMP file
â”‚       â”‚   â”‚  295 â”‚         /// </summary>
â”‚       â”‚   â”‚  296 â”‚         /// <param name="content">The file content</param>
â”‚       â”‚   â”‚  297 â”‚         /// <param name="options">The parsing options</param>
â”‚       â”‚   â”‚  298 â”‚         /// <returns>A list of controllers</returns>
â”‚       â”‚   â”‚  299 â”‚         private List<Controller> ParseDmpFile(string content, ParsingOptions options)
â”‚       â”‚   â”‚  300 â”‚         {
â”‚       â”‚   â”‚  301 â”‚             _logger.LogInformation("Parsing DMP file content ({ContentLength} bytes) with options: {Options}",
â”‚       â”‚   â”‚  302 â”‚                 content?.Length ?? 0, options);
â”‚       â”‚   â”‚  303 â”‚ 
â”‚       â”‚   â”‚  304 â”‚             var controllers = new List<Controller>();
â”‚       â”‚   â”‚  305 â”‚             var dictionaryEntries = new Dictionary<string, Dictionary<string, string>>();
â”‚       â”‚   â”‚  306 â”‚             Dictionary<int, string> currentColumnMap = null;
â”‚       â”‚   â”‚  307 â”‚ 
â”‚       â”‚   â”‚  308 â”‚             using (var reader = new StringReader(content))
â”‚       â”‚   â”‚  309 â”‚             {
â”‚       â”‚   â”‚  310 â”‚                 // First pass: Read dictionary entries
â”‚       â”‚   â”‚  311 â”‚                 string line;
â”‚       â”‚   â”‚  312 â”‚                 bool inDictionary = false;
â”‚       â”‚   â”‚  313 â”‚                 string currentDictionaryName = null;
â”‚       â”‚   â”‚  314 â”‚ 
â”‚       â”‚   â”‚  315 â”‚                 while ((line = reader.ReadLine()) != null)
â”‚       â”‚   â”‚  316 â”‚                 {
â”‚       â”‚   â”‚  317 â”‚                     line = line.Trim();
â”‚       â”‚   â”‚  318 â”‚ 
â”‚       â”‚   â”‚  319 â”‚                     // Check for dictionary start
â”‚       â”‚   â”‚  320 â”‚                     if (line.StartsWith("Dictionary : "))
â”‚       â”‚   â”‚  321 â”‚                     {
â”‚       â”‚   â”‚  322 â”‚                         inDictionary = true;
â”‚       â”‚   â”‚  323 â”‚                         currentDictionaryName = line.Substring("Dictionary : ".Length).Trim();
â”‚       â”‚   â”‚  324 â”‚                         continue;
â”‚       â”‚   â”‚  325 â”‚                     }
â”‚       â”‚   â”‚  326 â”‚ 
â”‚       â”‚   â”‚  327 â”‚                     // Check for dictionary end
â”‚       â”‚   â”‚  328 â”‚                     if (line == "EndDictionary")
â”‚       â”‚   â”‚  329 â”‚                     {
â”‚       â”‚   â”‚  330 â”‚                         inDictionary = false;
â”‚       â”‚   â”‚  331 â”‚                         currentDictionaryName = null;
â”‚       â”‚   â”‚  332 â”‚                         currentColumnMap = null;
â”‚       â”‚   â”‚  333 â”‚                         continue;
â”‚       â”‚   â”‚  334 â”‚                     }
â”‚       â”‚   â”‚  335 â”‚ 
â”‚       â”‚   â”‚  336 â”‚                     if (!inDictionary) continue;
â”‚       â”‚   â”‚  337 â”‚ 
â”‚       â”‚   â”‚  338 â”‚                     // Update column map when we find a type header
â”‚       â”‚   â”‚  339 â”‚                     if (line.StartsWith("'TYPE"))
â”‚       â”‚   â”‚  340 â”‚                     {
â”‚       â”‚   â”‚  341 â”‚                         currentColumnMap = ParseColumnHeaders(line);
â”‚       â”‚   â”‚  342 â”‚                         continue;
â”‚       â”‚   â”‚  343 â”‚                     }
â”‚       â”‚   â”‚  344 â”‚ 
â”‚       â”‚   â”‚  345 â”‚                     // Parse InfinityInfinetCtlr entries using current column map
â”‚       â”‚   â”‚  346 â”‚                     if (line.StartsWith("InfinityInfinetCtlr") && currentColumnMap != null)
â”‚       â”‚   â”‚  347 â”‚                     {
â”‚       â”‚   â”‚  348 â”‚                         var parts = line.Split(new[] { ':' }, StringSplitOptions.RemoveEmptyEntries)
â”‚       â”‚   â”‚  349 â”‚                             .Select(p => p.Trim())
â”‚       â”‚   â”‚  350 â”‚                             .ToArray();
â”‚       â”‚   â”‚  351 â”‚ 
â”‚       â”‚   â”‚  352 â”‚                         if (parts.Length >= currentColumnMap.Count)
â”‚       â”‚   â”‚  353 â”‚                         {
â”‚       â”‚   â”‚  354 â”‚                             var properties = new Dictionary<string, string>();
â”‚       â”‚   â”‚  355 â”‚ 
â”‚       â”‚   â”‚  356 â”‚                             // Use current column map to create properties
â”‚       â”‚   â”‚  357 â”‚                             for (int i = 0; i < parts.Length && i < currentColumnMap.Count; i++)
â”‚       â”‚   â”‚  358 â”‚                             {
â”‚       â”‚   â”‚  359 â”‚                                 if (i != 1) // Skip NAME as it's used as the key
â”‚       â”‚   â”‚  360 â”‚                                 {
â”‚       â”‚   â”‚  361 â”‚                                     string columnName = currentColumnMap[i];
â”‚       â”‚   â”‚  362 â”‚                                     string value = parts[i];
â”‚       â”‚   â”‚  363 â”‚ 
â”‚       â”‚   â”‚  364 â”‚                                     // Only add non-empty values
â”‚       â”‚   â”‚  365 â”‚                                     if (!string.IsNullOrWhiteSpace(value) && value != "False")
â”‚       â”‚   â”‚  366 â”‚                                     {
â”‚       â”‚   â”‚  367 â”‚                                         properties[columnName] = value;
â”‚       â”‚   â”‚  368 â”‚                                     }
â”‚       â”‚   â”‚  369 â”‚                                 }
â”‚       â”‚   â”‚  370 â”‚                             }
â”‚       â”‚   â”‚  371 â”‚ 
â”‚       â”‚   â”‚  372 â”‚                             // Add the dictionary name as a property
â”‚       â”‚   â”‚  373 â”‚                             if (!string.IsNullOrWhiteSpace(currentDictionaryName))
â”‚       â”‚   â”‚  374 â”‚                             {
â”‚       â”‚   â”‚  375 â”‚                                 properties["DictionaryName"] = currentDictionaryName;
â”‚       â”‚   â”‚  376 â”‚                             }
â”‚       â”‚   â”‚  377 â”‚ 
â”‚       â”‚   â”‚  378 â”‚                             // Determine and add controller family if we have a model
â”‚       â”‚   â”‚  379 â”‚                             if (properties.TryGetValue("Model", out string modelNumber))
â”‚       â”‚   â”‚  380 â”‚                             {
â”‚       â”‚   â”‚  381 â”‚                                 var family = DetermineControllerFamily(modelNumber);
â”‚       â”‚   â”‚  382 â”‚                                 properties["ControllerFamily"] = family.ToString();
â”‚       â”‚   â”‚  383 â”‚                             }
â”‚       â”‚   â”‚  384 â”‚ 
â”‚       â”‚   â”‚  385 â”‚                             dictionaryEntries[parts[1]] = properties; // Use NAME column value as key
â”‚       â”‚   â”‚  386 â”‚                         }
â”‚       â”‚   â”‚  387 â”‚                     }
â”‚       â”‚   â”‚  388 â”‚                 }
â”‚       â”‚   â”‚  389 â”‚             }
â”‚       â”‚   â”‚  390 â”‚ 
â”‚       â”‚   â”‚  391 â”‚             // Create controller objects from dictionary entries
â”‚       â”‚   â”‚  392 â”‚             foreach (var entry in dictionaryEntries)
â”‚       â”‚   â”‚  393 â”‚             {
â”‚       â”‚   â”‚  394 â”‚                 var controller = new Controller(entry.Key, entry.Value.GetValueOrDefault("Model", "Unknown"));
â”‚       â”‚   â”‚  395 â”‚ 
â”‚       â”‚   â”‚  396 â”‚                 // Copy all other properties
â”‚       â”‚   â”‚  397 â”‚                 foreach (var prop in entry.Value)
â”‚       â”‚   â”‚  398 â”‚                 {
â”‚       â”‚   â”‚  399 â”‚                     controller.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  400 â”‚                 }
â”‚       â”‚   â”‚  401 â”‚ 
â”‚       â”‚   â”‚  402 â”‚                 // Set connection info if available
â”‚       â”‚   â”‚  403 â”‚                 controller.SetConnectionInfo(
â”‚       â”‚   â”‚  404 â”‚                     entry.Value.GetValueOrDefault("Port", ""),
â”‚       â”‚   â”‚  405 â”‚                     entry.Value.GetValueOrDefault("SerialNumber", ""),
â”‚       â”‚   â”‚  406 â”‚                     entry.Value.GetValueOrDefault("InfinetId", "")
â”‚       â”‚   â”‚  407 â”‚                 );
â”‚       â”‚   â”‚  408 â”‚ 
â”‚       â”‚   â”‚  409 â”‚                 controllers.Add(controller);
â”‚       â”‚   â”‚  410 â”‚             }
â”‚       â”‚   â”‚  411 â”‚ 
â”‚       â”‚   â”‚  412 â”‚             // Second pass: Process controller contents (objects, etc.)
â”‚       â”‚   â”‚  413 â”‚             using (var reader = new StringReader(content))
â”‚       â”‚   â”‚  414 â”‚             {
â”‚       â”‚   â”‚  415 â”‚                 string line;
â”‚       â”‚   â”‚  416 â”‚                 Controller currentController = null;
â”‚       â”‚   â”‚  417 â”‚                 Stack<ControllerObject> objectStack = new Stack<ControllerObject>();
â”‚       â”‚   â”‚  418 â”‚ 
â”‚       â”‚   â”‚  419 â”‚                 while ((line = reader.ReadLine()) != null)
â”‚       â”‚   â”‚  420 â”‚                 {
â”‚       â”‚   â”‚  421 â”‚                     line = line.Trim();
â”‚       â”‚   â”‚  422 â”‚ 
â”‚       â”‚   â”‚  423 â”‚                     if (string.IsNullOrWhiteSpace(line) || line.StartsWith("'"))
â”‚       â”‚   â”‚  424 â”‚                         continue;
â”‚       â”‚   â”‚  425 â”‚ 
â”‚       â”‚   â”‚  426 â”‚                     if (line.StartsWith("InfinetCtlr :"))
â”‚       â”‚   â”‚  427 â”‚                     {
â”‚       â”‚   â”‚  428 â”‚                         var controllerName = line.Substring("InfinetCtlr :".Length).Trim();
â”‚       â”‚   â”‚  429 â”‚                         currentController = controllers.FirstOrDefault(c => c.Name == controllerName);
â”‚       â”‚   â”‚  430 â”‚                         continue;
â”‚       â”‚   â”‚  431 â”‚                     }
â”‚       â”‚   â”‚  432 â”‚ 
â”‚       â”‚   â”‚  433 â”‚                     // Controller end
â”‚       â”‚   â”‚  434 â”‚                     if (line == "EndInfinetCtlr")
â”‚       â”‚   â”‚  435 â”‚                     {
â”‚       â”‚   â”‚  436 â”‚                         currentController = null;
â”‚       â”‚   â”‚  437 â”‚                         objectStack.Clear();
â”‚       â”‚   â”‚  438 â”‚                         continue;
â”‚       â”‚   â”‚  439 â”‚                     }
â”‚       â”‚   â”‚  440 â”‚ 
â”‚       â”‚   â”‚  441 â”‚                     // Only process objects if we're in a controller section
â”‚       â”‚   â”‚  442 â”‚                     if (currentController == null)
â”‚       â”‚   â”‚  443 â”‚                         continue;
â”‚       â”‚   â”‚  444 â”‚ 
â”‚       â”‚   â”‚  445 â”‚                     // Object start
â”‚       â”‚   â”‚  446 â”‚                     if (line.StartsWith("Object :"))
â”‚       â”‚   â”‚  447 â”‚                     {
â”‚       â”‚   â”‚  448 â”‚                         var objName = line.Substring("Object :".Length).Trim();
â”‚       â”‚   â”‚  449 â”‚                         var newObject = new ControllerObject("Unknown", objName);
â”‚       â”‚   â”‚  450 â”‚ 
â”‚       â”‚   â”‚  451 â”‚                         if (objectStack.Count == 0)
â”‚       â”‚   â”‚  452 â”‚                         {
â”‚       â”‚   â”‚  453 â”‚                             // Top-level object
â”‚       â”‚   â”‚  454 â”‚                             currentController.AddObject(newObject);
â”‚       â”‚   â”‚  455 â”‚                         }
â”‚       â”‚   â”‚  456 â”‚                         else
â”‚       â”‚   â”‚  457 â”‚                         {
â”‚       â”‚   â”‚  458 â”‚                             // Child object
â”‚       â”‚   â”‚  459 â”‚                             objectStack.Peek().AddChild(newObject);
â”‚       â”‚   â”‚  460 â”‚                         }
â”‚       â”‚   â”‚  461 â”‚                         objectStack.Push(newObject);
â”‚       â”‚   â”‚  462 â”‚                         continue;
â”‚       â”‚   â”‚  463 â”‚                     }
â”‚       â”‚   â”‚  464 â”‚ 
â”‚       â”‚   â”‚  465 â”‚                     // Object end
â”‚       â”‚   â”‚  466 â”‚                     if (line == "EndObject" && objectStack.Count > 0)
â”‚       â”‚   â”‚  467 â”‚                     {
â”‚       â”‚   â”‚  468 â”‚                         objectStack.Pop();
â”‚       â”‚   â”‚  469 â”‚                         continue;
â”‚       â”‚   â”‚  470 â”‚                     }
â”‚       â”‚   â”‚  471 â”‚ 
â”‚       â”‚   â”‚  472 â”‚                     // Process properties
â”‚       â”‚   â”‚  473 â”‚                     if (objectStack.Count > 0 && line.Contains(" :"))
â”‚       â”‚   â”‚  474 â”‚                     {
â”‚       â”‚   â”‚  475 â”‚                         var parts = line.Split(new[] { " :" }, StringSplitOptions.None);
â”‚       â”‚   â”‚  476 â”‚                         if (parts.Length == 2)
â”‚       â”‚   â”‚  477 â”‚                         {
â”‚       â”‚   â”‚  478 â”‚                             var key = parts[0].Trim();
â”‚       â”‚   â”‚  479 â”‚                             var value = parts[1].Trim();
â”‚       â”‚   â”‚  480 â”‚ 
â”‚       â”‚   â”‚  481 â”‚                             var currentObject = objectStack.Peek();
â”‚       â”‚   â”‚  482 â”‚ 
â”‚       â”‚   â”‚  483 â”‚                             switch (key.ToLower())
â”‚       â”‚   â”‚  484 â”‚                             {
â”‚       â”‚   â”‚  485 â”‚                                 case "type":
â”‚       â”‚   â”‚  486 â”‚                                     // We need to replace the object since Type is immutable
â”‚       â”‚   â”‚  487 â”‚                                     var replacement = new ControllerObject(value, currentObject.Name, currentObject.Value);
â”‚       â”‚   â”‚  488 â”‚ 
â”‚       â”‚   â”‚  489 â”‚                                     // Copy all properties
â”‚       â”‚   â”‚  490 â”‚                                     if (currentObject.Alias != null)
â”‚       â”‚   â”‚  491 â”‚                                         replacement.SetAlias(currentObject.Alias);
â”‚       â”‚   â”‚  492 â”‚ 
â”‚       â”‚   â”‚  493 â”‚                                     foreach (var prop in currentObject.Properties)
â”‚       â”‚   â”‚  494 â”‚                                         replacement.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  495 â”‚ 
â”‚       â”‚   â”‚  496 â”‚                                     // Copy children
â”‚       â”‚   â”‚  497 â”‚                                     foreach (var child in currentObject.Children)
â”‚       â”‚   â”‚  498 â”‚                                         replacement.AddChild(child);
â”‚       â”‚   â”‚  499 â”‚ 
â”‚       â”‚   â”‚  500 â”‚                                     // Replace in parent or controller
â”‚       â”‚   â”‚  501 â”‚                                     if (objectStack.Count > 1)
â”‚       â”‚   â”‚  502 â”‚                                     {
â”‚       â”‚   â”‚  503 â”‚                                         var parentObject = objectStack.ElementAt(1);
â”‚       â”‚   â”‚  504 â”‚                                         // Remove old and add new - requires recreating the children list
â”‚       â”‚   â”‚  505 â”‚                                         // This is a limitation of the domain model design that type is immutable
â”‚       â”‚   â”‚  506 â”‚                                         var newChildren = parentObject.Children.Where(c => c != currentObject).ToList();
â”‚       â”‚   â”‚  507 â”‚                                         newChildren.Add(replacement);
â”‚       â”‚   â”‚  508 â”‚ 
â”‚       â”‚   â”‚  509 â”‚                                         // This would ideally use a ReplaceChild method on the domain model
â”‚       â”‚   â”‚  510 â”‚                                         // but we need to work with what we have
â”‚       â”‚   â”‚  511 â”‚                                     }
â”‚       â”‚   â”‚  512 â”‚                                     else
â”‚       â”‚   â”‚  513 â”‚                                     {
â”‚       â”‚   â”‚  514 â”‚                                         // Remove from controller and add back
â”‚       â”‚   â”‚  515 â”‚                                         currentController.RemoveObject(currentObject.Name);
â”‚       â”‚   â”‚  516 â”‚                                         currentController.AddObject(replacement);
â”‚       â”‚   â”‚  517 â”‚                                     }
â”‚       â”‚   â”‚  518 â”‚ 
â”‚       â”‚   â”‚  519 â”‚                                     // Update stack
â”‚       â”‚   â”‚  520 â”‚                                     objectStack.Pop();
â”‚       â”‚   â”‚  521 â”‚                                     objectStack.Push(replacement);
â”‚       â”‚   â”‚  522 â”‚ 
â”‚       â”‚   â”‚  523 â”‚                                     break;
â”‚       â”‚   â”‚  524 â”‚ 
â”‚       â”‚   â”‚  525 â”‚                                 case "alias":
â”‚       â”‚   â”‚  526 â”‚                                     currentObject.SetAlias(value);
â”‚       â”‚   â”‚  527 â”‚                                     break;
â”‚       â”‚   â”‚  528 â”‚ 
â”‚       â”‚   â”‚  529 â”‚                                 case "value":
â”‚       â”‚   â”‚  530 â”‚                                     currentObject.UpdateValue(value);
â”‚       â”‚   â”‚  531 â”‚                                     break;
â”‚       â”‚   â”‚  532 â”‚ 
â”‚       â”‚   â”‚  533 â”‚                                 case "bytecode":
â”‚       â”‚   â”‚  534 â”‚                                     if (options.IncludeByteCode)
â”‚       â”‚   â”‚  535 â”‚                                     {
â”‚       â”‚   â”‚  536 â”‚                                         var byteCodeContent = new StringBuilder();
â”‚       â”‚   â”‚  537 â”‚                                         string nextLine;
â”‚       â”‚   â”‚  538 â”‚ 
â”‚       â”‚   â”‚  539 â”‚                                         while ((nextLine = reader.ReadLine()) != null)
â”‚       â”‚   â”‚  540 â”‚                                         {
â”‚       â”‚   â”‚  541 â”‚                                             nextLine = nextLine.TrimEnd();
â”‚       â”‚   â”‚  542 â”‚                                             if (nextLine.Contains("EndByteCode"))
â”‚       â”‚   â”‚  543 â”‚                                             {
â”‚       â”‚   â”‚  544 â”‚                                                 break;
â”‚       â”‚   â”‚  545 â”‚                                             }
â”‚       â”‚   â”‚  546 â”‚ 
â”‚       â”‚   â”‚  547 â”‚                                             // Add the content line
â”‚       â”‚   â”‚  548 â”‚                                             byteCodeContent.AppendLine(nextLine);
â”‚       â”‚   â”‚  549 â”‚ 
â”‚       â”‚   â”‚  550 â”‚                                             // Skip the next line (empty line)
â”‚       â”‚   â”‚  551 â”‚                                             reader.ReadLine();
â”‚       â”‚   â”‚  552 â”‚                                         }
â”‚       â”‚   â”‚  553 â”‚ 
â”‚       â”‚   â”‚  554 â”‚                                         currentObject.UpdateValue(byteCodeContent.ToString());
â”‚       â”‚   â”‚  555 â”‚                                         currentObject.SetHasByteCode(true);
â”‚       â”‚   â”‚  556 â”‚                                     }
â”‚       â”‚   â”‚  557 â”‚                                     else
â”‚       â”‚   â”‚  558 â”‚                                     {
â”‚       â”‚   â”‚  559 â”‚                                         // Skip bytecode if not including it
â”‚       â”‚   â”‚  560 â”‚                                         SkipUntil(reader, "EndByteCode");
â”‚       â”‚   â”‚  561 â”‚                                         currentObject.SetHasByteCode(true);
â”‚       â”‚   â”‚  562 â”‚                                     }
â”‚       â”‚   â”‚  563 â”‚                                     break;
â”‚       â”‚   â”‚  564 â”‚ 
â”‚       â”‚   â”‚  565 â”‚                                 case "triggers":
â”‚       â”‚   â”‚  566 â”‚                                     SkipUntil(reader, "EndOfCDT");
â”‚       â”‚   â”‚  567 â”‚                                     break;
â”‚       â”‚   â”‚  568 â”‚ 
â”‚       â”‚   â”‚  569 â”‚                                 case "panelobjectlist":
â”‚       â”‚   â”‚  570 â”‚                                     SkipUntil(reader, "}");
â”‚       â”‚   â”‚  571 â”‚                                     break;
â”‚       â”‚   â”‚  572 â”‚ 
â”‚       â”‚   â”‚  573 â”‚                                 case "alarmlinks":
â”‚       â”‚   â”‚  574 â”‚                                     SkipUntil(reader, "EndAlarmLinks");
â”‚       â”‚   â”‚  575 â”‚                                     break;
â”‚       â”‚   â”‚  576 â”‚ 
â”‚       â”‚   â”‚  577 â”‚                                 default:
â”‚       â”‚   â”‚  578 â”‚                                     // Store all other properties
â”‚       â”‚   â”‚  579 â”‚                                     if (!key.StartsWith("EndOf") && !key.StartsWith("Begin"))
â”‚       â”‚   â”‚  580 â”‚                                     {
â”‚       â”‚   â”‚  581 â”‚                                         currentObject.SetProperty(key, value);
â”‚       â”‚   â”‚  582 â”‚                                     }
â”‚       â”‚   â”‚  583 â”‚                                     break;
â”‚       â”‚   â”‚  584 â”‚                             }
â”‚       â”‚   â”‚  585 â”‚                         }
â”‚       â”‚   â”‚  586 â”‚                     }
â”‚       â”‚   â”‚  587 â”‚                 }
â”‚       â”‚   â”‚  588 â”‚             }
â”‚       â”‚   â”‚  589 â”‚ 
â”‚       â”‚   â”‚  590 â”‚             // Apply filtering based on options
â”‚       â”‚   â”‚  591 â”‚             if (options.TypeWhitelist.Count > 0 || options.NameFilters.Count > 0 || options.IgnoreEmptyValues)
â”‚       â”‚   â”‚  592 â”‚             {
â”‚       â”‚   â”‚  593 â”‚                 controllers = FilterControllers(controllers, new FilterOptions
â”‚       â”‚   â”‚  594 â”‚                 {
â”‚       â”‚   â”‚  595 â”‚                     IncludeByteCode = options.IncludeByteCode,
â”‚       â”‚   â”‚  596 â”‚                     IgnoreEmptyValues = options.IgnoreEmptyValues,
â”‚       â”‚   â”‚  597 â”‚                     IncludedTypes = options.TypeWhitelist,
â”‚       â”‚   â”‚  598 â”‚                     NameFilters = options.NameFilters,
â”‚       â”‚   â”‚  599 â”‚                     IsWhitelist = options.IsWhitelist
â”‚       â”‚   â”‚  600 â”‚                 });
â”‚       â”‚   â”‚  601 â”‚             }
â”‚       â”‚   â”‚  602 â”‚ 
â”‚       â”‚   â”‚  603 â”‚             return controllers;
â”‚       â”‚   â”‚  604 â”‚         }
â”‚       â”‚   â”‚  605 â”‚ 
â”‚       â”‚   â”‚  606 â”‚         /// <summary>
â”‚       â”‚   â”‚  607 â”‚         /// Parses column headers from a DMP file
â”‚       â”‚   â”‚  608 â”‚         /// </summary>
â”‚       â”‚   â”‚  609 â”‚         private Dictionary<int, string> ParseColumnHeaders(string headerLine)
â”‚       â”‚   â”‚  610 â”‚         {
â”‚       â”‚   â”‚  611 â”‚             var columnMap = new Dictionary<int, string>();
â”‚       â”‚   â”‚  612 â”‚             var columns = headerLine.Substring(1).Split(new[] { ':' }, StringSplitOptions.RemoveEmptyEntries)
â”‚       â”‚   â”‚  613 â”‚                 .Select(c => c.Trim())
â”‚       â”‚   â”‚  614 â”‚                 .ToArray();
â”‚       â”‚   â”‚  615 â”‚ 
â”‚       â”‚   â”‚  616 â”‚             for (int i = 0; i < columns.Length; i++)
â”‚       â”‚   â”‚  617 â”‚             {
â”‚       â”‚   â”‚  618 â”‚                 // Clean up the column names and store them
â”‚       â”‚   â”‚  619 â”‚                 string columnName = columns[i].Trim();
â”‚       â”‚   â”‚  620 â”‚ 
â”‚       â”‚   â”‚  621 â”‚                 // Handle special cases in column names
â”‚       â”‚   â”‚  622 â”‚                 switch (columnName)
â”‚       â”‚   â”‚  623 â”‚                 {
â”‚       â”‚   â”‚  624 â”‚                     case "SERIALNUM":
â”‚       â”‚   â”‚  625 â”‚                         columnName = "SerialNumber";
â”‚       â”‚   â”‚  626 â”‚                         break;
â”‚       â”‚   â”‚  627 â”‚                     case "INFINETID":
â”‚       â”‚   â”‚  628 â”‚                         columnName = "InfinetId";
â”‚       â”‚   â”‚  629 â”‚                         break;
â”‚       â”‚   â”‚  630 â”‚                     default:
â”‚       â”‚   â”‚  631 â”‚                         // Convert to proper case and remove spaces
â”‚       â”‚   â”‚  632 â”‚                         columnName = string.Concat(columnName.Split(' ')
â”‚       â”‚   â”‚  633 â”‚                             .Select(word => char.ToUpper(word[0]) + word.Substring(1).ToLower()));
â”‚       â”‚   â”‚  634 â”‚                         break;
â”‚       â”‚   â”‚  635 â”‚                 }
â”‚       â”‚   â”‚  636 â”‚ 
â”‚       â”‚   â”‚  637 â”‚                 columnMap[i] = columnName;
â”‚       â”‚   â”‚  638 â”‚             }
â”‚       â”‚   â”‚  639 â”‚ 
â”‚       â”‚   â”‚  640 â”‚             return columnMap;
â”‚       â”‚   â”‚  641 â”‚         }
â”‚       â”‚   â”‚  642 â”‚ 
â”‚       â”‚   â”‚  643 â”‚         /// <summary>
â”‚       â”‚   â”‚  644 â”‚         /// Skips lines in a reader until a marker is found
â”‚       â”‚   â”‚  645 â”‚         /// </summary>
â”‚       â”‚   â”‚  646 â”‚         private void SkipUntil(StringReader reader, string endMarker)
â”‚       â”‚   â”‚  647 â”‚         {
â”‚       â”‚   â”‚  648 â”‚             string line;
â”‚       â”‚   â”‚  649 â”‚             while ((line = reader.ReadLine()) != null)
â”‚       â”‚   â”‚  650 â”‚             {
â”‚       â”‚   â”‚  651 â”‚                 if (line.Trim().Contains(endMarker))
â”‚       â”‚   â”‚  652 â”‚                     break;
â”‚       â”‚   â”‚  653 â”‚             }
â”‚       â”‚   â”‚  654 â”‚         }
â”‚       â”‚   â”‚  655 â”‚ 
â”‚       â”‚   â”‚  656 â”‚         #endregion
â”‚       â”‚   â”‚  657 â”‚ 
â”‚       â”‚   â”‚  658 â”‚         #region XML File Parsing
â”‚       â”‚   â”‚  659 â”‚ 
â”‚       â”‚   â”‚  660 â”‚         /// <summary>
â”‚       â”‚   â”‚  661 â”‚         /// Parses an XML file
â”‚       â”‚   â”‚  662 â”‚         /// </summary>
â”‚       â”‚   â”‚  663 â”‚         /// <param name="content">The file content</param>
â”‚       â”‚   â”‚  664 â”‚         /// <param name="options">The parsing options</param>
â”‚       â”‚   â”‚  665 â”‚         /// <returns>A list of controllers</returns>
â”‚       â”‚   â”‚  666 â”‚         private async Task<List<Controller>> ParseXmlFile(string content, ParsingOptions options)
â”‚       â”‚   â”‚  667 â”‚         {
â”‚       â”‚   â”‚  668 â”‚             _logger.LogInformation("Parsing XML file content ({ContentLength} bytes) with options: {Options}",
â”‚       â”‚   â”‚  669 â”‚                 content?.Length ?? 0, options);
â”‚       â”‚   â”‚  670 â”‚ 
â”‚       â”‚   â”‚  671 â”‚             var controllers = new List<Controller>();
â”‚       â”‚   â”‚  672 â”‚ 
â”‚       â”‚   â”‚  673 â”‚             try
â”‚       â”‚   â”‚  674 â”‚             {
â”‚       â”‚   â”‚  675 â”‚                 var doc = XDocument.Parse(content);
â”‚       â”‚   â”‚  676 â”‚ 
â”‚       â”‚   â”‚  677 â”‚                 // Look for different possible root elements
â”‚       â”‚   â”‚  678 â”‚                 if (doc.Root?.Name.LocalName == "InfinityControllers" ||
â”‚       â”‚   â”‚  679 â”‚                     doc.Root?.Name.LocalName == "Controllers")
â”‚       â”‚   â”‚  680 â”‚                 {
â”‚       â”‚   â”‚  681 â”‚                     // Parse PaapeConversionKit export format
â”‚       â”‚   â”‚  682 â”‚                     foreach (var controllerElement in doc.Root.Elements("Controller"))
â”‚       â”‚   â”‚  683 â”‚                     {
â”‚       â”‚   â”‚  684 â”‚                         var name = controllerElement.Attribute("Name")?.Value;
â”‚       â”‚   â”‚  685 â”‚                         if (string.IsNullOrEmpty(name))
â”‚       â”‚   â”‚  686 â”‚                             continue;
â”‚       â”‚   â”‚  687 â”‚ 
â”‚       â”‚   â”‚  688 â”‚                         var model = controllerElement.Attribute("Model")?.Value ?? "Unknown";
â”‚       â”‚   â”‚  689 â”‚                         var controller = new Controller(name, model);
â”‚       â”‚   â”‚  690 â”‚ 
â”‚       â”‚   â”‚  691 â”‚                         // Set connection info
â”‚       â”‚   â”‚  692 â”‚                         controller.SetConnectionInfo(
â”‚       â”‚   â”‚  693 â”‚                             controllerElement.Attribute("Port")?.Value ?? "",
â”‚       â”‚   â”‚  694 â”‚                             controllerElement.Attribute("SerialNumber")?.Value ?? "",
â”‚       â”‚   â”‚  695 â”‚                             controllerElement.Attribute("InfinetId")?.Value ?? ""
â”‚       â”‚   â”‚  696 â”‚                         );
â”‚       â”‚   â”‚  697 â”‚ 
â”‚       â”‚   â”‚  698 â”‚                         // Process properties
â”‚       â”‚   â”‚  699 â”‚                         var propertiesElement = controllerElement.Element("Properties");
â”‚       â”‚   â”‚  700 â”‚                         if (propertiesElement != null)
â”‚       â”‚   â”‚  701 â”‚                         {
â”‚       â”‚   â”‚  702 â”‚                             foreach (var propElement in propertiesElement.Elements("Property"))
â”‚       â”‚   â”‚  703 â”‚                             {
â”‚       â”‚   â”‚  704 â”‚                                 var key = propElement.Attribute("Key")?.Value ??
â”‚       â”‚   â”‚  705 â”‚                                           propElement.Attribute("Name")?.Value;
â”‚       â”‚   â”‚  706 â”‚                                 var value = propElement.Attribute("Value")?.Value;
â”‚       â”‚   â”‚  707 â”‚ 
â”‚       â”‚   â”‚  708 â”‚                                 if (!string.IsNullOrEmpty(key))
â”‚       â”‚   â”‚  709 â”‚                                 {
â”‚       â”‚   â”‚  710 â”‚                                     controller.SetProperty(key, value ?? "");
â”‚       â”‚   â”‚  711 â”‚                                 }
â”‚       â”‚   â”‚  712 â”‚                             }
â”‚       â”‚   â”‚  713 â”‚                         }
â”‚       â”‚   â”‚  714 â”‚ 
â”‚       â”‚   â”‚  715 â”‚                         // Process objects
â”‚       â”‚   â”‚  716 â”‚                         var objectsElement = controllerElement.Element("Objects");
â”‚       â”‚   â”‚  717 â”‚                         if (objectsElement != null)
â”‚       â”‚   â”‚  718 â”‚                         {
â”‚       â”‚   â”‚  719 â”‚                             foreach (var objElement in objectsElement.Elements("Object"))
â”‚       â”‚   â”‚  720 â”‚                             {
â”‚       â”‚   â”‚  721 â”‚                                 var obj = ParseXmlObject(objElement, options.IncludeByteCode);
â”‚       â”‚   â”‚  722 â”‚                                 if (obj != null)
â”‚       â”‚   â”‚  723 â”‚                                 {
â”‚       â”‚   â”‚  724 â”‚                                     controller.AddObject(obj);
â”‚       â”‚   â”‚  725 â”‚                                 }
â”‚       â”‚   â”‚  726 â”‚                             }
â”‚       â”‚   â”‚  727 â”‚                         }
â”‚       â”‚   â”‚  728 â”‚ 
â”‚       â”‚   â”‚  729 â”‚                         controllers.Add(controller);
â”‚       â”‚   â”‚  730 â”‚                     }
â”‚       â”‚   â”‚  731 â”‚                 }
â”‚       â”‚   â”‚  732 â”‚                 else if (doc.Root?.Name.LocalName == "ObjectSet")
â”‚       â”‚   â”‚  733 â”‚                 {
â”‚       â”‚   â”‚  734 â”‚                     // Use specialized ObjectSet parser
â”‚       â”‚   â”‚  735 â”‚                     var objectSetParser = _serviceProvider.GetRequiredService<IObjectSetParser>();
â”‚       â”‚   â”‚  736 â”‚ 
â”‚       â”‚   â”‚  737 â”‚                     // Configure ObjectSet parsing options
â”‚       â”‚   â”‚  738 â”‚                     var objectSetOptions = new ObjectSetParsingOptions
â”‚       â”‚   â”‚  739 â”‚                     {
â”‚       â”‚   â”‚  740 â”‚                         IncludeMetaInformation = true,
â”‚       â”‚   â”‚  741 â”‚                         IncludeTypeDefinitions = options.TypeWhitelist.Count > 0,
â”‚       â”‚   â”‚  742 â”‚                         IncludeExportedObjects = true,
â”‚       â”‚   â”‚  743 â”‚                         TypeWhitelist = options.TypeWhitelist
â”‚       â”‚   â”‚  744 â”‚                     };
â”‚       â”‚   â”‚  745 â”‚ 
â”‚       â”‚   â”‚  746 â”‚                     // Parse the ObjectSet document
â”‚       â”‚   â”‚  747 â”‚                     var parseResult = await objectSetParser.ParseAsync(doc, objectSetOptions);
â”‚       â”‚   â”‚  748 â”‚ 
â”‚       â”‚   â”‚  749 â”‚                     if (!parseResult.Success)
â”‚       â”‚   â”‚  750 â”‚                     {
â”‚       â”‚   â”‚  751 â”‚                         throw new ParsingException($"Failed to parse ObjectSet XML: {parseResult.ErrorMessage}", "ObjectSet");
â”‚       â”‚   â”‚  752 â”‚                     }
â”‚       â”‚   â”‚  753 â”‚ 
â”‚       â”‚   â”‚  754 â”‚                     // Extract controllers from exported objects
â”‚       â”‚   â”‚  755 â”‚                     if (parseResult.ExportedObjects != null)
â”‚       â”‚   â”‚  756 â”‚                     {
â”‚       â”‚   â”‚  757 â”‚                         // Find controller elements (top-level only)
â”‚       â”‚   â”‚  758 â”‚                         var controllerObjects = parseResult.ExportedObjects
â”‚       â”‚   â”‚  759 â”‚                             .Where(e => e.Properties.TryGetValue("TYPE", out var type) &&
â”‚       â”‚   â”‚  760 â”‚                                         (type == "InfinityInfinetCtlr" || type == "Controller"));
â”‚       â”‚   â”‚  761 â”‚ 
â”‚       â”‚   â”‚  762 â”‚                         foreach (var controllerObj in controllerObjects)
â”‚       â”‚   â”‚  763 â”‚                         {
â”‚       â”‚   â”‚  764 â”‚                             var controllerName = controllerObj.Name;
â”‚       â”‚   â”‚  765 â”‚                             if (string.IsNullOrEmpty(controllerName))
â”‚       â”‚   â”‚  766 â”‚                                 continue;
â”‚       â”‚   â”‚  767 â”‚ 
â”‚       â”‚   â”‚  768 â”‚                             // Get model from properties if available
â”‚       â”‚   â”‚  769 â”‚                             string model = "Unknown";
â”‚       â”‚   â”‚  770 â”‚                             controllerObj.Properties.TryGetValue("Model", out model);
â”‚       â”‚   â”‚  771 â”‚ 
â”‚       â”‚   â”‚  772 â”‚                             var controller = new Controller(controllerName, model);
â”‚       â”‚   â”‚  773 â”‚ 
â”‚       â”‚   â”‚  774 â”‚                             // Add properties
â”‚       â”‚   â”‚  775 â”‚                             foreach (var prop in controllerObj.Properties)
â”‚       â”‚   â”‚  776 â”‚                             {
â”‚       â”‚   â”‚  777 â”‚                                 controller.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  778 â”‚ 
â”‚       â”‚   â”‚  779 â”‚                                 // Check for special properties
â”‚       â”‚   â”‚  780 â”‚                                 if (prop.Key == "SerialNumber")
â”‚       â”‚   â”‚  781 â”‚                                 {
â”‚       â”‚   â”‚  782 â”‚                                     controller.SetConnectionInfo(controller.Port, prop.Value, controller.InfinetId);
â”‚       â”‚   â”‚  783 â”‚                                 }
â”‚       â”‚   â”‚  784 â”‚                                 else if (prop.Key == "InfinetId")
â”‚       â”‚   â”‚  785 â”‚                                 {
â”‚       â”‚   â”‚  786 â”‚                                     controller.SetConnectionInfo(controller.Port, controller.SerialNumber, prop.Value);
â”‚       â”‚   â”‚  787 â”‚                                 }
â”‚       â”‚   â”‚  788 â”‚                                 else if (prop.Key == "Port")
â”‚       â”‚   â”‚  789 â”‚                                 {
â”‚       â”‚   â”‚  790 â”‚                                     controller.SetConnectionInfo(prop.Value, controller.SerialNumber, controller.InfinetId);
â”‚       â”‚   â”‚  791 â”‚                                 }
â”‚       â”‚   â”‚  792 â”‚                             }
â”‚       â”‚   â”‚  793 â”‚ 
â”‚       â”‚   â”‚  794 â”‚                             // Process all children recursively
â”‚       â”‚   â”‚  795 â”‚                             foreach (var childObj in controllerObj.Children)
â”‚       â”‚   â”‚  796 â”‚                             {
â”‚       â”‚   â”‚  797 â”‚                                 ProcessObjectSetChild(childObj, controller, null, options.IncludeByteCode);
â”‚       â”‚   â”‚  798 â”‚                             }
â”‚       â”‚   â”‚  799 â”‚ 
â”‚       â”‚   â”‚  800 â”‚                             controllers.Add(controller);
â”‚       â”‚   â”‚  801 â”‚                         }
â”‚       â”‚   â”‚  802 â”‚                     }
â”‚       â”‚   â”‚  803 â”‚ 
â”‚       â”‚   â”‚  804 â”‚                     // Store parsed meta information and type definitions in session properties if available
â”‚       â”‚   â”‚  805 â”‚                     if (parseResult.MetaInfo != null || parseResult.Types.Any())
â”‚       â”‚   â”‚  806 â”‚                     {
â”‚       â”‚   â”‚  807 â”‚                         // This is a placeholder for potentially storing this information
â”‚       â”‚   â”‚  808 â”‚                         // You could serialize and store these in controller properties, session properties, or a separate storage
â”‚       â”‚   â”‚  809 â”‚                         _logger.LogInformation("Parsed ObjectSet with {TypeCount} type definitions",
â”‚       â”‚   â”‚  810 â”‚                             parseResult.Types?.Count ?? 0);
â”‚       â”‚   â”‚  811 â”‚                     }
â”‚       â”‚   â”‚  812 â”‚                 }
â”‚       â”‚   â”‚  813 â”‚             }
â”‚       â”‚   â”‚  814 â”‚             catch (Exception ex)
â”‚       â”‚   â”‚  815 â”‚             {
â”‚       â”‚   â”‚  816 â”‚                 _logger.LogError(ex, "Error parsing XML content");
â”‚       â”‚   â”‚  817 â”‚                 throw new ParsingException("Failed to parse XML content: " + ex.Message, "unknown");
â”‚       â”‚   â”‚  818 â”‚             }
â”‚       â”‚   â”‚  819 â”‚ 
â”‚       â”‚   â”‚  820 â”‚             // Apply filtering based on options
â”‚       â”‚   â”‚  821 â”‚             if (options.TypeWhitelist.Count > 0 || options.NameFilters.Count > 0 || options.IgnoreEmptyValues)
â”‚       â”‚   â”‚  822 â”‚             {
â”‚       â”‚   â”‚  823 â”‚                 controllers = FilterControllers(controllers, new FilterOptions
â”‚       â”‚   â”‚  824 â”‚                 {
â”‚       â”‚   â”‚  825 â”‚                     IncludeByteCode = options.IncludeByteCode,
â”‚       â”‚   â”‚  826 â”‚                     IgnoreEmptyValues = options.IgnoreEmptyValues,
â”‚       â”‚   â”‚  827 â”‚                     IncludedTypes = options.TypeWhitelist,
â”‚       â”‚   â”‚  828 â”‚                     NameFilters = options.NameFilters,
â”‚       â”‚   â”‚  829 â”‚                     IsWhitelist = options.IsWhitelist
â”‚       â”‚   â”‚  830 â”‚                 });
â”‚       â”‚   â”‚  831 â”‚             }
â”‚       â”‚   â”‚  832 â”‚ 
â”‚       â”‚   â”‚  833 â”‚             return controllers;
â”‚       â”‚   â”‚  834 â”‚         }
â”‚       â”‚   â”‚  835 â”‚ 
â”‚       â”‚   â”‚  836 â”‚ 
â”‚       â”‚   â”‚  837 â”‚         private void ProcessObjectSetChild(
â”‚       â”‚   â”‚  838 â”‚             ExportedObject obj,
â”‚       â”‚   â”‚  839 â”‚             Controller controller,
â”‚       â”‚   â”‚  840 â”‚             ControllerObject parent,
â”‚       â”‚   â”‚  841 â”‚             bool includeByteCode)
â”‚       â”‚   â”‚  842 â”‚         {
â”‚       â”‚   â”‚  843 â”‚             // Extract type from properties
â”‚       â”‚   â”‚  844 â”‚             string type = "Unknown";
â”‚       â”‚   â”‚  845 â”‚             obj.Properties.TryGetValue("TYPE", out type);
â”‚       â”‚   â”‚  846 â”‚ 
â”‚       â”‚   â”‚  847 â”‚             // Extract value if available
â”‚       â”‚   â”‚  848 â”‚             string value = string.Empty;
â”‚       â”‚   â”‚  849 â”‚             obj.Properties.TryGetValue("Value", out value);
â”‚       â”‚   â”‚  850 â”‚ 
â”‚       â”‚   â”‚  851 â”‚             // Create controller object
â”‚       â”‚   â”‚  852 â”‚             var controllerObj = new ControllerObject(type, obj.Name, value);
â”‚       â”‚   â”‚  853 â”‚ 
â”‚       â”‚   â”‚  854 â”‚             // Extract alias if available
â”‚       â”‚   â”‚  855 â”‚             string alias = null;
â”‚       â”‚   â”‚  856 â”‚             if (obj.Properties.TryGetValue("Alias", out alias) && !string.IsNullOrEmpty(alias))
â”‚       â”‚   â”‚  857 â”‚             {
â”‚       â”‚   â”‚  858 â”‚                 controllerObj.SetAlias(alias);
â”‚       â”‚   â”‚  859 â”‚             }
â”‚       â”‚   â”‚  860 â”‚ 
â”‚       â”‚   â”‚  861 â”‚             // Check if this is bytecode
â”‚       â”‚   â”‚  862 â”‚             bool hasByteCode = type == "InfinityProgram" || type == "InfinityFunction";
â”‚       â”‚   â”‚  863 â”‚             controllerObj.SetHasByteCode(hasByteCode);
â”‚       â”‚   â”‚  864 â”‚ 
â”‚       â”‚   â”‚  865 â”‚             if (hasByteCode && !includeByteCode)
â”‚       â”‚   â”‚  866 â”‚             {
â”‚       â”‚   â”‚  867 â”‚                 controllerObj.UpdateValue(string.Empty);
â”‚       â”‚   â”‚  868 â”‚             }
â”‚       â”‚   â”‚  869 â”‚ 
â”‚       â”‚   â”‚  870 â”‚             // Add all properties
â”‚       â”‚   â”‚  871 â”‚             foreach (var prop in obj.Properties)
â”‚       â”‚   â”‚  872 â”‚             {
â”‚       â”‚   â”‚  873 â”‚                 // Skip Value and Alias as they are handled specially
â”‚       â”‚   â”‚  874 â”‚                 if (prop.Key == "Value" || prop.Key == "Alias" || prop.Key == "TYPE")
â”‚       â”‚   â”‚  875 â”‚                     continue;
â”‚       â”‚   â”‚  876 â”‚ 
â”‚       â”‚   â”‚  877 â”‚                 controllerObj.SetProperty(prop.Key, prop.Value);
â”‚       â”‚   â”‚  878 â”‚             }
â”‚       â”‚   â”‚  879 â”‚ 
â”‚       â”‚   â”‚  880 â”‚             // Process children recursively
â”‚       â”‚   â”‚  881 â”‚             foreach (var childObj in obj.Children)
â”‚       â”‚   â”‚  882 â”‚             {
â”‚       â”‚   â”‚  883 â”‚                 ProcessObjectSetChild(childObj, controller, controllerObj, includeByteCode);
â”‚       â”‚   â”‚  884 â”‚             }
â”‚       â”‚   â”‚  885 â”‚ 
â”‚       â”‚   â”‚  886 â”‚             // Add to parent or controller
â”‚       â”‚   â”‚  887 â”‚             if (parent != null)
â”‚       â”‚   â”‚  888 â”‚             {
â”‚       â”‚   â”‚  889 â”‚                 parent.AddChild(controllerObj);
â”‚       â”‚   â”‚  890 â”‚             }
â”‚       â”‚   â”‚  891 â”‚             else
â”‚       â”‚   â”‚  892 â”‚             {
â”‚       â”‚   â”‚  893 â”‚                 controller.AddObject(controllerObj);
â”‚       â”‚   â”‚  894 â”‚             }
â”‚       â”‚   â”‚  895 â”‚         }
â”‚       â”‚   â”‚  896 â”‚         /// <summary>
â”‚       â”‚   â”‚  897 â”‚         /// Parses an XML controller object
â”‚       â”‚   â”‚  898 â”‚         /// </summary>
â”‚       â”‚   â”‚  899 â”‚         private ControllerObject ParseXmlObject(XElement element, bool includeByteCode)
â”‚       â”‚   â”‚  900 â”‚         {
â”‚       â”‚   â”‚  901 â”‚             var type = element.Element("Type")?.Value ??
â”‚       â”‚   â”‚  902 â”‚                        element.Attribute("Type")?.Value ??
â”‚       â”‚   â”‚  903 â”‚                        "Unknown";
â”‚       â”‚   â”‚  904 â”‚ 
â”‚       â”‚   â”‚  905 â”‚             var name = element.Element("Name")?.Value ??
â”‚       â”‚   â”‚  906 â”‚                        element.Attribute("Name")?.Value;
â”‚       â”‚   â”‚  907 â”‚ 
â”‚       â”‚   â”‚  908 â”‚             if (string.IsNullOrEmpty(name))
â”‚       â”‚   â”‚  909 â”‚                 return null;
â”‚       â”‚   â”‚  910 â”‚ 
â”‚       â”‚   â”‚  911 â”‚             var value = element.Element("Value")?.Value ??
â”‚       â”‚   â”‚  912 â”‚                         element.Attribute("Value")?.Value ??
â”‚       â”‚   â”‚  913 â”‚                         "";
â”‚       â”‚   â”‚  914 â”‚ 
â”‚       â”‚   â”‚  915 â”‚             var obj = new ControllerObject(type, name, value);
â”‚       â”‚   â”‚  916 â”‚ 
â”‚       â”‚   â”‚  917 â”‚             // Set alias if present
â”‚       â”‚   â”‚  918 â”‚             var alias = element.Element("Alias")?.Value ??
â”‚       â”‚   â”‚  919 â”‚                         element.Attribute("Alias")?.Value;
â”‚       â”‚   â”‚  920 â”‚ 
â”‚       â”‚   â”‚  921 â”‚             if (!string.IsNullOrEmpty(alias))
â”‚       â”‚   â”‚  922 â”‚             {
â”‚       â”‚   â”‚  923 â”‚                 obj.SetAlias(alias);
â”‚       â”‚   â”‚  924 â”‚             }
â”‚       â”‚   â”‚  925 â”‚ 
â”‚       â”‚   â”‚  926 â”‚             // Set bytecode flag if needed
â”‚       â”‚   â”‚  927 â”‚             bool hasByteCode = ByteCodeTypes.Contains(type);
â”‚       â”‚   â”‚  928 â”‚             if (hasByteCode)
â”‚       â”‚   â”‚  929 â”‚             {
â”‚       â”‚   â”‚  930 â”‚                 obj.SetHasByteCode(true);
â”‚       â”‚   â”‚  931 â”‚                 if (!includeByteCode)
â”‚       â”‚   â”‚  932 â”‚                 {
â”‚       â”‚   â”‚  933 â”‚                     obj.UpdateValue(string.Empty);
â”‚       â”‚   â”‚  934 â”‚                 }
â”‚       â”‚   â”‚  935 â”‚             }
â”‚       â”‚   â”‚  936 â”‚ 
â”‚       â”‚   â”‚  937 â”‚             // Process properties
â”‚       â”‚   â”‚  938 â”‚             var propertiesElement = element.Element("Properties");
â”‚       â”‚   â”‚  939 â”‚             if (propertiesElement != null)
â”‚       â”‚   â”‚  940 â”‚             {
â”‚       â”‚   â”‚  941 â”‚                 foreach (var propElement in propertiesElement.Elements("Property"))
â”‚       â”‚   â”‚  942 â”‚                 {
â”‚       â”‚   â”‚  943 â”‚                     var key = propElement.Attribute("Key")?.Value ??
â”‚       â”‚   â”‚  944 â”‚                               propElement.Attribute("Name")?.Value;
â”‚       â”‚   â”‚  945 â”‚                     var value2 = propElement.Attribute("Value")?.Value;
â”‚       â”‚   â”‚  946 â”‚ 
â”‚       â”‚   â”‚  947 â”‚                     if (!string.IsNullOrEmpty(key))
â”‚       â”‚   â”‚  948 â”‚                     {
â”‚       â”‚   â”‚  949 â”‚                         obj.SetProperty(key, value2 ?? "");
â”‚       â”‚   â”‚  950 â”‚                     }
â”‚       â”‚   â”‚  951 â”‚                 }
â”‚       â”‚   â”‚  952 â”‚             }
â”‚       â”‚   â”‚  953 â”‚ 
â”‚       â”‚   â”‚  954 â”‚             // Process children
â”‚       â”‚   â”‚  955 â”‚             var childrenElement = element.Element("Children");
â”‚       â”‚   â”‚  956 â”‚             if (childrenElement != null)
â”‚       â”‚   â”‚  957 â”‚             {
â”‚       â”‚   â”‚  958 â”‚                 foreach (var childElement in childrenElement.Elements("Object"))
â”‚       â”‚   â”‚  959 â”‚                 {
â”‚       â”‚   â”‚  960 â”‚                     var child = ParseXmlObject(childElement, includeByteCode);
â”‚       â”‚   â”‚  961 â”‚                     if (child != null)
â”‚       â”‚   â”‚  962 â”‚                     {
â”‚       â”‚   â”‚  963 â”‚                         obj.AddChild(child);
â”‚       â”‚   â”‚  964 â”‚                     }
â”‚       â”‚   â”‚  965 â”‚                 }
â”‚       â”‚   â”‚  966 â”‚             }
â”‚       â”‚   â”‚  967 â”‚ 
â”‚       â”‚   â”‚  968 â”‚             return obj;
â”‚       â”‚   â”‚  969 â”‚         }
â”‚       â”‚   â”‚  970 â”‚ 
â”‚       â”‚   â”‚  971 â”‚         /// <summary>
â”‚       â”‚   â”‚  972 â”‚         /// Parses XML child objects for ObjectSet format
â”‚       â”‚   â”‚  973 â”‚         /// </summary>
â”‚       â”‚   â”‚  974 â”‚         private void ParseXmlChildObjects(XElement element, Controller controller, bool includeByteCode, ControllerObject parent = null)
â”‚       â”‚   â”‚  975 â”‚         {
â”‚       â”‚   â”‚  976 â”‚             foreach (var childElement in element.Elements("OI"))
â”‚       â”‚   â”‚  977 â”‚             {
â”‚       â”‚   â”‚  978 â”‚                 var type = childElement.Attribute("TYPE")?.Value ?? "Unknown";
â”‚       â”‚   â”‚  979 â”‚                 var name = childElement.Attribute("NAME")?.Value;
â”‚       â”‚   â”‚  980 â”‚ 
â”‚       â”‚   â”‚  981 â”‚                 if (string.IsNullOrEmpty(name))
â”‚       â”‚   â”‚  982 â”‚                     continue;
â”‚       â”‚   â”‚  983 â”‚ 
â”‚       â”‚   â”‚  984 â”‚                 // Get value from PI element with name "Value"
â”‚       â”‚   â”‚  985 â”‚                 var valueElement = childElement.Elements("PI")
â”‚       â”‚   â”‚  986 â”‚                     .FirstOrDefault(e => e.Attribute("Name")?.Value == "Value");
â”‚       â”‚   â”‚  987 â”‚                 var value = valueElement?.Attribute("Value")?.Value ?? "";
â”‚       â”‚   â”‚  988 â”‚ 
â”‚       â”‚   â”‚  989 â”‚                 var obj = new ControllerObject(type, name, value);
â”‚       â”‚   â”‚  990 â”‚ 
â”‚       â”‚   â”‚  991 â”‚                 // Set alias if present
â”‚       â”‚   â”‚  992 â”‚                 var aliasElement = childElement.Elements("PI")
â”‚       â”‚   â”‚  993 â”‚                     .FirstOrDefault(e => e.Attribute("Name")?.Value == "Alias");
â”‚       â”‚   â”‚  994 â”‚                 var alias = aliasElement?.Attribute("Value")?.Value;
â”‚       â”‚   â”‚  995 â”‚ 
â”‚       â”‚   â”‚  996 â”‚                 if (!string.IsNullOrEmpty(alias))
â”‚       â”‚   â”‚  997 â”‚                 {
â”‚       â”‚   â”‚  998 â”‚                     obj.SetAlias(alias);
â”‚       â”‚   â”‚  999 â”‚                 }
â”‚       â”‚   â”‚ 1000 â”‚ 
â”‚       â”‚   â”‚ ... (truncated after 1000 lines, 533 more lines)
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ProjectService.cs (8.47 KB, 2025-03-11 14:52:44)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ProjectService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚       â”‚   â”‚    2 â”‚ using System;
â”‚       â”‚   â”‚    3 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    4 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    5 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    6 â”‚ using test.Core.Interfaces;
â”‚       â”‚   â”‚    7 â”‚ using test.Data.Mapping;
â”‚       â”‚   â”‚    8 â”‚ using test.Infrastructure.Logging;
â”‚       â”‚   â”‚    9 â”‚ using test.ViewModels;
â”‚       â”‚   â”‚   10 â”‚ 
â”‚       â”‚   â”‚   11 â”‚ namespace test.Application.Services
â”‚       â”‚   â”‚   12 â”‚ {
â”‚       â”‚   â”‚   13 â”‚     /// <summary>
â”‚       â”‚   â”‚   14 â”‚     /// Service for project-related operations
â”‚       â”‚   â”‚   15 â”‚     /// </summary>
â”‚       â”‚   â”‚   16 â”‚     public class ProjectService
â”‚       â”‚   â”‚   17 â”‚     {
â”‚       â”‚   â”‚   18 â”‚         private readonly IProjectRepository _projectRepository;
â”‚       â”‚   â”‚   19 â”‚         private readonly IErrorHandler _errorHandler;
â”‚       â”‚   â”‚   20 â”‚         private readonly ILogger<ProjectService> _logger;
â”‚       â”‚   â”‚   21 â”‚ 
â”‚       â”‚   â”‚   22 â”‚         /// <summary>
â”‚       â”‚   â”‚   23 â”‚         /// Creates a new project service
â”‚       â”‚   â”‚   24 â”‚         /// </summary>
â”‚       â”‚   â”‚   25 â”‚         /// <param name="projectRepository">The project repository</param>
â”‚       â”‚   â”‚   26 â”‚         /// <param name="errorHandler">The error handler</param>
â”‚       â”‚   â”‚   27 â”‚         /// <param name="logger">The logger</param>
â”‚       â”‚   â”‚   28 â”‚         public ProjectService(
â”‚       â”‚   â”‚   29 â”‚             IProjectRepository projectRepository,
â”‚       â”‚   â”‚   30 â”‚             IErrorHandler errorHandler,
â”‚       â”‚   â”‚   31 â”‚             ILogger<ProjectService> logger)
â”‚       â”‚   â”‚   32 â”‚         {
â”‚       â”‚   â”‚   33 â”‚             _projectRepository = projectRepository ?? throw new ArgumentNullException(nameof(projectRepository));
â”‚       â”‚   â”‚   34 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚       â”‚   â”‚   35 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚       â”‚   â”‚   36 â”‚         }
â”‚       â”‚   â”‚   37 â”‚ 
â”‚       â”‚   â”‚   38 â”‚         /// <summary>
â”‚       â”‚   â”‚   39 â”‚         /// Gets all projects
â”‚       â”‚   â”‚   40 â”‚         /// </summary>
â”‚       â”‚   â”‚   41 â”‚         /// <returns>A collection of project view models</returns>
â”‚       â”‚   â”‚   42 â”‚         public async Task<IEnumerable<ProjectViewModel>> GetAllProjectsAsync()
â”‚       â”‚   â”‚   43 â”‚         {
â”‚       â”‚   â”‚   44 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   45 â”‚             {
â”‚       â”‚   â”‚   46 â”‚                 var projects = await _projectRepository.GetAllAsync();
â”‚       â”‚   â”‚   47 â”‚                 var viewModels = new List<ProjectViewModel>();
â”‚       â”‚   â”‚   48 â”‚ 
â”‚       â”‚   â”‚   49 â”‚                 foreach (var project in projects)
â”‚       â”‚   â”‚   50 â”‚                 {
â”‚       â”‚   â”‚   51 â”‚                     viewModels.Add(ProjectMapper.ToDtoViewModel(project));
â”‚       â”‚   â”‚   52 â”‚                 }
â”‚       â”‚   â”‚   53 â”‚ 
â”‚       â”‚   â”‚   54 â”‚                 return viewModels;
â”‚       â”‚   â”‚   55 â”‚             }, "GetAllProjects");
â”‚       â”‚   â”‚   56 â”‚         }
â”‚       â”‚   â”‚   57 â”‚ 
â”‚       â”‚   â”‚   58 â”‚         /// <summary>
â”‚       â”‚   â”‚   59 â”‚         /// Gets a project by ID
â”‚       â”‚   â”‚   60 â”‚         /// </summary>
â”‚       â”‚   â”‚   61 â”‚         /// <param name="id">The project ID</param>
â”‚       â”‚   â”‚   62 â”‚         /// <returns>The project view model or null if not found</returns>
â”‚       â”‚   â”‚   63 â”‚         public async Task<ProjectViewModel> GetProjectByIdAsync(string id)
â”‚       â”‚   â”‚   64 â”‚         {
â”‚       â”‚   â”‚   65 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   66 â”‚             {
â”‚       â”‚   â”‚   67 â”‚                 var project = await _projectRepository.GetByIdAsync(id);
â”‚       â”‚   â”‚   68 â”‚                 return ProjectMapper.ToDtoViewModel(project);
â”‚       â”‚   â”‚   69 â”‚             }, "GetProjectById");
â”‚       â”‚   â”‚   70 â”‚         }
â”‚       â”‚   â”‚   71 â”‚ 
â”‚       â”‚   â”‚   72 â”‚         /// <summary>
â”‚       â”‚   â”‚   73 â”‚         /// Creates a new project
â”‚       â”‚   â”‚   74 â”‚         /// </summary>
â”‚       â”‚   â”‚   75 â”‚         /// <param name="name">The project name</param>
â”‚       â”‚   â”‚   76 â”‚         /// <param name="description">The project description</param>
â”‚       â”‚   â”‚   77 â”‚         /// <returns>The created project view model</returns>
â”‚       â”‚   â”‚   78 â”‚         public async Task<ProjectViewModel> CreateProjectAsync(string name, string description = "")
â”‚       â”‚   â”‚   79 â”‚         {
â”‚       â”‚   â”‚   80 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚   81 â”‚             {
â”‚       â”‚   â”‚   82 â”‚                 // Generate a new unique ID for the project
â”‚       â”‚   â”‚   83 â”‚                 var projectId = Ulid.NewUlid().ToString();
â”‚       â”‚   â”‚   84 â”‚                 var project = new Project(projectId, name, description);
â”‚       â”‚   â”‚   85 â”‚ 
â”‚       â”‚   â”‚   86 â”‚                 await _projectRepository.CreateAsync(project);
â”‚       â”‚   â”‚   87 â”‚                 return ProjectMapper.ToDtoViewModel(project);
â”‚       â”‚   â”‚   88 â”‚             }, "CreateProject");
â”‚       â”‚   â”‚   89 â”‚         }
â”‚       â”‚   â”‚   90 â”‚ 
â”‚       â”‚   â”‚   91 â”‚         /// <summary>
â”‚       â”‚   â”‚   92 â”‚         /// Updates a project
â”‚       â”‚   â”‚   93 â”‚         /// </summary>
â”‚       â”‚   â”‚   94 â”‚         /// <param name="id">The project ID</param>
â”‚       â”‚   â”‚   95 â”‚         /// <param name="name">The new name</param>
â”‚       â”‚   â”‚   96 â”‚         /// <param name="description">The new description</param>
â”‚       â”‚   â”‚   97 â”‚         /// <returns>The updated project view model</returns>
â”‚       â”‚   â”‚   98 â”‚         public async Task<ProjectViewModel> UpdateProjectAsync(string id, string name, string description)
â”‚       â”‚   â”‚   99 â”‚         {
â”‚       â”‚   â”‚  100 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  101 â”‚             {
â”‚       â”‚   â”‚  102 â”‚                 // Generate a new unique ID for the project
â”‚       â”‚   â”‚  103 â”‚                 var projectId = NUlid.Ulid.NewUlid().ToString();
â”‚       â”‚   â”‚  104 â”‚                 var project = new Project(projectId, name, description);
â”‚       â”‚   â”‚  105 â”‚ 
â”‚       â”‚   â”‚  106 â”‚                 await _projectRepository.CreateAsync(project);
â”‚       â”‚   â”‚  107 â”‚                 return ProjectMapper.ToDtoViewModel(project);
â”‚       â”‚   â”‚  108 â”‚             }, "CreateProject");
â”‚       â”‚   â”‚  109 â”‚         }
â”‚       â”‚   â”‚  110 â”‚ 
â”‚       â”‚   â”‚  111 â”‚         /// <summary>
â”‚       â”‚   â”‚  112 â”‚         /// Deletes a project
â”‚       â”‚   â”‚  113 â”‚         /// </summary>
â”‚       â”‚   â”‚  114 â”‚         /// <param name="id">The project ID</param>
â”‚       â”‚   â”‚  115 â”‚         /// <returns>True if deleted, false if not found</returns>
â”‚       â”‚   â”‚  116 â”‚         public async Task<bool> DeleteProjectAsync(string id)
â”‚       â”‚   â”‚  117 â”‚         {
â”‚       â”‚   â”‚  118 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  119 â”‚             {
â”‚       â”‚   â”‚  120 â”‚                 return await _projectRepository.DeleteAsync(id);
â”‚       â”‚   â”‚  121 â”‚             }, "DeleteProject");
â”‚       â”‚   â”‚  122 â”‚         }
â”‚       â”‚   â”‚  123 â”‚ 
â”‚       â”‚   â”‚  124 â”‚         /// <summary>
â”‚       â”‚   â”‚  125 â”‚         /// Imports a file into a project
â”‚       â”‚   â”‚  126 â”‚         /// </summary>
â”‚       â”‚   â”‚  127 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚  128 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚  129 â”‚         /// <returns>The imported file view model</returns>
â”‚       â”‚   â”‚  130 â”‚         public async Task<ImportedFileViewModel> ImportFileAsync(string projectId, string filePath)
â”‚       â”‚   â”‚  131 â”‚         {
â”‚       â”‚   â”‚  132 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  133 â”‚             {
â”‚       â”‚   â”‚  134 â”‚                 var importedFile = await _projectRepository.ImportFileAsync(projectId, filePath);
â”‚       â”‚   â”‚  135 â”‚                 return ProjectMapper.ToImportedFileViewModel(importedFile);
â”‚       â”‚   â”‚  136 â”‚             }, "ImportFile");
â”‚       â”‚   â”‚  137 â”‚         }
â”‚       â”‚   â”‚  138 â”‚ 
â”‚       â”‚   â”‚  139 â”‚         /// <summary>
â”‚       â”‚   â”‚  140 â”‚         /// Removes a file from a project
â”‚       â”‚   â”‚  141 â”‚         /// </summary>
â”‚       â”‚   â”‚  142 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚  143 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚  144 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚       â”‚   â”‚  145 â”‚         public async Task<bool> RemoveFileAsync(string projectId, string filePath)
â”‚       â”‚   â”‚  146 â”‚         {
â”‚       â”‚   â”‚  147 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  148 â”‚             {
â”‚       â”‚   â”‚  149 â”‚                 return await _projectRepository.RemoveFileAsync(projectId, filePath);
â”‚       â”‚   â”‚  150 â”‚             }, "RemoveFile");
â”‚       â”‚   â”‚  151 â”‚         }
â”‚       â”‚   â”‚  152 â”‚ 
â”‚       â”‚   â”‚  153 â”‚         /// <summary>
â”‚       â”‚   â”‚  154 â”‚         /// Imports a shared type into a project
â”‚       â”‚   â”‚  155 â”‚         /// </summary>
â”‚       â”‚   â”‚  156 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚  157 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚  158 â”‚         /// <param name="typeName">The type name (optional)</param>
â”‚       â”‚   â”‚  159 â”‚         /// <param name="category">The category (optional)</param>
â”‚       â”‚   â”‚  160 â”‚         /// <param name="description">The description (optional)</param>
â”‚       â”‚   â”‚  161 â”‚         /// <returns>The imported shared type view model</returns>
â”‚       â”‚   â”‚  162 â”‚         public async Task<SharedTypeViewModel> ImportSharedTypeAsync(
â”‚       â”‚   â”‚  163 â”‚             string projectId,
â”‚       â”‚   â”‚  164 â”‚             string filePath,
â”‚       â”‚   â”‚  165 â”‚             string typeName = null,
â”‚       â”‚   â”‚  166 â”‚             string category = null,
â”‚       â”‚   â”‚  167 â”‚             string description = null)
â”‚       â”‚   â”‚  168 â”‚         {
â”‚       â”‚   â”‚  169 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  170 â”‚             {
â”‚       â”‚   â”‚  171 â”‚                 var sharedType = await _projectRepository.AddSharedTypeAsync(
â”‚       â”‚   â”‚  172 â”‚                     projectId, filePath, typeName, category, description);
â”‚       â”‚   â”‚  173 â”‚                 return ProjectMapper.ToSharedTypeViewModel(sharedType);
â”‚       â”‚   â”‚  174 â”‚             }, "ImportSharedType");
â”‚       â”‚   â”‚  175 â”‚         }
â”‚       â”‚   â”‚  176 â”‚ 
â”‚       â”‚   â”‚  177 â”‚         /// <summary>
â”‚       â”‚   â”‚  178 â”‚         /// Updates a shared type description
â”‚       â”‚   â”‚  179 â”‚         /// </summary>
â”‚       â”‚   â”‚  180 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚  181 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚  182 â”‚         /// <param name="description">The new description</param>
â”‚       â”‚   â”‚  183 â”‚         /// <returns>True if updated, false if not found</returns>
â”‚       â”‚   â”‚  184 â”‚         public async Task<bool> UpdateSharedTypeDescriptionAsync(string projectId, string filePath, string description)
â”‚       â”‚   â”‚  185 â”‚         {
â”‚       â”‚   â”‚  186 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  187 â”‚             {
â”‚       â”‚   â”‚  188 â”‚                 return await _projectRepository.UpdateSharedTypeDescriptionAsync(projectId, filePath, description);
â”‚       â”‚   â”‚  189 â”‚             }, "UpdateSharedTypeDescription");
â”‚       â”‚   â”‚  190 â”‚         }
â”‚       â”‚   â”‚  191 â”‚ 
â”‚       â”‚   â”‚  192 â”‚         /// <summary>
â”‚       â”‚   â”‚  193 â”‚         /// Removes a shared type from a project
â”‚       â”‚   â”‚  194 â”‚         /// </summary>
â”‚       â”‚   â”‚  195 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚  196 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚  197 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚       â”‚   â”‚  198 â”‚         public async Task<bool> RemoveSharedTypeAsync(string projectId, string filePath)
â”‚       â”‚   â”‚  199 â”‚         {
â”‚       â”‚   â”‚  200 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚       â”‚   â”‚  201 â”‚             {
â”‚       â”‚   â”‚  202 â”‚                 return await _projectRepository.RemoveSharedTypeAsync(projectId, filePath);
â”‚       â”‚   â”‚  203 â”‚             }, "RemoveSharedType");
â”‚       â”‚   â”‚  204 â”‚         }
â”‚       â”‚   â”‚  205 â”‚     }
â”‚       â”‚   â”‚  206 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â””â”€â”€ ğŸ“„ XmlModificationService.cs (14.40 KB, 2025-03-11 15:51:04)
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚           â”‚ FILE CONTENT: XmlModificationService.cs
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚           â”‚    1 â”‚ ï»¿// test/Application/Services/XmlModificationService.cs
â”‚           â”‚    2 â”‚ using Microsoft.Extensions.Logging;
â”‚           â”‚    3 â”‚ using System;
â”‚           â”‚    4 â”‚ using System.Collections.Generic;
â”‚           â”‚    5 â”‚ using System.Linq;
â”‚           â”‚    6 â”‚ using System.Threading.Tasks;
â”‚           â”‚    7 â”‚ using System.Xml.Linq;
â”‚           â”‚    8 â”‚ using test.Core.Domain;
â”‚           â”‚    9 â”‚ using test.Core.Domain.ObjectSet;
â”‚           â”‚   10 â”‚ using test.Core.Interfaces;
â”‚           â”‚   11 â”‚ using test.Infrastructure.Logging;
â”‚           â”‚   12 â”‚ 
â”‚           â”‚   13 â”‚ namespace test.Application.Services
â”‚           â”‚   14 â”‚ {
â”‚           â”‚   15 â”‚     /// <summary>
â”‚           â”‚   16 â”‚     /// Service for modifying XML files with HVAC controller data
â”‚           â”‚   17 â”‚     /// </summary>
â”‚           â”‚   18 â”‚     public class XmlModificationService : IXmlModificationService
â”‚           â”‚   19 â”‚     {
â”‚           â”‚   20 â”‚         private readonly IObjectSetParser _parser;
â”‚           â”‚   21 â”‚         private readonly IObjectSetWriter _writer;
â”‚           â”‚   22 â”‚         private readonly IErrorHandler _errorHandler;
â”‚           â”‚   23 â”‚         private readonly ILogger<XmlModificationService> _logger;
â”‚           â”‚   24 â”‚         private readonly IFileSystem _fileSystem;
â”‚           â”‚   25 â”‚ 
â”‚           â”‚   26 â”‚         /// <summary>
â”‚           â”‚   27 â”‚         /// Creates a new XML modification service
â”‚           â”‚   28 â”‚         /// </summary>
â”‚           â”‚   29 â”‚         public XmlModificationService(
â”‚           â”‚   30 â”‚             IObjectSetParser parser,
â”‚           â”‚   31 â”‚             IObjectSetWriter writer,
â”‚           â”‚   32 â”‚             IErrorHandler errorHandler,
â”‚           â”‚   33 â”‚             ILogger<XmlModificationService> logger,
â”‚           â”‚   34 â”‚             IFileSystem fileSystem)
â”‚           â”‚   35 â”‚         {
â”‚           â”‚   36 â”‚             _parser = parser ?? throw new ArgumentNullException(nameof(parser));
â”‚           â”‚   37 â”‚             _writer = writer ?? throw new ArgumentNullException(nameof(writer));
â”‚           â”‚   38 â”‚             _errorHandler = errorHandler ?? throw new ArgumentNullException(nameof(errorHandler));
â”‚           â”‚   39 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚           â”‚   40 â”‚             _fileSystem = fileSystem ?? throw new ArgumentNullException(nameof(fileSystem));
â”‚           â”‚   41 â”‚         }
â”‚           â”‚   42 â”‚ 
â”‚           â”‚   43 â”‚         /// <inheritdoc/>
â”‚           â”‚   44 â”‚         public async Task<bool> UpdateVariableUnitValuesAsync(string filePath, string variableName, string newUnit)
â”‚           â”‚   45 â”‚         {
â”‚           â”‚   46 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚           â”‚   47 â”‚             {
â”‚           â”‚   48 â”‚                 // 1. Parse the XML file
â”‚           â”‚   49 â”‚                 var parseConfig = new ObjectSetParsingOptions
â”‚           â”‚   50 â”‚                 {
â”‚           â”‚   51 â”‚                     IncludeTypeDefinitions = true,  // We need type definitions since we're modifying variables
â”‚           â”‚   52 â”‚                     IncludeExportedObjects = false  // We don't need exported objects for this operation
â”‚           â”‚   53 â”‚                 };
â”‚           â”‚   54 â”‚ 
â”‚           â”‚   55 â”‚                 var content = await _fileSystem.ReadAllTextAsync(filePath);
â”‚           â”‚   56 â”‚                 var document = XDocument.Parse(content);
â”‚           â”‚   57 â”‚                 var parseResult = await _parser.ParseAsync(document, parseConfig);
â”‚           â”‚   58 â”‚ 
â”‚           â”‚   59 â”‚                 if (!parseResult.Success)
â”‚           â”‚   60 â”‚                 {
â”‚           â”‚   61 â”‚                     _logger.LogError("Failed to parse XML: {Error}", parseResult.ErrorMessage);
â”‚           â”‚   62 â”‚                     return false;
â”‚           â”‚   63 â”‚                 }
â”‚           â”‚   64 â”‚ 
â”‚           â”‚   65 â”‚                 // 2. Find and modify the target variables
â”‚           â”‚   66 â”‚                 var modified = false;
â”‚           â”‚   67 â”‚                 foreach (var type in parseResult.Types)
â”‚           â”‚   68 â”‚                 {
â”‚           â”‚   69 â”‚                     foreach (var tab in type.PropertyTabs)
â”‚           â”‚   70 â”‚                     {
â”‚           â”‚   71 â”‚                         foreach (var group in tab.PropertyGroups)
â”‚           â”‚   72 â”‚                         {
â”‚           â”‚   73 â”‚                             var targetVars = group.Variables
â”‚           â”‚   74 â”‚                                 .Where(v => v.Name.Equals(variableName, StringComparison.OrdinalIgnoreCase));
â”‚           â”‚   75 â”‚ 
â”‚           â”‚   76 â”‚                             foreach (var variable in targetVars)
â”‚           â”‚   77 â”‚                             {
â”‚           â”‚   78 â”‚                                 variable.Unit = newUnit;
â”‚           â”‚   79 â”‚                                 modified = true;
â”‚           â”‚   80 â”‚                             }
â”‚           â”‚   81 â”‚                         }
â”‚           â”‚   82 â”‚                     }
â”‚           â”‚   83 â”‚                 }
â”‚           â”‚   84 â”‚ 
â”‚           â”‚   85 â”‚                 if (!modified)
â”‚           â”‚   86 â”‚                 {
â”‚           â”‚   87 â”‚                     _logger.LogWarning("No matching variables found to update");
â”‚           â”‚   88 â”‚                     return false;
â”‚           â”‚   89 â”‚                 }
â”‚           â”‚   90 â”‚ 
â”‚           â”‚   91 â”‚                 // 3. Convert to controllers and write back to file
â”‚           â”‚   92 â”‚                 // Since we're updating type definitions, we need to include them in the write options
â”‚           â”‚   93 â”‚                 var writerOptions = new ObjectSetWriteOptions
â”‚           â”‚   94 â”‚                 {
â”‚           â”‚   95 â”‚                     TypeDefinitions = parseResult.Types,
â”‚           â”‚   96 â”‚                     PrettyPrint = true
â”‚           â”‚   97 â”‚                 };
â”‚           â”‚   98 â”‚ 
â”‚           â”‚   99 â”‚                 // Create empty controllers list - we're only updating type definitions
â”‚           â”‚  100 â”‚                 var controllers = new List<Controller>();
â”‚           â”‚  101 â”‚                 var resultDoc = await _writer.WriteAsync(controllers, writerOptions);
â”‚           â”‚  102 â”‚                 await _fileSystem.WriteAllTextAsync(filePath, resultDoc.ToString());
â”‚           â”‚  103 â”‚ 
â”‚           â”‚  104 â”‚                 return true;
â”‚           â”‚  105 â”‚             }, "UpdateVariableUnitValues");
â”‚           â”‚  106 â”‚         }
â”‚           â”‚  107 â”‚ 
â”‚           â”‚  108 â”‚         /// <inheritdoc/>
â”‚           â”‚  109 â”‚         public async Task<bool> UpdateObjectValueAsync(string filePath, string objectName, string newValue)
â”‚           â”‚  110 â”‚         {
â”‚           â”‚  111 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚           â”‚  112 â”‚             {
â”‚           â”‚  113 â”‚                 // 1. Parse the XML file
â”‚           â”‚  114 â”‚                 var parseConfig = new ObjectSetParsingOptions
â”‚           â”‚  115 â”‚                 {
â”‚           â”‚  116 â”‚                     IncludeTypeDefinitions = false,   // We don't need type definitions for this operation
â”‚           â”‚  117 â”‚                     IncludeExportedObjects = true     // We need exported objects since we're modifying them
â”‚           â”‚  118 â”‚                 };
â”‚           â”‚  119 â”‚ 
â”‚           â”‚  120 â”‚                 var content = await _fileSystem.ReadAllTextAsync(filePath);
â”‚           â”‚  121 â”‚                 var document = XDocument.Parse(content);
â”‚           â”‚  122 â”‚                 var parseResult = await _parser.ParseAsync(document, parseConfig);
â”‚           â”‚  123 â”‚ 
â”‚           â”‚  124 â”‚                 if (!parseResult.Success)
â”‚           â”‚  125 â”‚                 {
â”‚           â”‚  126 â”‚                     _logger.LogError("Failed to parse XML: {Error}", parseResult.ErrorMessage);
â”‚           â”‚  127 â”‚                     return false;
â”‚           â”‚  128 â”‚                 }
â”‚           â”‚  129 â”‚ 
â”‚           â”‚  130 â”‚                 // 2. Find and update the target object value
â”‚           â”‚  131 â”‚                 var modified = false;
â”‚           â”‚  132 â”‚                 foreach (var obj in parseResult.ExportedObjects)
â”‚           â”‚  133 â”‚                 {
â”‚           â”‚  134 â”‚                     modified |= UpdateObjectValueRecursive(obj, objectName, newValue);
â”‚           â”‚  135 â”‚                 }
â”‚           â”‚  136 â”‚ 
â”‚           â”‚  137 â”‚                 if (!modified)
â”‚           â”‚  138 â”‚                 {
â”‚           â”‚  139 â”‚                     _logger.LogWarning("No matching objects found to update");
â”‚           â”‚  140 â”‚                     return false;
â”‚           â”‚  141 â”‚                 }
â”‚           â”‚  142 â”‚ 
â”‚           â”‚  143 â”‚                 // 3. Convert exported objects to controllers and write back to file
â”‚           â”‚  144 â”‚                 var controllers = ConvertExportedObjectsToControllers(parseResult.ExportedObjects);
â”‚           â”‚  145 â”‚                 var writerOptions = new ObjectSetWriteOptions
â”‚           â”‚  146 â”‚                 {
â”‚           â”‚  147 â”‚                     PrettyPrint = true
â”‚           â”‚  148 â”‚                 };
â”‚           â”‚  149 â”‚ 
â”‚           â”‚  150 â”‚                 var resultDoc = await _writer.WriteAsync(controllers, writerOptions);
â”‚           â”‚  151 â”‚                 await _fileSystem.WriteAllTextAsync(filePath, resultDoc.ToString());
â”‚           â”‚  152 â”‚ 
â”‚           â”‚  153 â”‚                 return true;
â”‚           â”‚  154 â”‚             }, "UpdateObjectValue");
â”‚           â”‚  155 â”‚         }
â”‚           â”‚  156 â”‚ 
â”‚           â”‚  157 â”‚         /// <inheritdoc/>
â”‚           â”‚  158 â”‚         public async Task<bool> UpdateNumericValuesAsync(string filePath, Func<string, double, double> transformationFunc)
â”‚           â”‚  159 â”‚         {
â”‚           â”‚  160 â”‚             return await _errorHandler.WithErrorHandlingAsync(async () =>
â”‚           â”‚  161 â”‚             {
â”‚           â”‚  162 â”‚                 var parseConfig = new ObjectSetParsingOptions
â”‚           â”‚  163 â”‚                 {
â”‚           â”‚  164 â”‚                     IncludeTypeDefinitions = false,
â”‚           â”‚  165 â”‚                     IncludeExportedObjects = true
â”‚           â”‚  166 â”‚                 };
â”‚           â”‚  167 â”‚ 
â”‚           â”‚  168 â”‚                 var content = await _fileSystem.ReadAllTextAsync(filePath);
â”‚           â”‚  169 â”‚                 var document = XDocument.Parse(content);
â”‚           â”‚  170 â”‚                 var parseResult = await _parser.ParseAsync(document, parseConfig);
â”‚           â”‚  171 â”‚ 
â”‚           â”‚  172 â”‚                 if (!parseResult.Success) return false;
â”‚           â”‚  173 â”‚ 
â”‚           â”‚  174 â”‚                 var modified = false;
â”‚           â”‚  175 â”‚                 foreach (var obj in parseResult.ExportedObjects)
â”‚           â”‚  176 â”‚                 {
â”‚           â”‚  177 â”‚                     modified |= TransformNumericValuesRecursive(obj, transformationFunc);
â”‚           â”‚  178 â”‚                 }
â”‚           â”‚  179 â”‚ 
â”‚           â”‚  180 â”‚                 if (!modified) return false;
â”‚           â”‚  181 â”‚ 
â”‚           â”‚  182 â”‚                 // Convert exported objects to controllers and write back to file
â”‚           â”‚  183 â”‚                 var controllers = ConvertExportedObjectsToControllers(parseResult.ExportedObjects);
â”‚           â”‚  184 â”‚                 var writerOptions = new ObjectSetWriteOptions
â”‚           â”‚  185 â”‚                 {
â”‚           â”‚  186 â”‚                     PrettyPrint = true
â”‚           â”‚  187 â”‚                 };
â”‚           â”‚  188 â”‚ 
â”‚           â”‚  189 â”‚                 var resultDoc = await _writer.WriteAsync(controllers, writerOptions);
â”‚           â”‚  190 â”‚                 await _fileSystem.WriteAllTextAsync(filePath, resultDoc.ToString());
â”‚           â”‚  191 â”‚ 
â”‚           â”‚  192 â”‚                 return true;
â”‚           â”‚  193 â”‚             }, "UpdateNumericValues");
â”‚           â”‚  194 â”‚         }
â”‚           â”‚  195 â”‚ 
â”‚           â”‚  196 â”‚         #region Helper Methods
â”‚           â”‚  197 â”‚ 
â”‚           â”‚  198 â”‚         /// <summary>
â”‚           â”‚  199 â”‚         /// Converts exported objects to controllers for writing back to file
â”‚           â”‚  200 â”‚         /// </summary>
â”‚           â”‚  201 â”‚         private List<Controller> ConvertExportedObjectsToControllers(List<ExportedObject> exportedObjects)
â”‚           â”‚  202 â”‚         {
â”‚           â”‚  203 â”‚             var controllers = new List<Controller>();
â”‚           â”‚  204 â”‚ 
â”‚           â”‚  205 â”‚             foreach (var exportedObj in exportedObjects)
â”‚           â”‚  206 â”‚             {
â”‚           â”‚  207 â”‚                 // Get controller name and type
â”‚           â”‚  208 â”‚                 exportedObj.Properties.TryGetValue("Name", out string name);
â”‚           â”‚  209 â”‚                 exportedObj.Properties.TryGetValue("TYPE", out string type);
â”‚           â”‚  210 â”‚ 
â”‚           â”‚  211 â”‚                 if (type == "InfinityInfinetCtlr" || type == "Controller")
â”‚           â”‚  212 â”‚                 {
â”‚           â”‚  213 â”‚                     // Create controller
â”‚           â”‚  214 â”‚                     var controller = new Controller(name ?? "Unknown", "Unknown");
â”‚           â”‚  215 â”‚ 
â”‚           â”‚  216 â”‚                     // Add all properties
â”‚           â”‚  217 â”‚                     foreach (var prop in exportedObj.Properties)
â”‚           â”‚  218 â”‚                     {
â”‚           â”‚  219 â”‚                         if (prop.Key != "Name" && prop.Key != "TYPE")
â”‚           â”‚  220 â”‚                         {
â”‚           â”‚  221 â”‚                             controller.SetProperty(prop.Key, prop.Value);
â”‚           â”‚  222 â”‚                         }
â”‚           â”‚  223 â”‚                     }
â”‚           â”‚  224 â”‚ 
â”‚           â”‚  225 â”‚                     // Process child objects - they would need to be converted to ControllerObject instances
â”‚           â”‚  226 â”‚                     // This is a simplified conversion - in a real implementation, you would need to
â”‚           â”‚  227 â”‚                     // convert all the child objects recursively
â”‚           â”‚  228 â”‚                     foreach (var child in exportedObj.Children)
â”‚           â”‚  229 â”‚                     {
â”‚           â”‚  230 â”‚                         ConvertExportedObjectToControllerObject(child, controller);
â”‚           â”‚  231 â”‚                     }
â”‚           â”‚  232 â”‚ 
â”‚           â”‚  233 â”‚                     controllers.Add(controller);
â”‚           â”‚  234 â”‚                 }
â”‚           â”‚  235 â”‚             }
â”‚           â”‚  236 â”‚ 
â”‚           â”‚  237 â”‚             return controllers;
â”‚           â”‚  238 â”‚         }
â”‚           â”‚  239 â”‚ 
â”‚           â”‚  240 â”‚         /// <summary>
â”‚           â”‚  241 â”‚         /// Converts an exported object to a controller object and adds it to the controller
â”‚           â”‚  242 â”‚         /// </summary>
â”‚           â”‚  243 â”‚         private void ConvertExportedObjectToControllerObject(ExportedObject exportedObj, Controller controller)
â”‚           â”‚  244 â”‚         {
â”‚           â”‚  245 â”‚             // Get object name, type, and value
â”‚           â”‚  246 â”‚             exportedObj.Properties.TryGetValue("Name", out string name);
â”‚           â”‚  247 â”‚             exportedObj.Properties.TryGetValue("TYPE", out string type);
â”‚           â”‚  248 â”‚             exportedObj.Properties.TryGetValue("Value", out string value);
â”‚           â”‚  249 â”‚ 
â”‚           â”‚  250 â”‚             if (!string.IsNullOrEmpty(name))
â”‚           â”‚  251 â”‚             {
â”‚           â”‚  252 â”‚                 // Create controller object
â”‚           â”‚  253 â”‚                 var controllerObj = new ControllerObject(type ?? "Unknown", name, value ?? "");
â”‚           â”‚  254 â”‚ 
â”‚           â”‚  255 â”‚                 // Add all properties
â”‚           â”‚  256 â”‚                 foreach (var prop in exportedObj.Properties)
â”‚           â”‚  257 â”‚                 {
â”‚           â”‚  258 â”‚                     if (prop.Key != "Name" && prop.Key != "TYPE" && prop.Key != "Value")
â”‚           â”‚  259 â”‚                     {
â”‚           â”‚  260 â”‚                         controllerObj.SetProperty(prop.Key, prop.Value);
â”‚           â”‚  261 â”‚                     }
â”‚           â”‚  262 â”‚                 }
â”‚           â”‚  263 â”‚ 
â”‚           â”‚  264 â”‚                 // Process child objects recursively
â”‚           â”‚  265 â”‚                 foreach (var child in exportedObj.Children)
â”‚           â”‚  266 â”‚                 {
â”‚           â”‚  267 â”‚                     ConvertExportedObjectToControllerObjectChild(child, controllerObj);
â”‚           â”‚  268 â”‚                 }
â”‚           â”‚  269 â”‚ 
â”‚           â”‚  270 â”‚                 // Add to controller
â”‚           â”‚  271 â”‚                 controller.AddObject(controllerObj);
â”‚           â”‚  272 â”‚             }
â”‚           â”‚  273 â”‚         }
â”‚           â”‚  274 â”‚ 
â”‚           â”‚  275 â”‚         /// <summary>
â”‚           â”‚  276 â”‚         /// Converts an exported object to a controller object and adds it as a child
â”‚           â”‚  277 â”‚         /// </summary>
â”‚           â”‚  278 â”‚         private void ConvertExportedObjectToControllerObjectChild(ExportedObject exportedObj, ControllerObject parent)
â”‚           â”‚  279 â”‚         {
â”‚           â”‚  280 â”‚             // Get object name, type, and value
â”‚           â”‚  281 â”‚             exportedObj.Properties.TryGetValue("Name", out string name);
â”‚           â”‚  282 â”‚             exportedObj.Properties.TryGetValue("TYPE", out string type);
â”‚           â”‚  283 â”‚             exportedObj.Properties.TryGetValue("Value", out string value);
â”‚           â”‚  284 â”‚ 
â”‚           â”‚  285 â”‚             if (!string.IsNullOrEmpty(name))
â”‚           â”‚  286 â”‚             {
â”‚           â”‚  287 â”‚                 // Create controller object
â”‚           â”‚  288 â”‚                 var controllerObj = new ControllerObject(type ?? "Unknown", name, value ?? "");
â”‚           â”‚  289 â”‚ 
â”‚           â”‚  290 â”‚                 // Add all properties
â”‚           â”‚  291 â”‚                 foreach (var prop in exportedObj.Properties)
â”‚           â”‚  292 â”‚                 {
â”‚           â”‚  293 â”‚                     if (prop.Key != "Name" && prop.Key != "TYPE" && prop.Key != "Value")
â”‚           â”‚  294 â”‚                     {
â”‚           â”‚  295 â”‚                         controllerObj.SetProperty(prop.Key, prop.Value);
â”‚           â”‚  296 â”‚                     }
â”‚           â”‚  297 â”‚                 }
â”‚           â”‚  298 â”‚ 
â”‚           â”‚  299 â”‚                 // Process child objects recursively
â”‚           â”‚  300 â”‚                 foreach (var child in exportedObj.Children)
â”‚           â”‚  301 â”‚                 {
â”‚           â”‚  302 â”‚                     ConvertExportedObjectToControllerObjectChild(child, controllerObj);
â”‚           â”‚  303 â”‚                 }
â”‚           â”‚  304 â”‚ 
â”‚           â”‚  305 â”‚                 // Add to parent
â”‚           â”‚  306 â”‚                 parent.AddChild(controllerObj);
â”‚           â”‚  307 â”‚             }
â”‚           â”‚  308 â”‚         }
â”‚           â”‚  309 â”‚ 
â”‚           â”‚  310 â”‚         /// <summary>
â”‚           â”‚  311 â”‚         /// Recursively updates object values
â”‚           â”‚  312 â”‚         /// </summary>
â”‚           â”‚  313 â”‚         private bool UpdateObjectValueRecursive(ExportedObject obj, string targetName, string newValue)
â”‚           â”‚  314 â”‚         {
â”‚           â”‚  315 â”‚             var modified = false;
â”‚           â”‚  316 â”‚ 
â”‚           â”‚  317 â”‚             // Check if this is our target object
â”‚           â”‚  318 â”‚             if (obj.Properties.TryGetValue("Name", out var name) &&
â”‚           â”‚  319 â”‚                 name.Equals(targetName, StringComparison.OrdinalIgnoreCase))
â”‚           â”‚  320 â”‚             {
â”‚           â”‚  321 â”‚                 obj.Properties["Value"] = newValue;
â”‚           â”‚  322 â”‚                 modified = true;
â”‚           â”‚  323 â”‚             }
â”‚           â”‚  324 â”‚ 
â”‚           â”‚  325 â”‚             // Recursively check children
â”‚           â”‚  326 â”‚             foreach (var child in obj.Children)
â”‚           â”‚  327 â”‚             {
â”‚           â”‚  328 â”‚                 modified |= UpdateObjectValueRecursive(child, targetName, newValue);
â”‚           â”‚  329 â”‚             }
â”‚           â”‚  330 â”‚ 
â”‚           â”‚  331 â”‚             return modified;
â”‚           â”‚  332 â”‚         }
â”‚           â”‚  333 â”‚ 
â”‚           â”‚  334 â”‚         /// <summary>
â”‚           â”‚  335 â”‚         /// Recursively transforms numeric values
â”‚           â”‚  336 â”‚         /// </summary>
â”‚           â”‚  337 â”‚         private bool TransformNumericValuesRecursive(
â”‚           â”‚  338 â”‚             ExportedObject obj,
â”‚           â”‚  339 â”‚             Func<string, double, double> transformationFunc)
â”‚           â”‚  340 â”‚         {
â”‚           â”‚  341 â”‚             var modified = false;
â”‚           â”‚  342 â”‚ 
â”‚           â”‚  343 â”‚             // Try to transform any numeric values
â”‚           â”‚  344 â”‚             if (obj.Properties.TryGetValue("Value", out var valueStr) &&
â”‚           â”‚  345 â”‚                 double.TryParse(valueStr, out var numericValue))
â”‚           â”‚  346 â”‚             {
â”‚           â”‚  347 â”‚                 var newValue = transformationFunc(obj.Name, numericValue);
â”‚           â”‚  348 â”‚                 obj.Properties["Value"] = newValue.ToString("F2");
â”‚           â”‚  349 â”‚                 modified = true;
â”‚           â”‚  350 â”‚             }
â”‚           â”‚  351 â”‚ 
â”‚           â”‚  352 â”‚             // Recursively process children
â”‚           â”‚  353 â”‚             foreach (var child in obj.Children)
â”‚           â”‚  354 â”‚             {
â”‚           â”‚  355 â”‚                 modified |= TransformNumericValuesRecursive(child, transformationFunc);
â”‚           â”‚  356 â”‚             }
â”‚           â”‚  357 â”‚ 
â”‚           â”‚  358 â”‚             return modified;
â”‚           â”‚  359 â”‚         }
â”‚           â”‚  360 â”‚ 
â”‚           â”‚  361 â”‚         #endregion
â”‚           â”‚  362 â”‚     }
â”‚           â”‚  363 â”‚ }
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   ğŸ“ Core
â”‚   â”‚   ğŸ“ Domain
â”‚   â”‚   â”‚   ğŸ“ ObjectSet
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ObjectSetModels.cs (3.50 KB, 2025-03-11 14:55:53)
â”‚   â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚       â”‚ FILE CONTENT: ObjectSetModels.cs
â”‚   â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚       â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚       â”‚    3 â”‚ 
â”‚   â”‚   â”‚       â”‚    4 â”‚ namespace test.Core.Domain.ObjectSet
â”‚   â”‚   â”‚       â”‚    5 â”‚ {
â”‚   â”‚   â”‚       â”‚    6 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚    7 â”‚     /// Contains metadata information from an ObjectSet XML file
â”‚   â”‚   â”‚       â”‚    8 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚    9 â”‚     public class MetaInformation
â”‚   â”‚   â”‚       â”‚   10 â”‚     {
â”‚   â”‚   â”‚       â”‚   11 â”‚         public string ExportMode { get; set; }
â”‚   â”‚   â”‚       â”‚   12 â”‚         public string SemanticsFilter { get; set; }
â”‚   â”‚   â”‚       â”‚   13 â”‚         public string RuntimeVersion { get; set; }
â”‚   â”‚   â”‚       â”‚   14 â”‚         public string SourceVersion { get; set; }
â”‚   â”‚   â”‚       â”‚   15 â”‚         public string ServerFullPath { get; set; }
â”‚   â”‚   â”‚       â”‚   16 â”‚     }
â”‚   â”‚   â”‚       â”‚   17 â”‚ 
â”‚   â”‚   â”‚       â”‚   18 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   19 â”‚     /// Definition of an object type from an ObjectSet XML file
â”‚   â”‚   â”‚       â”‚   20 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   21 â”‚     public class ObjectTypeDefinition
â”‚   â”‚   â”‚       â”‚   22 â”‚     {
â”‚   â”‚   â”‚       â”‚   23 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚       â”‚   24 â”‚         public string DisplayName { get; set; }
â”‚   â”‚   â”‚       â”‚   25 â”‚         public string Description { get; set; }
â”‚   â”‚   â”‚       â”‚   26 â”‚         public List<PropertyTab> PropertyTabs { get; set; } = new();
â”‚   â”‚   â”‚       â”‚   27 â”‚     }
â”‚   â”‚   â”‚       â”‚   28 â”‚ 
â”‚   â”‚   â”‚       â”‚   29 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   30 â”‚     /// A property tab in an object type definition
â”‚   â”‚   â”‚       â”‚   31 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   32 â”‚     public class PropertyTab
â”‚   â”‚   â”‚       â”‚   33 â”‚     {
â”‚   â”‚   â”‚       â”‚   34 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚       â”‚   35 â”‚         public List<PropertyGroup> PropertyGroups { get; set; } = new();
â”‚   â”‚   â”‚       â”‚   36 â”‚     }
â”‚   â”‚   â”‚       â”‚   37 â”‚ 
â”‚   â”‚   â”‚       â”‚   38 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   39 â”‚     /// A property group in a property tab
â”‚   â”‚   â”‚       â”‚   40 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   41 â”‚     public class PropertyGroup
â”‚   â”‚   â”‚       â”‚   42 â”‚     {
â”‚   â”‚   â”‚       â”‚   43 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚       â”‚   44 â”‚         public List<Parameter> Parameters { get; set; } = new();
â”‚   â”‚   â”‚       â”‚   45 â”‚         public List<Variable> Variables { get; set; } = new();
â”‚   â”‚   â”‚       â”‚   46 â”‚     }
â”‚   â”‚   â”‚       â”‚   47 â”‚ 
â”‚   â”‚   â”‚       â”‚   48 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   49 â”‚     /// A parameter definition
â”‚   â”‚   â”‚       â”‚   50 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   51 â”‚     public class Parameter
â”‚   â”‚   â”‚       â”‚   52 â”‚     {
â”‚   â”‚   â”‚       â”‚   53 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚       â”‚   54 â”‚         public string DisplayName { get; set; }
â”‚   â”‚   â”‚       â”‚   55 â”‚         public string Description { get; set; }
â”‚   â”‚   â”‚       â”‚   56 â”‚         public ParameterType Type { get; set; }
â”‚   â”‚   â”‚       â”‚   57 â”‚         public string Unit { get; set; }
â”‚   â”‚   â”‚       â”‚   58 â”‚         public string InitValue { get; set; }
â”‚   â”‚   â”‚       â”‚   59 â”‚         public string FileContents { get; set; }
â”‚   â”‚   â”‚       â”‚   60 â”‚     }
â”‚   â”‚   â”‚       â”‚   61 â”‚ 
â”‚   â”‚   â”‚       â”‚   62 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   63 â”‚     /// A variable definition
â”‚   â”‚   â”‚       â”‚   64 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   65 â”‚     public class Variable
â”‚   â”‚   â”‚       â”‚   66 â”‚     {
â”‚   â”‚   â”‚       â”‚   67 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚       â”‚   68 â”‚         public string DisplayName { get; set; }
â”‚   â”‚   â”‚       â”‚   69 â”‚         public string Description { get; set; }
â”‚   â”‚   â”‚       â”‚   70 â”‚         public ParameterType Type { get; set; }
â”‚   â”‚   â”‚       â”‚   71 â”‚         public string Unit { get; set; }
â”‚   â”‚   â”‚       â”‚   72 â”‚         public Runtime Runtime { get; set; }
â”‚   â”‚   â”‚       â”‚   73 â”‚     }
â”‚   â”‚   â”‚       â”‚   74 â”‚ 
â”‚   â”‚   â”‚       â”‚   75 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   76 â”‚     /// Runtime properties for a variable
â”‚   â”‚   â”‚       â”‚   77 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   78 â”‚     public class Runtime
â”‚   â”‚   â”‚       â”‚   79 â”‚     {
â”‚   â”‚   â”‚       â”‚   80 â”‚         public bool ReadOnly { get; set; }
â”‚   â”‚   â”‚       â”‚   81 â”‚         public string RetainLevel { get; set; }
â”‚   â”‚   â”‚       â”‚   82 â”‚         public bool Forceable { get; set; }
â”‚   â”‚   â”‚       â”‚   83 â”‚         public string InitValue { get; set; }
â”‚   â”‚   â”‚       â”‚   84 â”‚     }
â”‚   â”‚   â”‚       â”‚   85 â”‚ 
â”‚   â”‚   â”‚       â”‚   86 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   87 â”‚     /// Type information for a parameter or variable
â”‚   â”‚   â”‚       â”‚   88 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   89 â”‚     public class ParameterType
â”‚   â”‚   â”‚       â”‚   90 â”‚     {
â”‚   â”‚   â”‚       â”‚   91 â”‚         public string Value { get; set; }
â”‚   â”‚   â”‚       â”‚   92 â”‚     }
â”‚   â”‚   â”‚       â”‚   93 â”‚ 
â”‚   â”‚   â”‚       â”‚   94 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   95 â”‚     /// Represents an exported object from an ObjectSet XML file
â”‚   â”‚   â”‚       â”‚   96 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   97 â”‚     public class ExportedObject
â”‚   â”‚   â”‚       â”‚   98 â”‚     {
â”‚   â”‚   â”‚       â”‚   99 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚       â”‚  100 â”‚         public string Value { get; set; }
â”‚   â”‚   â”‚       â”‚  101 â”‚         public List<ExportedObject> Children { get; set; } = new();
â”‚   â”‚   â”‚       â”‚  102 â”‚         public Dictionary<string, string> Properties { get; set; } = new();
â”‚   â”‚   â”‚       â”‚  103 â”‚     }
â”‚   â”‚   â”‚       â”‚  104 â”‚ 
â”‚   â”‚   â”‚       â”‚  105 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚  106 â”‚     /// Result of parsing an ObjectSet XML file
â”‚   â”‚   â”‚       â”‚  107 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚  108 â”‚     public class ObjectSetParseResult
â”‚   â”‚   â”‚       â”‚  109 â”‚     {
â”‚   â”‚   â”‚       â”‚  110 â”‚         public MetaInformation MetaInfo { get; set; }
â”‚   â”‚   â”‚       â”‚  111 â”‚         public List<ObjectTypeDefinition> Types { get; set; } = new();
â”‚   â”‚   â”‚       â”‚  112 â”‚         public List<ExportedObject> ExportedObjects { get; set; } = new();
â”‚   â”‚   â”‚       â”‚  113 â”‚         public bool Success { get; set; }
â”‚   â”‚   â”‚       â”‚  114 â”‚         public string ErrorMessage { get; set; }
â”‚   â”‚   â”‚       â”‚  115 â”‚     }
â”‚   â”‚   â”‚       â”‚  116 â”‚ }
â”‚   â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Controller.cs (7.35 KB, 2025-03-11 14:52:32)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: Controller.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Represents an HVAC controller in the system.
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Core domain entity that encapsulates controller-specific business rules.
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public class Controller
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         private readonly List<ControllerObject> _objects = new();
â”‚   â”‚   â”‚   â”‚   16 â”‚         private readonly Dictionary<string, string> _properties = new(StringComparer.OrdinalIgnoreCase);
â”‚   â”‚   â”‚   â”‚   17 â”‚ 
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// The unique name of the controller
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// 
â”‚   â”‚   â”‚   â”‚   22 â”‚         public string Name { get; private set; }
â”‚   â”‚   â”‚   â”‚   23 â”‚ 
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   25 â”‚         /// The model number of the controller
â”‚   â”‚   â”‚   â”‚   26 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚         public string Model { get; private set; }
â”‚   â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚         /// Port information for the controller
â”‚   â”‚   â”‚   â”‚   31 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   32 â”‚         public string Port { get; private set; }
â”‚   â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   35 â”‚         /// Serial number of the controller
â”‚   â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   37 â”‚         public string SerialNumber { get; private set; }
â”‚   â”‚   â”‚   â”‚   38 â”‚ 
â”‚   â”‚   â”‚   â”‚   39 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   40 â”‚         /// InfinetId of the controller
â”‚   â”‚   â”‚   â”‚   41 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   42 â”‚         public string InfinetId { get; private set; }
â”‚   â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   46 â”‚         /// Gets the controller family based on the model
â”‚   â”‚   â”‚   â”‚   47 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   48 â”‚         public ControllerModelInfo.ControllerFamily Family =>
â”‚   â”‚   â”‚   â”‚   49 â”‚             ControllerModelInfo.DetermineControllerFamily(Model);
â”‚   â”‚   â”‚   â”‚   50 â”‚ 
â”‚   â”‚   â”‚   â”‚   51 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   52 â”‚         /// Gets the model properties if available
â”‚   â”‚   â”‚   â”‚   53 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   54 â”‚         public ControllerModelInfo.ModelProperties ModelProperties =>
â”‚   â”‚   â”‚   â”‚   55 â”‚             ControllerModelInfo.GetModelProperties(Model);
â”‚   â”‚   â”‚   â”‚   56 â”‚ 
â”‚   â”‚   â”‚   â”‚   57 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   58 â”‚         /// Gets the number of analog outputs for this controller model
â”‚   â”‚   â”‚   â”‚   59 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   60 â”‚         public int AnalogOutputs => ModelProperties?.AnalogOutputs ?? 0;
â”‚   â”‚   â”‚   â”‚   61 â”‚ 
â”‚   â”‚   â”‚   â”‚   62 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   63 â”‚         /// Gets the number of digital outputs for this controller model
â”‚   â”‚   â”‚   â”‚   64 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   65 â”‚         public int DigitalOutputs => ModelProperties?.DigitalOutputs ?? 0;
â”‚   â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   â”‚   67 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   68 â”‚         /// Gets the number of digital inputs for this controller model
â”‚   â”‚   â”‚   â”‚   69 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   70 â”‚         public int DigitalInputs => ModelProperties?.DigitalInputs ?? 0;
â”‚   â”‚   â”‚   â”‚   71 â”‚ 
â”‚   â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   â”‚   73 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   74 â”‚         /// Read-only collection of objects contained in this controller
â”‚   â”‚   â”‚   â”‚   75 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   76 â”‚         public IReadOnlyCollection<ControllerObject> Objects => _objects.AsReadOnly();
â”‚   â”‚   â”‚   â”‚   77 â”‚ 
â”‚   â”‚   â”‚   â”‚   78 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   79 â”‚         /// Read-only dictionary of additional properties for this controller
â”‚   â”‚   â”‚   â”‚   80 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   81 â”‚         public IReadOnlyDictionary<string, string> Properties => _properties;
â”‚   â”‚   â”‚   â”‚   82 â”‚ 
â”‚   â”‚   â”‚   â”‚   83 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   84 â”‚         /// Creates a new controller instance
â”‚   â”‚   â”‚   â”‚   85 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   86 â”‚         /// <param name="name">The name of the controller</param>
â”‚   â”‚   â”‚   â”‚   87 â”‚         /// <param name="model">The model number</param>
â”‚   â”‚   â”‚   â”‚   88 â”‚         public Controller(string name, string model)
â”‚   â”‚   â”‚   â”‚   89 â”‚         {
â”‚   â”‚   â”‚   â”‚   90 â”‚             if (string.IsNullOrWhiteSpace(name))
â”‚   â”‚   â”‚   â”‚   91 â”‚                 throw new ArgumentException("Controller name cannot be empty", nameof(name));
â”‚   â”‚   â”‚   â”‚   92 â”‚ 
â”‚   â”‚   â”‚   â”‚   93 â”‚             Name = name;
â”‚   â”‚   â”‚   â”‚   94 â”‚             Model = model ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   95 â”‚         }
â”‚   â”‚   â”‚   â”‚   96 â”‚ 
â”‚   â”‚   â”‚   â”‚   97 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   98 â”‚         /// Sets the connection information for this controller
â”‚   â”‚   â”‚   â”‚   99 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  100 â”‚         public void SetConnectionInfo(string port, string serialNumber, string infinetId)
â”‚   â”‚   â”‚   â”‚  101 â”‚         {
â”‚   â”‚   â”‚   â”‚  102 â”‚             Port = port;
â”‚   â”‚   â”‚   â”‚  103 â”‚             SerialNumber = serialNumber;
â”‚   â”‚   â”‚   â”‚  104 â”‚             InfinetId = infinetId;
â”‚   â”‚   â”‚   â”‚  105 â”‚         }
â”‚   â”‚   â”‚   â”‚  106 â”‚ 
â”‚   â”‚   â”‚   â”‚  107 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  108 â”‚         /// Adds an object to this controller
â”‚   â”‚   â”‚   â”‚  109 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  110 â”‚         /// <param name="obj">The object to add</param>
â”‚   â”‚   â”‚   â”‚  111 â”‚         /// <exception cref="ArgumentException">Thrown if an object with the same name already exists</exception>
â”‚   â”‚   â”‚   â”‚  112 â”‚         public void AddObject(ControllerObject obj)
â”‚   â”‚   â”‚   â”‚  113 â”‚         {
â”‚   â”‚   â”‚   â”‚  114 â”‚             if (obj == null)
â”‚   â”‚   â”‚   â”‚  115 â”‚                 throw new ArgumentNullException(nameof(obj));
â”‚   â”‚   â”‚   â”‚  116 â”‚ 
â”‚   â”‚   â”‚   â”‚  117 â”‚             if (_objects.Any(o => o.Name == obj.Name && o.Type == obj.Type))
â”‚   â”‚   â”‚   â”‚  118 â”‚                 throw new ArgumentException($"An object with name '{obj.Name}' and type '{obj.Type}' already exists in this controller");
â”‚   â”‚   â”‚   â”‚  119 â”‚ 
â”‚   â”‚   â”‚   â”‚  120 â”‚             _objects.Add(obj);
â”‚   â”‚   â”‚   â”‚  121 â”‚         }
â”‚   â”‚   â”‚   â”‚  122 â”‚ 
â”‚   â”‚   â”‚   â”‚  123 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  124 â”‚         /// Sets a property value for this controller
â”‚   â”‚   â”‚   â”‚  125 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  126 â”‚         /// <param name="key">The property key</param>
â”‚   â”‚   â”‚   â”‚  127 â”‚         /// <param name="value">The property value</param>
â”‚   â”‚   â”‚   â”‚  128 â”‚         public void SetProperty(string key, string value)
â”‚   â”‚   â”‚   â”‚  129 â”‚         {
â”‚   â”‚   â”‚   â”‚  130 â”‚             if (string.IsNullOrEmpty(key))
â”‚   â”‚   â”‚   â”‚  131 â”‚                 throw new ArgumentException("Property key cannot be empty", nameof(key));
â”‚   â”‚   â”‚   â”‚  132 â”‚ 
â”‚   â”‚   â”‚   â”‚  133 â”‚             _properties[key] = value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚  134 â”‚         }
â”‚   â”‚   â”‚   â”‚  135 â”‚ 
â”‚   â”‚   â”‚   â”‚  136 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  137 â”‚         /// Gets a property value or default if not found
â”‚   â”‚   â”‚   â”‚  138 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  139 â”‚         /// <param name="key">The property key</param>
â”‚   â”‚   â”‚   â”‚  140 â”‚         /// <param name="defaultValue">The default value to return if property is not found</param>
â”‚   â”‚   â”‚   â”‚  141 â”‚         /// <returns>The property value or default</returns>
â”‚   â”‚   â”‚   â”‚  142 â”‚         public string GetProperty(string key, string defaultValue = "")
â”‚   â”‚   â”‚   â”‚  143 â”‚         {
â”‚   â”‚   â”‚   â”‚  144 â”‚             if (string.IsNullOrEmpty(key))
â”‚   â”‚   â”‚   â”‚  145 â”‚                 return defaultValue;
â”‚   â”‚   â”‚   â”‚  146 â”‚ 
â”‚   â”‚   â”‚   â”‚  147 â”‚             return _properties.TryGetValue(key, out var value) ? value : defaultValue;
â”‚   â”‚   â”‚   â”‚  148 â”‚         }
â”‚   â”‚   â”‚   â”‚  149 â”‚ 
â”‚   â”‚   â”‚   â”‚  150 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  151 â”‚         /// Finds objects by type
â”‚   â”‚   â”‚   â”‚  152 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  153 â”‚         /// <param name="typeName">The type name to search for</param>
â”‚   â”‚   â”‚   â”‚  154 â”‚         /// <returns>A collection of matching objects</returns>
â”‚   â”‚   â”‚   â”‚  155 â”‚         public IEnumerable<ControllerObject> FindObjectsByType(string typeName)
â”‚   â”‚   â”‚   â”‚  156 â”‚         {
â”‚   â”‚   â”‚   â”‚  157 â”‚             if (string.IsNullOrEmpty(typeName))
â”‚   â”‚   â”‚   â”‚  158 â”‚                 return Enumerable.Empty<ControllerObject>();
â”‚   â”‚   â”‚   â”‚  159 â”‚ 
â”‚   â”‚   â”‚   â”‚  160 â”‚             return _objects.Where(o => o.Type.Equals(typeName, StringComparison.OrdinalIgnoreCase));
â”‚   â”‚   â”‚   â”‚  161 â”‚         }
â”‚   â”‚   â”‚   â”‚  162 â”‚ 
â”‚   â”‚   â”‚   â”‚  163 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  164 â”‚         /// Finds an object by name
â”‚   â”‚   â”‚   â”‚  165 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  166 â”‚         /// 
â”‚   â”‚   â”‚   â”‚  167 â”‚         /// <param name="name">The object name</param>
â”‚   â”‚   â”‚   â”‚  168 â”‚         /// <returns>The object or null if not found</returns>
â”‚   â”‚   â”‚   â”‚  169 â”‚         public ControllerObject FindObjectByName(string name)
â”‚   â”‚   â”‚   â”‚  170 â”‚         {
â”‚   â”‚   â”‚   â”‚  171 â”‚             if (string.IsNullOrEmpty(name))
â”‚   â”‚   â”‚   â”‚  172 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚  173 â”‚ 
â”‚   â”‚   â”‚   â”‚  174 â”‚             return _objects.FirstOrDefault(o => o.Name.Equals(name, StringComparison.OrdinalIgnoreCase));
â”‚   â”‚   â”‚   â”‚  175 â”‚         }
â”‚   â”‚   â”‚   â”‚  176 â”‚ 
â”‚   â”‚   â”‚   â”‚  177 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  178 â”‚         /// Finds an object by alias
â”‚   â”‚   â”‚   â”‚  179 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  180 â”‚         /// <param name="alias">The object alias</param>
â”‚   â”‚   â”‚   â”‚  181 â”‚         /// <returns>The object or null if not found</returns>
â”‚   â”‚   â”‚   â”‚  182 â”‚         public ControllerObject FindObjectByAlias(string alias)
â”‚   â”‚   â”‚   â”‚  183 â”‚         {
â”‚   â”‚   â”‚   â”‚  184 â”‚             if (string.IsNullOrEmpty(alias))
â”‚   â”‚   â”‚   â”‚  185 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚  186 â”‚ 
â”‚   â”‚   â”‚   â”‚  187 â”‚             return _objects.FirstOrDefault(o =>
â”‚   â”‚   â”‚   â”‚  188 â”‚                 !string.IsNullOrEmpty(o.Alias) &&
â”‚   â”‚   â”‚   â”‚  189 â”‚                 o.Alias.Equals(alias, StringComparison.OrdinalIgnoreCase));
â”‚   â”‚   â”‚   â”‚  190 â”‚         }
â”‚   â”‚   â”‚   â”‚  191 â”‚ 
â”‚   â”‚   â”‚   â”‚  192 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  193 â”‚         /// Removes an object from this controller
â”‚   â”‚   â”‚   â”‚  194 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  195 â”‚         /// <param name="name">The name of the object to remove</param>
â”‚   â”‚   â”‚   â”‚  196 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚   â”‚   â”‚   â”‚  197 â”‚         public bool RemoveObject(string name)
â”‚   â”‚   â”‚   â”‚  198 â”‚         {
â”‚   â”‚   â”‚   â”‚  199 â”‚             if (string.IsNullOrEmpty(name))
â”‚   â”‚   â”‚   â”‚  200 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  201 â”‚ 
â”‚   â”‚   â”‚   â”‚  202 â”‚             var obj = FindObjectByName(name);
â”‚   â”‚   â”‚   â”‚  203 â”‚             if (obj == null)
â”‚   â”‚   â”‚   â”‚  204 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  205 â”‚ 
â”‚   â”‚   â”‚   â”‚  206 â”‚             return _objects.Remove(obj);
â”‚   â”‚   â”‚   â”‚  207 â”‚         }
â”‚   â”‚   â”‚   â”‚  208 â”‚     }
â”‚   â”‚   â”‚   â”‚  209 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerGroup.cs (3.49 KB, 2025-03-11 13:29:15)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ControllerGroup.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ 
â”‚   â”‚   â”‚   â”‚    4 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    5 â”‚ {
â”‚   â”‚   â”‚   â”‚    6 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚    7 â”‚     /// Represents a controller group for comparison and analysis.
â”‚   â”‚   â”‚   â”‚    8 â”‚     /// This is the definitive domain model implementation.
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     public class ControllerGroup
â”‚   â”‚   â”‚   â”‚   11 â”‚     {
â”‚   â”‚   â”‚   â”‚   12 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚         /// The group identifier
â”‚   â”‚   â”‚   â”‚   14 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   15 â”‚         public string GroupIdentifier { get; }
â”‚   â”‚   â”‚   â”‚   16 â”‚ 
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// The controller names in this group
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   20 â”‚         public List<string> ControllerNames { get; } = new();
â”‚   â”‚   â”‚   â”‚   21 â”‚ 
â”‚   â”‚   â”‚   â”‚   22 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   23 â”‚         /// Original values from controllers (pre-replacement)
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   25 â”‚         public Dictionary<string, string> OriginalValues { get; } = new(StringComparer.OrdinalIgnoreCase);
â”‚   â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   â”‚   27 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   28 â”‚         /// Processed values after name processing
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚         public Dictionary<string, string> ProcessedValues { get; } = new(StringComparer.OrdinalIgnoreCase);
â”‚   â”‚   â”‚   â”‚   31 â”‚ 
â”‚   â”‚   â”‚   â”‚   32 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   33 â”‚         /// Shared values after name processing (alias for ProcessedValues for backward compatibility)
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   35 â”‚         public Dictionary<string, string> SharedValues => ProcessedValues;
â”‚   â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   â”‚   37 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   38 â”‚         /// Mapping from original to processed names
â”‚   â”‚   â”‚   â”‚   39 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   40 â”‚         public Dictionary<string, string> NameMapping { get; } = new(StringComparer.OrdinalIgnoreCase);
â”‚   â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   â”‚   42 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   43 â”‚         /// Creates a new controller group
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// <param name="identifier">The group identifier</param>
â”‚   â”‚   â”‚   â”‚   46 â”‚         public ControllerGroup(string identifier)
â”‚   â”‚   â”‚   â”‚   47 â”‚         {
â”‚   â”‚   â”‚   â”‚   48 â”‚             GroupIdentifier = identifier ?? throw new ArgumentNullException(nameof(identifier));
â”‚   â”‚   â”‚   â”‚   49 â”‚         }
â”‚   â”‚   â”‚   â”‚   50 â”‚ 
â”‚   â”‚   â”‚   â”‚   51 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   52 â”‚         /// Adds a controller name to the group
â”‚   â”‚   â”‚   â”‚   53 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   54 â”‚         /// <param name="controllerName">The controller name to add</param>
â”‚   â”‚   â”‚   â”‚   55 â”‚         public void AddControllerName(string controllerName)
â”‚   â”‚   â”‚   â”‚   56 â”‚         {
â”‚   â”‚   â”‚   â”‚   57 â”‚             if (!string.IsNullOrWhiteSpace(controllerName))
â”‚   â”‚   â”‚   â”‚   58 â”‚             {
â”‚   â”‚   â”‚   â”‚   59 â”‚                 ControllerNames.Add(controllerName);
â”‚   â”‚   â”‚   â”‚   60 â”‚             }
â”‚   â”‚   â”‚   â”‚   61 â”‚         }
â”‚   â”‚   â”‚   â”‚   62 â”‚ 
â”‚   â”‚   â”‚   â”‚   63 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   64 â”‚         /// Adds a value to the original values dictionary
â”‚   â”‚   â”‚   â”‚   65 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   66 â”‚         /// <param name="key">The key</param>
â”‚   â”‚   â”‚   â”‚   67 â”‚         /// <param name="value">The value</param>
â”‚   â”‚   â”‚   â”‚   68 â”‚         public void AddOriginalValue(string key, string value)
â”‚   â”‚   â”‚   â”‚   69 â”‚         {
â”‚   â”‚   â”‚   â”‚   70 â”‚             if (!string.IsNullOrWhiteSpace(key))
â”‚   â”‚   â”‚   â”‚   71 â”‚             {
â”‚   â”‚   â”‚   â”‚   72 â”‚                 OriginalValues[key] = value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   73 â”‚             }
â”‚   â”‚   â”‚   â”‚   74 â”‚         }
â”‚   â”‚   â”‚   â”‚   75 â”‚ 
â”‚   â”‚   â”‚   â”‚   76 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   77 â”‚         /// Adds a value to the processed values dictionary
â”‚   â”‚   â”‚   â”‚   78 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   79 â”‚         /// <param name="key">The key</param>
â”‚   â”‚   â”‚   â”‚   80 â”‚         /// <param name="value">The value</param>
â”‚   â”‚   â”‚   â”‚   81 â”‚         public void AddProcessedValue(string key, string value)
â”‚   â”‚   â”‚   â”‚   82 â”‚         {
â”‚   â”‚   â”‚   â”‚   83 â”‚             if (!string.IsNullOrWhiteSpace(key))
â”‚   â”‚   â”‚   â”‚   84 â”‚             {
â”‚   â”‚   â”‚   â”‚   85 â”‚                 ProcessedValues[key] = value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   86 â”‚             }
â”‚   â”‚   â”‚   â”‚   87 â”‚         }
â”‚   â”‚   â”‚   â”‚   88 â”‚ 
â”‚   â”‚   â”‚   â”‚   89 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   90 â”‚         /// Adds a mapping entry
â”‚   â”‚   â”‚   â”‚   91 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   92 â”‚         /// <param name="originalName">The original name</param>
â”‚   â”‚   â”‚   â”‚   93 â”‚         /// <param name="processedName">The processed name</param>
â”‚   â”‚   â”‚   â”‚   94 â”‚         public void AddMapping(string originalName, string processedName)
â”‚   â”‚   â”‚   â”‚   95 â”‚         {
â”‚   â”‚   â”‚   â”‚   96 â”‚             if (!string.IsNullOrWhiteSpace(originalName) && !string.IsNullOrWhiteSpace(processedName))
â”‚   â”‚   â”‚   â”‚   97 â”‚             {
â”‚   â”‚   â”‚   â”‚   98 â”‚                 NameMapping[originalName] = processedName;
â”‚   â”‚   â”‚   â”‚   99 â”‚             }
â”‚   â”‚   â”‚   â”‚  100 â”‚         }
â”‚   â”‚   â”‚   â”‚  101 â”‚     }
â”‚   â”‚   â”‚   â”‚  102 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerModelInfo.cs (3.49 KB, 2025-03-11 13:50:08)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ControllerModelInfo.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿// Place in test/Core/Domain/ControllerModelInfo.cs
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ 
â”‚   â”‚   â”‚   â”‚    4 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    5 â”‚ {
â”‚   â”‚   â”‚   â”‚    6 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚    7 â”‚     /// Provides information and operations related to controller models
â”‚   â”‚   â”‚   â”‚    8 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚    9 â”‚     public class ControllerModelInfo
â”‚   â”‚   â”‚   â”‚   10 â”‚     {
â”‚   â”‚   â”‚   â”‚   11 â”‚         // Restore the enum for type safety instead of using strings
â”‚   â”‚   â”‚   â”‚   12 â”‚         public enum ControllerFamily
â”‚   â”‚   â”‚   â”‚   13 â”‚         {
â”‚   â”‚   â”‚   â”‚   14 â”‚             Infinity,
â”‚   â”‚   â”‚   â”‚   15 â”‚             I2,
â”‚   â”‚   â”‚   â”‚   16 â”‚             Unknown
â”‚   â”‚   â”‚   â”‚   17 â”‚         }
â”‚   â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   â”‚   19 â”‚         // Maintain the model lists from the original and the current implementation
â”‚   â”‚   â”‚   â”‚   20 â”‚         private static readonly HashSet<string> InfinityModels = new HashSet<string>
â”‚   â”‚   â”‚   â”‚   21 â”‚         {
â”‚   â”‚   â”‚   â”‚   22 â”‚             "800", "810", "843", "846", "850", "851", "853", "890",
â”‚   â”‚   â”‚   â”‚   23 â”‚             "700", "891", "892", "920", "780", "865", "866", "867",
â”‚   â”‚   â”‚   â”‚   24 â”‚             "701", "781"
â”‚   â”‚   â”‚   â”‚   25 â”‚         };
â”‚   â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   â”‚   27 â”‚         private static readonly HashSet<string> I2Models = new HashSet<string>
â”‚   â”‚   â”‚   â”‚   28 â”‚         {
â”‚   â”‚   â”‚   â”‚   29 â”‚             "i2624", "i2608", "i2800", "i2804", "i2850", "i2851",
â”‚   â”‚   â”‚   â”‚   30 â”‚             "i2853", "i2865", "i2866", "i2885", "i2867", "i2920"
â”‚   â”‚   â”‚   â”‚   31 â”‚         };
â”‚   â”‚   â”‚   â”‚   32 â”‚ 
â”‚   â”‚   â”‚   â”‚   33 â”‚         // Restore the ModelProperties class with I/O counts
â”‚   â”‚   â”‚   â”‚   34 â”‚         public class ModelProperties
â”‚   â”‚   â”‚   â”‚   35 â”‚         {
â”‚   â”‚   â”‚   â”‚   36 â”‚             public int AnalogOutputs { get; set; }
â”‚   â”‚   â”‚   â”‚   37 â”‚             public int DigitalOutputs { get; set; }
â”‚   â”‚   â”‚   â”‚   38 â”‚             public int DigitalInputs { get; set; }
â”‚   â”‚   â”‚   â”‚   39 â”‚             // Add more properties as needed
â”‚   â”‚   â”‚   â”‚   40 â”‚         }
â”‚   â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   â”‚   42 â”‚         // Restore the model specifications dictionary
â”‚   â”‚   â”‚   â”‚   43 â”‚         private static readonly Dictionary<string, ModelProperties> ModelSpecifications = new Dictionary<string, ModelProperties>();
â”‚   â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   46 â”‚         /// Determines the controller family based on the model number
â”‚   â”‚   â”‚   â”‚   47 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   48 â”‚         /// <param name="modelNumber">The controller model number</param>
â”‚   â”‚   â”‚   â”‚   49 â”‚         /// <returns>The controller family</returns>
â”‚   â”‚   â”‚   â”‚   50 â”‚         public static ControllerFamily DetermineControllerFamily(string modelNumber)
â”‚   â”‚   â”‚   â”‚   51 â”‚         {
â”‚   â”‚   â”‚   â”‚   52 â”‚             if (string.IsNullOrWhiteSpace(modelNumber))
â”‚   â”‚   â”‚   â”‚   53 â”‚                 return ControllerFamily.Unknown;
â”‚   â”‚   â”‚   â”‚   54 â”‚ 
â”‚   â”‚   â”‚   â”‚   55 â”‚             // Check exact matches first
â”‚   â”‚   â”‚   â”‚   56 â”‚             if (InfinityModels.Contains(modelNumber))
â”‚   â”‚   â”‚   â”‚   57 â”‚                 return ControllerFamily.Infinity;
â”‚   â”‚   â”‚   â”‚   58 â”‚ 
â”‚   â”‚   â”‚   â”‚   59 â”‚             if (I2Models.Contains(modelNumber))
â”‚   â”‚   â”‚   â”‚   60 â”‚                 return ControllerFamily.I2;
â”‚   â”‚   â”‚   â”‚   61 â”‚ 
â”‚   â”‚   â”‚   â”‚   62 â”‚             // Apply pattern matching rules
â”‚   â”‚   â”‚   â”‚   63 â”‚             if (modelNumber.Length == 3 && int.TryParse(modelNumber, out _))
â”‚   â”‚   â”‚   â”‚   64 â”‚                 return ControllerFamily.Infinity;
â”‚   â”‚   â”‚   â”‚   65 â”‚ 
â”‚   â”‚   â”‚   â”‚   66 â”‚             if (modelNumber.StartsWith("i2", System.StringComparison.OrdinalIgnoreCase))
â”‚   â”‚   â”‚   â”‚   67 â”‚                 return ControllerFamily.I2;
â”‚   â”‚   â”‚   â”‚   68 â”‚ 
â”‚   â”‚   â”‚   â”‚   69 â”‚             return ControllerFamily.Unknown;
â”‚   â”‚   â”‚   â”‚   70 â”‚         }
â”‚   â”‚   â”‚   â”‚   71 â”‚ 
â”‚   â”‚   â”‚   â”‚   72 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   73 â”‚         /// Gets the properties for a specific model
â”‚   â”‚   â”‚   â”‚   74 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   75 â”‚         /// <param name="modelNumber">The model number</param>
â”‚   â”‚   â”‚   â”‚   76 â”‚         /// <returns>The model properties or null if not found</returns>
â”‚   â”‚   â”‚   â”‚   77 â”‚         public static ModelProperties GetModelProperties(string modelNumber)
â”‚   â”‚   â”‚   â”‚   78 â”‚         {
â”‚   â”‚   â”‚   â”‚   79 â”‚             if (ModelSpecifications.TryGetValue(modelNumber, out var properties))
â”‚   â”‚   â”‚   â”‚   80 â”‚                 return properties;
â”‚   â”‚   â”‚   â”‚   81 â”‚ 
â”‚   â”‚   â”‚   â”‚   82 â”‚             return null;
â”‚   â”‚   â”‚   â”‚   83 â”‚         }
â”‚   â”‚   â”‚   â”‚   84 â”‚ 
â”‚   â”‚   â”‚   â”‚   85 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   86 â”‚         /// Sets the properties for a specific model
â”‚   â”‚   â”‚   â”‚   87 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   88 â”‚         /// <param name="modelNumber">The model number</param>
â”‚   â”‚   â”‚   â”‚   89 â”‚         /// <param name="properties">The properties to set</param>
â”‚   â”‚   â”‚   â”‚   90 â”‚         public static void SetModelProperties(string modelNumber, ModelProperties properties)
â”‚   â”‚   â”‚   â”‚   91 â”‚         {
â”‚   â”‚   â”‚   â”‚   92 â”‚             ModelSpecifications[modelNumber] = properties;
â”‚   â”‚   â”‚   â”‚   93 â”‚         }
â”‚   â”‚   â”‚   â”‚   94 â”‚     }
â”‚   â”‚   â”‚   â”‚   95 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerObject.cs (5.88 KB, 2025-03-11 14:52:32)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ControllerObject.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Represents an object within an HVAC controller.
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Core domain entity with associated business rules.
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public class ControllerObject
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         private readonly List<ControllerObject> _children = new();
â”‚   â”‚   â”‚   â”‚   16 â”‚         private readonly Dictionary<string, string> _properties = new(StringComparer.OrdinalIgnoreCase);
â”‚   â”‚   â”‚   â”‚   17 â”‚ 
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// The type of this object
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   21 â”‚         public string Type { get; }
â”‚   â”‚   â”‚   â”‚   22 â”‚ 
â”‚   â”‚   â”‚   â”‚   23 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// The name of this object
â”‚   â”‚   â”‚   â”‚   25 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   26 â”‚         public string Name { get; }
â”‚   â”‚   â”‚   â”‚   27 â”‚ 
â”‚   â”‚   â”‚   â”‚   28 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// The alias of this object (optional)
â”‚   â”‚   â”‚   â”‚   30 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   31 â”‚         public string Alias { get; private set; }
â”‚   â”‚   â”‚   â”‚   32 â”‚ 
â”‚   â”‚   â”‚   â”‚   33 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// The value of this object
â”‚   â”‚   â”‚   â”‚   35 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   36 â”‚         public string Value { get; private set; }
â”‚   â”‚   â”‚   â”‚   37 â”‚ 
â”‚   â”‚   â”‚   â”‚   38 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   39 â”‚         /// Indicates if this object has bytecode
â”‚   â”‚   â”‚   â”‚   40 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   41 â”‚         public bool HasByteCode { get; private set; }
â”‚   â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   â”‚   43 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// Read-only collection of child objects
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   46 â”‚         public IReadOnlyCollection<ControllerObject> Children => _children.AsReadOnly();
â”‚   â”‚   â”‚   â”‚   47 â”‚ 
â”‚   â”‚   â”‚   â”‚   48 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   49 â”‚         /// Read-only dictionary of additional properties
â”‚   â”‚   â”‚   â”‚   50 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   51 â”‚         public IReadOnlyDictionary<string, string> Properties => _properties;
â”‚   â”‚   â”‚   â”‚   52 â”‚ 
â”‚   â”‚   â”‚   â”‚   53 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   54 â”‚         /// Creates a new controller object
â”‚   â”‚   â”‚   â”‚   55 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   56 â”‚         /// <param name="type">The object type</param>
â”‚   â”‚   â”‚   â”‚   57 â”‚         /// <param name="name">The object name</param>
â”‚   â”‚   â”‚   â”‚   58 â”‚         /// <param name="value">The object value (optional)</param>
â”‚   â”‚   â”‚   â”‚   59 â”‚         public ControllerObject(string type, string name, string value = "")
â”‚   â”‚   â”‚   â”‚   60 â”‚         {
â”‚   â”‚   â”‚   â”‚   61 â”‚             if (string.IsNullOrWhiteSpace(type))
â”‚   â”‚   â”‚   â”‚   62 â”‚                 throw new ArgumentException("Object type cannot be empty", nameof(type));
â”‚   â”‚   â”‚   â”‚   63 â”‚ 
â”‚   â”‚   â”‚   â”‚   64 â”‚             if (string.IsNullOrWhiteSpace(name))
â”‚   â”‚   â”‚   â”‚   65 â”‚                 throw new ArgumentException("Object name cannot be empty", nameof(name));
â”‚   â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   â”‚   67 â”‚             Type = type;
â”‚   â”‚   â”‚   â”‚   68 â”‚             Name = name;
â”‚   â”‚   â”‚   â”‚   69 â”‚             Value = value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   70 â”‚ 
â”‚   â”‚   â”‚   â”‚   71 â”‚             // Set HasByteCode based on type
â”‚   â”‚   â”‚   â”‚   72 â”‚             HasByteCode = type.Equals("InfinityProgram", StringComparison.OrdinalIgnoreCase) ||
â”‚   â”‚   â”‚   â”‚   73 â”‚                          type.Equals("InfinityFunction", StringComparison.OrdinalIgnoreCase);
â”‚   â”‚   â”‚   â”‚   74 â”‚         }
â”‚   â”‚   â”‚   â”‚   75 â”‚ 
â”‚   â”‚   â”‚   â”‚   76 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   77 â”‚         /// Sets the alias for this object
â”‚   â”‚   â”‚   â”‚   78 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   79 â”‚         /// <param name="alias">The alias to set</param>
â”‚   â”‚   â”‚   â”‚   80 â”‚         public void SetAlias(string alias)
â”‚   â”‚   â”‚   â”‚   81 â”‚         {
â”‚   â”‚   â”‚   â”‚   82 â”‚             Alias = alias;
â”‚   â”‚   â”‚   â”‚   83 â”‚         }
â”‚   â”‚   â”‚   â”‚   84 â”‚ 
â”‚   â”‚   â”‚   â”‚   85 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   86 â”‚         /// Updates the value of this object
â”‚   â”‚   â”‚   â”‚   87 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   88 â”‚         /// <param name="newValue">The new value</param>
â”‚   â”‚   â”‚   â”‚   89 â”‚         public void UpdateValue(string newValue)
â”‚   â”‚   â”‚   â”‚   90 â”‚         {
â”‚   â”‚   â”‚   â”‚   91 â”‚             Value = newValue ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   92 â”‚         }
â”‚   â”‚   â”‚   â”‚   93 â”‚ 
â”‚   â”‚   â”‚   â”‚   94 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   95 â”‚         /// Sets a property value for this object
â”‚   â”‚   â”‚   â”‚   96 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   97 â”‚         /// <param name="key">The property key</param>
â”‚   â”‚   â”‚   â”‚   98 â”‚         /// <param name="value">The property value</param>
â”‚   â”‚   â”‚   â”‚   99 â”‚         public void SetProperty(string key, string value)
â”‚   â”‚   â”‚   â”‚  100 â”‚         {
â”‚   â”‚   â”‚   â”‚  101 â”‚             if (string.IsNullOrEmpty(key))
â”‚   â”‚   â”‚   â”‚  102 â”‚                 throw new ArgumentException("Property key cannot be empty", nameof(key));
â”‚   â”‚   â”‚   â”‚  103 â”‚ 
â”‚   â”‚   â”‚   â”‚  104 â”‚             _properties[key] = value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚  105 â”‚         }
â”‚   â”‚   â”‚   â”‚  106 â”‚ 
â”‚   â”‚   â”‚   â”‚  107 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  108 â”‚         /// Gets a property value or default if not found
â”‚   â”‚   â”‚   â”‚  109 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  110 â”‚         /// <param name="key">The property key</param>
â”‚   â”‚   â”‚   â”‚  111 â”‚         /// <param name="defaultValue">The default value to return if property is not found</param>
â”‚   â”‚   â”‚   â”‚  112 â”‚         /// <returns>The property value or default</returns>
â”‚   â”‚   â”‚   â”‚  113 â”‚         public string GetProperty(string key, string defaultValue = "")
â”‚   â”‚   â”‚   â”‚  114 â”‚         {
â”‚   â”‚   â”‚   â”‚  115 â”‚             if (string.IsNullOrEmpty(key))
â”‚   â”‚   â”‚   â”‚  116 â”‚                 return defaultValue;
â”‚   â”‚   â”‚   â”‚  117 â”‚ 
â”‚   â”‚   â”‚   â”‚  118 â”‚             return _properties.TryGetValue(key, out var value) ? value : defaultValue;
â”‚   â”‚   â”‚   â”‚  119 â”‚         }
â”‚   â”‚   â”‚   â”‚  120 â”‚ 
â”‚   â”‚   â”‚   â”‚  121 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  122 â”‚         /// Sets whether this object has bytecode
â”‚   â”‚   â”‚   â”‚  123 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  124 â”‚         /// <param name="hasByteCode">True if this object has bytecode, false otherwise</param>
â”‚   â”‚   â”‚   â”‚  125 â”‚         public void SetHasByteCode(bool hasByteCode)
â”‚   â”‚   â”‚   â”‚  126 â”‚         {
â”‚   â”‚   â”‚   â”‚  127 â”‚             HasByteCode = hasByteCode;
â”‚   â”‚   â”‚   â”‚  128 â”‚         }
â”‚   â”‚   â”‚   â”‚  129 â”‚ 
â”‚   â”‚   â”‚   â”‚  130 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  131 â”‚         /// Adds a child object
â”‚   â”‚   â”‚   â”‚  132 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  133 â”‚         /// <param name="child">The child object to add</param>
â”‚   â”‚   â”‚   â”‚  134 â”‚         public void AddChild(ControllerObject child)
â”‚   â”‚   â”‚   â”‚  135 â”‚         {
â”‚   â”‚   â”‚   â”‚  136 â”‚             if (child == null)
â”‚   â”‚   â”‚   â”‚  137 â”‚                 throw new ArgumentNullException(nameof(child));
â”‚   â”‚   â”‚   â”‚  138 â”‚ 
â”‚   â”‚   â”‚   â”‚  139 â”‚             if (_children.Any(c => c.Name == child.Name && c.Type == child.Type))
â”‚   â”‚   â”‚   â”‚  140 â”‚                 throw new ArgumentException($"A child object with name '{child.Name}' and type '{child.Type}' already exists");
â”‚   â”‚   â”‚   â”‚  141 â”‚ 
â”‚   â”‚   â”‚   â”‚  142 â”‚             _children.Add(child);
â”‚   â”‚   â”‚   â”‚  143 â”‚         }
â”‚   â”‚   â”‚   â”‚  144 â”‚ 
â”‚   â”‚   â”‚   â”‚  145 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  146 â”‚         /// Finds a child object by name
â”‚   â”‚   â”‚   â”‚  147 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  148 â”‚         /// <param name="name">The name to search for</param>
â”‚   â”‚   â”‚   â”‚  149 â”‚         /// <returns>The matching object or null if not found</returns>
â”‚   â”‚   â”‚   â”‚  150 â”‚         public ControllerObject FindChild(string name)
â”‚   â”‚   â”‚   â”‚  151 â”‚         {
â”‚   â”‚   â”‚   â”‚  152 â”‚             if (string.IsNullOrEmpty(name))
â”‚   â”‚   â”‚   â”‚  153 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚  154 â”‚ 
â”‚   â”‚   â”‚   â”‚  155 â”‚             return _children.FirstOrDefault(c => c.Name.Equals(name, StringComparison.OrdinalIgnoreCase));
â”‚   â”‚   â”‚   â”‚  156 â”‚         }
â”‚   â”‚   â”‚   â”‚  157 â”‚ 
â”‚   â”‚   â”‚   â”‚  158 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  159 â”‚         /// Removes a child object
â”‚   â”‚   â”‚   â”‚  160 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  161 â”‚         /// <param name="name">The name of the child to remove</param>
â”‚   â”‚   â”‚   â”‚  162 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚   â”‚   â”‚   â”‚  163 â”‚         public bool RemoveChild(string name)
â”‚   â”‚   â”‚   â”‚  164 â”‚         {
â”‚   â”‚   â”‚   â”‚  165 â”‚             var child = FindChild(name);
â”‚   â”‚   â”‚   â”‚  166 â”‚             if (child == null)
â”‚   â”‚   â”‚   â”‚  167 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  168 â”‚ 
â”‚   â”‚   â”‚   â”‚  169 â”‚             return _children.Remove(child);
â”‚   â”‚   â”‚   â”‚  170 â”‚         }
â”‚   â”‚   â”‚   â”‚  171 â”‚     }
â”‚   â”‚   â”‚   â”‚  172 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CustomTypeFile.cs (2.30 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: CustomTypeFile.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Represents a custom type file in a project.
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚     public class CustomTypeFile
â”‚   â”‚   â”‚   â”‚   13 â”‚     {
â”‚   â”‚   â”‚   â”‚   14 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   15 â”‚         /// The file name
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   17 â”‚         public string FileName { get; }
â”‚   â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// The number of types in the file
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   22 â”‚         public int TypeCount { get; private set; }
â”‚   â”‚   â”‚   â”‚   23 â”‚ 
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   25 â”‚         /// The description of the file
â”‚   â”‚   â”‚   â”‚   26 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚         public string Description { get; private set; }
â”‚   â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚         /// The date the file was last modified
â”‚   â”‚   â”‚   â”‚   31 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   32 â”‚         public DateTime LastModified { get; private set; }
â”‚   â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   35 â”‚         /// Creates a new custom type file
â”‚   â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   37 â”‚         /// <param name="fileName">The file name</param>
â”‚   â”‚   â”‚   â”‚   38 â”‚         /// <param name="typeCount">The number of types</param>
â”‚   â”‚   â”‚   â”‚   39 â”‚         /// <param name="description">The description</param>
â”‚   â”‚   â”‚   â”‚   40 â”‚         public CustomTypeFile(string fileName, int typeCount, string description)
â”‚   â”‚   â”‚   â”‚   41 â”‚         {
â”‚   â”‚   â”‚   â”‚   42 â”‚             if (string.IsNullOrWhiteSpace(fileName))
â”‚   â”‚   â”‚   â”‚   43 â”‚                 throw new ArgumentException("File name cannot be empty", nameof(fileName));
â”‚   â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   â”‚   45 â”‚             FileName = fileName;
â”‚   â”‚   â”‚   â”‚   46 â”‚             TypeCount = typeCount;
â”‚   â”‚   â”‚   â”‚   47 â”‚             Description = description ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   48 â”‚             LastModified = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚   49 â”‚         }
â”‚   â”‚   â”‚   â”‚   50 â”‚ 
â”‚   â”‚   â”‚   â”‚   51 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   52 â”‚         /// Updates the description of the file
â”‚   â”‚   â”‚   â”‚   53 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   54 â”‚         /// <param name="description">The new description</param>
â”‚   â”‚   â”‚   â”‚   55 â”‚         public void UpdateDescription(string description)
â”‚   â”‚   â”‚   â”‚   56 â”‚         {
â”‚   â”‚   â”‚   â”‚   57 â”‚             Description = description ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   58 â”‚             LastModified = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚   59 â”‚         }
â”‚   â”‚   â”‚   â”‚   60 â”‚ 
â”‚   â”‚   â”‚   â”‚   61 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   62 â”‚         /// Updates the type count
â”‚   â”‚   â”‚   â”‚   63 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   64 â”‚         /// <param name="typeCount">The new type count</param>
â”‚   â”‚   â”‚   â”‚   65 â”‚         public void UpdateTypeCount(int typeCount)
â”‚   â”‚   â”‚   â”‚   66 â”‚         {
â”‚   â”‚   â”‚   â”‚   67 â”‚             if (typeCount < 0)
â”‚   â”‚   â”‚   â”‚   68 â”‚                 throw new ArgumentException("Type count cannot be negative", nameof(typeCount));
â”‚   â”‚   â”‚   â”‚   69 â”‚ 
â”‚   â”‚   â”‚   â”‚   70 â”‚             TypeCount = typeCount;
â”‚   â”‚   â”‚   â”‚   71 â”‚             LastModified = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚   72 â”‚         }
â”‚   â”‚   â”‚   â”‚   73 â”‚     }
â”‚   â”‚   â”‚   â”‚   74 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ImportedFile.cs (2.24 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ImportedFile.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Represents a file imported into a project.
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚     public class ImportedFile
â”‚   â”‚   â”‚   â”‚   13 â”‚     {
â”‚   â”‚   â”‚   â”‚   14 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   15 â”‚         /// The file path
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   17 â”‚         public string FilePath { get; }
â”‚   â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// The file name
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   22 â”‚         public string FileName { get; }
â”‚   â”‚   â”‚   â”‚   23 â”‚ 
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   25 â”‚         /// The file size in bytes
â”‚   â”‚   â”‚   â”‚   26 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚         public long FileSize { get; }
â”‚   â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚         /// The file type (e.g., dmp, xml)
â”‚   â”‚   â”‚   â”‚   31 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   32 â”‚         public string FileType { get; }
â”‚   â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   35 â”‚         /// The date the file was imported
â”‚   â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   37 â”‚         public DateTime ImportDate { get; }
â”‚   â”‚   â”‚   â”‚   38 â”‚ 
â”‚   â”‚   â”‚   â”‚   39 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   40 â”‚         /// The status of the file
â”‚   â”‚   â”‚   â”‚   41 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   42 â”‚         public string Status { get; private set; }
â”‚   â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// Creates a new imported file
â”‚   â”‚   â”‚   â”‚   46 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   47 â”‚         /// <param name="filePath">The file path</param>
â”‚   â”‚   â”‚   â”‚   48 â”‚         /// <param name="fileName">The file name</param>
â”‚   â”‚   â”‚   â”‚   49 â”‚         /// <param name="fileSize">The file size</param>
â”‚   â”‚   â”‚   â”‚   50 â”‚         /// <param name="fileType">The file type</param>
â”‚   â”‚   â”‚   â”‚   51 â”‚         public ImportedFile(string filePath, string fileName, long fileSize, string fileType)
â”‚   â”‚   â”‚   â”‚   52 â”‚         {
â”‚   â”‚   â”‚   â”‚   53 â”‚             if (string.IsNullOrWhiteSpace(filePath))
â”‚   â”‚   â”‚   â”‚   54 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(filePath));
â”‚   â”‚   â”‚   â”‚   55 â”‚ 
â”‚   â”‚   â”‚   â”‚   56 â”‚             if (string.IsNullOrWhiteSpace(fileName))
â”‚   â”‚   â”‚   â”‚   57 â”‚                 throw new ArgumentException("File name cannot be empty", nameof(fileName));
â”‚   â”‚   â”‚   â”‚   58 â”‚ 
â”‚   â”‚   â”‚   â”‚   59 â”‚             FilePath = filePath;
â”‚   â”‚   â”‚   â”‚   60 â”‚             FileName = fileName;
â”‚   â”‚   â”‚   â”‚   61 â”‚             FileSize = fileSize;
â”‚   â”‚   â”‚   â”‚   62 â”‚             FileType = fileType ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   63 â”‚             ImportDate = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚   64 â”‚             Status = "Imported";
â”‚   â”‚   â”‚   â”‚   65 â”‚         }
â”‚   â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   â”‚   67 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   68 â”‚         /// Updates the status of the file
â”‚   â”‚   â”‚   â”‚   69 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   70 â”‚         /// <param name="status">The new status</param>
â”‚   â”‚   â”‚   â”‚   71 â”‚         public void UpdateStatus(string status)
â”‚   â”‚   â”‚   â”‚   72 â”‚         {
â”‚   â”‚   â”‚   â”‚   73 â”‚             Status = status ?? "Unknown";
â”‚   â”‚   â”‚   â”‚   74 â”‚         }
â”‚   â”‚   â”‚   â”‚   75 â”‚     }
â”‚   â”‚   â”‚   â”‚   76 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Project.cs (10.10 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: Project.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Represents a project within the application.
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Core domain entity encapsulating project-specific business rules.
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public class Project
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         private readonly List<ImportedFile> _importedFiles = new();
â”‚   â”‚   â”‚   â”‚   16 â”‚         private readonly List<SharedType> _sharedTypes = new();
â”‚   â”‚   â”‚   â”‚   17 â”‚         private readonly List<CustomTypeFile> _customTypeFiles = new();
â”‚   â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// The unique identifier for the project
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   22 â”‚         public string Id { get; private set; }
â”‚   â”‚   â”‚   â”‚   23 â”‚ 
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   25 â”‚         /// The name of the project
â”‚   â”‚   â”‚   â”‚   26 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚         public string Name { get; private set; }
â”‚   â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚         /// The description of the project
â”‚   â”‚   â”‚   â”‚   31 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   32 â”‚         public string Description { get; private set; }
â”‚   â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   35 â”‚         /// The date the project was created
â”‚   â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   37 â”‚         public DateTime Created { get; private set; }
â”‚   â”‚   â”‚   â”‚   38 â”‚ 
â”‚   â”‚   â”‚   â”‚   39 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   40 â”‚         /// The date the project was last modified
â”‚   â”‚   â”‚   â”‚   41 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   42 â”‚         public DateTime LastModified { get; private set; }
â”‚   â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// Read-only collection of imported files
â”‚   â”‚   â”‚   â”‚   46 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   47 â”‚         public IReadOnlyCollection<ImportedFile> ImportedFiles => _importedFiles.AsReadOnly();
â”‚   â”‚   â”‚   â”‚   48 â”‚ 
â”‚   â”‚   â”‚   â”‚   49 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   50 â”‚         /// Read-only collection of shared types
â”‚   â”‚   â”‚   â”‚   51 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   52 â”‚         public IReadOnlyCollection<SharedType> SharedTypes => _sharedTypes.AsReadOnly();
â”‚   â”‚   â”‚   â”‚   53 â”‚ 
â”‚   â”‚   â”‚   â”‚   54 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   55 â”‚         /// Read-only collection of custom type files
â”‚   â”‚   â”‚   â”‚   56 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   57 â”‚         public IReadOnlyCollection<CustomTypeFile> CustomTypeFiles => _customTypeFiles.AsReadOnly();
â”‚   â”‚   â”‚   â”‚   58 â”‚ 
â”‚   â”‚   â”‚   â”‚   59 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   60 â”‚         /// Creates a new project
â”‚   â”‚   â”‚   â”‚   61 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   62 â”‚         /// <param name="id">The project ID</param>
â”‚   â”‚   â”‚   â”‚   63 â”‚         /// <param name="name">The project name</param>
â”‚   â”‚   â”‚   â”‚   64 â”‚         /// <param name="description">The project description (optional)</param>
â”‚   â”‚   â”‚   â”‚   65 â”‚         public Project(string id, string name, string description = "")
â”‚   â”‚   â”‚   â”‚   66 â”‚         {
â”‚   â”‚   â”‚   â”‚   67 â”‚             if (string.IsNullOrWhiteSpace(id))
â”‚   â”‚   â”‚   â”‚   68 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(id));
â”‚   â”‚   â”‚   â”‚   69 â”‚ 
â”‚   â”‚   â”‚   â”‚   70 â”‚             if (string.IsNullOrWhiteSpace(name))
â”‚   â”‚   â”‚   â”‚   71 â”‚                 throw new ArgumentException("Project name cannot be empty", nameof(name));
â”‚   â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   â”‚   73 â”‚             Id = id;
â”‚   â”‚   â”‚   â”‚   74 â”‚             Name = name;
â”‚   â”‚   â”‚   â”‚   75 â”‚             Description = description ?? string.Empty;
â”‚   â”‚   â”‚   â”‚   76 â”‚             Created = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚   77 â”‚             LastModified = Created;
â”‚   â”‚   â”‚   â”‚   78 â”‚         }
â”‚   â”‚   â”‚   â”‚   79 â”‚ 
â”‚   â”‚   â”‚   â”‚   80 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   81 â”‚         /// Constructor for loading existing projects
â”‚   â”‚   â”‚   â”‚   82 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   83 â”‚         internal Project(
â”‚   â”‚   â”‚   â”‚   84 â”‚             string id,
â”‚   â”‚   â”‚   â”‚   85 â”‚             string name,
â”‚   â”‚   â”‚   â”‚   86 â”‚             string description,
â”‚   â”‚   â”‚   â”‚   87 â”‚             DateTime created,
â”‚   â”‚   â”‚   â”‚   88 â”‚             DateTime lastModified,
â”‚   â”‚   â”‚   â”‚   89 â”‚             IEnumerable<ImportedFile> importedFiles = null,
â”‚   â”‚   â”‚   â”‚   90 â”‚             IEnumerable<SharedType> sharedTypes = null,
â”‚   â”‚   â”‚   â”‚   91 â”‚             IEnumerable<CustomTypeFile> customTypeFiles = null)
â”‚   â”‚   â”‚   â”‚   92 â”‚         {
â”‚   â”‚   â”‚   â”‚   93 â”‚             Id = id;
â”‚   â”‚   â”‚   â”‚   94 â”‚             Name = name;
â”‚   â”‚   â”‚   â”‚   95 â”‚             Description = description;
â”‚   â”‚   â”‚   â”‚   96 â”‚             Created = created;
â”‚   â”‚   â”‚   â”‚   97 â”‚             LastModified = lastModified;
â”‚   â”‚   â”‚   â”‚   98 â”‚ 
â”‚   â”‚   â”‚   â”‚   99 â”‚             if (importedFiles != null)
â”‚   â”‚   â”‚   â”‚  100 â”‚                 _importedFiles.AddRange(importedFiles);
â”‚   â”‚   â”‚   â”‚  101 â”‚ 
â”‚   â”‚   â”‚   â”‚  102 â”‚             if (sharedTypes != null)
â”‚   â”‚   â”‚   â”‚  103 â”‚                 _sharedTypes.AddRange(sharedTypes);
â”‚   â”‚   â”‚   â”‚  104 â”‚ 
â”‚   â”‚   â”‚   â”‚  105 â”‚             if (customTypeFiles != null)
â”‚   â”‚   â”‚   â”‚  106 â”‚                 _customTypeFiles.AddRange(customTypeFiles);
â”‚   â”‚   â”‚   â”‚  107 â”‚         }
â”‚   â”‚   â”‚   â”‚  108 â”‚ 
â”‚   â”‚   â”‚   â”‚  109 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  110 â”‚         /// Updates project details
â”‚   â”‚   â”‚   â”‚  111 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  112 â”‚         /// <param name="name">The new name</param>
â”‚   â”‚   â”‚   â”‚  113 â”‚         /// <param name="description">The new description</param>
â”‚   â”‚   â”‚   â”‚  114 â”‚         public void UpdateDetails(string name, string description)
â”‚   â”‚   â”‚   â”‚  115 â”‚         {
â”‚   â”‚   â”‚   â”‚  116 â”‚             if (string.IsNullOrWhiteSpace(name))
â”‚   â”‚   â”‚   â”‚  117 â”‚                 throw new ArgumentException("Project name cannot be empty", nameof(name));
â”‚   â”‚   â”‚   â”‚  118 â”‚ 
â”‚   â”‚   â”‚   â”‚  119 â”‚             Name = name;
â”‚   â”‚   â”‚   â”‚  120 â”‚             Description = description ?? string.Empty;
â”‚   â”‚   â”‚   â”‚  121 â”‚             UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  122 â”‚         }
â”‚   â”‚   â”‚   â”‚  123 â”‚ 
â”‚   â”‚   â”‚   â”‚  124 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  125 â”‚         /// Imports a file into the project
â”‚   â”‚   â”‚   â”‚  126 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  127 â”‚         /// <param name="path">The file path</param>
â”‚   â”‚   â”‚   â”‚  128 â”‚         /// <param name="fileName">The file name</param>
â”‚   â”‚   â”‚   â”‚  129 â”‚         /// <param name="fileSize">The file size</param>
â”‚   â”‚   â”‚   â”‚  130 â”‚         /// <param name="fileType">The file type</param>
â”‚   â”‚   â”‚   â”‚  131 â”‚         /// <returns>The imported file object</returns>
â”‚   â”‚   â”‚   â”‚  132 â”‚         public ImportedFile ImportFile(string path, string fileName, long fileSize, string fileType)
â”‚   â”‚   â”‚   â”‚  133 â”‚         {
â”‚   â”‚   â”‚   â”‚  134 â”‚             if (string.IsNullOrWhiteSpace(path))
â”‚   â”‚   â”‚   â”‚  135 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(path));
â”‚   â”‚   â”‚   â”‚  136 â”‚ 
â”‚   â”‚   â”‚   â”‚  137 â”‚             if (string.IsNullOrWhiteSpace(fileName))
â”‚   â”‚   â”‚   â”‚  138 â”‚                 throw new ArgumentException("File name cannot be empty", nameof(fileName));
â”‚   â”‚   â”‚   â”‚  139 â”‚ 
â”‚   â”‚   â”‚   â”‚  140 â”‚             if (_importedFiles.Any(f => f.FilePath == path))
â”‚   â”‚   â”‚   â”‚  141 â”‚                 throw new InvalidOperationException($"File at path '{path}' is already imported");
â”‚   â”‚   â”‚   â”‚  142 â”‚ 
â”‚   â”‚   â”‚   â”‚  143 â”‚             var file = new ImportedFile(path, fileName, fileSize, fileType);
â”‚   â”‚   â”‚   â”‚  144 â”‚             _importedFiles.Add(file);
â”‚   â”‚   â”‚   â”‚  145 â”‚ 
â”‚   â”‚   â”‚   â”‚  146 â”‚             UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  147 â”‚             return file;
â”‚   â”‚   â”‚   â”‚  148 â”‚         }
â”‚   â”‚   â”‚   â”‚  149 â”‚ 
â”‚   â”‚   â”‚   â”‚  150 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  151 â”‚         /// Removes a file from the project
â”‚   â”‚   â”‚   â”‚  152 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  153 â”‚         /// <param name="path">The path of the file to remove</param>
â”‚   â”‚   â”‚   â”‚  154 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚   â”‚   â”‚   â”‚  155 â”‚         public bool RemoveFile(string path)
â”‚   â”‚   â”‚   â”‚  156 â”‚         {
â”‚   â”‚   â”‚   â”‚  157 â”‚             if (string.IsNullOrEmpty(path))
â”‚   â”‚   â”‚   â”‚  158 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  159 â”‚ 
â”‚   â”‚   â”‚   â”‚  160 â”‚             var file = _importedFiles.FirstOrDefault(f => f.FilePath == path);
â”‚   â”‚   â”‚   â”‚  161 â”‚             if (file == null)
â”‚   â”‚   â”‚   â”‚  162 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  163 â”‚ 
â”‚   â”‚   â”‚   â”‚  164 â”‚             var result = _importedFiles.Remove(file);
â”‚   â”‚   â”‚   â”‚  165 â”‚             if (result)
â”‚   â”‚   â”‚   â”‚  166 â”‚                 UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  167 â”‚ 
â”‚   â”‚   â”‚   â”‚  168 â”‚             return result;
â”‚   â”‚   â”‚   â”‚  169 â”‚         }
â”‚   â”‚   â”‚   â”‚  170 â”‚ 
â”‚   â”‚   â”‚   â”‚  171 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  172 â”‚         /// Adds a shared type to the project
â”‚   â”‚   â”‚   â”‚  173 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  174 â”‚         /// <param name="typeName">The type name</param>
â”‚   â”‚   â”‚   â”‚  175 â”‚         /// <param name="fileName">The file name</param>
â”‚   â”‚   â”‚   â”‚  176 â”‚         /// <param name="filePath">The file path</param>
â”‚   â”‚   â”‚   â”‚  177 â”‚         /// <param name="category">The category</param>
â”‚   â”‚   â”‚   â”‚  178 â”‚         /// <param name="description">The description</param>
â”‚   â”‚   â”‚   â”‚  179 â”‚         /// <param name="fileSize">The file size</param>
â”‚   â”‚   â”‚   â”‚  180 â”‚         /// <returns>The added shared type</returns>
â”‚   â”‚   â”‚   â”‚  181 â”‚         public SharedType AddSharedType(
â”‚   â”‚   â”‚   â”‚  182 â”‚             string typeName,
â”‚   â”‚   â”‚   â”‚  183 â”‚             string fileName,
â”‚   â”‚   â”‚   â”‚  184 â”‚             string filePath,
â”‚   â”‚   â”‚   â”‚  185 â”‚             string category,
â”‚   â”‚   â”‚   â”‚  186 â”‚             string description,
â”‚   â”‚   â”‚   â”‚  187 â”‚             long fileSize)
â”‚   â”‚   â”‚   â”‚  188 â”‚         {
â”‚   â”‚   â”‚   â”‚  189 â”‚             if (string.IsNullOrWhiteSpace(typeName))
â”‚   â”‚   â”‚   â”‚  190 â”‚                 throw new ArgumentException("Type name cannot be empty", nameof(typeName));
â”‚   â”‚   â”‚   â”‚  191 â”‚ 
â”‚   â”‚   â”‚   â”‚  192 â”‚             if (string.IsNullOrWhiteSpace(filePath))
â”‚   â”‚   â”‚   â”‚  193 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(filePath));
â”‚   â”‚   â”‚   â”‚  194 â”‚ 
â”‚   â”‚   â”‚   â”‚  195 â”‚             if (_sharedTypes.Any(t => t.FilePath == filePath))
â”‚   â”‚   â”‚   â”‚  196 â”‚                 throw new InvalidOperationException($"Shared type at path '{filePath}' already exists");
â”‚   â”‚   â”‚   â”‚  197 â”‚ 
â”‚   â”‚   â”‚   â”‚  198 â”‚             var sharedType = new SharedType(
â”‚   â”‚   â”‚   â”‚  199 â”‚                 typeName,
â”‚   â”‚   â”‚   â”‚  200 â”‚                 fileName,
â”‚   â”‚   â”‚   â”‚  201 â”‚                 filePath,
â”‚   â”‚   â”‚   â”‚  202 â”‚                 category,
â”‚   â”‚   â”‚   â”‚  203 â”‚                 description,
â”‚   â”‚   â”‚   â”‚  204 â”‚                 fileSize);
â”‚   â”‚   â”‚   â”‚  205 â”‚ 
â”‚   â”‚   â”‚   â”‚  206 â”‚             _sharedTypes.Add(sharedType);
â”‚   â”‚   â”‚   â”‚  207 â”‚             UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  208 â”‚ 
â”‚   â”‚   â”‚   â”‚  209 â”‚             return sharedType;
â”‚   â”‚   â”‚   â”‚  210 â”‚         }
â”‚   â”‚   â”‚   â”‚  211 â”‚ 
â”‚   â”‚   â”‚   â”‚  212 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  213 â”‚         /// Updates the description of a shared type
â”‚   â”‚   â”‚   â”‚  214 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  215 â”‚         /// <param name="filePath">The file path of the shared type</param>
â”‚   â”‚   â”‚   â”‚  216 â”‚         /// <param name="description">The new description</param>
â”‚   â”‚   â”‚   â”‚  217 â”‚         /// <returns>True if updated, false if not found</returns>
â”‚   â”‚   â”‚   â”‚  218 â”‚         public bool UpdateSharedTypeDescription(string filePath, string description)
â”‚   â”‚   â”‚   â”‚  219 â”‚         {
â”‚   â”‚   â”‚   â”‚  220 â”‚             if (string.IsNullOrEmpty(filePath))
â”‚   â”‚   â”‚   â”‚  221 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  222 â”‚ 
â”‚   â”‚   â”‚   â”‚  223 â”‚             var sharedType = _sharedTypes.FirstOrDefault(t => t.FilePath == filePath);
â”‚   â”‚   â”‚   â”‚  224 â”‚             if (sharedType == null)
â”‚   â”‚   â”‚   â”‚  225 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  226 â”‚ 
â”‚   â”‚   â”‚   â”‚  227 â”‚             sharedType.UpdateDescription(description);
â”‚   â”‚   â”‚   â”‚  228 â”‚             UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  229 â”‚             return true;
â”‚   â”‚   â”‚   â”‚  230 â”‚         }
â”‚   â”‚   â”‚   â”‚  231 â”‚ 
â”‚   â”‚   â”‚   â”‚  232 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  233 â”‚         /// Removes a shared type from the project
â”‚   â”‚   â”‚   â”‚  234 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  235 â”‚         /// <param name="filePath">The file path of the shared type to remove</param>
â”‚   â”‚   â”‚   â”‚  236 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚   â”‚   â”‚   â”‚  237 â”‚         public bool RemoveSharedType(string filePath)
â”‚   â”‚   â”‚   â”‚  238 â”‚         {
â”‚   â”‚   â”‚   â”‚  239 â”‚             if (string.IsNullOrEmpty(filePath))
â”‚   â”‚   â”‚   â”‚  240 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  241 â”‚ 
â”‚   â”‚   â”‚   â”‚  242 â”‚             var sharedType = _sharedTypes.FirstOrDefault(t => t.FilePath == filePath);
â”‚   â”‚   â”‚   â”‚  243 â”‚             if (sharedType == null)
â”‚   â”‚   â”‚   â”‚  244 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  245 â”‚ 
â”‚   â”‚   â”‚   â”‚  246 â”‚             var result = _sharedTypes.Remove(sharedType);
â”‚   â”‚   â”‚   â”‚  247 â”‚             if (result)
â”‚   â”‚   â”‚   â”‚  248 â”‚                 UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  249 â”‚ 
â”‚   â”‚   â”‚   â”‚  250 â”‚             return result;
â”‚   â”‚   â”‚   â”‚  251 â”‚         }
â”‚   â”‚   â”‚   â”‚  252 â”‚ 
â”‚   â”‚   â”‚   â”‚  253 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  254 â”‚         /// Adds a custom type file to the project
â”‚   â”‚   â”‚   â”‚  255 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  256 â”‚         /// <param name="fileName">The file name</param>
â”‚   â”‚   â”‚   â”‚  257 â”‚         /// <param name="typeCount">The number of types</param>
â”‚   â”‚   â”‚   â”‚  258 â”‚         /// <param name="description">The description</param>
â”‚   â”‚   â”‚   â”‚  259 â”‚         /// <returns>The added custom type file</returns>
â”‚   â”‚   â”‚   â”‚  260 â”‚         public CustomTypeFile AddCustomTypeFile(string fileName, int typeCount, string description)
â”‚   â”‚   â”‚   â”‚  261 â”‚         {
â”‚   â”‚   â”‚   â”‚  262 â”‚             if (string.IsNullOrWhiteSpace(fileName))
â”‚   â”‚   â”‚   â”‚  263 â”‚                 throw new ArgumentException("File name cannot be empty", nameof(fileName));
â”‚   â”‚   â”‚   â”‚  264 â”‚ 
â”‚   â”‚   â”‚   â”‚  265 â”‚             if (_customTypeFiles.Any(f => f.FileName == fileName))
â”‚   â”‚   â”‚   â”‚  266 â”‚                 throw new InvalidOperationException($"Custom type file '{fileName}' already exists");
â”‚   â”‚   â”‚   â”‚  267 â”‚ 
â”‚   â”‚   â”‚   â”‚  268 â”‚             var customTypeFile = new CustomTypeFile(fileName, typeCount, description);
â”‚   â”‚   â”‚   â”‚  269 â”‚             _customTypeFiles.Add(customTypeFile);
â”‚   â”‚   â”‚   â”‚  270 â”‚ 
â”‚   â”‚   â”‚   â”‚  271 â”‚             UpdateModificationTime();
â”‚   â”‚   â”‚   â”‚  272 â”‚             return customTypeFile;
â”‚   â”‚   â”‚   â”‚  273 â”‚         }
â”‚   â”‚   â”‚   â”‚  274 â”‚ 
â”‚   â”‚   â”‚   â”‚  275 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  276 â”‚         /// Updates the modification time to now
â”‚   â”‚   â”‚   â”‚  277 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  278 â”‚         private void UpdateModificationTime()
â”‚   â”‚   â”‚   â”‚  279 â”‚         {
â”‚   â”‚   â”‚   â”‚  280 â”‚             LastModified = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚  281 â”‚         }
â”‚   â”‚   â”‚   â”‚  282 â”‚     }
â”‚   â”‚   â”‚   â”‚  283 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Session.cs (5.31 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: Session.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System.IO;    
â”‚   â”‚   â”‚   â”‚    7 â”‚ 
â”‚   â”‚   â”‚   â”‚    8 â”‚ namespace test.Core.Domain
â”‚   â”‚   â”‚   â”‚    9 â”‚ {
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Represents a session in the system.
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// A session is created when controllers are parsed and stored in the database.
â”‚   â”‚   â”‚   â”‚   13 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   14 â”‚     public class Session
â”‚   â”‚   â”‚   â”‚   15 â”‚     {
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// The unique ID of the session
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   19 â”‚         public string Id { get; }
â”‚   â”‚   â”‚   â”‚   20 â”‚ 
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   22 â”‚         /// The project ID this session belongs to, if any
â”‚   â”‚   â”‚   â”‚   23 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   24 â”‚         public string ProjectId { get; }
â”‚   â”‚   â”‚   â”‚   25 â”‚ 
â”‚   â”‚   â”‚   â”‚   26 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚         /// The original file name this session was created from
â”‚   â”‚   â”‚   â”‚   28 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   29 â”‚         public string FileName { get; }
â”‚   â”‚   â”‚   â”‚   30 â”‚ 
â”‚   â”‚   â”‚   â”‚   31 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   32 â”‚         /// The full path to the original file
â”‚   â”‚   â”‚   â”‚   33 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   34 â”‚         public string OriginalFilePath { get; }
â”‚   â”‚   â”‚   â”‚   35 â”‚ 
â”‚   â”‚   â”‚   â”‚   36 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   37 â”‚         /// The number of controllers in this session
â”‚   â”‚   â”‚   â”‚   38 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   39 â”‚         public int ControllerCount { get; private set; }
â”‚   â”‚   â”‚   â”‚   40 â”‚ 
â”‚   â”‚   â”‚   â”‚   41 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   42 â”‚         /// The date this session was created
â”‚   â”‚   â”‚   â”‚   43 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   44 â”‚         public DateTime Created { get; }
â”‚   â”‚   â”‚   â”‚   45 â”‚ 
â”‚   â”‚   â”‚   â”‚   46 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   47 â”‚         /// The controller names in this session
â”‚   â”‚   â”‚   â”‚   48 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   49 â”‚         private readonly HashSet<string> _controllerNames = new();
â”‚   â”‚   â”‚   â”‚   50 â”‚ 
â”‚   â”‚   â”‚   â”‚   51 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   52 â”‚         /// Read-only collection of controller names
â”‚   â”‚   â”‚   â”‚   53 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   54 â”‚         public IReadOnlyCollection<string> ControllerNames => _controllerNames.ToList().AsReadOnly();
â”‚   â”‚   â”‚   â”‚   55 â”‚ 
â”‚   â”‚   â”‚   â”‚   56 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   57 â”‚         /// Creates a new session
â”‚   â”‚   â”‚   â”‚   58 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   59 â”‚         /// <param name="id">The session ID</param>
â”‚   â”‚   â”‚   â”‚   60 â”‚         /// <param name="originalFilePath">The original file path</param>
â”‚   â”‚   â”‚   â”‚   61 â”‚         /// <param name="projectId">The project ID (optional)</param>
â”‚   â”‚   â”‚   â”‚   62 â”‚         public Session(string id, string originalFilePath, string projectId = null)
â”‚   â”‚   â”‚   â”‚   63 â”‚         {
â”‚   â”‚   â”‚   â”‚   64 â”‚             if (string.IsNullOrWhiteSpace(id))
â”‚   â”‚   â”‚   â”‚   65 â”‚                 throw new ArgumentException("Session ID cannot be empty", nameof(id));
â”‚   â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   â”‚   67 â”‚             Id = id;
â”‚   â”‚   â”‚   â”‚   68 â”‚             ProjectId = projectId;
â”‚   â”‚   â”‚   â”‚   69 â”‚             OriginalFilePath = originalFilePath;
â”‚   â”‚   â”‚   â”‚   70 â”‚             FileName = originalFilePath != null ? Path.GetFileName(originalFilePath) : null;
â”‚   â”‚   â”‚   â”‚   71 â”‚             Created = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚   72 â”‚         }
â”‚   â”‚   â”‚   â”‚   73 â”‚ 
â”‚   â”‚   â”‚   â”‚   74 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   75 â”‚         /// Constructor for loading existing sessions
â”‚   â”‚   â”‚   â”‚   76 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   77 â”‚         internal Session(
â”‚   â”‚   â”‚   â”‚   78 â”‚             string id,
â”‚   â”‚   â”‚   â”‚   79 â”‚             string originalFilePath,
â”‚   â”‚   â”‚   â”‚   80 â”‚             string projectId,
â”‚   â”‚   â”‚   â”‚   81 â”‚             int controllerCount,
â”‚   â”‚   â”‚   â”‚   82 â”‚             DateTime created,
â”‚   â”‚   â”‚   â”‚   83 â”‚             IEnumerable<string> controllerNames = null)
â”‚   â”‚   â”‚   â”‚   84 â”‚         {
â”‚   â”‚   â”‚   â”‚   85 â”‚             Id = id;
â”‚   â”‚   â”‚   â”‚   86 â”‚             OriginalFilePath = originalFilePath;
â”‚   â”‚   â”‚   â”‚   87 â”‚             FileName = originalFilePath != null ? Path.GetFileName(originalFilePath) : null;
â”‚   â”‚   â”‚   â”‚   88 â”‚             ProjectId = projectId;
â”‚   â”‚   â”‚   â”‚   89 â”‚             ControllerCount = controllerCount;
â”‚   â”‚   â”‚   â”‚   90 â”‚             Created = created;
â”‚   â”‚   â”‚   â”‚   91 â”‚ 
â”‚   â”‚   â”‚   â”‚   92 â”‚             if (controllerNames != null)
â”‚   â”‚   â”‚   â”‚   93 â”‚             {
â”‚   â”‚   â”‚   â”‚   94 â”‚                 foreach (var name in controllerNames)
â”‚   â”‚   â”‚   â”‚   95 â”‚                 {
â”‚   â”‚   â”‚   â”‚   96 â”‚                     AddControllerName(name);
â”‚   â”‚   â”‚   â”‚   97 â”‚                 }
â”‚   â”‚   â”‚   â”‚   98 â”‚             }
â”‚   â”‚   â”‚   â”‚   99 â”‚         }
â”‚   â”‚   â”‚   â”‚  100 â”‚ 
â”‚   â”‚   â”‚   â”‚  101 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  102 â”‚         /// Adds a controller name to the session
â”‚   â”‚   â”‚   â”‚  103 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  104 â”‚         /// <param name="controllerName">The controller name</param>
â”‚   â”‚   â”‚   â”‚  105 â”‚         public void AddControllerName(string controllerName)
â”‚   â”‚   â”‚   â”‚  106 â”‚         {
â”‚   â”‚   â”‚   â”‚  107 â”‚             if (string.IsNullOrWhiteSpace(controllerName))
â”‚   â”‚   â”‚   â”‚  108 â”‚                 return;
â”‚   â”‚   â”‚   â”‚  109 â”‚ 
â”‚   â”‚   â”‚   â”‚  110 â”‚             _controllerNames.Add(controllerName);
â”‚   â”‚   â”‚   â”‚  111 â”‚         }
â”‚   â”‚   â”‚   â”‚  112 â”‚ 
â”‚   â”‚   â”‚   â”‚  113 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  114 â”‚         /// Sets the controller count
â”‚   â”‚   â”‚   â”‚  115 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  116 â”‚         /// <param name="count">The new count</param>
â”‚   â”‚   â”‚   â”‚  117 â”‚         public void SetControllerCount(int count)
â”‚   â”‚   â”‚   â”‚  118 â”‚         {
â”‚   â”‚   â”‚   â”‚  119 â”‚             if (count < 0)
â”‚   â”‚   â”‚   â”‚  120 â”‚                 throw new ArgumentException("Controller count cannot be negative", nameof(count));
â”‚   â”‚   â”‚   â”‚  121 â”‚ 
â”‚   â”‚   â”‚   â”‚  122 â”‚             ControllerCount = count;
â”‚   â”‚   â”‚   â”‚  123 â”‚         }
â”‚   â”‚   â”‚   â”‚  124 â”‚ 
â”‚   â”‚   â”‚   â”‚  125 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  126 â”‚         /// Gets the display name for this session
â”‚   â”‚   â”‚   â”‚  127 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  128 â”‚         /// <returns>The display name</returns>
â”‚   â”‚   â”‚   â”‚  129 â”‚         public string GetDisplayName()
â”‚   â”‚   â”‚   â”‚  130 â”‚         {
â”‚   â”‚   â”‚   â”‚  131 â”‚             if (!string.IsNullOrEmpty(FileName))
â”‚   â”‚   â”‚   â”‚  132 â”‚                 return FileName;
â”‚   â”‚   â”‚   â”‚  133 â”‚ 
â”‚   â”‚   â”‚   â”‚  134 â”‚             // Use first part of session ID as fallback
â”‚   â”‚   â”‚   â”‚  135 â”‚             if (!string.IsNullOrEmpty(Id) && Id.Length >= 8)
â”‚   â”‚   â”‚   â”‚  136 â”‚                 return $"Session {Id.Substring(0, 8)}";
â”‚   â”‚   â”‚   â”‚  137 â”‚ 
â”‚   â”‚   â”‚   â”‚  138 â”‚             return "Unknown Session";
â”‚   â”‚   â”‚   â”‚  139 â”‚         }
â”‚   â”‚   â”‚   â”‚  140 â”‚ 
â”‚   â”‚   â”‚   â”‚  141 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  142 â”‚         /// Gets additional display information for the session
â”‚   â”‚   â”‚   â”‚  143 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  144 â”‚         /// <returns>The display information</returns>
â”‚   â”‚   â”‚   â”‚  145 â”‚         public string GetDisplayInfo()
â”‚   â”‚   â”‚   â”‚  146 â”‚         {
â”‚   â”‚   â”‚   â”‚  147 â”‚             var parts = new List<string>();
â”‚   â”‚   â”‚   â”‚  148 â”‚ 
â”‚   â”‚   â”‚   â”‚  149 â”‚             if (ControllerCount > 0)
â”‚   â”‚   â”‚   â”‚  150 â”‚                 parts.Add($"{ControllerCount} controllers");
â”‚   â”‚   â”‚   â”‚  151 â”‚ 
â”‚   â”‚   â”‚   â”‚  152 â”‚             if (Created != DateTime.MinValue)
â”‚   â”‚   â”‚   â”‚  153 â”‚                 parts.Add($"{Created:MMM dd, yyyy HH:mm}");
â”‚   â”‚   â”‚   â”‚  154 â”‚ 
â”‚   â”‚   â”‚   â”‚  155 â”‚             return parts.Count > 0 ? string.Join(" - ", parts) : "No details available";
â”‚   â”‚   â”‚   â”‚  156 â”‚         }
â”‚   â”‚   â”‚   â”‚  157 â”‚ 
â”‚   â”‚   â”‚   â”‚  158 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  159 â”‚         /// Checks if this is a project session
â”‚   â”‚   â”‚   â”‚  160 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  161 â”‚         /// <returns>True if this is a project session, false otherwise</returns>
â”‚   â”‚   â”‚   â”‚  162 â”‚         public bool IsProjectSession()
â”‚   â”‚   â”‚   â”‚  163 â”‚         {
â”‚   â”‚   â”‚   â”‚  164 â”‚             return !string.IsNullOrEmpty(ProjectId);
â”‚   â”‚   â”‚   â”‚  165 â”‚         }
â”‚   â”‚   â”‚   â”‚  166 â”‚     }
â”‚   â”‚   â”‚   â”‚  167 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ SharedType.cs (4.14 KB, 2025-03-11 09:48:27)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: SharedType.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚       â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚       â”‚    3 â”‚ using System.Linq;
â”‚   â”‚       â”‚    4 â”‚ using System.Text;
â”‚   â”‚       â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚       â”‚    6 â”‚ using System.IO;
â”‚   â”‚       â”‚    7 â”‚ 
â”‚   â”‚       â”‚    8 â”‚ namespace test.Core.Domain
â”‚   â”‚       â”‚    9 â”‚ {
â”‚   â”‚       â”‚   10 â”‚     /// <summary>
â”‚   â”‚       â”‚   11 â”‚     /// Represents a shared type in a project.
â”‚   â”‚       â”‚   12 â”‚     /// </summary>
â”‚   â”‚       â”‚   13 â”‚     public class SharedType
â”‚   â”‚       â”‚   14 â”‚     {
â”‚   â”‚       â”‚   15 â”‚         /// <summary>
â”‚   â”‚       â”‚   16 â”‚         /// The name of the type
â”‚   â”‚       â”‚   17 â”‚         /// </summary>
â”‚   â”‚       â”‚   18 â”‚         public string TypeName { get; }
â”‚   â”‚       â”‚   19 â”‚ 
â”‚   â”‚       â”‚   20 â”‚         /// <summary>
â”‚   â”‚       â”‚   21 â”‚         /// The file name
â”‚   â”‚       â”‚   22 â”‚         /// </summary>
â”‚   â”‚       â”‚   23 â”‚         public string FileName { get; }
â”‚   â”‚       â”‚   24 â”‚ 
â”‚   â”‚       â”‚   25 â”‚         /// <summary>
â”‚   â”‚       â”‚   26 â”‚         /// The file path
â”‚   â”‚       â”‚   27 â”‚         /// </summary>
â”‚   â”‚       â”‚   28 â”‚         public string FilePath { get; }
â”‚   â”‚       â”‚   29 â”‚ 
â”‚   â”‚       â”‚   30 â”‚         /// <summary>
â”‚   â”‚       â”‚   31 â”‚         /// The category of the shared type
â”‚   â”‚       â”‚   32 â”‚         /// </summary>
â”‚   â”‚       â”‚   33 â”‚         public string Category { get; }
â”‚   â”‚       â”‚   34 â”‚ 
â”‚   â”‚       â”‚   35 â”‚         /// <summary>
â”‚   â”‚       â”‚   36 â”‚         /// The description of the shared type
â”‚   â”‚       â”‚   37 â”‚         /// </summary>
â”‚   â”‚       â”‚   38 â”‚         public string Description { get; private set; }
â”‚   â”‚       â”‚   39 â”‚ 
â”‚   â”‚       â”‚   40 â”‚         /// <summary>
â”‚   â”‚       â”‚   41 â”‚         /// The date the shared type was imported
â”‚   â”‚       â”‚   42 â”‚         /// </summary>
â”‚   â”‚       â”‚   43 â”‚         public DateTime ImportDate { get; }
â”‚   â”‚       â”‚   44 â”‚ 
â”‚   â”‚       â”‚   45 â”‚         /// <summary>
â”‚   â”‚       â”‚   46 â”‚         /// The file size in bytes
â”‚   â”‚       â”‚   47 â”‚         /// </summary>
â”‚   â”‚       â”‚   48 â”‚         public long FileSize { get; }
â”‚   â”‚       â”‚   49 â”‚ 
â”‚   â”‚       â”‚   50 â”‚         /// <summary>
â”‚   â”‚       â”‚   51 â”‚         /// The number of times the shared type has been used
â”‚   â”‚       â”‚   52 â”‚         /// </summary>
â”‚   â”‚       â”‚   53 â”‚         public int UsageCount { get; private set; }
â”‚   â”‚       â”‚   54 â”‚ 
â”‚   â”‚       â”‚   55 â”‚         /// <summary>
â”‚   â”‚       â”‚   56 â”‚         /// The number of variables in the shared type
â”‚   â”‚       â”‚   57 â”‚         /// </summary>
â”‚   â”‚       â”‚   58 â”‚         public int VariableCount { get; private set; }
â”‚   â”‚       â”‚   59 â”‚ 
â”‚   â”‚       â”‚   60 â”‚         /// <summary>
â”‚   â”‚       â”‚   61 â”‚         /// The default target name for the shared type
â”‚   â”‚       â”‚   62 â”‚         /// </summary>
â”‚   â”‚       â”‚   63 â”‚         public string DefaultTargetName { get; private set; }
â”‚   â”‚       â”‚   64 â”‚ 
â”‚   â”‚       â”‚   65 â”‚         /// <summary>
â”‚   â”‚       â”‚   66 â”‚         /// Creates a new shared type
â”‚   â”‚       â”‚   67 â”‚         /// </summary>
â”‚   â”‚       â”‚   68 â”‚         /// <param name="typeName">The type name</param>
â”‚   â”‚       â”‚   69 â”‚         /// <param name="fileName">The file name</param>
â”‚   â”‚       â”‚   70 â”‚         /// <param name="filePath">The file path</param>
â”‚   â”‚       â”‚   71 â”‚         /// <param name="category">The category</param>
â”‚   â”‚       â”‚   72 â”‚         /// <param name="description">The description</param>
â”‚   â”‚       â”‚   73 â”‚         /// <param name="fileSize">The file size</param>
â”‚   â”‚       â”‚   74 â”‚         public SharedType(
â”‚   â”‚       â”‚   75 â”‚             string typeName,
â”‚   â”‚       â”‚   76 â”‚             string fileName,
â”‚   â”‚       â”‚   77 â”‚             string filePath,
â”‚   â”‚       â”‚   78 â”‚             string category,
â”‚   â”‚       â”‚   79 â”‚             string description,
â”‚   â”‚       â”‚   80 â”‚             long fileSize)
â”‚   â”‚       â”‚   81 â”‚         {
â”‚   â”‚       â”‚   82 â”‚             if (string.IsNullOrWhiteSpace(typeName))
â”‚   â”‚       â”‚   83 â”‚                 throw new ArgumentException("Type name cannot be empty", nameof(typeName));
â”‚   â”‚       â”‚   84 â”‚ 
â”‚   â”‚       â”‚   85 â”‚             if (string.IsNullOrWhiteSpace(filePath))
â”‚   â”‚       â”‚   86 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(filePath));
â”‚   â”‚       â”‚   87 â”‚ 
â”‚   â”‚       â”‚   88 â”‚             TypeName = typeName;
â”‚   â”‚       â”‚   89 â”‚             FileName = fileName ?? Path.GetFileName(filePath);
â”‚   â”‚       â”‚   90 â”‚             FilePath = filePath;
â”‚   â”‚       â”‚   91 â”‚             Category = category ?? "Default";
â”‚   â”‚       â”‚   92 â”‚             Description = description ?? string.Empty;
â”‚   â”‚       â”‚   93 â”‚             FileSize = fileSize;
â”‚   â”‚       â”‚   94 â”‚             ImportDate = DateTime.UtcNow;
â”‚   â”‚       â”‚   95 â”‚             UsageCount = 0;
â”‚   â”‚       â”‚   96 â”‚         }
â”‚   â”‚       â”‚   97 â”‚ 
â”‚   â”‚       â”‚   98 â”‚         /// <summary>
â”‚   â”‚       â”‚   99 â”‚         /// Updates the description of the shared type
â”‚   â”‚       â”‚  100 â”‚         /// </summary>
â”‚   â”‚       â”‚  101 â”‚         /// <param name="description">The new description</param>
â”‚   â”‚       â”‚  102 â”‚         public void UpdateDescription(string description)
â”‚   â”‚       â”‚  103 â”‚         {
â”‚   â”‚       â”‚  104 â”‚             Description = description ?? string.Empty;
â”‚   â”‚       â”‚  105 â”‚         }
â”‚   â”‚       â”‚  106 â”‚ 
â”‚   â”‚       â”‚  107 â”‚         /// <summary>
â”‚   â”‚       â”‚  108 â”‚         /// Sets the number of variables in the shared type
â”‚   â”‚       â”‚  109 â”‚         /// </summary>
â”‚   â”‚       â”‚  110 â”‚         /// <param name="count">The variable count</param>
â”‚   â”‚       â”‚  111 â”‚         public void SetVariableCount(int count)
â”‚   â”‚       â”‚  112 â”‚         {
â”‚   â”‚       â”‚  113 â”‚             if (count < 0)
â”‚   â”‚       â”‚  114 â”‚                 throw new ArgumentException("Variable count cannot be negative", nameof(count));
â”‚   â”‚       â”‚  115 â”‚ 
â”‚   â”‚       â”‚  116 â”‚             VariableCount = count;
â”‚   â”‚       â”‚  117 â”‚         }
â”‚   â”‚       â”‚  118 â”‚ 
â”‚   â”‚       â”‚  119 â”‚         /// <summary>
â”‚   â”‚       â”‚  120 â”‚         /// Sets the default target name for the shared type
â”‚   â”‚       â”‚  121 â”‚         /// </summary>
â”‚   â”‚       â”‚  122 â”‚         /// <param name="targetName">The target name</param>
â”‚   â”‚       â”‚  123 â”‚         public void SetDefaultTargetName(string targetName)
â”‚   â”‚       â”‚  124 â”‚         {
â”‚   â”‚       â”‚  125 â”‚             DefaultTargetName = targetName ?? string.Empty;
â”‚   â”‚       â”‚  126 â”‚         }
â”‚   â”‚       â”‚  127 â”‚ 
â”‚   â”‚       â”‚  128 â”‚         /// <summary>
â”‚   â”‚       â”‚  129 â”‚         /// Increments the usage count by one
â”‚   â”‚       â”‚  130 â”‚         /// </summary>
â”‚   â”‚       â”‚  131 â”‚         public void IncrementUsageCount()
â”‚   â”‚       â”‚  132 â”‚         {
â”‚   â”‚       â”‚  133 â”‚             UsageCount++;
â”‚   â”‚       â”‚  134 â”‚         }
â”‚   â”‚       â”‚  135 â”‚     }
â”‚   â”‚       â”‚  136 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   ğŸ“ Dto
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerGroupDto.cs (1.21 KB, 2025-03-11 13:30:26)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ControllerGroupDto.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    2 â”‚ 
â”‚   â”‚   â”‚   â”‚    3 â”‚ namespace test.Core.Dto
â”‚   â”‚   â”‚   â”‚    4 â”‚ {
â”‚   â”‚   â”‚   â”‚    5 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚    6 â”‚     /// Data Transfer Object for controller groups.
â”‚   â”‚   â”‚   â”‚    7 â”‚     /// Used in service interfaces for looser coupling and mutable properties.
â”‚   â”‚   â”‚   â”‚    8 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚    9 â”‚     public class ControllerGroupDto
â”‚   â”‚   â”‚   â”‚   10 â”‚     {
â”‚   â”‚   â”‚   â”‚   11 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚         /// The group identifier
â”‚   â”‚   â”‚   â”‚   13 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   14 â”‚         public string GroupIdentifier { get; set; }
â”‚   â”‚   â”‚   â”‚   15 â”‚ 
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// The controller names in this group
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   19 â”‚         public List<string> ControllerNames { get; set; } = new List<string>();
â”‚   â”‚   â”‚   â”‚   20 â”‚ 
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   22 â”‚         /// Original values from controllers (pre-replacement)
â”‚   â”‚   â”‚   â”‚   23 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   24 â”‚         public Dictionary<string, string> OriginalValues { get; set; } = new Dictionary<string, string>();
â”‚   â”‚   â”‚   â”‚   25 â”‚ 
â”‚   â”‚   â”‚   â”‚   26 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚         /// Processed values after name processing
â”‚   â”‚   â”‚   â”‚   28 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   29 â”‚         public Dictionary<string, string> ProcessedValues { get; set; } = new Dictionary<string, string>();
â”‚   â”‚   â”‚   â”‚   30 â”‚ 
â”‚   â”‚   â”‚   â”‚   31 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   32 â”‚         /// Mapping from original to processed names
â”‚   â”‚   â”‚   â”‚   33 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   34 â”‚         public Dictionary<string, string> NameMapping { get; set; } = new Dictionary<string, string>();
â”‚   â”‚   â”‚   â”‚   35 â”‚     }
â”‚   â”‚   â”‚   â”‚   36 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ SimilarityResultDto.cs (1.29 KB, 2025-03-11 13:31:10)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: SimilarityResultDto.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using System.Collections.Generic;
â”‚   â”‚       â”‚    2 â”‚ 
â”‚   â”‚       â”‚    3 â”‚ namespace test.Core.Dto
â”‚   â”‚       â”‚    4 â”‚ {
â”‚   â”‚       â”‚    5 â”‚     /// <summary>
â”‚   â”‚       â”‚    6 â”‚     /// Data Transfer Object for similarity search results
â”‚   â”‚       â”‚    7 â”‚     /// </summary>
â”‚   â”‚       â”‚    8 â”‚     public class SimilarityResultDto
â”‚   â”‚       â”‚    9 â”‚     {
â”‚   â”‚       â”‚   10 â”‚         /// <summary>
â”‚   â”‚       â”‚   11 â”‚         /// The group identifier
â”‚   â”‚       â”‚   12 â”‚         /// </summary>
â”‚   â”‚       â”‚   13 â”‚         public string GroupIdentifier { get; set; }
â”‚   â”‚       â”‚   14 â”‚ 
â”‚   â”‚       â”‚   15 â”‚         /// <summary>
â”‚   â”‚       â”‚   16 â”‚         /// The controller names in this group
â”‚   â”‚       â”‚   17 â”‚         /// </summary>
â”‚   â”‚       â”‚   18 â”‚         public List<string> ControllerNames { get; set; } = new List<string>();
â”‚   â”‚       â”‚   19 â”‚ 
â”‚   â”‚       â”‚   20 â”‚         /// <summary>
â”‚   â”‚       â”‚   21 â”‚         /// The similarity score (0.0-1.0)
â”‚   â”‚       â”‚   22 â”‚         /// </summary>
â”‚   â”‚       â”‚   23 â”‚         public double SimilarityScore { get; set; }
â”‚   â”‚       â”‚   24 â”‚ 
â”‚   â”‚       â”‚   25 â”‚         /// <summary>
â”‚   â”‚       â”‚   26 â”‚         /// The original values before any name processing
â”‚   â”‚       â”‚   27 â”‚         /// </summary>
â”‚   â”‚       â”‚   28 â”‚         public Dictionary<string, string> OriginalValues { get; set; } = new Dictionary<string, string>();
â”‚   â”‚       â”‚   29 â”‚ 
â”‚   â”‚       â”‚   30 â”‚         /// <summary>
â”‚   â”‚       â”‚   31 â”‚         /// The processed values used for comparison
â”‚   â”‚       â”‚   32 â”‚         /// </summary>
â”‚   â”‚       â”‚   33 â”‚         public Dictionary<string, string> ProcessedValues { get; set; } = new Dictionary<string, string>();
â”‚   â”‚       â”‚   34 â”‚ 
â”‚   â”‚       â”‚   35 â”‚         /// <summary>
â”‚   â”‚       â”‚   36 â”‚         /// The mapping between original and processed names
â”‚   â”‚       â”‚   37 â”‚         /// </summary>
â”‚   â”‚       â”‚   38 â”‚         public Dictionary<string, string> NameMapping { get; set; } = new Dictionary<string, string>();
â”‚   â”‚       â”‚   39 â”‚     }
â”‚   â”‚       â”‚   40 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   ğŸ“ Exceptions
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ BusinessRuleException.cs (528.00 B, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: BusinessRuleException.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Exceptions
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Exception thrown when a business rule is violated
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚     public class BusinessRuleException : DomainExceptionBase
â”‚   â”‚   â”‚   â”‚   13 â”‚     {
â”‚   â”‚   â”‚   â”‚   14 â”‚         public BusinessRuleException(string message) : base(message) { }
â”‚   â”‚   â”‚   â”‚   15 â”‚         public BusinessRuleException(string message, Exception innerException) : base(message, innerException) { }
â”‚   â”‚   â”‚   â”‚   16 â”‚     }
â”‚   â”‚   â”‚   â”‚   17 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DataAccessException.cs (1.23 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: DataAccessException.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    7 â”‚ 
â”‚   â”‚   â”‚   â”‚    8 â”‚ namespace test.Core.Exceptions
â”‚   â”‚   â”‚   â”‚    9 â”‚ {
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Exception thrown when a data access operation fails
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public class DataAccessException : DomainExceptionBase
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         public string Operation { get; }
â”‚   â”‚   â”‚   â”‚   16 â”‚         public string EntityType { get; }
â”‚   â”‚   â”‚   â”‚   17 â”‚ 
â”‚   â”‚   â”‚   â”‚   18 â”‚         public DataAccessException(string message, string operation, string entityType = null)
â”‚   â”‚   â”‚   â”‚   19 â”‚             : base(message)
â”‚   â”‚   â”‚   â”‚   20 â”‚         {
â”‚   â”‚   â”‚   â”‚   21 â”‚             Operation = operation;
â”‚   â”‚   â”‚   â”‚   22 â”‚             EntityType = entityType;
â”‚   â”‚   â”‚   â”‚   23 â”‚         }
â”‚   â”‚   â”‚   â”‚   24 â”‚ 
â”‚   â”‚   â”‚   â”‚   25 â”‚         public DataAccessException(string message, string operation, string entityType, Exception innerException)
â”‚   â”‚   â”‚   â”‚   26 â”‚             : base(message, innerException)
â”‚   â”‚   â”‚   â”‚   27 â”‚         {
â”‚   â”‚   â”‚   â”‚   28 â”‚             Operation = operation;
â”‚   â”‚   â”‚   â”‚   29 â”‚             EntityType = entityType;
â”‚   â”‚   â”‚   â”‚   30 â”‚         }
â”‚   â”‚   â”‚   â”‚   31 â”‚ 
â”‚   â”‚   â”‚   â”‚   32 â”‚         // Add a new constructor that takes just operation and exception - fixes the argument conversion error
â”‚   â”‚   â”‚   â”‚   33 â”‚         public DataAccessException(string message, string operation, Exception innerException)
â”‚   â”‚   â”‚   â”‚   34 â”‚             : base(message, innerException)
â”‚   â”‚   â”‚   â”‚   35 â”‚         {
â”‚   â”‚   â”‚   â”‚   36 â”‚             Operation = operation;
â”‚   â”‚   â”‚   â”‚   37 â”‚             EntityType = null;
â”‚   â”‚   â”‚   â”‚   38 â”‚         }
â”‚   â”‚   â”‚   â”‚   39 â”‚     }
â”‚   â”‚   â”‚   â”‚   40 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DomainExceptionBase.cs (527.00 B, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: DomainExceptionBase.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Exceptions
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Base exception class for all domain-specific exceptions
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚     public abstract class DomainExceptionBase : Exception
â”‚   â”‚   â”‚   â”‚   13 â”‚     {
â”‚   â”‚   â”‚   â”‚   14 â”‚         public DomainExceptionBase(string message) : base(message) { }
â”‚   â”‚   â”‚   â”‚   15 â”‚         public DomainExceptionBase(string message, Exception innerException) : base(message, innerException) { }
â”‚   â”‚   â”‚   â”‚   16 â”‚     }
â”‚   â”‚   â”‚   â”‚   17 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ NotFoundException.cs (733.00 B, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: NotFoundException.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ namespace test.Core.Exceptions
â”‚   â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// Exception thrown when a requested entity cannot be found
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚     public class NotFoundException : DomainExceptionBase
â”‚   â”‚   â”‚   â”‚   13 â”‚     {
â”‚   â”‚   â”‚   â”‚   14 â”‚         public string EntityType { get; }
â”‚   â”‚   â”‚   â”‚   15 â”‚         public string EntityId { get; }
â”‚   â”‚   â”‚   â”‚   16 â”‚ 
â”‚   â”‚   â”‚   â”‚   17 â”‚         public NotFoundException(string message) : base(message) { }
â”‚   â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   â”‚   19 â”‚         public NotFoundException(string entityType, string entityId)
â”‚   â”‚   â”‚   â”‚   20 â”‚             : base($"{entityType} with ID {entityId} was not found")
â”‚   â”‚   â”‚   â”‚   21 â”‚         {
â”‚   â”‚   â”‚   â”‚   22 â”‚             EntityType = entityType;
â”‚   â”‚   â”‚   â”‚   23 â”‚             EntityId = entityId;
â”‚   â”‚   â”‚   â”‚   24 â”‚         }
â”‚   â”‚   â”‚   â”‚   25 â”‚     }
â”‚   â”‚   â”‚   â”‚   26 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ ParsingException.cs (943.00 B, 2025-03-11 09:48:27)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: ParsingException.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚       â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚       â”‚    3 â”‚ using System.Linq;
â”‚   â”‚       â”‚    4 â”‚ using System.Text;
â”‚   â”‚       â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚       â”‚    6 â”‚ using System.IO;
â”‚   â”‚       â”‚    7 â”‚ 
â”‚   â”‚       â”‚    8 â”‚ namespace test.Core.Exceptions
â”‚   â”‚       â”‚    9 â”‚ {
â”‚   â”‚       â”‚   10 â”‚     /// <summary>
â”‚   â”‚       â”‚   11 â”‚     /// Exception thrown when a parsing operation fails
â”‚   â”‚       â”‚   12 â”‚     /// </summary>
â”‚   â”‚       â”‚   13 â”‚     public class ParsingException : DomainExceptionBase
â”‚   â”‚       â”‚   14 â”‚     {
â”‚   â”‚       â”‚   15 â”‚         public string FilePath { get; }
â”‚   â”‚       â”‚   16 â”‚         public string FileType { get; }
â”‚   â”‚       â”‚   17 â”‚ 
â”‚   â”‚       â”‚   18 â”‚         public ParsingException(string message, string filePath)
â”‚   â”‚       â”‚   19 â”‚             : base(message)
â”‚   â”‚       â”‚   20 â”‚         {
â”‚   â”‚       â”‚   21 â”‚             FilePath = filePath;
â”‚   â”‚       â”‚   22 â”‚             FileType = Path.GetExtension(filePath)?.TrimStart('.') ?? "unknown";
â”‚   â”‚       â”‚   23 â”‚         }
â”‚   â”‚       â”‚   24 â”‚ 
â”‚   â”‚       â”‚   25 â”‚         public ParsingException(string message, string filePath, Exception innerException)
â”‚   â”‚       â”‚   26 â”‚             : base(message, innerException)
â”‚   â”‚       â”‚   27 â”‚         {
â”‚   â”‚       â”‚   28 â”‚             FilePath = filePath;
â”‚   â”‚       â”‚   29 â”‚             FileType = Path.GetExtension(filePath)?.TrimStart('.') ?? "unknown";
â”‚   â”‚       â”‚   30 â”‚         }
â”‚   â”‚       â”‚   31 â”‚     }
â”‚   â”‚       â”‚   32 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       ğŸ“ Interfaces
â”‚       â”œâ”€â”€ ğŸ“„ IComparisonService.cs (5.11 KB, 2025-03-11 13:29:32)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IComparisonService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System.Collections.Generic;
â”‚       â”‚   â”‚    2 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    3 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    4 â”‚ using test.Core.Dto;
â”‚       â”‚   â”‚    5 â”‚ 
â”‚       â”‚   â”‚    6 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    7 â”‚ {
â”‚       â”‚   â”‚    8 â”‚     /// <summary>
â”‚       â”‚   â”‚    9 â”‚     /// Service interface for comparing controller data with XML and other formats
â”‚       â”‚   â”‚   10 â”‚     /// </summary>
â”‚       â”‚   â”‚   11 â”‚     public interface IComparisonService
â”‚       â”‚   â”‚   12 â”‚     {
â”‚       â”‚   â”‚   13 â”‚         /// <summary>
â”‚       â”‚   â”‚   14 â”‚         /// Compares controllers with XML content
â”‚       â”‚   â”‚   15 â”‚         /// </summary>
â”‚       â”‚   â”‚   16 â”‚         /// <param name="xmlContent">The XML content to compare with</param>
â”‚       â”‚   â”‚   17 â”‚         /// <param name="controllers">The controllers to compare</param>
â”‚       â”‚   â”‚   18 â”‚         /// <returns>A collection of comparison results</returns>
â”‚       â”‚   â”‚   19 â”‚         Task<IEnumerable<ComparisonResult>> CompareWithXmlAsync(string xmlContent, IEnumerable<Controller> controllers);
â”‚       â”‚   â”‚   20 â”‚ 
â”‚       â”‚   â”‚   21 â”‚         /// <summary>
â”‚       â”‚   â”‚   22 â”‚         /// Generates modified XML content based on a controller
â”‚       â”‚   â”‚   23 â”‚         /// </summary>
â”‚       â”‚   â”‚   24 â”‚         /// <param name="originalXmlContent">The original XML content</param>
â”‚       â”‚   â”‚   25 â”‚         /// <param name="controller">The controller to use for modifications</param>
â”‚       â”‚   â”‚   26 â”‚         /// <param name="targetName">Optional target name for the modified XML</param>
â”‚       â”‚   â”‚   27 â”‚         /// <returns>The modified XML content</returns>
â”‚       â”‚   â”‚   28 â”‚         Task<string> GenerateModifiedXmlAsync(string originalXmlContent, Controller controller, string targetName = null);
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         /// <summary>
â”‚       â”‚   â”‚   31 â”‚         /// Groups controllers based on similarities
â”‚       â”‚   â”‚   32 â”‚         /// </summary>
â”‚       â”‚   â”‚   33 â”‚         /// <param name="controllers">The controllers to group</param>
â”‚       â”‚   â”‚   34 â”‚         /// <param name="options">Grouping options</param>
â”‚       â”‚   â”‚   35 â”‚         /// <returns>A collection of controller groups</returns>
â”‚       â”‚   â”‚   36 â”‚         Task<IEnumerable<ControllerGroup>> GroupControllersAsync(IEnumerable<Controller> controllers, GroupingOptions options = null);
â”‚       â”‚   â”‚   37 â”‚ 
â”‚       â”‚   â”‚   38 â”‚         /// <summary>
â”‚       â”‚   â”‚   39 â”‚         /// Find similar controllers in XML content
â”‚       â”‚   â”‚   40 â”‚         /// </summary>
â”‚       â”‚   â”‚   41 â”‚         /// <param name="xmlContent">The XML content to search in</param>
â”‚       â”‚   â”‚   42 â”‚         /// <param name="controllers">The controllers to find similarities for</param>
â”‚       â”‚   â”‚   43 â”‚         /// <param name="options">Grouping options</param>
â”‚       â”‚   â”‚   44 â”‚         /// <returns>A collection of similarity results</returns>
â”‚       â”‚   â”‚   45 â”‚         Task<IEnumerable<SimilarityResultDto>> FindSimilarControllersAsync(string xmlContent, IEnumerable<Controller> controllers, GroupingOptions options = null);
â”‚       â”‚   â”‚   46 â”‚     }
â”‚       â”‚   â”‚   47 â”‚ 
â”‚       â”‚   â”‚   48 â”‚     /// <summary>
â”‚       â”‚   â”‚   49 â”‚     /// Options for controller grouping
â”‚       â”‚   â”‚   50 â”‚     /// </summary>
â”‚       â”‚   â”‚   51 â”‚     public class GroupingOptions
â”‚       â”‚   â”‚   52 â”‚     {
â”‚       â”‚   â”‚   53 â”‚         /// <summary>
â”‚       â”‚   â”‚   54 â”‚         /// Minimum similarity threshold (0.0-1.0)
â”‚       â”‚   â”‚   55 â”‚         /// </summary>
â”‚       â”‚   â”‚   56 â”‚         public double MinimumSimilarityThreshold { get; set; } = 0.7;
â”‚       â”‚   â”‚   57 â”‚ 
â”‚       â”‚   â”‚   58 â”‚         /// <summary>
â”‚       â”‚   â”‚   59 â”‚         /// Whether to return best matches regardless of threshold
â”‚       â”‚   â”‚   60 â”‚         /// </summary>
â”‚       â”‚   â”‚   61 â”‚         public bool ReturnBestMatchesRegardless { get; set; } = false;
â”‚       â”‚   â”‚   62 â”‚ 
â”‚       â”‚   â”‚   63 â”‚         /// <summary>
â”‚       â”‚   â”‚   64 â”‚         /// Weight for exact value matches (1.0 means exact matches only)
â”‚       â”‚   â”‚   65 â”‚         /// </summary>
â”‚       â”‚   â”‚   66 â”‚         public double ExactMatchWeight { get; set; } = 1.0;
â”‚       â”‚   â”‚   67 â”‚ 
â”‚       â”‚   â”‚   68 â”‚         /// <summary>
â”‚       â”‚   â”‚   69 â”‚         /// Weight for numeric values within tolerance
â”‚       â”‚   â”‚   70 â”‚         /// </summary>
â”‚       â”‚   â”‚   71 â”‚         public double NumericToleranceWeight { get; set; } = 0.8;
â”‚       â”‚   â”‚   72 â”‚ 
â”‚       â”‚   â”‚   73 â”‚         /// <summary>
â”‚       â”‚   â”‚   74 â”‚         /// Acceptable percentage difference for numeric values (e.g., 0.1 = 10%)
â”‚       â”‚   â”‚   75 â”‚         /// </summary>
â”‚       â”‚   â”‚   76 â”‚         public double NumericTolerance { get; set; } = 0.1;
â”‚       â”‚   â”‚   77 â”‚ 
â”‚       â”‚   â”‚   78 â”‚         /// <summary>
â”‚       â”‚   â”‚   79 â”‚         /// Number of groups to match
â”‚       â”‚   â”‚   80 â”‚         /// </summary>
â”‚       â”‚   â”‚   81 â”‚         public int NumberOfGroupsToMatch { get; set; } = 3;
â”‚       â”‚   â”‚   82 â”‚ 
â”‚       â”‚   â”‚   83 â”‚         /// <summary>
â”‚       â”‚   â”‚   84 â”‚         /// Replacement rules for name processing
â”‚       â”‚   â”‚   85 â”‚         /// </summary>
â”‚       â”‚   â”‚   86 â”‚         public IEnumerable<ReplacementRule> ReplacementRules { get; set; } = new List<ReplacementRule>();
â”‚       â”‚   â”‚   87 â”‚     }
â”‚       â”‚   â”‚   88 â”‚ 
â”‚       â”‚   â”‚   89 â”‚     /// <summary>
â”‚       â”‚   â”‚   90 â”‚     /// Rule for replacing names during comparison
â”‚       â”‚   â”‚   91 â”‚     /// </summary>
â”‚       â”‚   â”‚   92 â”‚     public class ReplacementRule
â”‚       â”‚   â”‚   93 â”‚     {
â”‚       â”‚   â”‚   94 â”‚         /// <summary>
â”‚       â”‚   â”‚   95 â”‚         /// The pattern to replace
â”‚       â”‚   â”‚   96 â”‚         /// </summary>
â”‚       â”‚   â”‚   97 â”‚         public string Pattern { get; set; }
â”‚       â”‚   â”‚   98 â”‚ 
â”‚       â”‚   â”‚   99 â”‚         /// <summary>
â”‚       â”‚   â”‚  100 â”‚         /// The replacement value
â”‚       â”‚   â”‚  101 â”‚         /// </summary>
â”‚       â”‚   â”‚  102 â”‚         public string Replacement { get; set; }
â”‚       â”‚   â”‚  103 â”‚ 
â”‚       â”‚   â”‚  104 â”‚         /// <summary>
â”‚       â”‚   â”‚  105 â”‚         /// Whether this is a prefix (true) or suffix (false) replacement
â”‚       â”‚   â”‚  106 â”‚         /// </summary>
â”‚       â”‚   â”‚  107 â”‚         public bool IsPrefix { get; set; }
â”‚       â”‚   â”‚  108 â”‚ 
â”‚       â”‚   â”‚  109 â”‚         /// <summary>
â”‚       â”‚   â”‚  110 â”‚         /// Priority of the rule (higher values are processed first)
â”‚       â”‚   â”‚  111 â”‚         /// </summary>
â”‚       â”‚   â”‚  112 â”‚         public int Priority { get; set; }
â”‚       â”‚   â”‚  113 â”‚     }
â”‚       â”‚   â”‚  114 â”‚ 
â”‚       â”‚   â”‚  115 â”‚     /// <summary>
â”‚       â”‚   â”‚  116 â”‚     /// Result of a comparison operation
â”‚       â”‚   â”‚  117 â”‚     /// </summary>
â”‚       â”‚   â”‚  118 â”‚     public class ComparisonResult
â”‚       â”‚   â”‚  119 â”‚     {
â”‚       â”‚   â”‚  120 â”‚         /// <summary>
â”‚       â”‚   â”‚  121 â”‚         /// The controller object name
â”‚       â”‚   â”‚  122 â”‚         /// </summary>
â”‚       â”‚   â”‚  123 â”‚         public string Name { get; set; }
â”‚       â”‚   â”‚  124 â”‚ 
â”‚       â”‚   â”‚  125 â”‚         /// <summary>
â”‚       â”‚   â”‚  126 â”‚         /// The value in the controller
â”‚       â”‚   â”‚  127 â”‚         /// </summary>
â”‚       â”‚   â”‚  128 â”‚         public string ControllerValue { get; set; }
â”‚       â”‚   â”‚  129 â”‚ 
â”‚       â”‚   â”‚  130 â”‚         /// <summary>
â”‚       â”‚   â”‚  131 â”‚         /// The value in the XML
â”‚       â”‚   â”‚  132 â”‚         /// </summary>
â”‚       â”‚   â”‚  133 â”‚         public string XmlValue { get; set; }
â”‚       â”‚   â”‚  134 â”‚ 
â”‚       â”‚   â”‚  135 â”‚         /// <summary>
â”‚       â”‚   â”‚  136 â”‚         /// The XML address
â”‚       â”‚   â”‚  137 â”‚         /// </summary>
â”‚       â”‚   â”‚  138 â”‚         public string XmlAddress { get; set; }
â”‚       â”‚   â”‚  139 â”‚ 
â”‚       â”‚   â”‚  140 â”‚         /// <summary>
â”‚       â”‚   â”‚  141 â”‚         /// Whether the values match
â”‚       â”‚   â”‚  142 â”‚         /// </summary>
â”‚       â”‚   â”‚  143 â”‚         public bool IsMatch { get; set; }
â”‚       â”‚   â”‚  144 â”‚     }
â”‚       â”‚   â”‚  145 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IControllerModelService.cs (1.07 KB, 2025-03-11 13:55:09)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IControllerModelService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.Linq;
â”‚       â”‚   â”‚    4 â”‚ using System.Text;
â”‚       â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    6 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    7 â”‚ 
â”‚       â”‚   â”‚    8 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    9 â”‚ {
â”‚       â”‚   â”‚   10 â”‚     /// <summary>
â”‚       â”‚   â”‚   11 â”‚     /// Service interface for controller model operations
â”‚       â”‚   â”‚   12 â”‚     /// </summary>
â”‚       â”‚   â”‚   13 â”‚     public interface IControllerModelService
â”‚       â”‚   â”‚   14 â”‚     {
â”‚       â”‚   â”‚   15 â”‚         /// <summary>
â”‚       â”‚   â”‚   16 â”‚         /// Determines the controller family based on model number
â”‚       â”‚   â”‚   17 â”‚         /// </summary>
â”‚       â”‚   â”‚   18 â”‚         ControllerModelInfo.ControllerFamily DetermineFamily(string modelNumber);
â”‚       â”‚   â”‚   19 â”‚ 
â”‚       â”‚   â”‚   20 â”‚         /// <summary>
â”‚       â”‚   â”‚   21 â”‚         /// Gets the properties for a controller model
â”‚       â”‚   â”‚   22 â”‚         /// </summary>
â”‚       â”‚   â”‚   23 â”‚         ControllerModelInfo.ModelProperties GetModelProperties(string modelNumber);
â”‚       â”‚   â”‚   24 â”‚ 
â”‚       â”‚   â”‚   25 â”‚         /// <summary>
â”‚       â”‚   â”‚   26 â”‚         /// Updates or adds properties for a controller model
â”‚       â”‚   â”‚   27 â”‚         /// </summary>
â”‚       â”‚   â”‚   28 â”‚         void SetModelProperties(string modelNumber, ControllerModelInfo.ModelProperties properties);
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         /// <summary>
â”‚       â”‚   â”‚   31 â”‚         /// Gets all known controller models
â”‚       â”‚   â”‚   32 â”‚         /// </summary>
â”‚       â”‚   â”‚   33 â”‚         IEnumerable<string> GetAllKnownModels();
â”‚       â”‚   â”‚   34 â”‚     }
â”‚       â”‚   â”‚   35 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IControllerRepository.cs (3.34 KB, 2025-03-11 09:48:27)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IControllerRepository.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.Linq;
â”‚       â”‚   â”‚    4 â”‚ using System.Text;
â”‚       â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    6 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    7 â”‚ using test.Data;
â”‚       â”‚   â”‚    8 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    9 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚   10 â”‚ 
â”‚       â”‚   â”‚   11 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚   12 â”‚ {
â”‚       â”‚   â”‚   13 â”‚     /// <summary>
â”‚       â”‚   â”‚   14 â”‚     /// Repository interface for controller operations
â”‚       â”‚   â”‚   15 â”‚     /// </summary>
â”‚       â”‚   â”‚   16 â”‚     public interface IControllerRepository
â”‚       â”‚   â”‚   17 â”‚     {
â”‚       â”‚   â”‚   18 â”‚         /// <summary>
â”‚       â”‚   â”‚   19 â”‚         /// Saves a batch of controllers to the database
â”‚       â”‚   â”‚   20 â”‚         /// </summary>
â”‚       â”‚   â”‚   21 â”‚         /// <param name="controllers">The controllers to save</param>
â”‚       â”‚   â”‚   22 â”‚         /// <param name="fileName">The original file name</param>
â”‚       â”‚   â”‚   23 â”‚         /// <param name="sessionPrefix">Optional session ID prefix</param>
â”‚       â”‚   â”‚   24 â”‚         /// <returns>The session ID</returns>
â”‚       â”‚   â”‚   25 â”‚         Task<string> SaveControllerBatchAsync(IEnumerable<Controller> controllers, string fileName = null, string sessionPrefix = null);
â”‚       â”‚   â”‚   26 â”‚ 
â”‚       â”‚   â”‚   27 â”‚         /// <summary>
â”‚       â”‚   â”‚   28 â”‚         /// Gets controllers by session ID
â”‚       â”‚   â”‚   29 â”‚         /// </summary>
â”‚       â”‚   â”‚   30 â”‚         /// <param name="sessionId">The session ID</param>
â”‚       â”‚   â”‚   31 â”‚         /// <param name="skip">The number of controllers to skip</param>
â”‚       â”‚   â”‚   32 â”‚         /// <param name="take">The maximum number of controllers to return</param>
â”‚       â”‚   â”‚   33 â”‚         /// <returns>A collection of controllers</returns>
â”‚       â”‚   â”‚   34 â”‚         Task<IEnumerable<Controller>> GetControllersBySessionAsync(string sessionId, int skip = 0, int take = 50);
â”‚       â”‚   â”‚   35 â”‚ 
â”‚       â”‚   â”‚   36 â”‚         /// <summary>
â”‚       â”‚   â”‚   37 â”‚         /// Deletes a session and all its controllers
â”‚       â”‚   â”‚   38 â”‚         /// </summary>
â”‚       â”‚   â”‚   39 â”‚         /// <param name="sessionId">The session ID</param>
â”‚       â”‚   â”‚   40 â”‚         /// <returns>True if deleted, false if not found</returns>
â”‚       â”‚   â”‚   41 â”‚         Task<bool> DeleteSessionAsync(string sessionId);
â”‚       â”‚   â”‚   42 â”‚ 
â”‚       â”‚   â”‚   43 â”‚         /// <summary>
â”‚       â”‚   â”‚   44 â”‚         /// Gets session information
â”‚       â”‚   â”‚   45 â”‚         /// </summary>
â”‚       â”‚   â”‚   46 â”‚         /// <param name="sessionId">The session ID</param>
â”‚       â”‚   â”‚   47 â”‚         /// <returns>Session information</returns>
â”‚       â”‚   â”‚   48 â”‚         Task<SessionInfo> GetSessionInfoAsync(string sessionId);
â”‚       â”‚   â”‚   49 â”‚ 
â”‚       â”‚   â”‚   50 â”‚         /// <summary>
â”‚       â”‚   â”‚   51 â”‚         /// Gets information for all sessions
â”‚       â”‚   â”‚   52 â”‚         /// </summary>
â”‚       â”‚   â”‚   53 â”‚         /// <returns>A collection of session information</returns>
â”‚       â”‚   â”‚   54 â”‚         Task<IEnumerable<SessionInfo>> GetAllSessionsAsync();
â”‚       â”‚   â”‚   55 â”‚ 
â”‚       â”‚   â”‚   56 â”‚         /// <summary>
â”‚       â”‚   â”‚   57 â”‚         /// Gets sessions by project ID
â”‚       â”‚   â”‚   58 â”‚         /// </summary>
â”‚       â”‚   â”‚   59 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   60 â”‚         /// <returns>A collection of session information</returns>
â”‚       â”‚   â”‚   61 â”‚         Task<IEnumerable<SessionInfo>> GetSessionsByProjectAsync(string projectId);
â”‚       â”‚   â”‚   62 â”‚ 
â”‚       â”‚   â”‚   63 â”‚         /// <summary>
â”‚       â”‚   â”‚   64 â”‚         /// Gets sessions by prefix
â”‚       â”‚   â”‚   65 â”‚         /// </summary>
â”‚       â”‚   â”‚   66 â”‚         /// <param name="prefix">The session ID prefix</param>
â”‚       â”‚   â”‚   67 â”‚         /// <returns>A collection of session IDs</returns>
â”‚       â”‚   â”‚   68 â”‚         Task<IEnumerable<string>> GetSessionIdsByPrefixAsync(string prefix);
â”‚       â”‚   â”‚   69 â”‚ 
â”‚       â”‚   â”‚   70 â”‚         /// <summary>
â”‚       â”‚   â”‚   71 â”‚         /// Cleans up sessions older than the specified age
â”‚       â”‚   â”‚   72 â”‚         /// </summary>
â”‚       â”‚   â”‚   73 â”‚         /// <param name="maxAge">The maximum age of sessions to keep</param>
â”‚       â”‚   â”‚   74 â”‚         /// <returns>The number of sessions deleted</returns>
â”‚       â”‚   â”‚   75 â”‚         Task<int> CleanupOldSessionsAsync(TimeSpan maxAge);
â”‚       â”‚   â”‚   76 â”‚ 
â”‚       â”‚   â”‚   77 â”‚         /// <summary>
â”‚       â”‚   â”‚   78 â”‚         /// Optimizes the database
â”‚       â”‚   â”‚   79 â”‚         /// </summary>
â”‚       â”‚   â”‚   80 â”‚         Task OptimizeDatabaseAsync();
â”‚       â”‚   â”‚   81 â”‚ 
â”‚       â”‚   â”‚   82 â”‚         /// <summary>
â”‚       â”‚   â”‚   83 â”‚         /// Gets a database health report
â”‚       â”‚   â”‚   84 â”‚         /// </summary>
â”‚       â”‚   â”‚   85 â”‚         /// <returns>A health report string</returns>
â”‚       â”‚   â”‚   86 â”‚         Task<string> GetDatabaseHealthReportAsync();
â”‚       â”‚   â”‚   87 â”‚     }
â”‚       â”‚   â”‚   88 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IDialogService.cs (873.00 B, 2025-03-11 09:48:27)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IDialogService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    4 â”‚ 
â”‚       â”‚   â”‚    5 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    6 â”‚ {
â”‚       â”‚   â”‚    7 â”‚     /// <summary>
â”‚       â”‚   â”‚    8 â”‚     /// Abstraction for dialog operations to enable testability and proper MVVM separation
â”‚       â”‚   â”‚    9 â”‚     /// </summary>
â”‚       â”‚   â”‚   10 â”‚     public interface IDialogService
â”‚       â”‚   â”‚   11 â”‚     {
â”‚       â”‚   â”‚   12 â”‚         Task<string[]> ShowOpenFileDialogAsync(string title, IEnumerable<FileDialogFilter> filters, bool allowMultiple = false);
â”‚       â”‚   â”‚   13 â”‚         Task<string> ShowSaveFileDialogAsync(string title, string defaultExtension, IEnumerable<FileDialogFilter> filters);
â”‚       â”‚   â”‚   14 â”‚         Task<string> ShowOpenFolderDialogAsync(string title);
â”‚       â”‚   â”‚   15 â”‚         Task<bool> ShowConfirmDialogAsync(string title, string message);
â”‚       â”‚   â”‚   16 â”‚         Task ShowErrorDialogAsync(string title, string message);
â”‚       â”‚   â”‚   17 â”‚         Task<string> ShowInputDialogAsync(string title, string message, string defaultValue = "");
â”‚       â”‚   â”‚   18 â”‚     }
â”‚       â”‚   â”‚   19 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IErrorHandler.cs (1009.00 B, 2025-03-11 10:01:03)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IErrorHandler.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.Linq;
â”‚       â”‚   â”‚    4 â”‚ using System.Text;
â”‚       â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    6 â”‚ 
â”‚       â”‚   â”‚    7 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    8 â”‚ {
â”‚       â”‚   â”‚    9 â”‚     /// <summary>
â”‚       â”‚   â”‚   10 â”‚     /// Interface for handling errors consistently throughout the application
â”‚       â”‚   â”‚   11 â”‚     /// </summary>
â”‚       â”‚   â”‚   12 â”‚     public interface IErrorHandler
â”‚       â”‚   â”‚   13 â”‚     {
â”‚       â”‚   â”‚   14 â”‚         /// <summary>
â”‚       â”‚   â”‚   15 â”‚         /// Handles an exception without user interaction (logging only)
â”‚       â”‚   â”‚   16 â”‚         /// </summary>
â”‚       â”‚   â”‚   17 â”‚         void HandleException(Exception ex, string context);
â”‚       â”‚   â”‚   18 â”‚ 
â”‚       â”‚   â”‚   19 â”‚ 
â”‚       â”‚   â”‚   20 â”‚         /// <summary>
â”‚       â”‚   â”‚   21 â”‚         /// Handles an exception with user notification
â”‚       â”‚   â”‚   22 â”‚         /// </summary>
â”‚       â”‚   â”‚   23 â”‚         Task HandleExceptionWithUIAsync(Exception ex, string context);
â”‚       â”‚   â”‚   24 â”‚ 
â”‚       â”‚   â”‚   25 â”‚         /// <summary>
â”‚       â”‚   â”‚   26 â”‚         /// Logs a warning message
â”‚       â”‚   â”‚   27 â”‚         /// </summary>
â”‚       â”‚   â”‚   28 â”‚         void LogWarning(string message, string context);
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         /// <summary>
â”‚       â”‚   â”‚   31 â”‚         /// Records a telemetry event
â”‚       â”‚   â”‚   32 â”‚         /// </summary>
â”‚       â”‚   â”‚   33 â”‚         void TrackEvent(string name, IDictionary<string, string> properties = null);
â”‚       â”‚   â”‚   34 â”‚     }
â”‚       â”‚   â”‚   35 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IExportService.cs (5.73 KB, 2025-03-11 09:48:27)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IExportService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System.Collections.Generic;
â”‚       â”‚   â”‚    2 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    3 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    4 â”‚ 
â”‚       â”‚   â”‚    5 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    6 â”‚ {
â”‚       â”‚   â”‚    7 â”‚     /// <summary>
â”‚       â”‚   â”‚    8 â”‚     /// Service interface for exporting controller data to various formats
â”‚       â”‚   â”‚    9 â”‚     /// </summary>
â”‚       â”‚   â”‚   10 â”‚     public interface IExportService
â”‚       â”‚   â”‚   11 â”‚     {
â”‚       â”‚   â”‚   12 â”‚         /// <summary>
â”‚       â”‚   â”‚   13 â”‚         /// Exports controllers to XML format
â”‚       â”‚   â”‚   14 â”‚         /// </summary>
â”‚       â”‚   â”‚   15 â”‚         /// <param name="controllers">The controllers to export</param>
â”‚       â”‚   â”‚   16 â”‚         /// <param name="filePath">The output file path</param>
â”‚       â”‚   â”‚   17 â”‚         /// <param name="options">Export options (optional)</param>
â”‚       â”‚   â”‚   18 â”‚         /// <returns>True if successful, false otherwise</returns>
â”‚       â”‚   â”‚   19 â”‚         Task<bool> ExportToXmlAsync(IEnumerable<Controller> controllers, string filePath, ExportOptions options = null);
â”‚       â”‚   â”‚   20 â”‚ 
â”‚       â”‚   â”‚   21 â”‚         /// <summary>
â”‚       â”‚   â”‚   22 â”‚         /// Exports controllers to Excel format
â”‚       â”‚   â”‚   23 â”‚         /// </summary>
â”‚       â”‚   â”‚   24 â”‚         /// <param name="controllers">The controllers to export</param>
â”‚       â”‚   â”‚   25 â”‚         /// <param name="filePath">The output file path</param>
â”‚       â”‚   â”‚   26 â”‚         /// <param name="options">Export options (optional)</param>
â”‚       â”‚   â”‚   27 â”‚         /// <returns>True if successful, false otherwise</returns>
â”‚       â”‚   â”‚   28 â”‚         Task<bool> ExportToExcelAsync(IEnumerable<Controller> controllers, string filePath, ExportOptions options = null);
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         /// <summary>
â”‚       â”‚   â”‚   31 â”‚         /// Exports controllers to CSV format
â”‚       â”‚   â”‚   32 â”‚         /// </summary>
â”‚       â”‚   â”‚   33 â”‚         /// <param name="controllers">The controllers to export</param>
â”‚       â”‚   â”‚   34 â”‚         /// <param name="filePath">The output file path</param>
â”‚       â”‚   â”‚   35 â”‚         /// <param name="options">Export options (optional)</param>
â”‚       â”‚   â”‚   36 â”‚         /// <returns>A collection of found group comparisons</returns>
â”‚       â”‚   â”‚   37 â”‚         Task<IEnumerable<GroupComparison>> ExportToGroupedCsvAsync(IEnumerable<Controller> controllers, string filePath, ExportOptions options = null);
â”‚       â”‚   â”‚   38 â”‚ 
â”‚       â”‚   â”‚   39 â”‚         /// <summary>
â”‚       â”‚   â”‚   40 â”‚         /// Gets available export formats
â”‚       â”‚   â”‚   41 â”‚         /// </summary>
â”‚       â”‚   â”‚   42 â”‚         /// <returns>A collection of export format descriptors</returns>
â”‚       â”‚   â”‚   43 â”‚         IEnumerable<ExportFormat> GetAvailableFormats();
â”‚       â”‚   â”‚   44 â”‚     }
â”‚       â”‚   â”‚   45 â”‚ 
â”‚       â”‚   â”‚   46 â”‚     /// <summary>
â”‚       â”‚   â”‚   47 â”‚     /// Options for export operations
â”‚       â”‚   â”‚   48 â”‚     /// </summary>
â”‚       â”‚   â”‚   49 â”‚     public class ExportOptions
â”‚       â”‚   â”‚   50 â”‚     {
â”‚       â”‚   â”‚   51 â”‚         /// <summary>
â”‚       â”‚   â”‚   52 â”‚         /// Whether to include byte code in the export
â”‚       â”‚   â”‚   53 â”‚         /// </summary>
â”‚       â”‚   â”‚   54 â”‚         public bool IncludeByteCode { get; set; } = false;
â”‚       â”‚   â”‚   55 â”‚ 
â”‚       â”‚   â”‚   56 â”‚         /// <summary>
â”‚       â”‚   â”‚   57 â”‚         /// Whether to include empty values in the export
â”‚       â”‚   â”‚   58 â”‚         /// </summary>
â”‚       â”‚   â”‚   59 â”‚         public bool IncludeEmptyValues { get; set; } = true;
â”‚       â”‚   â”‚   60 â”‚ 
â”‚       â”‚   â”‚   61 â”‚         /// <summary>
â”‚       â”‚   â”‚   62 â”‚         /// Types to include (empty for all types)
â”‚       â”‚   â”‚   63 â”‚         /// </summary>
â”‚       â”‚   â”‚   64 â”‚         public HashSet<string> IncludedTypes { get; set; } = new HashSet<string>();
â”‚       â”‚   â”‚   65 â”‚ 
â”‚       â”‚   â”‚   66 â”‚         /// <summary>
â”‚       â”‚   â”‚   67 â”‚         /// Names to exclude (for objects)
â”‚       â”‚   â”‚   68 â”‚         /// </summary>
â”‚       â”‚   â”‚   69 â”‚         public HashSet<string> ExcludedNames { get; set; } = new HashSet<string>();
â”‚       â”‚   â”‚   70 â”‚ 
â”‚       â”‚   â”‚   71 â”‚         /// <summary>
â”‚       â”‚   â”‚   72 â”‚         /// Whether to pretty-print/format the output (for applicable formats)
â”‚       â”‚   â”‚   73 â”‚         /// </summary>
â”‚       â”‚   â”‚   74 â”‚         public bool PrettyPrint { get; set; } = true;
â”‚       â”‚   â”‚   75 â”‚ 
â”‚       â”‚   â”‚   76 â”‚         /// <summary>
â”‚       â”‚   â”‚   77 â”‚         /// Additional format-specific options
â”‚       â”‚   â”‚   78 â”‚         /// </summary>
â”‚       â”‚   â”‚   79 â”‚         public Dictionary<string, string> AdditionalOptions { get; set; } = new Dictionary<string, string>();
â”‚       â”‚   â”‚   80 â”‚     }
â”‚       â”‚   â”‚   81 â”‚ 
â”‚       â”‚   â”‚   82 â”‚     /// <summary>
â”‚       â”‚   â”‚   83 â”‚     /// Describes an export format
â”‚       â”‚   â”‚   84 â”‚     /// </summary>
â”‚       â”‚   â”‚   85 â”‚     public class ExportFormat
â”‚       â”‚   â”‚   86 â”‚     {
â”‚       â”‚   â”‚   87 â”‚         /// <summary>
â”‚       â”‚   â”‚   88 â”‚         /// The format ID
â”‚       â”‚   â”‚   89 â”‚         /// </summary>
â”‚       â”‚   â”‚   90 â”‚         public string Id { get; set; }
â”‚       â”‚   â”‚   91 â”‚ 
â”‚       â”‚   â”‚   92 â”‚         /// <summary>
â”‚       â”‚   â”‚   93 â”‚         /// The display name
â”‚       â”‚   â”‚   94 â”‚         /// </summary>
â”‚       â”‚   â”‚   95 â”‚         public string DisplayName { get; set; }
â”‚       â”‚   â”‚   96 â”‚ 
â”‚       â”‚   â”‚   97 â”‚         /// <summary>
â”‚       â”‚   â”‚   98 â”‚         /// The file extension
â”‚       â”‚   â”‚   99 â”‚         /// </summary>
â”‚       â”‚   â”‚  100 â”‚         public string Extension { get; set; }
â”‚       â”‚   â”‚  101 â”‚ 
â”‚       â”‚   â”‚  102 â”‚         /// <summary>
â”‚       â”‚   â”‚  103 â”‚         /// The MIME type
â”‚       â”‚   â”‚  104 â”‚         /// </summary>
â”‚       â”‚   â”‚  105 â”‚         public string MimeType { get; set; }
â”‚       â”‚   â”‚  106 â”‚ 
â”‚       â”‚   â”‚  107 â”‚         /// <summary>
â”‚       â”‚   â”‚  108 â”‚         /// Whether byte code is supported
â”‚       â”‚   â”‚  109 â”‚         /// </summary>
â”‚       â”‚   â”‚  110 â”‚         public bool SupportsById { get; set; }
â”‚       â”‚   â”‚  111 â”‚ 
â”‚       â”‚   â”‚  112 â”‚         /// <summary>
â”‚       â”‚   â”‚  113 â”‚         /// Brief description of the format
â”‚       â”‚   â”‚  114 â”‚         /// </summary>
â”‚       â”‚   â”‚  115 â”‚         public string Description { get; set; }
â”‚       â”‚   â”‚  116 â”‚     }
â”‚       â”‚   â”‚  117 â”‚ 
â”‚       â”‚   â”‚  118 â”‚     /// <summary>
â”‚       â”‚   â”‚  119 â”‚     /// Result of a group comparison during CSV export
â”‚       â”‚   â”‚  120 â”‚     /// </summary>
â”‚       â”‚   â”‚  121 â”‚     public class GroupComparison
â”‚       â”‚   â”‚  122 â”‚     {
â”‚       â”‚   â”‚  123 â”‚         /// <summary>
â”‚       â”‚   â”‚  124 â”‚         /// First group identifier
â”‚       â”‚   â”‚  125 â”‚         /// </summary>
â”‚       â”‚   â”‚  126 â”‚         public string Group1Key { get; set; }
â”‚       â”‚   â”‚  127 â”‚ 
â”‚       â”‚   â”‚  128 â”‚         /// <summary>
â”‚       â”‚   â”‚  129 â”‚         /// Second group identifier
â”‚       â”‚   â”‚  130 â”‚         /// </summary>
â”‚       â”‚   â”‚  131 â”‚         public string Group2Key { get; set; }
â”‚       â”‚   â”‚  132 â”‚ 
â”‚       â”‚   â”‚  133 â”‚         /// <summary>
â”‚       â”‚   â”‚  134 â”‚         /// Number of controllers in first group
â”‚       â”‚   â”‚  135 â”‚         /// </summary>
â”‚       â”‚   â”‚  136 â”‚         public int ControllersInGroup1 { get; set; }
â”‚       â”‚   â”‚  137 â”‚ 
â”‚       â”‚   â”‚  138 â”‚         /// <summary>
â”‚       â”‚   â”‚  139 â”‚         /// Number of controllers in second group
â”‚       â”‚   â”‚  140 â”‚         /// </summary>
â”‚       â”‚   â”‚  141 â”‚         public int ControllersInGroup2 { get; set; }
â”‚       â”‚   â”‚  142 â”‚ 
â”‚       â”‚   â”‚  143 â”‚         /// <summary>
â”‚       â”‚   â”‚  144 â”‚         /// Collection of different property names
â”‚       â”‚   â”‚  145 â”‚         /// </summary>
â”‚       â”‚   â”‚  146 â”‚         public List<string> DifferentProperties { get; set; } = new List<string>();
â”‚       â”‚   â”‚  147 â”‚ 
â”‚       â”‚   â”‚  148 â”‚         /// <summary>
â”‚       â”‚   â”‚  149 â”‚         /// First controller name in group 1
â”‚       â”‚   â”‚  150 â”‚         /// </summary>
â”‚       â”‚   â”‚  151 â”‚         public string FirstControllerGroup1 { get; set; }
â”‚       â”‚   â”‚  152 â”‚ 
â”‚       â”‚   â”‚  153 â”‚         /// <summary>
â”‚       â”‚   â”‚  154 â”‚         /// First controller name in group 2
â”‚       â”‚   â”‚  155 â”‚         /// </summary>
â”‚       â”‚   â”‚  156 â”‚         public string FirstControllerGroup2 { get; set; }
â”‚       â”‚   â”‚  157 â”‚ 
â”‚       â”‚   â”‚  158 â”‚         /// <summary>
â”‚       â”‚   â”‚  159 â”‚         /// Returns a string representation of the comparison
â”‚       â”‚   â”‚  160 â”‚         /// </summary>
â”‚       â”‚   â”‚  161 â”‚         public override string ToString()
â”‚       â”‚   â”‚  162 â”‚         {
â”‚       â”‚   â”‚  163 â”‚             return $"Group 1 ({ControllersInGroup1} controllers, first: {FirstControllerGroup1}) vs " +
â”‚       â”‚   â”‚  164 â”‚                    $"Group 2 ({ControllersInGroup2} controllers, first: {FirstControllerGroup2})\n" +
â”‚       â”‚   â”‚  165 â”‚                    $"Different Properties ({DifferentProperties.Count}): {string.Join(", ", DifferentProperties)}\n";
â”‚       â”‚   â”‚  166 â”‚         }
â”‚       â”‚   â”‚  167 â”‚     }
â”‚       â”‚   â”‚  168 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IFileSystem.cs (675.00 B, 2025-03-11 09:48:27)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IFileSystem.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.IO;
â”‚       â”‚   â”‚    4 â”‚ using System.Linq;
â”‚       â”‚   â”‚    5 â”‚ using System.Text;
â”‚       â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    7 â”‚ 
â”‚       â”‚   â”‚    8 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    9 â”‚ {
â”‚       â”‚   â”‚   10 â”‚     /// <summary>
â”‚       â”‚   â”‚   11 â”‚     /// Abstraction for file system operations to enable testability and decoupling
â”‚       â”‚   â”‚   12 â”‚     /// </summary>
â”‚       â”‚   â”‚   13 â”‚     public interface IFileSystem
â”‚       â”‚   â”‚   14 â”‚     {
â”‚       â”‚   â”‚   15 â”‚         Task<string> ReadAllTextAsync(string path);
â”‚       â”‚   â”‚   16 â”‚         Task WriteAllTextAsync(string path, string content);
â”‚       â”‚   â”‚   17 â”‚         bool FileExists(string path);
â”‚       â”‚   â”‚   18 â”‚         Stream OpenRead(string path);
â”‚       â”‚   â”‚   19 â”‚         Stream OpenWrite(string path);
â”‚       â”‚   â”‚   20 â”‚         void CreateDirectory(string path);
â”‚       â”‚   â”‚   21 â”‚         bool DirectoryExists(string path);
â”‚       â”‚   â”‚   22 â”‚     }
â”‚       â”‚   â”‚   23 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ ILoggingService.cs (858.00 B, 2025-03-12 12:24:10)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: ILoggingService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using Serilog.Events;
â”‚       â”‚   â”‚    2 â”‚ 
â”‚       â”‚   â”‚    3 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    4 â”‚ {
â”‚       â”‚   â”‚    5 â”‚     /// <summary>
â”‚       â”‚   â”‚    6 â”‚     /// Interface for application logging service
â”‚       â”‚   â”‚    7 â”‚     /// </summary>
â”‚       â”‚   â”‚    8 â”‚     public interface ILoggingService
â”‚       â”‚   â”‚    9 â”‚     {
â”‚       â”‚   â”‚   10 â”‚         /// <summary>
â”‚       â”‚   â”‚   11 â”‚         /// Enables or disables logging
â”‚       â”‚   â”‚   12 â”‚         /// </summary>
â”‚       â”‚   â”‚   13 â”‚         /// <param name="enable">Whether to enable logging</param>
â”‚       â”‚   â”‚   14 â”‚         void EnableLogging(bool enable);
â”‚       â”‚   â”‚   15 â”‚ 
â”‚       â”‚   â”‚   16 â”‚         /// <summary>
â”‚       â”‚   â”‚   17 â”‚         /// Gets whether logging is enabled
â”‚       â”‚   â”‚   18 â”‚         /// </summary>
â”‚       â”‚   â”‚   19 â”‚         bool IsLoggingEnabled { get; }
â”‚       â”‚   â”‚   20 â”‚ 
â”‚       â”‚   â”‚   21 â”‚         /// <summary>
â”‚       â”‚   â”‚   22 â”‚         /// Gets the path to the log file
â”‚       â”‚   â”‚   23 â”‚         /// </summary>
â”‚       â”‚   â”‚   24 â”‚         string LogFilePath { get; }
â”‚       â”‚   â”‚   25 â”‚ 
â”‚       â”‚   â”‚   26 â”‚         /// <summary>
â”‚       â”‚   â”‚   27 â”‚         /// Sets the log level
â”‚       â”‚   â”‚   28 â”‚         /// </summary>
â”‚       â”‚   â”‚   29 â”‚         /// <param name="level">The log level to set</param>
â”‚       â”‚   â”‚   30 â”‚         void SetLogLevel(LogEventLevel level);
â”‚       â”‚   â”‚   31 â”‚     }
â”‚       â”‚   â”‚   32 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ INavigationService.cs (2.05 KB, 2025-03-11 16:15:02)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: INavigationService.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ 
â”‚       â”‚   â”‚    3 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    4 â”‚ {
â”‚       â”‚   â”‚    5 â”‚     /// <summary>
â”‚       â”‚   â”‚    6 â”‚     /// Interface for navigation between different views in the application
â”‚       â”‚   â”‚    7 â”‚     /// </summary>
â”‚       â”‚   â”‚    8 â”‚     public interface INavigationService
â”‚       â”‚   â”‚    9 â”‚     {
â”‚       â”‚   â”‚   10 â”‚         /// <summary>
â”‚       â”‚   â”‚   11 â”‚         /// Navigates to the specified view
â”‚       â”‚   â”‚   12 â”‚         /// </summary>
â”‚       â”‚   â”‚   13 â”‚         /// <param name="viewName">The name of the view to navigate to</param>
â”‚       â”‚   â”‚   14 â”‚         /// <param name="parameter">Optional parameter to pass to the view</param>
â”‚       â”‚   â”‚   15 â”‚         /// <returns>True if navigation was successful, false otherwise</returns>
â”‚       â”‚   â”‚   16 â”‚         bool NavigateTo(string viewName, object parameter = null);
â”‚       â”‚   â”‚   17 â”‚ 
â”‚       â”‚   â”‚   18 â”‚         /// <summary>
â”‚       â”‚   â”‚   19 â”‚         /// Checks if navigation to the specified view is possible
â”‚       â”‚   â”‚   20 â”‚         /// </summary>
â”‚       â”‚   â”‚   21 â”‚         /// <param name="viewName">The name of the view to check</param>
â”‚       â”‚   â”‚   22 â”‚         /// <returns>True if navigation is possible, false otherwise</returns>
â”‚       â”‚   â”‚   23 â”‚         bool CanNavigate(string viewName);
â”‚       â”‚   â”‚   24 â”‚ 
â”‚       â”‚   â”‚   25 â”‚         /// <summary>
â”‚       â”‚   â”‚   26 â”‚         /// Gets the name of the currently active view
â”‚       â”‚   â”‚   27 â”‚         /// </summary>
â”‚       â”‚   â”‚   28 â”‚         string CurrentView { get; }
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         /// <summary>
â”‚       â”‚   â”‚   31 â”‚         /// Event raised when navigation occurs
â”‚       â”‚   â”‚   32 â”‚         /// </summary>
â”‚       â”‚   â”‚   33 â”‚         event EventHandler<NavigationEventArgs> Navigated;
â”‚       â”‚   â”‚   34 â”‚     }
â”‚       â”‚   â”‚   35 â”‚ 
â”‚       â”‚   â”‚   36 â”‚     /// <summary>
â”‚       â”‚   â”‚   37 â”‚     /// Event arguments for navigation events
â”‚       â”‚   â”‚   38 â”‚     /// </summary>
â”‚       â”‚   â”‚   39 â”‚     public class NavigationEventArgs : EventArgs
â”‚       â”‚   â”‚   40 â”‚     {
â”‚       â”‚   â”‚   41 â”‚         /// <summary>
â”‚       â”‚   â”‚   42 â”‚         /// The name of the view being navigated to
â”‚       â”‚   â”‚   43 â”‚         /// </summary>
â”‚       â”‚   â”‚   44 â”‚         public string ViewName { get; }
â”‚       â”‚   â”‚   45 â”‚ 
â”‚       â”‚   â”‚   46 â”‚         /// <summary>
â”‚       â”‚   â”‚   47 â”‚         /// Any additional parameters for the navigation
â”‚       â”‚   â”‚   48 â”‚         /// </summary>
â”‚       â”‚   â”‚   49 â”‚         public object Parameter { get; }
â”‚       â”‚   â”‚   50 â”‚ 
â”‚       â”‚   â”‚   51 â”‚         /// <summary>
â”‚       â”‚   â”‚   52 â”‚         /// Creates new navigation event arguments
â”‚       â”‚   â”‚   53 â”‚         /// </summary>
â”‚       â”‚   â”‚   54 â”‚         /// <param name="viewName">The view name</param>
â”‚       â”‚   â”‚   55 â”‚         /// <param name="parameter">Optional navigation parameter</param>
â”‚       â”‚   â”‚   56 â”‚         public NavigationEventArgs(string viewName, object parameter = null)
â”‚       â”‚   â”‚   57 â”‚         {
â”‚       â”‚   â”‚   58 â”‚             ViewName = viewName;
â”‚       â”‚   â”‚   59 â”‚             Parameter = parameter;
â”‚       â”‚   â”‚   60 â”‚         }
â”‚       â”‚   â”‚   61 â”‚     }
â”‚       â”‚   â”‚   62 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IObjectSetParser.cs (2.43 KB, 2025-03-11 14:56:16)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IObjectSetParser.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System.Collections.Generic;
â”‚       â”‚   â”‚    2 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    3 â”‚ using System.Xml.Linq;
â”‚       â”‚   â”‚    4 â”‚ using test.Core.Domain.ObjectSet;
â”‚       â”‚   â”‚    5 â”‚ 
â”‚       â”‚   â”‚    6 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    7 â”‚ {
â”‚       â”‚   â”‚    8 â”‚     /// <summary>
â”‚       â”‚   â”‚    9 â”‚     /// Interface for parsing ObjectSet XML documents
â”‚       â”‚   â”‚   10 â”‚     /// </summary>
â”‚       â”‚   â”‚   11 â”‚     public interface IObjectSetParser
â”‚       â”‚   â”‚   12 â”‚     {
â”‚       â”‚   â”‚   13 â”‚         /// <summary>
â”‚       â”‚   â”‚   14 â”‚         /// Parses an ObjectSet XML document
â”‚       â”‚   â”‚   15 â”‚         /// </summary>
â”‚       â”‚   â”‚   16 â”‚         /// <param name="document">The XML document to parse</param>
â”‚       â”‚   â”‚   17 â”‚         /// <param name="options">Parsing options</param>
â”‚       â”‚   â”‚   18 â”‚         /// <returns>The parsing result</returns>
â”‚       â”‚   â”‚   19 â”‚         Task<ObjectSetParseResult> ParseAsync(XDocument document, ObjectSetParsingOptions options);
â”‚       â”‚   â”‚   20 â”‚ 
â”‚       â”‚   â”‚   21 â”‚         /// <summary>
â”‚       â”‚   â”‚   22 â”‚         /// Parses meta information from an ObjectSet XML document
â”‚       â”‚   â”‚   23 â”‚         /// </summary>
â”‚       â”‚   â”‚   24 â”‚         /// <param name="document">The XML document</param>
â”‚       â”‚   â”‚   25 â”‚         /// <returns>The meta information</returns>
â”‚       â”‚   â”‚   26 â”‚         MetaInformation ParseMetaInformation(XDocument document);
â”‚       â”‚   â”‚   27 â”‚ 
â”‚       â”‚   â”‚   28 â”‚         /// <summary>
â”‚       â”‚   â”‚   29 â”‚         /// Parses type definitions from an ObjectSet XML document
â”‚       â”‚   â”‚   30 â”‚         /// </summary>
â”‚       â”‚   â”‚   31 â”‚         /// <param name="document">The XML document</param>
â”‚       â”‚   â”‚   32 â”‚         /// <param name="typeWhitelist">Optional type whitelist</param>
â”‚       â”‚   â”‚   33 â”‚         /// <returns>The type definitions</returns>
â”‚       â”‚   â”‚   34 â”‚         List<ObjectTypeDefinition> ParseTypeDefinitions(XDocument document, HashSet<string> typeWhitelist = null);
â”‚       â”‚   â”‚   35 â”‚ 
â”‚       â”‚   â”‚   36 â”‚         /// <summary>
â”‚       â”‚   â”‚   37 â”‚         /// Parses exported objects from an ObjectSet XML document
â”‚       â”‚   â”‚   38 â”‚         /// </summary>
â”‚       â”‚   â”‚   39 â”‚         /// <param name="document">The XML document</param>
â”‚       â”‚   â”‚   40 â”‚         /// <returns>The exported objects</returns>
â”‚       â”‚   â”‚   41 â”‚         List<ExportedObject> ParseExportedObjects(XDocument document);
â”‚       â”‚   â”‚   42 â”‚     }
â”‚       â”‚   â”‚   43 â”‚ 
â”‚       â”‚   â”‚   44 â”‚     /// <summary>
â”‚       â”‚   â”‚   45 â”‚     /// Options for parsing ObjectSet XML
â”‚       â”‚   â”‚   46 â”‚     /// </summary>
â”‚       â”‚   â”‚   47 â”‚     public class ObjectSetParsingOptions
â”‚       â”‚   â”‚   48 â”‚     {
â”‚       â”‚   â”‚   49 â”‚         /// <summary>
â”‚       â”‚   â”‚   50 â”‚         /// Whether to include meta information
â”‚       â”‚   â”‚   51 â”‚         /// </summary>
â”‚       â”‚   â”‚   52 â”‚         public bool IncludeMetaInformation { get; set; } = true;
â”‚       â”‚   â”‚   53 â”‚ 
â”‚       â”‚   â”‚   54 â”‚         /// <summary>
â”‚       â”‚   â”‚   55 â”‚         /// Whether to include type definitions
â”‚       â”‚   â”‚   56 â”‚         /// </summary>
â”‚       â”‚   â”‚   57 â”‚         public bool IncludeTypeDefinitions { get; set; } = true;
â”‚       â”‚   â”‚   58 â”‚ 
â”‚       â”‚   â”‚   59 â”‚         /// <summary>
â”‚       â”‚   â”‚   60 â”‚         /// Whether to include exported objects
â”‚       â”‚   â”‚   61 â”‚         /// </summary>
â”‚       â”‚   â”‚   62 â”‚         public bool IncludeExportedObjects { get; set; } = true;
â”‚       â”‚   â”‚   63 â”‚ 
â”‚       â”‚   â”‚   64 â”‚         /// <summary>
â”‚       â”‚   â”‚   65 â”‚         /// Optional type whitelist
â”‚       â”‚   â”‚   66 â”‚         /// </summary>
â”‚       â”‚   â”‚   67 â”‚         public HashSet<string> TypeWhitelist { get; set; } = new();
â”‚       â”‚   â”‚   68 â”‚     }
â”‚       â”‚   â”‚   69 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IObjectSetWriter.cs (1.48 KB, 2025-03-11 14:56:30)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IObjectSetWriter.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System.Collections.Generic;
â”‚       â”‚   â”‚    2 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    3 â”‚ using System.Xml.Linq;
â”‚       â”‚   â”‚    4 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    5 â”‚ using test.Core.Domain.ObjectSet;
â”‚       â”‚   â”‚    6 â”‚ 
â”‚       â”‚   â”‚    7 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚    8 â”‚ {
â”‚       â”‚   â”‚    9 â”‚     /// <summary>
â”‚       â”‚   â”‚   10 â”‚     /// Interface for writing controllers to ObjectSet XML format
â”‚       â”‚   â”‚   11 â”‚     /// </summary>
â”‚       â”‚   â”‚   12 â”‚     public interface IObjectSetWriter
â”‚       â”‚   â”‚   13 â”‚     {
â”‚       â”‚   â”‚   14 â”‚         /// <summary>
â”‚       â”‚   â”‚   15 â”‚         /// Converts controllers to ObjectSet XML
â”‚       â”‚   â”‚   16 â”‚         /// </summary>
â”‚       â”‚   â”‚   17 â”‚         /// <param name="controllers">The controllers to convert</param>
â”‚       â”‚   â”‚   18 â”‚         /// <param name="options">Writing options</param>
â”‚       â”‚   â”‚   19 â”‚         /// <returns>The generated XML document</returns>
â”‚       â”‚   â”‚   20 â”‚         Task<XDocument> WriteAsync(IEnumerable<Controller> controllers, ObjectSetWriteOptions options = null);
â”‚       â”‚   â”‚   21 â”‚     }
â”‚       â”‚   â”‚   22 â”‚ 
â”‚       â”‚   â”‚   23 â”‚     /// <summary>
â”‚       â”‚   â”‚   24 â”‚     /// Options for writing to ObjectSet XML format
â”‚       â”‚   â”‚   25 â”‚     /// </summary>
â”‚       â”‚   â”‚   26 â”‚     public class ObjectSetWriteOptions
â”‚       â”‚   â”‚   27 â”‚     {
â”‚       â”‚   â”‚   28 â”‚         /// <summary>
â”‚       â”‚   â”‚   29 â”‚         /// Meta information to include
â”‚       â”‚   â”‚   30 â”‚         /// </summary>
â”‚       â”‚   â”‚   31 â”‚         public MetaInformation MetaInformation { get; set; }
â”‚       â”‚   â”‚   32 â”‚ 
â”‚       â”‚   â”‚   33 â”‚         /// <summary>
â”‚       â”‚   â”‚   34 â”‚         /// Type definitions to include
â”‚       â”‚   â”‚   35 â”‚         /// </summary>
â”‚       â”‚   â”‚   36 â”‚         public IEnumerable<ObjectTypeDefinition> TypeDefinitions { get; set; }
â”‚       â”‚   â”‚   37 â”‚ 
â”‚       â”‚   â”‚   38 â”‚         /// <summary>
â”‚       â”‚   â”‚   39 â”‚         /// Whether to include byte code
â”‚       â”‚   â”‚   40 â”‚         /// </summary>
â”‚       â”‚   â”‚   41 â”‚         public bool IncludeByteCode { get; set; } = false;
â”‚       â”‚   â”‚   42 â”‚ 
â”‚       â”‚   â”‚   43 â”‚         /// <summary>
â”‚       â”‚   â”‚   44 â”‚         /// Whether to pretty-print the XML
â”‚       â”‚   â”‚   45 â”‚         /// </summary>
â”‚       â”‚   â”‚   46 â”‚         public bool PrettyPrint { get; set; } = true;
â”‚       â”‚   â”‚   47 â”‚     }
â”‚       â”‚   â”‚   48 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IProjectRepository.cs (3.61 KB, 2025-03-11 09:48:27)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IProjectRepository.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.Linq;
â”‚       â”‚   â”‚    4 â”‚ using System.Text;
â”‚       â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    6 â”‚ using test.Core.Domain;
â”‚       â”‚   â”‚    7 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    8 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    9 â”‚ 
â”‚       â”‚   â”‚   10 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚   11 â”‚ {
â”‚       â”‚   â”‚   12 â”‚     /// <summary>
â”‚       â”‚   â”‚   13 â”‚     /// Repository interface for project operations
â”‚       â”‚   â”‚   14 â”‚     /// </summary>
â”‚       â”‚   â”‚   15 â”‚     public interface IProjectRepository
â”‚       â”‚   â”‚   16 â”‚     {
â”‚       â”‚   â”‚   17 â”‚         /// <summary>
â”‚       â”‚   â”‚   18 â”‚         /// Gets a project by ID
â”‚       â”‚   â”‚   19 â”‚         /// </summary>
â”‚       â”‚   â”‚   20 â”‚         /// <param name="id">The project ID</param>
â”‚       â”‚   â”‚   21 â”‚         /// <returns>The project or null if not found</returns>
â”‚       â”‚   â”‚   22 â”‚         Task<Project> GetByIdAsync(string id);
â”‚       â”‚   â”‚   23 â”‚ 
â”‚       â”‚   â”‚   24 â”‚         /// <summary>
â”‚       â”‚   â”‚   25 â”‚         /// Gets all projects
â”‚       â”‚   â”‚   26 â”‚         /// </summary>
â”‚       â”‚   â”‚   27 â”‚         /// <returns>A collection of all projects</returns>
â”‚       â”‚   â”‚   28 â”‚         Task<IEnumerable<Project>> GetAllAsync();
â”‚       â”‚   â”‚   29 â”‚ 
â”‚       â”‚   â”‚   30 â”‚         /// <summary>
â”‚       â”‚   â”‚   31 â”‚         /// Creates a new project
â”‚       â”‚   â”‚   32 â”‚         /// </summary>
â”‚       â”‚   â”‚   33 â”‚         /// <param name="project">The project to create</param>
â”‚       â”‚   â”‚   34 â”‚         Task CreateAsync(Project project);
â”‚       â”‚   â”‚   35 â”‚ 
â”‚       â”‚   â”‚   36 â”‚         /// <summary>
â”‚       â”‚   â”‚   37 â”‚         /// Updates a project
â”‚       â”‚   â”‚   38 â”‚         /// </summary>
â”‚       â”‚   â”‚   39 â”‚         /// <param name="project">The project to update</param>
â”‚       â”‚   â”‚   40 â”‚         Task UpdateAsync(Project project);
â”‚       â”‚   â”‚   41 â”‚ 
â”‚       â”‚   â”‚   42 â”‚         /// <summary>
â”‚       â”‚   â”‚   43 â”‚         /// Deletes a project
â”‚       â”‚   â”‚   44 â”‚         /// </summary>
â”‚       â”‚   â”‚   45 â”‚         /// <param name="id">The ID of the project to delete</param>
â”‚       â”‚   â”‚   46 â”‚         /// <returns>True if deleted, false if not found</returns>
â”‚       â”‚   â”‚   47 â”‚         Task<bool> DeleteAsync(string id);
â”‚       â”‚   â”‚   48 â”‚ 
â”‚       â”‚   â”‚   49 â”‚         /// <summary>
â”‚       â”‚   â”‚   50 â”‚         /// Imports a file into a project
â”‚       â”‚   â”‚   51 â”‚         /// </summary>
â”‚       â”‚   â”‚   52 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   53 â”‚         /// <param name="sourceFilePath">The source file path</param>
â”‚       â”‚   â”‚   54 â”‚         /// <returns>The imported file</returns>
â”‚       â”‚   â”‚   55 â”‚         Task<ImportedFile> ImportFileAsync(string projectId, string sourceFilePath);
â”‚       â”‚   â”‚   56 â”‚ 
â”‚       â”‚   â”‚   57 â”‚         /// <summary>
â”‚       â”‚   â”‚   58 â”‚         /// Removes a file from a project
â”‚       â”‚   â”‚   59 â”‚         /// </summary>
â”‚       â”‚   â”‚   60 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   61 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚   62 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚       â”‚   â”‚   63 â”‚         Task<bool> RemoveFileAsync(string projectId, string filePath);
â”‚       â”‚   â”‚   64 â”‚ 
â”‚       â”‚   â”‚   65 â”‚         /// <summary>
â”‚       â”‚   â”‚   66 â”‚         /// Adds a shared type to a project
â”‚       â”‚   â”‚   67 â”‚         /// </summary>
â”‚       â”‚   â”‚   68 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   69 â”‚         /// <param name="sourceFilePath">The source file path</param>
â”‚       â”‚   â”‚   70 â”‚         /// <param name="typeName">The type name</param>
â”‚       â”‚   â”‚   71 â”‚         /// <param name="category">The category</param>
â”‚       â”‚   â”‚   72 â”‚         /// <param name="description">The description</param>
â”‚       â”‚   â”‚   73 â”‚         /// <returns>The added shared type</returns>
â”‚       â”‚   â”‚   74 â”‚         Task<SharedType> AddSharedTypeAsync(
â”‚       â”‚   â”‚   75 â”‚             string projectId,
â”‚       â”‚   â”‚   76 â”‚             string sourceFilePath,
â”‚       â”‚   â”‚   77 â”‚             string typeName = null,
â”‚       â”‚   â”‚   78 â”‚             string category = null,
â”‚       â”‚   â”‚   79 â”‚             string description = null);
â”‚       â”‚   â”‚   80 â”‚ 
â”‚       â”‚   â”‚   81 â”‚         /// <summary>
â”‚       â”‚   â”‚   82 â”‚         /// Updates a shared type description
â”‚       â”‚   â”‚   83 â”‚         /// </summary>
â”‚       â”‚   â”‚   84 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   85 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚   86 â”‚         /// <param name="description">The new description</param>
â”‚       â”‚   â”‚   87 â”‚         /// <returns>True if updated, false if not found</returns>
â”‚       â”‚   â”‚   88 â”‚         Task<bool> UpdateSharedTypeDescriptionAsync(string projectId, string filePath, string description);
â”‚       â”‚   â”‚   89 â”‚ 
â”‚       â”‚   â”‚   90 â”‚         /// <summary>
â”‚       â”‚   â”‚   91 â”‚         /// Removes a shared type from a project
â”‚       â”‚   â”‚   92 â”‚         /// </summary>
â”‚       â”‚   â”‚   93 â”‚         /// <param name="projectId">The project ID</param>
â”‚       â”‚   â”‚   94 â”‚         /// <param name="filePath">The file path</param>
â”‚       â”‚   â”‚   95 â”‚         /// <returns>True if removed, false if not found</returns>
â”‚       â”‚   â”‚   96 â”‚         Task<bool> RemoveSharedTypeAsync(string projectId, string filePath);
â”‚       â”‚   â”‚   97 â”‚     }
â”‚       â”‚   â”‚   98 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”œâ”€â”€ ğŸ“„ IRepository.cs (1.58 KB, 2025-03-11 09:48:27)
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚ FILE CONTENT: IRepository.cs
â”‚       â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    3 â”‚ using System.Linq;
â”‚       â”‚   â”‚    4 â”‚ using System.Text;
â”‚       â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    6 â”‚ using System.Collections.Generic;
â”‚       â”‚   â”‚    7 â”‚ using System.Threading.Tasks;
â”‚       â”‚   â”‚    8 â”‚ 
â”‚       â”‚   â”‚    9 â”‚ namespace test.Core.Interfaces
â”‚       â”‚   â”‚   10 â”‚ {
â”‚       â”‚   â”‚   11 â”‚     /// <summary>
â”‚       â”‚   â”‚   12 â”‚     /// Generic repository interface for basic CRUD operations
â”‚       â”‚   â”‚   13 â”‚     /// </summary>
â”‚       â”‚   â”‚   14 â”‚     /// <typeparam name="T">The entity type</typeparam>
â”‚       â”‚   â”‚   15 â”‚     /// <typeparam name="TId">The type of the entity ID</typeparam>
â”‚       â”‚   â”‚   16 â”‚     public interface IRepository<T, TId>
â”‚       â”‚   â”‚   17 â”‚     {
â”‚       â”‚   â”‚   18 â”‚         /// <summary>
â”‚       â”‚   â”‚   19 â”‚         /// Creates a new entity
â”‚       â”‚   â”‚   20 â”‚         /// </summary>
â”‚       â”‚   â”‚   21 â”‚         /// <param name="entity">The entity to create</param>
â”‚       â”‚   â”‚   22 â”‚         /// <returns>The ID of the created entity</returns>
â”‚       â”‚   â”‚   23 â”‚         Task<TId> CreateAsync(T entity);
â”‚       â”‚   â”‚   24 â”‚ 
â”‚       â”‚   â”‚   25 â”‚         /// <summary>
â”‚       â”‚   â”‚   26 â”‚         /// Gets an entity by ID
â”‚       â”‚   â”‚   27 â”‚         /// </summary>
â”‚       â”‚   â”‚   28 â”‚         /// <param name="id">The entity ID</param>
â”‚       â”‚   â”‚   29 â”‚         /// <returns>The entity or null if not found</returns>
â”‚       â”‚   â”‚   30 â”‚         Task<T> GetByIdAsync(TId id);
â”‚       â”‚   â”‚   31 â”‚ 
â”‚       â”‚   â”‚   32 â”‚         /// <summary>
â”‚       â”‚   â”‚   33 â”‚         /// Gets all entities
â”‚       â”‚   â”‚   34 â”‚         /// </summary>
â”‚       â”‚   â”‚   35 â”‚         /// <returns>A collection of all entities</returns>
â”‚       â”‚   â”‚   36 â”‚         Task<IEnumerable<T>> GetAllAsync();
â”‚       â”‚   â”‚   37 â”‚ 
â”‚       â”‚   â”‚   38 â”‚         /// <summary>
â”‚       â”‚   â”‚   39 â”‚         /// Updates an entity
â”‚       â”‚   â”‚   40 â”‚         /// </summary>
â”‚       â”‚   â”‚   41 â”‚         /// <param name="entity">The entity to update</param>
â”‚       â”‚   â”‚   42 â”‚         Task UpdateAsync(T entity);
â”‚       â”‚   â”‚   43 â”‚ 
â”‚       â”‚   â”‚   44 â”‚         /// <summary>
â”‚       â”‚   â”‚   45 â”‚         /// Deletes an entity
â”‚       â”‚   â”‚   46 â”‚         /// </summary>
â”‚       â”‚   â”‚   47 â”‚         /// <param name="id">The ID of the entity to delete</param>
â”‚       â”‚   â”‚   48 â”‚         /// <returns>True if deleted, false if not found</returns>
â”‚       â”‚   â”‚   49 â”‚         Task<bool> DeleteAsync(TId id);
â”‚       â”‚   â”‚   50 â”‚     }
â”‚       â”‚   â”‚   51 â”‚ }
â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â””â”€â”€ ğŸ“„ IXmlModificationService.cs (1.65 KB, 2025-03-11 15:48:01)
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚           â”‚ FILE CONTENT: IXmlModificationService.cs
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚           â”‚    1 â”‚ ï»¿// test/Core/Interfaces/IXmlModificationService.cs
â”‚           â”‚    2 â”‚ using System;
â”‚           â”‚    3 â”‚ using System.Threading.Tasks;
â”‚           â”‚    4 â”‚ 
â”‚           â”‚    5 â”‚ namespace test.Core.Interfaces
â”‚           â”‚    6 â”‚ {
â”‚           â”‚    7 â”‚     /// <summary>
â”‚           â”‚    8 â”‚     /// Interface for XML modification operations
â”‚           â”‚    9 â”‚     /// </summary>
â”‚           â”‚   10 â”‚     public interface IXmlModificationService
â”‚           â”‚   11 â”‚     {
â”‚           â”‚   12 â”‚         /// <summary>
â”‚           â”‚   13 â”‚         /// Updates variable unit values in an XML file
â”‚           â”‚   14 â”‚         /// </summary>
â”‚           â”‚   15 â”‚         /// <param name="filePath">The XML file path</param>
â”‚           â”‚   16 â”‚         /// <param name="variableName">The variable name to update</param>
â”‚           â”‚   17 â”‚         /// <param name="newUnit">The new unit value</param>
â”‚           â”‚   18 â”‚         /// <returns>True if successful, false otherwise</returns>
â”‚           â”‚   19 â”‚         Task<bool> UpdateVariableUnitValuesAsync(string filePath, string variableName, string newUnit);
â”‚           â”‚   20 â”‚ 
â”‚           â”‚   21 â”‚         /// <summary>
â”‚           â”‚   22 â”‚         /// Updates an object value in an XML file
â”‚           â”‚   23 â”‚         /// </summary>
â”‚           â”‚   24 â”‚         /// <param name="filePath">The XML file path</param>
â”‚           â”‚   25 â”‚         /// <param name="objectName">The object name to update</param>
â”‚           â”‚   26 â”‚         /// <param name="newValue">The new value</param>
â”‚           â”‚   27 â”‚         /// <returns>True if successful, false otherwise</returns>
â”‚           â”‚   28 â”‚         Task<bool> UpdateObjectValueAsync(string filePath, string objectName, string newValue);
â”‚           â”‚   29 â”‚ 
â”‚           â”‚   30 â”‚         /// <summary>
â”‚           â”‚   31 â”‚         /// Applies a transformation function to numeric values in an XML file
â”‚           â”‚   32 â”‚         /// </summary>
â”‚           â”‚   33 â”‚         /// <param name="filePath">The XML file path</param>
â”‚           â”‚   34 â”‚         /// <param name="transformationFunc">The transformation function to apply</param>
â”‚           â”‚   35 â”‚         /// <returns>True if successful, false otherwise</returns>
â”‚           â”‚   36 â”‚         Task<bool> UpdateNumericValuesAsync(string filePath, Func<string, double, double> transformationFunc);
â”‚           â”‚   37 â”‚     }
â”‚           â”‚   38 â”‚ }
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   ğŸ“ Data
â”‚   â”‚   ğŸ“ Mapping
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerGroupMapper.cs (4.27 KB, 2025-03-11 13:30:52)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ControllerGroupMapper.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using test.Core.Dto;
â”‚   â”‚   â”‚   â”‚    5 â”‚ 
â”‚   â”‚   â”‚   â”‚    6 â”‚ namespace test.Data.Mapping
â”‚   â”‚   â”‚   â”‚    7 â”‚ {
â”‚   â”‚   â”‚   â”‚    8 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚    9 â”‚     /// Mapping utilities for converting between domain ControllerGroup and DTO versions
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   11 â”‚     public static class ControllerGroupMapper
â”‚   â”‚   â”‚   â”‚   12 â”‚     {
â”‚   â”‚   â”‚   â”‚   13 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   14 â”‚         /// Maps a domain ControllerGroup to a DTO
â”‚   â”‚   â”‚   â”‚   15 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// <param name="domain">The domain entity</param>
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// <returns>The mapped DTO</returns>
â”‚   â”‚   â”‚   â”‚   18 â”‚         public static ControllerGroupDto ToDto(ControllerGroup domain)
â”‚   â”‚   â”‚   â”‚   19 â”‚         {
â”‚   â”‚   â”‚   â”‚   20 â”‚             if (domain == null) return null;
â”‚   â”‚   â”‚   â”‚   21 â”‚ 
â”‚   â”‚   â”‚   â”‚   22 â”‚             var dto = new ControllerGroupDto
â”‚   â”‚   â”‚   â”‚   23 â”‚             {
â”‚   â”‚   â”‚   â”‚   24 â”‚                 GroupIdentifier = domain.GroupIdentifier,
â”‚   â”‚   â”‚   â”‚   25 â”‚                 ControllerNames = new List<string>(domain.ControllerNames),
â”‚   â”‚   â”‚   â”‚   26 â”‚                 OriginalValues = new Dictionary<string, string>(domain.OriginalValues, StringComparer.OrdinalIgnoreCase),
â”‚   â”‚   â”‚   â”‚   27 â”‚                 ProcessedValues = new Dictionary<string, string>(domain.ProcessedValues, StringComparer.OrdinalIgnoreCase),
â”‚   â”‚   â”‚   â”‚   28 â”‚                 NameMapping = new Dictionary<string, string>(domain.NameMapping, StringComparer.OrdinalIgnoreCase)
â”‚   â”‚   â”‚   â”‚   29 â”‚             };
â”‚   â”‚   â”‚   â”‚   30 â”‚ 
â”‚   â”‚   â”‚   â”‚   31 â”‚             return dto;
â”‚   â”‚   â”‚   â”‚   32 â”‚         }
â”‚   â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   â”‚   34 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   35 â”‚         /// Maps a DTO to a domain ControllerGroup
â”‚   â”‚   â”‚   â”‚   36 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   37 â”‚         /// <param name="dto">The DTO</param>
â”‚   â”‚   â”‚   â”‚   38 â”‚         /// <returns>The mapped domain entity</returns>
â”‚   â”‚   â”‚   â”‚   39 â”‚         public static ControllerGroup ToDomain(ControllerGroupDto dto)
â”‚   â”‚   â”‚   â”‚   40 â”‚         {
â”‚   â”‚   â”‚   â”‚   41 â”‚             if (dto == null) return null;
â”‚   â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   â”‚   43 â”‚             var domain = new ControllerGroup(dto.GroupIdentifier ?? "unknown");
â”‚   â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   â”‚   45 â”‚             // Add controller names
â”‚   â”‚   â”‚   â”‚   46 â”‚             if (dto.ControllerNames != null)
â”‚   â”‚   â”‚   â”‚   47 â”‚             {
â”‚   â”‚   â”‚   â”‚   48 â”‚                 foreach (var name in dto.ControllerNames)
â”‚   â”‚   â”‚   â”‚   49 â”‚                 {
â”‚   â”‚   â”‚   â”‚   50 â”‚                     domain.AddControllerName(name);
â”‚   â”‚   â”‚   â”‚   51 â”‚                 }
â”‚   â”‚   â”‚   â”‚   52 â”‚             }
â”‚   â”‚   â”‚   â”‚   53 â”‚ 
â”‚   â”‚   â”‚   â”‚   54 â”‚             // Add original values
â”‚   â”‚   â”‚   â”‚   55 â”‚             if (dto.OriginalValues != null)
â”‚   â”‚   â”‚   â”‚   56 â”‚             {
â”‚   â”‚   â”‚   â”‚   57 â”‚                 foreach (var kvp in dto.OriginalValues)
â”‚   â”‚   â”‚   â”‚   58 â”‚                 {
â”‚   â”‚   â”‚   â”‚   59 â”‚                     domain.AddOriginalValue(kvp.Key, kvp.Value);
â”‚   â”‚   â”‚   â”‚   60 â”‚                 }
â”‚   â”‚   â”‚   â”‚   61 â”‚             }
â”‚   â”‚   â”‚   â”‚   62 â”‚ 
â”‚   â”‚   â”‚   â”‚   63 â”‚             // Add processed values
â”‚   â”‚   â”‚   â”‚   64 â”‚             if (dto.ProcessedValues != null)
â”‚   â”‚   â”‚   â”‚   65 â”‚             {
â”‚   â”‚   â”‚   â”‚   66 â”‚                 foreach (var kvp in dto.ProcessedValues)
â”‚   â”‚   â”‚   â”‚   67 â”‚                 {
â”‚   â”‚   â”‚   â”‚   68 â”‚                     domain.AddProcessedValue(kvp.Key, kvp.Value);
â”‚   â”‚   â”‚   â”‚   69 â”‚                 }
â”‚   â”‚   â”‚   â”‚   70 â”‚             }
â”‚   â”‚   â”‚   â”‚   71 â”‚ 
â”‚   â”‚   â”‚   â”‚   72 â”‚             // Add name mappings
â”‚   â”‚   â”‚   â”‚   73 â”‚             if (dto.NameMapping != null)
â”‚   â”‚   â”‚   â”‚   74 â”‚             {
â”‚   â”‚   â”‚   â”‚   75 â”‚                 foreach (var kvp in dto.NameMapping)
â”‚   â”‚   â”‚   â”‚   76 â”‚                 {
â”‚   â”‚   â”‚   â”‚   77 â”‚                     domain.AddMapping(kvp.Key, kvp.Value);
â”‚   â”‚   â”‚   â”‚   78 â”‚                 }
â”‚   â”‚   â”‚   â”‚   79 â”‚             }
â”‚   â”‚   â”‚   â”‚   80 â”‚ 
â”‚   â”‚   â”‚   â”‚   81 â”‚             return domain;
â”‚   â”‚   â”‚   â”‚   82 â”‚         }
â”‚   â”‚   â”‚   â”‚   83 â”‚ 
â”‚   â”‚   â”‚   â”‚   84 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   85 â”‚         /// Maps a collection of domain ControllerGroups to DTOs
â”‚   â”‚   â”‚   â”‚   86 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   87 â”‚         /// <param name="domainCollection">The domain collection</param>
â”‚   â”‚   â”‚   â”‚   88 â”‚         /// <returns>The DTO collection</returns>
â”‚   â”‚   â”‚   â”‚   89 â”‚         public static IEnumerable<ControllerGroupDto> ToDtoCollection(IEnumerable<ControllerGroup> domainCollection)
â”‚   â”‚   â”‚   â”‚   90 â”‚         {
â”‚   â”‚   â”‚   â”‚   91 â”‚             if (domainCollection == null) return new List<ControllerGroupDto>();
â”‚   â”‚   â”‚   â”‚   92 â”‚ 
â”‚   â”‚   â”‚   â”‚   93 â”‚             var dtos = new List<ControllerGroupDto>();
â”‚   â”‚   â”‚   â”‚   94 â”‚             foreach (var domain in domainCollection)
â”‚   â”‚   â”‚   â”‚   95 â”‚             {
â”‚   â”‚   â”‚   â”‚   96 â”‚                 var dto = ToDto(domain);
â”‚   â”‚   â”‚   â”‚   97 â”‚                 if (dto != null)
â”‚   â”‚   â”‚   â”‚   98 â”‚                 {
â”‚   â”‚   â”‚   â”‚   99 â”‚                     dtos.Add(dto);
â”‚   â”‚   â”‚   â”‚  100 â”‚                 }
â”‚   â”‚   â”‚   â”‚  101 â”‚             }
â”‚   â”‚   â”‚   â”‚  102 â”‚ 
â”‚   â”‚   â”‚   â”‚  103 â”‚             return dtos;
â”‚   â”‚   â”‚   â”‚  104 â”‚         }
â”‚   â”‚   â”‚   â”‚  105 â”‚ 
â”‚   â”‚   â”‚   â”‚  106 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  107 â”‚         /// Maps a collection of DTOs to domain ControllerGroups
â”‚   â”‚   â”‚   â”‚  108 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  109 â”‚         /// <param name="dtoCollection">The DTO collection</param>
â”‚   â”‚   â”‚   â”‚  110 â”‚         /// <returns>The domain collection</returns>
â”‚   â”‚   â”‚   â”‚  111 â”‚         public static IEnumerable<ControllerGroup> ToDomainCollection(IEnumerable<ControllerGroupDto> dtoCollection)
â”‚   â”‚   â”‚   â”‚  112 â”‚         {
â”‚   â”‚   â”‚   â”‚  113 â”‚             if (dtoCollection == null) return new List<ControllerGroup>();
â”‚   â”‚   â”‚   â”‚  114 â”‚ 
â”‚   â”‚   â”‚   â”‚  115 â”‚             var domains = new List<ControllerGroup>();
â”‚   â”‚   â”‚   â”‚  116 â”‚             foreach (var dto in dtoCollection)
â”‚   â”‚   â”‚   â”‚  117 â”‚             {
â”‚   â”‚   â”‚   â”‚  118 â”‚                 var domain = ToDomain(dto);
â”‚   â”‚   â”‚   â”‚  119 â”‚                 if (domain != null)
â”‚   â”‚   â”‚   â”‚  120 â”‚                 {
â”‚   â”‚   â”‚   â”‚  121 â”‚                     domains.Add(domain);
â”‚   â”‚   â”‚   â”‚  122 â”‚                 }
â”‚   â”‚   â”‚   â”‚  123 â”‚             }
â”‚   â”‚   â”‚   â”‚  124 â”‚ 
â”‚   â”‚   â”‚   â”‚  125 â”‚             return domains;
â”‚   â”‚   â”‚   â”‚  126 â”‚         }
â”‚   â”‚   â”‚   â”‚  127 â”‚     }
â”‚   â”‚   â”‚   â”‚  128 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControllerMapper.cs (5.37 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ControllerMapper.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   â”‚    7 â”‚ using test.Data.Entities;
â”‚   â”‚   â”‚   â”‚    8 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    9 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚   10 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚   11 â”‚ 
â”‚   â”‚   â”‚   â”‚   12 â”‚ namespace test.Data.Mapping
â”‚   â”‚   â”‚   â”‚   13 â”‚ {
â”‚   â”‚   â”‚   â”‚   14 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   15 â”‚     /// Maps between Controller domain entities and database entities
â”‚   â”‚   â”‚   â”‚   16 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   17 â”‚     public static class ControllerMapper
â”‚   â”‚   â”‚   â”‚   18 â”‚     {
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// Maps a database controller entity to a domain controller
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   22 â”‚         /// <param name="entity">The database entity</param>
â”‚   â”‚   â”‚   â”‚   23 â”‚         /// <returns>A domain controller</returns>
â”‚   â”‚   â”‚   â”‚   24 â”‚         public static Controller ToDomain(ParsedController entity)
â”‚   â”‚   â”‚   â”‚   25 â”‚         {
â”‚   â”‚   â”‚   â”‚   26 â”‚             if (entity == null)
â”‚   â”‚   â”‚   â”‚   27 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   â”‚   29 â”‚             var controller = new Controller(entity.Name, GetModelFromProperties(entity.Properties));
â”‚   â”‚   â”‚   â”‚   30 â”‚ 
â”‚   â”‚   â”‚   â”‚   31 â”‚             // Set connection info if available
â”‚   â”‚   â”‚   â”‚   32 â”‚             controller.SetConnectionInfo(
â”‚   â”‚   â”‚   â”‚   33 â”‚                 GetPropertyValue(entity.Properties, "Port"),
â”‚   â”‚   â”‚   â”‚   34 â”‚                 GetPropertyValue(entity.Properties, "SerialNumber"),
â”‚   â”‚   â”‚   â”‚   35 â”‚                 GetPropertyValue(entity.Properties, "InfinetId")
â”‚   â”‚   â”‚   â”‚   36 â”‚             );
â”‚   â”‚   â”‚   â”‚   37 â”‚ 
â”‚   â”‚   â”‚   â”‚   38 â”‚             // Add all properties
â”‚   â”‚   â”‚   â”‚   39 â”‚             foreach (var prop in entity.Properties)
â”‚   â”‚   â”‚   â”‚   40 â”‚             {
â”‚   â”‚   â”‚   â”‚   41 â”‚                 controller.SetProperty(prop.Key, prop.Value);
â”‚   â”‚   â”‚   â”‚   42 â”‚             }
â”‚   â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   â”‚   44 â”‚             // Map all objects
â”‚   â”‚   â”‚   â”‚   45 â”‚             if (entity.Objects != null)
â”‚   â”‚   â”‚   â”‚   46 â”‚             {
â”‚   â”‚   â”‚   â”‚   47 â”‚                 foreach (var obj in entity.Objects.Where(o => o.ParentObjectId == null))
â”‚   â”‚   â”‚   â”‚   48 â”‚                 {
â”‚   â”‚   â”‚   â”‚   49 â”‚                     var domainObj = ObjectMapper.ToDomain(obj);
â”‚   â”‚   â”‚   â”‚   50 â”‚                     if (domainObj != null)
â”‚   â”‚   â”‚   â”‚   51 â”‚                     {
â”‚   â”‚   â”‚   â”‚   52 â”‚                         controller.AddObject(domainObj);
â”‚   â”‚   â”‚   â”‚   53 â”‚                     }
â”‚   â”‚   â”‚   â”‚   54 â”‚                 }
â”‚   â”‚   â”‚   â”‚   55 â”‚             }
â”‚   â”‚   â”‚   â”‚   56 â”‚ 
â”‚   â”‚   â”‚   â”‚   57 â”‚             return controller;
â”‚   â”‚   â”‚   â”‚   58 â”‚         }
â”‚   â”‚   â”‚   â”‚   59 â”‚ 
â”‚   â”‚   â”‚   â”‚   60 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   61 â”‚         /// Maps a domain controller to a database entity
â”‚   â”‚   â”‚   â”‚   62 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   63 â”‚         /// <param name="domain">The domain controller</param>
â”‚   â”‚   â”‚   â”‚   64 â”‚         /// <param name="sessionId">The session ID</param>
â”‚   â”‚   â”‚   â”‚   65 â”‚         /// <returns>A database controller entity</returns>
â”‚   â”‚   â”‚   â”‚   66 â”‚         public static ParsedController ToEntity(Controller domain, string sessionId)
â”‚   â”‚   â”‚   â”‚   67 â”‚         {
â”‚   â”‚   â”‚   â”‚   68 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   69 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   70 â”‚ 
â”‚   â”‚   â”‚   â”‚   71 â”‚             var entity = new ParsedController
â”‚   â”‚   â”‚   â”‚   72 â”‚             {
â”‚   â”‚   â”‚   â”‚   73 â”‚                 Name = domain.Name,
â”‚   â”‚   â”‚   â”‚   74 â”‚                 SessionId = sessionId,
â”‚   â”‚   â”‚   â”‚   75 â”‚                 Created = DateTime.UtcNow,
â”‚   â”‚   â”‚   â”‚   76 â”‚                 Properties = new List<ControllerProperty>(),
â”‚   â”‚   â”‚   â”‚   77 â”‚                 Objects = new List<ParsedObject>()
â”‚   â”‚   â”‚   â”‚   78 â”‚             };
â”‚   â”‚   â”‚   â”‚   79 â”‚ 
â”‚   â”‚   â”‚   â”‚   80 â”‚             // Add all properties
â”‚   â”‚   â”‚   â”‚   81 â”‚             foreach (var prop in domain.Properties)
â”‚   â”‚   â”‚   â”‚   82 â”‚             {
â”‚   â”‚   â”‚   â”‚   83 â”‚                 entity.Properties.Add(new ControllerProperty
â”‚   â”‚   â”‚   â”‚   84 â”‚                 {
â”‚   â”‚   â”‚   â”‚   85 â”‚                     Key = prop.Key,
â”‚   â”‚   â”‚   â”‚   86 â”‚                     Value = prop.Value
â”‚   â”‚   â”‚   â”‚   87 â”‚                 });
â”‚   â”‚   â”‚   â”‚   88 â”‚             }
â”‚   â”‚   â”‚   â”‚   89 â”‚ 
â”‚   â”‚   â”‚   â”‚   90 â”‚             // Make sure model is included in properties
â”‚   â”‚   â”‚   â”‚   91 â”‚             if (!string.IsNullOrEmpty(domain.Model) && !entity.Properties.Any(p => p.Key == "Model"))
â”‚   â”‚   â”‚   â”‚   92 â”‚             {
â”‚   â”‚   â”‚   â”‚   93 â”‚                 entity.Properties.Add(new ControllerProperty
â”‚   â”‚   â”‚   â”‚   94 â”‚                 {
â”‚   â”‚   â”‚   â”‚   95 â”‚                     Key = "Model",
â”‚   â”‚   â”‚   â”‚   96 â”‚                     Value = domain.Model
â”‚   â”‚   â”‚   â”‚   97 â”‚                 });
â”‚   â”‚   â”‚   â”‚   98 â”‚             }
â”‚   â”‚   â”‚   â”‚   99 â”‚ 
â”‚   â”‚   â”‚   â”‚  100 â”‚             // Add connection properties if available
â”‚   â”‚   â”‚   â”‚  101 â”‚             if (!string.IsNullOrEmpty(domain.Port) && !entity.Properties.Any(p => p.Key == "Port"))
â”‚   â”‚   â”‚   â”‚  102 â”‚             {
â”‚   â”‚   â”‚   â”‚  103 â”‚                 entity.Properties.Add(new ControllerProperty
â”‚   â”‚   â”‚   â”‚  104 â”‚                 {
â”‚   â”‚   â”‚   â”‚  105 â”‚                     Key = "Port",
â”‚   â”‚   â”‚   â”‚  106 â”‚                     Value = domain.Port
â”‚   â”‚   â”‚   â”‚  107 â”‚                 });
â”‚   â”‚   â”‚   â”‚  108 â”‚             }
â”‚   â”‚   â”‚   â”‚  109 â”‚ 
â”‚   â”‚   â”‚   â”‚  110 â”‚             if (!string.IsNullOrEmpty(domain.SerialNumber) && !entity.Properties.Any(p => p.Key == "SerialNumber"))
â”‚   â”‚   â”‚   â”‚  111 â”‚             {
â”‚   â”‚   â”‚   â”‚  112 â”‚                 entity.Properties.Add(new ControllerProperty
â”‚   â”‚   â”‚   â”‚  113 â”‚                 {
â”‚   â”‚   â”‚   â”‚  114 â”‚                     Key = "SerialNumber",
â”‚   â”‚   â”‚   â”‚  115 â”‚                     Value = domain.SerialNumber
â”‚   â”‚   â”‚   â”‚  116 â”‚                 });
â”‚   â”‚   â”‚   â”‚  117 â”‚             }
â”‚   â”‚   â”‚   â”‚  118 â”‚ 
â”‚   â”‚   â”‚   â”‚  119 â”‚             if (!string.IsNullOrEmpty(domain.InfinetId) && !entity.Properties.Any(p => p.Key == "InfinetId"))
â”‚   â”‚   â”‚   â”‚  120 â”‚             {
â”‚   â”‚   â”‚   â”‚  121 â”‚                 entity.Properties.Add(new ControllerProperty
â”‚   â”‚   â”‚   â”‚  122 â”‚                 {
â”‚   â”‚   â”‚   â”‚  123 â”‚                     Key = "InfinetId",
â”‚   â”‚   â”‚   â”‚  124 â”‚                     Value = domain.InfinetId
â”‚   â”‚   â”‚   â”‚  125 â”‚                 });
â”‚   â”‚   â”‚   â”‚  126 â”‚             }
â”‚   â”‚   â”‚   â”‚  127 â”‚ 
â”‚   â”‚   â”‚   â”‚  128 â”‚             // Map all objects
â”‚   â”‚   â”‚   â”‚  129 â”‚             foreach (var obj in domain.Objects)
â”‚   â”‚   â”‚   â”‚  130 â”‚             {
â”‚   â”‚   â”‚   â”‚  131 â”‚                 var objEntity = ObjectMapper.ToEntity(obj, sessionId);
â”‚   â”‚   â”‚   â”‚  132 â”‚                 if (objEntity != null)
â”‚   â”‚   â”‚   â”‚  133 â”‚                 {
â”‚   â”‚   â”‚   â”‚  134 â”‚                     entity.Objects.Add(objEntity);
â”‚   â”‚   â”‚   â”‚  135 â”‚                 }
â”‚   â”‚   â”‚   â”‚  136 â”‚             }
â”‚   â”‚   â”‚   â”‚  137 â”‚ 
â”‚   â”‚   â”‚   â”‚  138 â”‚             return entity;
â”‚   â”‚   â”‚   â”‚  139 â”‚         }
â”‚   â”‚   â”‚   â”‚  140 â”‚ 
â”‚   â”‚   â”‚   â”‚  141 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  142 â”‚         /// Extracts the model from controller properties
â”‚   â”‚   â”‚   â”‚  143 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  144 â”‚         private static string GetModelFromProperties(IEnumerable<ControllerProperty> properties)
â”‚   â”‚   â”‚   â”‚  145 â”‚         {
â”‚   â”‚   â”‚   â”‚  146 â”‚             return GetPropertyValue(properties, "Model");
â”‚   â”‚   â”‚   â”‚  147 â”‚         }
â”‚   â”‚   â”‚   â”‚  148 â”‚ 
â”‚   â”‚   â”‚   â”‚  149 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  150 â”‚         /// Gets a property value from a list of properties
â”‚   â”‚   â”‚   â”‚  151 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  152 â”‚         private static string GetPropertyValue(IEnumerable<ControllerProperty> properties, string key)
â”‚   â”‚   â”‚   â”‚  153 â”‚         {
â”‚   â”‚   â”‚   â”‚  154 â”‚             if (properties == null)
â”‚   â”‚   â”‚   â”‚  155 â”‚                 return string.Empty;
â”‚   â”‚   â”‚   â”‚  156 â”‚ 
â”‚   â”‚   â”‚   â”‚  157 â”‚             var prop = properties.FirstOrDefault(p => p.Key.Equals(key, StringComparison.OrdinalIgnoreCase));
â”‚   â”‚   â”‚   â”‚  158 â”‚             return prop?.Value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚  159 â”‚         }
â”‚   â”‚   â”‚   â”‚  160 â”‚     }
â”‚   â”‚   â”‚   â”‚  161 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ObjectMapper.cs (3.41 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ObjectMapper.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚   â”‚    7 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   â”‚    8 â”‚ using test.Data.Entities;
â”‚   â”‚   â”‚   â”‚    9 â”‚ using System;
â”‚   â”‚   â”‚   â”‚   10 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚   11 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚   12 â”‚ 
â”‚   â”‚   â”‚   â”‚   13 â”‚ namespace test.Data.Mapping
â”‚   â”‚   â”‚   â”‚   14 â”‚ {
â”‚   â”‚   â”‚   â”‚   15 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   16 â”‚     /// Maps between ControllerObject domain entities and database entities
â”‚   â”‚   â”‚   â”‚   17 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   18 â”‚     public static class ObjectMapper
â”‚   â”‚   â”‚   â”‚   19 â”‚     {
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// Maps a database object entity to a domain object
â”‚   â”‚   â”‚   â”‚   22 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   23 â”‚         /// <param name="entity">The database entity</param>
â”‚   â”‚   â”‚   â”‚   24 â”‚         /// <returns>A domain controller object</returns>
â”‚   â”‚   â”‚   â”‚   25 â”‚         public static ControllerObject ToDomain(ParsedObject entity)
â”‚   â”‚   â”‚   â”‚   26 â”‚         {
â”‚   â”‚   â”‚   â”‚   27 â”‚             if (entity == null)
â”‚   â”‚   â”‚   â”‚   28 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   29 â”‚ 
â”‚   â”‚   â”‚   â”‚   30 â”‚             var obj = new ControllerObject(
â”‚   â”‚   â”‚   â”‚   31 â”‚                 entity.Type ?? "Unknown",
â”‚   â”‚   â”‚   â”‚   32 â”‚                 entity.Name,
â”‚   â”‚   â”‚   â”‚   33 â”‚                 entity.Value
â”‚   â”‚   â”‚   â”‚   34 â”‚             );
â”‚   â”‚   â”‚   â”‚   35 â”‚ 
â”‚   â”‚   â”‚   â”‚   36 â”‚             // Set alias if available
â”‚   â”‚   â”‚   â”‚   37 â”‚             if (!string.IsNullOrEmpty(entity.Alias))
â”‚   â”‚   â”‚   â”‚   38 â”‚             {
â”‚   â”‚   â”‚   â”‚   39 â”‚                 obj.SetAlias(entity.Alias);
â”‚   â”‚   â”‚   â”‚   40 â”‚             }
â”‚   â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   â”‚   42 â”‚             // Set has byte code flag
â”‚   â”‚   â”‚   â”‚   43 â”‚             obj.SetHasByteCode(entity.HasByteCode);
â”‚   â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   â”‚   45 â”‚             // Add properties
â”‚   â”‚   â”‚   â”‚   46 â”‚             if (entity.Properties != null)
â”‚   â”‚   â”‚   â”‚   47 â”‚             {
â”‚   â”‚   â”‚   â”‚   48 â”‚                 foreach (var prop in entity.Properties)
â”‚   â”‚   â”‚   â”‚   49 â”‚                 {
â”‚   â”‚   â”‚   â”‚   50 â”‚                     obj.SetProperty(prop.Key, prop.Value);
â”‚   â”‚   â”‚   â”‚   51 â”‚                 }
â”‚   â”‚   â”‚   â”‚   52 â”‚             }
â”‚   â”‚   â”‚   â”‚   53 â”‚ 
â”‚   â”‚   â”‚   â”‚   54 â”‚             // Add child objects
â”‚   â”‚   â”‚   â”‚   55 â”‚             if (entity.Children != null)
â”‚   â”‚   â”‚   â”‚   56 â”‚             {
â”‚   â”‚   â”‚   â”‚   57 â”‚                 foreach (var child in entity.Children)
â”‚   â”‚   â”‚   â”‚   58 â”‚                 {
â”‚   â”‚   â”‚   â”‚   59 â”‚                     var childObj = ToDomain(child);
â”‚   â”‚   â”‚   â”‚   60 â”‚                     if (childObj != null)
â”‚   â”‚   â”‚   â”‚   61 â”‚                     {
â”‚   â”‚   â”‚   â”‚   62 â”‚                         obj.AddChild(childObj);
â”‚   â”‚   â”‚   â”‚   63 â”‚                     }
â”‚   â”‚   â”‚   â”‚   64 â”‚                 }
â”‚   â”‚   â”‚   â”‚   65 â”‚             }
â”‚   â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   â”‚   67 â”‚             return obj;
â”‚   â”‚   â”‚   â”‚   68 â”‚         }
â”‚   â”‚   â”‚   â”‚   69 â”‚ 
â”‚   â”‚   â”‚   â”‚   70 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   71 â”‚         /// Maps a domain controller object to a database entity
â”‚   â”‚   â”‚   â”‚   72 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   73 â”‚         /// <param name="domain">The domain controller object</param>
â”‚   â”‚   â”‚   â”‚   74 â”‚         /// <param name="sessionId">The session ID</param>
â”‚   â”‚   â”‚   â”‚   75 â”‚         /// <returns>A database object entity</returns>
â”‚   â”‚   â”‚   â”‚   76 â”‚         public static ParsedObject ToEntity(ControllerObject domain, string sessionId)
â”‚   â”‚   â”‚   â”‚   77 â”‚         {
â”‚   â”‚   â”‚   â”‚   78 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   79 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   80 â”‚ 
â”‚   â”‚   â”‚   â”‚   81 â”‚             var entity = new ParsedObject
â”‚   â”‚   â”‚   â”‚   82 â”‚             {
â”‚   â”‚   â”‚   â”‚   83 â”‚                 Type = domain.Type,
â”‚   â”‚   â”‚   â”‚   84 â”‚                 Name = domain.Name,
â”‚   â”‚   â”‚   â”‚   85 â”‚                 Alias = domain.Alias,
â”‚   â”‚   â”‚   â”‚   86 â”‚                 Value = domain.Value,
â”‚   â”‚   â”‚   â”‚   87 â”‚                 HasByteCode = domain.HasByteCode,
â”‚   â”‚   â”‚   â”‚   88 â”‚                 SessionId = sessionId,
â”‚   â”‚   â”‚   â”‚   89 â”‚                 Properties = new List<ObjectProperty>(),
â”‚   â”‚   â”‚   â”‚   90 â”‚                 Children = new List<ParsedObject>()
â”‚   â”‚   â”‚   â”‚   91 â”‚             };
â”‚   â”‚   â”‚   â”‚   92 â”‚ 
â”‚   â”‚   â”‚   â”‚   93 â”‚             // Add properties
â”‚   â”‚   â”‚   â”‚   94 â”‚             foreach (var prop in domain.Properties)
â”‚   â”‚   â”‚   â”‚   95 â”‚             {
â”‚   â”‚   â”‚   â”‚   96 â”‚                 entity.Properties.Add(new ObjectProperty
â”‚   â”‚   â”‚   â”‚   97 â”‚                 {
â”‚   â”‚   â”‚   â”‚   98 â”‚                     Key = prop.Key,
â”‚   â”‚   â”‚   â”‚   99 â”‚                     Value = prop.Value
â”‚   â”‚   â”‚   â”‚  100 â”‚                 });
â”‚   â”‚   â”‚   â”‚  101 â”‚             }
â”‚   â”‚   â”‚   â”‚  102 â”‚ 
â”‚   â”‚   â”‚   â”‚  103 â”‚             // Add children
â”‚   â”‚   â”‚   â”‚  104 â”‚             foreach (var child in domain.Children)
â”‚   â”‚   â”‚   â”‚  105 â”‚             {
â”‚   â”‚   â”‚   â”‚  106 â”‚                 var childEntity = ToEntity(child, sessionId);
â”‚   â”‚   â”‚   â”‚  107 â”‚                 if (childEntity != null)
â”‚   â”‚   â”‚   â”‚  108 â”‚                 {
â”‚   â”‚   â”‚   â”‚  109 â”‚                     entity.Children.Add(childEntity);
â”‚   â”‚   â”‚   â”‚  110 â”‚                 }
â”‚   â”‚   â”‚   â”‚  111 â”‚             }
â”‚   â”‚   â”‚   â”‚  112 â”‚ 
â”‚   â”‚   â”‚   â”‚  113 â”‚             return entity;
â”‚   â”‚   â”‚   â”‚  114 â”‚         }
â”‚   â”‚   â”‚   â”‚  115 â”‚     }
â”‚   â”‚   â”‚   â”‚  116 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ParsedController.cs (1.15 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ParsedController.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    7 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    8 â”‚ using System.ComponentModel.DataAnnotations;
â”‚   â”‚   â”‚   â”‚    9 â”‚ 
â”‚   â”‚   â”‚   â”‚   10 â”‚ namespace test.Data.Entities
â”‚   â”‚   â”‚   â”‚   11 â”‚ {
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     /// Database entity for a parsed controller
â”‚   â”‚   â”‚   â”‚   14 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   15 â”‚     public class ParsedController
â”‚   â”‚   â”‚   â”‚   16 â”‚     {
â”‚   â”‚   â”‚   â”‚   17 â”‚         [Key]
â”‚   â”‚   â”‚   â”‚   18 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   â”‚   19 â”‚ 
â”‚   â”‚   â”‚   â”‚   20 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚   â”‚   21 â”‚         public string SessionId { get; set; } // To group controllers from the same parse
â”‚   â”‚   â”‚   â”‚   22 â”‚         public DateTime Created { get; set; }
â”‚   â”‚   â”‚   â”‚   23 â”‚         public virtual List<ControllerProperty> Properties { get; set; } = new();
â”‚   â”‚   â”‚   â”‚   24 â”‚         public virtual List<ParsedObject> Objects { get; set; } = new();
â”‚   â”‚   â”‚   â”‚   25 â”‚     }
â”‚   â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   â”‚   27 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   28 â”‚     /// Database entity for a controller property
â”‚   â”‚   â”‚   â”‚   29 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚     public class ControllerProperty
â”‚   â”‚   â”‚   â”‚   31 â”‚     {
â”‚   â”‚   â”‚   â”‚   32 â”‚         [Key]
â”‚   â”‚   â”‚   â”‚   33 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   â”‚   34 â”‚ 
â”‚   â”‚   â”‚   â”‚   35 â”‚         public int ControllerId { get; set; }
â”‚   â”‚   â”‚   â”‚   36 â”‚         public string Key { get; set; }
â”‚   â”‚   â”‚   â”‚   37 â”‚         public string Value { get; set; }
â”‚   â”‚   â”‚   â”‚   38 â”‚         public virtual ParsedController Controller { get; set; }
â”‚   â”‚   â”‚   â”‚   39 â”‚     }
â”‚   â”‚   â”‚   â”‚   40 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ParsedObject.cs (1.45 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ParsedObject.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    7 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    8 â”‚ using System.ComponentModel.DataAnnotations;
â”‚   â”‚   â”‚   â”‚    9 â”‚ 
â”‚   â”‚   â”‚   â”‚   10 â”‚ namespace test.Data.Entities
â”‚   â”‚   â”‚   â”‚   11 â”‚ {
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     /// Database entity for a parsed controller object
â”‚   â”‚   â”‚   â”‚   14 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   15 â”‚     public class ParsedObject
â”‚   â”‚   â”‚   â”‚   16 â”‚     {
â”‚   â”‚   â”‚   â”‚   17 â”‚         [Key]
â”‚   â”‚   â”‚   â”‚   18 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   â”‚   19 â”‚ 
â”‚   â”‚   â”‚   â”‚   20 â”‚         public int? ControllerId { get; set; }
â”‚   â”‚   â”‚   â”‚   21 â”‚         public int? ParentObjectId { get; set; }
â”‚   â”‚   â”‚   â”‚   22 â”‚         public string Type { get; set; }
â”‚   â”‚   â”‚   â”‚   23 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚   â”‚   24 â”‚         public string Alias { get; set; }
â”‚   â”‚   â”‚   â”‚   25 â”‚         public string Value { get; set; } = string.Empty;
â”‚   â”‚   â”‚   â”‚   26 â”‚         public bool HasByteCode { get; set; }
â”‚   â”‚   â”‚   â”‚   27 â”‚         public string SessionId { get; set; }
â”‚   â”‚   â”‚   â”‚   28 â”‚ 
â”‚   â”‚   â”‚   â”‚   29 â”‚         public virtual ParsedController Controller { get; set; }
â”‚   â”‚   â”‚   â”‚   30 â”‚         public virtual ParsedObject ParentObject { get; set; }
â”‚   â”‚   â”‚   â”‚   31 â”‚         public virtual List<ParsedObject> Children { get; set; } = new();
â”‚   â”‚   â”‚   â”‚   32 â”‚         public virtual List<ObjectProperty> Properties { get; set; } = new();
â”‚   â”‚   â”‚   â”‚   33 â”‚     }
â”‚   â”‚   â”‚   â”‚   34 â”‚ 
â”‚   â”‚   â”‚   â”‚   35 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   36 â”‚     /// Database entity for an object property
â”‚   â”‚   â”‚   â”‚   37 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   38 â”‚     public class ObjectProperty
â”‚   â”‚   â”‚   â”‚   39 â”‚     {
â”‚   â”‚   â”‚   â”‚   40 â”‚         [Key]
â”‚   â”‚   â”‚   â”‚   41 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   â”‚   43 â”‚         public int ObjectId { get; set; }
â”‚   â”‚   â”‚   â”‚   44 â”‚         public string Key { get; set; }
â”‚   â”‚   â”‚   â”‚   45 â”‚         public string Value { get; set; }
â”‚   â”‚   â”‚   â”‚   46 â”‚         public virtual ParsedObject Object { get; set; }
â”‚   â”‚   â”‚   â”‚   47 â”‚     }
â”‚   â”‚   â”‚   â”‚   48 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProjectMapper.cs (3.84 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ProjectMapper.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Collections.ObjectModel;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using test.ViewModels;
â”‚   â”‚   â”‚   â”‚    7 â”‚ 
â”‚   â”‚   â”‚   â”‚    8 â”‚ namespace test.Data.Mapping
â”‚   â”‚   â”‚   â”‚    9 â”‚ {
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Maps between Project domain entities and view models
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public static class ProjectMapper
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// Maps a domain Project to a ProjectViewModel
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// <param name="domain">The domain project</param>
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// <returns>A ProjectViewModel</returns>
â”‚   â”‚   â”‚   â”‚   20 â”‚         public static ProjectViewModel ToDtoViewModel(Project domain)
â”‚   â”‚   â”‚   â”‚   21 â”‚         {
â”‚   â”‚   â”‚   â”‚   22 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   23 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   24 â”‚ 
â”‚   â”‚   â”‚   â”‚   25 â”‚             var viewModel = new ProjectViewModel
â”‚   â”‚   â”‚   â”‚   26 â”‚             {
â”‚   â”‚   â”‚   â”‚   27 â”‚                 ProjectId = domain.Id,
â”‚   â”‚   â”‚   â”‚   28 â”‚                 Name = domain.Name,
â”‚   â”‚   â”‚   â”‚   29 â”‚                 Description = domain.Description,
â”‚   â”‚   â”‚   â”‚   30 â”‚                 Created = domain.Created,
â”‚   â”‚   â”‚   â”‚   31 â”‚                 LastModified = domain.LastModified,
â”‚   â”‚   â”‚   â”‚   32 â”‚                 ImportedFiles = new ObservableCollection<ImportedFileViewModel>(domain.ImportedFiles.Select(ToImportedFileViewModel).ToList()),
â”‚   â”‚   â”‚   â”‚   33 â”‚                 SharedTypes = new ObservableCollection<SharedTypeViewModel>(domain.SharedTypes.Select(ToSharedTypeViewModel).ToList()),
â”‚   â”‚   â”‚   â”‚   34 â”‚                 CustomTypeFiles = new ObservableCollection<CustomTypeFileViewModel>(domain.CustomTypeFiles.Select(ToCustomTypeFileViewModel).ToList())
â”‚   â”‚   â”‚   â”‚   35 â”‚             };
â”‚   â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   â”‚   37 â”‚             return viewModel;
â”‚   â”‚   â”‚   â”‚   38 â”‚         }
â”‚   â”‚   â”‚   â”‚   39 â”‚ 
â”‚   â”‚   â”‚   â”‚   40 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   41 â”‚         /// Maps a domain ImportedFile to an ImportedFileViewModel
â”‚   â”‚   â”‚   â”‚   42 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   43 â”‚         /// <param name="domain">The domain imported file</param>
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// <returns>An ImportedFileViewModel</returns>
â”‚   â”‚   â”‚   â”‚   45 â”‚         public static ImportedFileViewModel ToImportedFileViewModel(ImportedFile domain)
â”‚   â”‚   â”‚   â”‚   46 â”‚         {
â”‚   â”‚   â”‚   â”‚   47 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   48 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   49 â”‚ 
â”‚   â”‚   â”‚   â”‚   50 â”‚             return new ImportedFileViewModel
â”‚   â”‚   â”‚   â”‚   51 â”‚             {
â”‚   â”‚   â”‚   â”‚   52 â”‚                 FileName = domain.FileName,
â”‚   â”‚   â”‚   â”‚   53 â”‚                 FilePath = domain.FilePath,
â”‚   â”‚   â”‚   â”‚   54 â”‚                 Status = domain.Status,
â”‚   â”‚   â”‚   â”‚   55 â”‚                 ImportDate = domain.ImportDate,
â”‚   â”‚   â”‚   â”‚   56 â”‚                 FileSize = domain.FileSize,
â”‚   â”‚   â”‚   â”‚   57 â”‚                 FileType = domain.FileType
â”‚   â”‚   â”‚   â”‚   58 â”‚             };
â”‚   â”‚   â”‚   â”‚   59 â”‚         }
â”‚   â”‚   â”‚   â”‚   60 â”‚ 
â”‚   â”‚   â”‚   â”‚   61 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   62 â”‚         /// Maps a domain SharedType to a SharedTypeViewModel
â”‚   â”‚   â”‚   â”‚   63 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   64 â”‚         /// <param name="domain">The domain shared type</param>
â”‚   â”‚   â”‚   â”‚   65 â”‚         /// <returns>A SharedTypeViewModel</returns>
â”‚   â”‚   â”‚   â”‚   66 â”‚         public static SharedTypeViewModel ToSharedTypeViewModel(SharedType domain)
â”‚   â”‚   â”‚   â”‚   67 â”‚         {
â”‚   â”‚   â”‚   â”‚   68 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   69 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   70 â”‚ 
â”‚   â”‚   â”‚   â”‚   71 â”‚             return new SharedTypeViewModel
â”‚   â”‚   â”‚   â”‚   72 â”‚             {
â”‚   â”‚   â”‚   â”‚   73 â”‚                 TypeName = domain.TypeName,
â”‚   â”‚   â”‚   â”‚   74 â”‚                 FileName = domain.FileName,
â”‚   â”‚   â”‚   â”‚   75 â”‚                 FilePath = domain.FilePath,
â”‚   â”‚   â”‚   â”‚   76 â”‚                 Category = domain.Category,
â”‚   â”‚   â”‚   â”‚   77 â”‚                 Description = domain.Description,
â”‚   â”‚   â”‚   â”‚   78 â”‚                 ImportDate = domain.ImportDate,
â”‚   â”‚   â”‚   â”‚   79 â”‚                 FileSize = domain.FileSize,
â”‚   â”‚   â”‚   â”‚   80 â”‚                 UsageCount = domain.UsageCount,
â”‚   â”‚   â”‚   â”‚   81 â”‚                 VariableCount = domain.VariableCount,
â”‚   â”‚   â”‚   â”‚   82 â”‚                 DefaultTargetName = domain.DefaultTargetName
â”‚   â”‚   â”‚   â”‚   83 â”‚             };
â”‚   â”‚   â”‚   â”‚   84 â”‚         }
â”‚   â”‚   â”‚   â”‚   85 â”‚ 
â”‚   â”‚   â”‚   â”‚   86 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   87 â”‚         /// Maps a domain CustomTypeFile to a CustomTypeFileViewModel
â”‚   â”‚   â”‚   â”‚   88 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   89 â”‚         /// <param name="domain">The domain custom type file</param>
â”‚   â”‚   â”‚   â”‚   90 â”‚         /// <returns>A CustomTypeFileViewModel</returns>
â”‚   â”‚   â”‚   â”‚   91 â”‚         public static CustomTypeFileViewModel ToCustomTypeFileViewModel(CustomTypeFile domain)
â”‚   â”‚   â”‚   â”‚   92 â”‚         {
â”‚   â”‚   â”‚   â”‚   93 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   94 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   95 â”‚ 
â”‚   â”‚   â”‚   â”‚   96 â”‚             return new CustomTypeFileViewModel
â”‚   â”‚   â”‚   â”‚   97 â”‚             {
â”‚   â”‚   â”‚   â”‚   98 â”‚                 FileName = domain.FileName,
â”‚   â”‚   â”‚   â”‚   99 â”‚                 TypeCount = domain.TypeCount,
â”‚   â”‚   â”‚   â”‚  100 â”‚                 LastModified = domain.LastModified,
â”‚   â”‚   â”‚   â”‚  101 â”‚                 Description = domain.Description
â”‚   â”‚   â”‚   â”‚  102 â”‚             };
â”‚   â”‚   â”‚   â”‚  103 â”‚         }
â”‚   â”‚   â”‚   â”‚  104 â”‚     }
â”‚   â”‚   â”‚   â”‚  105 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SessionMapper.cs (2.24 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: SessionMapper.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   â”‚    7 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    8 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    9 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚   10 â”‚ 
â”‚   â”‚   â”‚   â”‚   11 â”‚ namespace test.Data.Mapping
â”‚   â”‚   â”‚   â”‚   12 â”‚ {
â”‚   â”‚   â”‚   â”‚   13 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   14 â”‚     /// Maps between Session domain entities and SessionInfo DTOs
â”‚   â”‚   â”‚   â”‚   15 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   16 â”‚     public static class SessionMapper
â”‚   â”‚   â”‚   â”‚   17 â”‚     {
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// Maps SessionInfo DTO to a domain Session
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// <param name="info">The session info</param>
â”‚   â”‚   â”‚   â”‚   22 â”‚         /// <returns>A domain Session</returns>
â”‚   â”‚   â”‚   â”‚   23 â”‚         public static Session ToDomain(SessionInfo info)
â”‚   â”‚   â”‚   â”‚   24 â”‚         {
â”‚   â”‚   â”‚   â”‚   25 â”‚             if (info == null)
â”‚   â”‚   â”‚   â”‚   26 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   27 â”‚ 
â”‚   â”‚   â”‚   â”‚   28 â”‚             // Extract project ID from session ID if applicable
â”‚   â”‚   â”‚   â”‚   29 â”‚             string projectId = null;
â”‚   â”‚   â”‚   â”‚   30 â”‚             if (info.SessionId.StartsWith("project_"))
â”‚   â”‚   â”‚   â”‚   31 â”‚             {
â”‚   â”‚   â”‚   â”‚   32 â”‚                 var parts = info.SessionId.Split('_', 3);
â”‚   â”‚   â”‚   â”‚   33 â”‚                 if (parts.Length >= 3)
â”‚   â”‚   â”‚   â”‚   34 â”‚                 {
â”‚   â”‚   â”‚   â”‚   35 â”‚                     projectId = parts[1];
â”‚   â”‚   â”‚   â”‚   36 â”‚                 }
â”‚   â”‚   â”‚   â”‚   37 â”‚             }
â”‚   â”‚   â”‚   â”‚   38 â”‚             else
â”‚   â”‚   â”‚   â”‚   39 â”‚             {
â”‚   â”‚   â”‚   â”‚   40 â”‚                 projectId = info.ProjectId;
â”‚   â”‚   â”‚   â”‚   41 â”‚             }
â”‚   â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   â”‚   43 â”‚             var session = new Session(
â”‚   â”‚   â”‚   â”‚   44 â”‚                 info.SessionId,
â”‚   â”‚   â”‚   â”‚   45 â”‚                 info.OriginalFilePath,
â”‚   â”‚   â”‚   â”‚   46 â”‚                 projectId,
â”‚   â”‚   â”‚   â”‚   47 â”‚                 info.ControllerCount,
â”‚   â”‚   â”‚   â”‚   48 â”‚                 info.Created,
â”‚   â”‚   â”‚   â”‚   49 â”‚                 new List<string>() // No controller names available in SessionInfo
â”‚   â”‚   â”‚   â”‚   50 â”‚             );
â”‚   â”‚   â”‚   â”‚   51 â”‚ 
â”‚   â”‚   â”‚   â”‚   52 â”‚             return session;
â”‚   â”‚   â”‚   â”‚   53 â”‚         }
â”‚   â”‚   â”‚   â”‚   54 â”‚ 
â”‚   â”‚   â”‚   â”‚   55 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   56 â”‚         /// Maps a domain Session to SessionInfo DTO
â”‚   â”‚   â”‚   â”‚   57 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   58 â”‚         /// <param name="domain">The domain Session</param>
â”‚   â”‚   â”‚   â”‚   59 â”‚         /// <returns>A SessionInfo DTO</returns>
â”‚   â”‚   â”‚   â”‚   60 â”‚         public static SessionInfo ToInfo(Session domain)
â”‚   â”‚   â”‚   â”‚   61 â”‚         {
â”‚   â”‚   â”‚   â”‚   62 â”‚             if (domain == null)
â”‚   â”‚   â”‚   â”‚   63 â”‚                 return null;
â”‚   â”‚   â”‚   â”‚   64 â”‚ 
â”‚   â”‚   â”‚   â”‚   65 â”‚             return new SessionInfo
â”‚   â”‚   â”‚   â”‚   66 â”‚             {
â”‚   â”‚   â”‚   â”‚   67 â”‚                 SessionId = domain.Id,
â”‚   â”‚   â”‚   â”‚   68 â”‚                 FileName = domain.FileName,
â”‚   â”‚   â”‚   â”‚   69 â”‚                 OriginalFilePath = domain.OriginalFilePath,
â”‚   â”‚   â”‚   â”‚   70 â”‚                 ProjectId = domain.ProjectId,
â”‚   â”‚   â”‚   â”‚   71 â”‚                 ControllerCount = domain.ControllerCount,
â”‚   â”‚   â”‚   â”‚   72 â”‚                 Created = domain.Created
â”‚   â”‚   â”‚   â”‚   73 â”‚             };
â”‚   â”‚   â”‚   â”‚   74 â”‚         }
â”‚   â”‚   â”‚   â”‚   75 â”‚     }
â”‚   â”‚   â”‚   â”‚   76 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ SimilarityResultMapper.cs (2.61 KB, 2025-03-11 13:31:27)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: SimilarityResultMapper.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚       â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚       â”‚    3 â”‚ using test.Core.Domain;
â”‚   â”‚       â”‚    4 â”‚ using test.Core.Dto;
â”‚   â”‚       â”‚    5 â”‚ 
â”‚   â”‚       â”‚    6 â”‚ namespace test.Data.Mapping
â”‚   â”‚       â”‚    7 â”‚ {
â”‚   â”‚       â”‚    8 â”‚     /// <summary>
â”‚   â”‚       â”‚    9 â”‚     /// Mapping utilities for similarity results
â”‚   â”‚       â”‚   10 â”‚     /// </summary>
â”‚   â”‚       â”‚   11 â”‚     public static class SimilarityResultMapper
â”‚   â”‚       â”‚   12 â”‚     {
â”‚   â”‚       â”‚   13 â”‚         /// <summary>
â”‚   â”‚       â”‚   14 â”‚         /// Creates a SimilarityResultDto from a ControllerGroup and a similarity score
â”‚   â”‚       â”‚   15 â”‚         /// </summary>
â”‚   â”‚       â”‚   16 â”‚         /// <param name="group">The controller group</param>
â”‚   â”‚       â”‚   17 â”‚         /// <param name="similarityScore">The similarity score</param>
â”‚   â”‚       â”‚   18 â”‚         /// <returns>A similarity result DTO</returns>
â”‚   â”‚       â”‚   19 â”‚         public static SimilarityResultDto FromControllerGroup(ControllerGroup group, double similarityScore)
â”‚   â”‚       â”‚   20 â”‚         {
â”‚   â”‚       â”‚   21 â”‚             if (group == null) return null;
â”‚   â”‚       â”‚   22 â”‚ 
â”‚   â”‚       â”‚   23 â”‚             return new SimilarityResultDto
â”‚   â”‚       â”‚   24 â”‚             {
â”‚   â”‚       â”‚   25 â”‚                 GroupIdentifier = group.GroupIdentifier,
â”‚   â”‚       â”‚   26 â”‚                 SimilarityScore = similarityScore,
â”‚   â”‚       â”‚   27 â”‚                 ControllerNames = new List<string>(group.ControllerNames),
â”‚   â”‚       â”‚   28 â”‚                 OriginalValues = new Dictionary<string, string>(group.OriginalValues, StringComparer.OrdinalIgnoreCase),
â”‚   â”‚       â”‚   29 â”‚                 ProcessedValues = new Dictionary<string, string>(group.ProcessedValues, StringComparer.OrdinalIgnoreCase),
â”‚   â”‚       â”‚   30 â”‚                 NameMapping = new Dictionary<string, string>(group.NameMapping, StringComparer.OrdinalIgnoreCase)
â”‚   â”‚       â”‚   31 â”‚             };
â”‚   â”‚       â”‚   32 â”‚         }
â”‚   â”‚       â”‚   33 â”‚ 
â”‚   â”‚       â”‚   34 â”‚         /// <summary>
â”‚   â”‚       â”‚   35 â”‚         /// Maps a collection of ControllerGroups to SimilarityResultDtos
â”‚   â”‚       â”‚   36 â”‚         /// </summary>
â”‚   â”‚       â”‚   37 â”‚         /// <param name="groups">The controller groups</param>
â”‚   â”‚       â”‚   38 â”‚         /// <param name="similarityScores">Dictionary mapping group IDs to similarity scores</param>
â”‚   â”‚       â”‚   39 â”‚         /// <returns>Collection of similarity result DTOs</returns>
â”‚   â”‚       â”‚   40 â”‚         public static IEnumerable<SimilarityResultDto> FromControllerGroups(
â”‚   â”‚       â”‚   41 â”‚             IEnumerable<ControllerGroup> groups,
â”‚   â”‚       â”‚   42 â”‚             Dictionary<string, double> similarityScores)
â”‚   â”‚       â”‚   43 â”‚         {
â”‚   â”‚       â”‚   44 â”‚             if (groups == null) return new List<SimilarityResultDto>();
â”‚   â”‚       â”‚   45 â”‚ 
â”‚   â”‚       â”‚   46 â”‚             var results = new List<SimilarityResultDto>();
â”‚   â”‚       â”‚   47 â”‚             foreach (var group in groups)
â”‚   â”‚       â”‚   48 â”‚             {
â”‚   â”‚       â”‚   49 â”‚                 double score = 0;
â”‚   â”‚       â”‚   50 â”‚                 if (similarityScores != null && group != null &&
â”‚   â”‚       â”‚   51 â”‚                     similarityScores.TryGetValue(group.GroupIdentifier, out double groupScore))
â”‚   â”‚       â”‚   52 â”‚                 {
â”‚   â”‚       â”‚   53 â”‚                     score = groupScore;
â”‚   â”‚       â”‚   54 â”‚                 }
â”‚   â”‚       â”‚   55 â”‚ 
â”‚   â”‚       â”‚   56 â”‚                 var dto = FromControllerGroup(group, score);
â”‚   â”‚       â”‚   57 â”‚                 if (dto != null)
â”‚   â”‚       â”‚   58 â”‚                 {
â”‚   â”‚       â”‚   59 â”‚                     results.Add(dto);
â”‚   â”‚       â”‚   60 â”‚                 }
â”‚   â”‚       â”‚   61 â”‚             }
â”‚   â”‚       â”‚   62 â”‚ 
â”‚   â”‚       â”‚   63 â”‚             return results;
â”‚   â”‚       â”‚   64 â”‚         }
â”‚   â”‚       â”‚   65 â”‚     }
â”‚   â”‚       â”‚   66 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ParserDbContext.cs (5.06 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ParserDbContext.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Microsoft.EntityFrameworkCore;
â”‚   â”‚   â”‚    2 â”‚ using System;
â”‚   â”‚   â”‚    3 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚    4 â”‚ using System.ComponentModel.DataAnnotations;
â”‚   â”‚   â”‚    5 â”‚ using System.IO;
â”‚   â”‚   â”‚    6 â”‚ 
â”‚   â”‚   â”‚    7 â”‚ namespace test.Data
â”‚   â”‚   â”‚    8 â”‚ {
â”‚   â”‚   â”‚    9 â”‚     public class ParsedController
â”‚   â”‚   â”‚   10 â”‚     {
â”‚   â”‚   â”‚   11 â”‚         [Key]
â”‚   â”‚   â”‚   12 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   13 â”‚ 
â”‚   â”‚   â”‚   14 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚   15 â”‚         public string SessionId { get; set; } // To group controllers from the same parse
â”‚   â”‚   â”‚   16 â”‚         public DateTime Created { get; set; }
â”‚   â”‚   â”‚   17 â”‚         public virtual List<ControllerProperty> Properties { get; set; }
â”‚   â”‚   â”‚   18 â”‚         public virtual List<ParsedObject> Objects { get; set; }
â”‚   â”‚   â”‚   19 â”‚     }
â”‚   â”‚   â”‚   20 â”‚ 
â”‚   â”‚   â”‚   21 â”‚     public class ControllerProperty
â”‚   â”‚   â”‚   22 â”‚     {
â”‚   â”‚   â”‚   23 â”‚         [Key]
â”‚   â”‚   â”‚   24 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   25 â”‚ 
â”‚   â”‚   â”‚   26 â”‚         public int ControllerId { get; set; }
â”‚   â”‚   â”‚   27 â”‚         public string Key { get; set; }
â”‚   â”‚   â”‚   28 â”‚         public string Value { get; set; }
â”‚   â”‚   â”‚   29 â”‚         public virtual ParsedController Controller { get; set; }
â”‚   â”‚   â”‚   30 â”‚     }
â”‚   â”‚   â”‚   31 â”‚ 
â”‚   â”‚   â”‚   32 â”‚     public class ParsedObject
â”‚   â”‚   â”‚   33 â”‚     {
â”‚   â”‚   â”‚   34 â”‚         [Key]
â”‚   â”‚   â”‚   35 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   37 â”‚         public int? ControllerId { get; set; }
â”‚   â”‚   â”‚   38 â”‚         public int? ParentObjectId { get; set; }
â”‚   â”‚   â”‚   39 â”‚         public string Type { get; set; }
â”‚   â”‚   â”‚   40 â”‚         public string Name { get; set; }
â”‚   â”‚   â”‚   41 â”‚         public string Alias { get; set; }
â”‚   â”‚   â”‚   42 â”‚         public string Value { get; set; } = string.Empty; // Set default empty string
â”‚   â”‚   â”‚   43 â”‚         public bool HasByteCode { get; set; }
â”‚   â”‚   â”‚   44 â”‚         public string SessionId { get; set; }
â”‚   â”‚   â”‚   45 â”‚ 
â”‚   â”‚   â”‚   46 â”‚         public virtual ParsedController Controller { get; set; }
â”‚   â”‚   â”‚   47 â”‚         public virtual ParsedObject ParentObject { get; set; }
â”‚   â”‚   â”‚   48 â”‚         public virtual List<ParsedObject> Children { get; set; }
â”‚   â”‚   â”‚   49 â”‚         public virtual List<ObjectProperty> Properties { get; set; }
â”‚   â”‚   â”‚   50 â”‚     }
â”‚   â”‚   â”‚   51 â”‚ 
â”‚   â”‚   â”‚   52 â”‚     public class ObjectProperty
â”‚   â”‚   â”‚   53 â”‚     {
â”‚   â”‚   â”‚   54 â”‚         [Key]
â”‚   â”‚   â”‚   55 â”‚         public int Id { get; set; }
â”‚   â”‚   â”‚   56 â”‚ 
â”‚   â”‚   â”‚   57 â”‚         public int ObjectId { get; set; }
â”‚   â”‚   â”‚   58 â”‚         public string Key { get; set; }
â”‚   â”‚   â”‚   59 â”‚         public string Value { get; set; }
â”‚   â”‚   â”‚   60 â”‚         public virtual ParsedObject Object { get; set; }
â”‚   â”‚   â”‚   61 â”‚     }
â”‚   â”‚   â”‚   62 â”‚ 
â”‚   â”‚   â”‚   63 â”‚     public class ParserDbContext : DbContext
â”‚   â”‚   â”‚   64 â”‚     {
â”‚   â”‚   â”‚   65 â”‚         public DbSet<ParsedController> Controllers { get; set; }
â”‚   â”‚   â”‚   66 â”‚         public DbSet<ControllerProperty> ControllerProperties { get; set; }
â”‚   â”‚   â”‚   67 â”‚         public DbSet<ParsedObject> Objects { get; set; }
â”‚   â”‚   â”‚   68 â”‚         public DbSet<ObjectProperty> ObjectProperties { get; set; }
â”‚   â”‚   â”‚   69 â”‚ 
â”‚   â”‚   â”‚   70 â”‚         private string DbPath { get; }
â”‚   â”‚   â”‚   71 â”‚ 
â”‚   â”‚   â”‚   72 â”‚         public ParserDbContext()
â”‚   â”‚   â”‚   73 â”‚         {
â”‚   â”‚   â”‚   74 â”‚             var folder = Environment.SpecialFolder.LocalApplicationData;
â”‚   â”‚   â”‚   75 â”‚             var path = Environment.GetFolderPath(folder);
â”‚   â”‚   â”‚   76 â”‚             DbPath = Path.Join(path, "PaapeConversionKit", "parser.db");
â”‚   â”‚   â”‚   77 â”‚ 
â”‚   â”‚   â”‚   78 â”‚             Directory.CreateDirectory(Path.GetDirectoryName(DbPath));
â”‚   â”‚   â”‚   79 â”‚         }
â”‚   â”‚   â”‚   80 â”‚ 
â”‚   â”‚   â”‚   81 â”‚         protected override void OnConfiguring(DbContextOptionsBuilder options)
â”‚   â”‚   â”‚   82 â”‚         {
â”‚   â”‚   â”‚   83 â”‚             options.UseSqlite($"Data Source={DbPath}", sqliteOptions =>
â”‚   â”‚   â”‚   84 â”‚             {
â”‚   â”‚   â”‚   85 â”‚                 sqliteOptions.CommandTimeout(60); // Increase timeout to 60 seconds
â”‚   â”‚   â”‚   86 â”‚             });
â”‚   â”‚   â”‚   87 â”‚ 
â”‚   â”‚   â”‚   88 â”‚             // Enable detailed errors and sensitive data logging for development
â”‚   â”‚   â”‚   89 â”‚             options.EnableDetailedErrors()
â”‚   â”‚   â”‚   90 â”‚                    .EnableSensitiveDataLogging();
â”‚   â”‚   â”‚   91 â”‚         }
â”‚   â”‚   â”‚   92 â”‚ 
â”‚   â”‚   â”‚   93 â”‚         protected override void OnModelCreating(ModelBuilder modelBuilder)
â”‚   â”‚   â”‚   94 â”‚         {
â”‚   â”‚   â”‚   95 â”‚             // Configure Value column for ParsedObject
â”‚   â”‚   â”‚   96 â”‚             modelBuilder.Entity<ParsedObject>(entity =>
â”‚   â”‚   â”‚   97 â”‚             {
â”‚   â”‚   â”‚   98 â”‚                 entity.Property(e => e.Value)
â”‚   â”‚   â”‚   99 â”‚                       .HasColumnType("TEXT")
â”‚   â”‚   â”‚  100 â”‚                       .IsRequired(false);
â”‚   â”‚   â”‚  101 â”‚ 
â”‚   â”‚   â”‚  102 â”‚                 entity.Property(e => e.Name)
â”‚   â”‚   â”‚  103 â”‚                       .HasMaxLength(255)
â”‚   â”‚   â”‚  104 â”‚                       .IsRequired();
â”‚   â”‚   â”‚  105 â”‚ 
â”‚   â”‚   â”‚  106 â”‚                 entity.Property(e => e.Type)
â”‚   â”‚   â”‚  107 â”‚                       .HasMaxLength(100)
â”‚   â”‚   â”‚  108 â”‚                       .IsRequired();
â”‚   â”‚   â”‚  109 â”‚ 
â”‚   â”‚   â”‚  110 â”‚                 entity.Property(e => e.Alias)
â”‚   â”‚   â”‚  111 â”‚                       .HasMaxLength(255)
â”‚   â”‚   â”‚  112 â”‚                       .IsRequired(false);
â”‚   â”‚   â”‚  113 â”‚             });
â”‚   â”‚   â”‚  114 â”‚ 
â”‚   â”‚   â”‚  115 â”‚             // Add other configurations
â”‚   â”‚   â”‚  116 â”‚             modelBuilder.Entity<ParsedController>()
â”‚   â”‚   â”‚  117 â”‚                 .HasMany(c => c.Properties)
â”‚   â”‚   â”‚  118 â”‚                 .WithOne(p => p.Controller)
â”‚   â”‚   â”‚  119 â”‚                 .HasForeignKey(p => p.ControllerId)
â”‚   â”‚   â”‚  120 â”‚                 .OnDelete(DeleteBehavior.Cascade);
â”‚   â”‚   â”‚  121 â”‚ 
â”‚   â”‚   â”‚  122 â”‚             modelBuilder.Entity<ParsedController>()
â”‚   â”‚   â”‚  123 â”‚                 .HasMany(c => c.Objects)
â”‚   â”‚   â”‚  124 â”‚                 .WithOne(o => o.Controller)
â”‚   â”‚   â”‚  125 â”‚                 .HasForeignKey(o => o.ControllerId)
â”‚   â”‚   â”‚  126 â”‚                 .OnDelete(DeleteBehavior.Cascade);
â”‚   â”‚   â”‚  127 â”‚ 
â”‚   â”‚   â”‚  128 â”‚             modelBuilder.Entity<ParsedObject>()
â”‚   â”‚   â”‚  129 â”‚                 .HasMany(o => o.Children)
â”‚   â”‚   â”‚  130 â”‚                 .WithOne(o => o.ParentObject)
â”‚   â”‚   â”‚  131 â”‚                 .HasForeignKey(o => o.ParentObjectId)
â”‚   â”‚   â”‚  132 â”‚                 .OnDelete(DeleteBehavior.Cascade);
â”‚   â”‚   â”‚  133 â”‚ 
â”‚   â”‚   â”‚  134 â”‚             modelBuilder.Entity<ParsedObject>()
â”‚   â”‚   â”‚  135 â”‚                 .HasMany(o => o.Properties)
â”‚   â”‚   â”‚  136 â”‚                 .WithOne(p => p.Object)
â”‚   â”‚   â”‚  137 â”‚                 .HasForeignKey(p => p.ObjectId)
â”‚   â”‚   â”‚  138 â”‚                 .OnDelete(DeleteBehavior.Cascade);
â”‚   â”‚   â”‚  139 â”‚ 
â”‚   â”‚   â”‚  140 â”‚             // Add indexes
â”‚   â”‚   â”‚  141 â”‚             modelBuilder.Entity<ParsedController>()
â”‚   â”‚   â”‚  142 â”‚                 .HasIndex(c => c.SessionId);
â”‚   â”‚   â”‚  143 â”‚ 
â”‚   â”‚   â”‚  144 â”‚             modelBuilder.Entity<ParsedObject>()
â”‚   â”‚   â”‚  145 â”‚                 .HasIndex(o => o.SessionId);
â”‚   â”‚   â”‚  146 â”‚         }
â”‚   â”‚   â”‚  147 â”‚     }
â”‚   â”‚   â”‚  148 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â””â”€â”€ ğŸ“„ SessionInfo.cs (1.89 KB, 2025-03-11 09:48:27)
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚ FILE CONTENT: SessionInfo.cs
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚       â”‚    2 â”‚ using System.Collections.Generic;
â”‚       â”‚    3 â”‚ using System.Linq;
â”‚       â”‚    4 â”‚ using System.Text;
â”‚       â”‚    5 â”‚ using System.Threading.Tasks;
â”‚       â”‚    6 â”‚ using System;
â”‚       â”‚    7 â”‚ using System.Collections.Generic;
â”‚       â”‚    8 â”‚ 
â”‚       â”‚    9 â”‚ namespace test.Data
â”‚       â”‚   10 â”‚ {
â”‚       â”‚   11 â”‚     /// <summary>
â”‚       â”‚   12 â”‚     /// Data transfer object with session information
â”‚       â”‚   13 â”‚     /// </summary>
â”‚       â”‚   14 â”‚     public class SessionInfo
â”‚       â”‚   15 â”‚     {
â”‚       â”‚   16 â”‚         public string SessionId { get; set; } = string.Empty;
â”‚       â”‚   17 â”‚         public string FileName { get; set; } // Original file name
â”‚       â”‚   18 â”‚         public string OriginalFilePath { get; set; } = string.Empty; // Path to the original source file
â”‚       â”‚   19 â”‚         public string ProjectId { get; set; } = string.Empty; // ID of the project this session belongs to, if any
â”‚       â”‚   20 â”‚         public int ControllerCount { get; set; }
â”‚       â”‚   21 â”‚         public DateTime Created { get; set; }
â”‚       â”‚   22 â”‚ 
â”‚       â”‚   23 â”‚         // Display properties for UI with fallbacks
â”‚       â”‚   24 â”‚         public string DisplayName
â”‚       â”‚   25 â”‚         {
â”‚       â”‚   26 â”‚             get
â”‚       â”‚   27 â”‚             {
â”‚       â”‚   28 â”‚                 if (!string.IsNullOrEmpty(FileName))
â”‚       â”‚   29 â”‚                     return FileName;
â”‚       â”‚   30 â”‚ 
â”‚       â”‚   31 â”‚                 // Use first part of session ID if no filename
â”‚       â”‚   32 â”‚                 if (!string.IsNullOrEmpty(SessionId) && SessionId.Length >= 8)
â”‚       â”‚   33 â”‚                     return $"Session {SessionId.Substring(0, 8)}";
â”‚       â”‚   34 â”‚ 
â”‚       â”‚   35 â”‚                 // Ultimate fallback
â”‚       â”‚   36 â”‚                 return "Unknown Session";
â”‚       â”‚   37 â”‚             }
â”‚       â”‚   38 â”‚         }
â”‚       â”‚   39 â”‚ 
â”‚       â”‚   40 â”‚         public string DisplayInfo
â”‚       â”‚   41 â”‚         {
â”‚       â”‚   42 â”‚             get
â”‚       â”‚   43 â”‚             {
â”‚       â”‚   44 â”‚                 var parts = new List<string>();
â”‚       â”‚   45 â”‚ 
â”‚       â”‚   46 â”‚                 if (ControllerCount > 0)
â”‚       â”‚   47 â”‚                     parts.Add($"{ControllerCount} controllers");
â”‚       â”‚   48 â”‚ 
â”‚       â”‚   49 â”‚                 if (Created != DateTime.MinValue)
â”‚       â”‚   50 â”‚                     parts.Add($"{Created:MMM dd, yyyy HH:mm}");
â”‚       â”‚   51 â”‚ 
â”‚       â”‚   52 â”‚                 return parts.Count > 0 ? string.Join(" - ", parts) : "No details available";
â”‚       â”‚   53 â”‚             }
â”‚       â”‚   54 â”‚         }
â”‚       â”‚   55 â”‚ 
â”‚       â”‚   56 â”‚         public override string ToString()
â”‚       â”‚   57 â”‚         {
â”‚       â”‚   58 â”‚             return $"{DisplayName} - {DisplayInfo}";
â”‚       â”‚   59 â”‚         }
â”‚       â”‚   60 â”‚     }
â”‚       â”‚   61 â”‚ }
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   ğŸ“ Infrastructure
â”‚   â”‚   ğŸ“ Data
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EfControllerRepository.cs (38.53 KB, 2025-03-11 15:38:22)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: EfControllerRepository.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System.Linq;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using Microsoft.Data.Sqlite;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using Microsoft.EntityFrameworkCore;
â”‚   â”‚   â”‚   â”‚    7 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚   â”‚    8 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚   â”‚    9 â”‚ using test.Core.Exceptions;
â”‚   â”‚   â”‚   â”‚   10 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   â”‚   11 â”‚ using test.Data;
â”‚   â”‚   â”‚   â”‚   12 â”‚ using test.Data.Entities;
â”‚   â”‚   â”‚   â”‚   13 â”‚ using test.Data.Mapping;
â”‚   â”‚   â”‚   â”‚   14 â”‚ using test.Infrastructure.Processing;
â”‚   â”‚   â”‚   â”‚   15 â”‚ using System.Diagnostics;
â”‚   â”‚   â”‚   â”‚   16 â”‚ using System.IO;
â”‚   â”‚   â”‚   â”‚   17 â”‚ using NUlid;
â”‚   â”‚   â”‚   â”‚   18 â”‚ using System.Text;
â”‚   â”‚   â”‚   â”‚   19 â”‚ using ObjectProperty = test.Data.ObjectProperty;
â”‚   â”‚   â”‚   â”‚   20 â”‚ using ParsedObject = test.Data.ParsedObject;
â”‚   â”‚   â”‚   â”‚   21 â”‚ 
â”‚   â”‚   â”‚   â”‚   22 â”‚ namespace test.Infrastructure.Data
â”‚   â”‚   â”‚   â”‚   23 â”‚ {
â”‚   â”‚   â”‚   â”‚   24 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   25 â”‚     /// Entity Framework Core implementation of IControllerRepository with enhanced ByteCode handling
â”‚   â”‚   â”‚   â”‚   26 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   27 â”‚     public class EfControllerRepository : IControllerRepository, IDisposable
â”‚   â”‚   â”‚   â”‚   28 â”‚     {
â”‚   â”‚   â”‚   â”‚   29 â”‚         private readonly ParserDbContext _context;
â”‚   â”‚   â”‚   â”‚   30 â”‚         private readonly ILogger<EfControllerRepository> _logger;
â”‚   â”‚   â”‚   â”‚   31 â”‚         private readonly ByteCodeProcessor _byteCodeProcessor;
â”‚   â”‚   â”‚   â”‚   32 â”‚         private bool _disposed;
â”‚   â”‚   â”‚   â”‚   33 â”‚ 
â”‚   â”‚   â”‚   â”‚   34 â”‚         // Constants for batch operations
â”‚   â”‚   â”‚   â”‚   35 â”‚         private const int BATCH_SIZE = 500;
â”‚   â”‚   â”‚   â”‚   36 â”‚         private int _pendingObjects = 0;
â”‚   â”‚   â”‚   â”‚   37 â”‚ 
â”‚   â”‚   â”‚   â”‚   38 â”‚         // For debugging
â”‚   â”‚   â”‚   â”‚   39 â”‚         private Stopwatch _timer = new Stopwatch();
â”‚   â”‚   â”‚   â”‚   40 â”‚         private int _totalObjectsSaved = 0;
â”‚   â”‚   â”‚   â”‚   41 â”‚         private int _batchCount = 0;
â”‚   â”‚   â”‚   â”‚   42 â”‚         private int _controllerCount = 0;
â”‚   â”‚   â”‚   â”‚   43 â”‚ 
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   45 â”‚         /// Creates a new instance of EfControllerRepository
â”‚   â”‚   â”‚   â”‚   46 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   47 â”‚         /// <param name="context">The database context</param>
â”‚   â”‚   â”‚   â”‚   48 â”‚         /// <param name="logger">The logger</param>
â”‚   â”‚   â”‚   â”‚   49 â”‚         /// <param name="byteCodeProcessor">The ByteCode processor</param>
â”‚   â”‚   â”‚   â”‚   50 â”‚         public EfControllerRepository(
â”‚   â”‚   â”‚   â”‚   51 â”‚             ParserDbContext context,
â”‚   â”‚   â”‚   â”‚   52 â”‚             ILogger<EfControllerRepository> logger,
â”‚   â”‚   â”‚   â”‚   53 â”‚             ByteCodeProcessor byteCodeProcessor)
â”‚   â”‚   â”‚   â”‚   54 â”‚         {
â”‚   â”‚   â”‚   â”‚   55 â”‚             _context = context ?? throw new ArgumentNullException(nameof(context));
â”‚   â”‚   â”‚   â”‚   56 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚   â”‚   â”‚   â”‚   57 â”‚             _byteCodeProcessor = byteCodeProcessor ?? throw new ArgumentNullException(nameof(byteCodeProcessor));
â”‚   â”‚   â”‚   â”‚   58 â”‚         }
â”‚   â”‚   â”‚   â”‚   59 â”‚ 
â”‚   â”‚   â”‚   â”‚   60 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚   61 â”‚         public async Task<IEnumerable<string>> GetAllSessionIdsAsync()
â”‚   â”‚   â”‚   â”‚   62 â”‚         {
â”‚   â”‚   â”‚   â”‚   63 â”‚             try
â”‚   â”‚   â”‚   â”‚   64 â”‚             {
â”‚   â”‚   â”‚   â”‚   65 â”‚                 return await _context.Controllers
â”‚   â”‚   â”‚   â”‚   66 â”‚                     .AsNoTracking()
â”‚   â”‚   â”‚   â”‚   67 â”‚                     .GroupBy(c => c.SessionId)
â”‚   â”‚   â”‚   â”‚   68 â”‚                     .Select(g => new {
â”‚   â”‚   â”‚   â”‚   69 â”‚                         SessionId = g.Key,
â”‚   â”‚   â”‚   â”‚   70 â”‚                         Created = g.Min(c => c.Created) // Earliest created date
â”‚   â”‚   â”‚   â”‚   71 â”‚                     })
â”‚   â”‚   â”‚   â”‚   72 â”‚                     .OrderByDescending(s => s.Created) // Sort by creation date, newest first
â”‚   â”‚   â”‚   â”‚   73 â”‚                     .Select(s => s.SessionId)
â”‚   â”‚   â”‚   â”‚   74 â”‚                     .ToListAsync();
â”‚   â”‚   â”‚   â”‚   75 â”‚             }
â”‚   â”‚   â”‚   â”‚   76 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚   77 â”‚             {
â”‚   â”‚   â”‚   â”‚   78 â”‚                 _logger.LogError(ex, "Error getting session IDs");
â”‚   â”‚   â”‚   â”‚   79 â”‚                 throw new DataAccessException("Failed to retrieve session IDs", "GetAllSessionIds", "Session", ex);
â”‚   â”‚   â”‚   â”‚   80 â”‚             }
â”‚   â”‚   â”‚   â”‚   81 â”‚         }
â”‚   â”‚   â”‚   â”‚   82 â”‚ 
â”‚   â”‚   â”‚   â”‚   83 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚   84 â”‚         public async Task<IEnumerable<SessionInfo>> GetAllSessionsAsync()
â”‚   â”‚   â”‚   â”‚   85 â”‚         {
â”‚   â”‚   â”‚   â”‚   86 â”‚             try
â”‚   â”‚   â”‚   â”‚   87 â”‚             {
â”‚   â”‚   â”‚   â”‚   88 â”‚                 // First, we need to get all sessions with their creation dates
â”‚   â”‚   â”‚   â”‚   89 â”‚                 var sessionData = await _context.Controllers
â”‚   â”‚   â”‚   â”‚   90 â”‚                     .AsNoTracking()
â”‚   â”‚   â”‚   â”‚   91 â”‚                     .GroupBy(c => c.SessionId)
â”‚   â”‚   â”‚   â”‚   92 â”‚                     .Select(g => new {
â”‚   â”‚   â”‚   â”‚   93 â”‚                         SessionId = g.Key,
â”‚   â”‚   â”‚   â”‚   94 â”‚                         Created = g.Min(c => c.Created) // Use the earliest created date for the session
â”‚   â”‚   â”‚   â”‚   95 â”‚                     })
â”‚   â”‚   â”‚   â”‚   96 â”‚                     .OrderByDescending(s => s.Created) // Sort by creation date, newest first
â”‚   â”‚   â”‚   â”‚   97 â”‚                     .ToListAsync();
â”‚   â”‚   â”‚   â”‚   98 â”‚ 
â”‚   â”‚   â”‚   â”‚   99 â”‚                 var result = new List<SessionInfo>();
â”‚   â”‚   â”‚   â”‚  100 â”‚ 
â”‚   â”‚   â”‚   â”‚  101 â”‚                 foreach (var session in sessionData)
â”‚   â”‚   â”‚   â”‚  102 â”‚                 {
â”‚   â”‚   â”‚   â”‚  103 â”‚                     // Get detailed session info
â”‚   â”‚   â”‚   â”‚  104 â”‚                     var sessionInfo = await GetSessionInfoAsync(session.SessionId);
â”‚   â”‚   â”‚   â”‚  105 â”‚                     result.Add(sessionInfo);
â”‚   â”‚   â”‚   â”‚  106 â”‚                 }
â”‚   â”‚   â”‚   â”‚  107 â”‚ 
â”‚   â”‚   â”‚   â”‚  108 â”‚                 return result;
â”‚   â”‚   â”‚   â”‚  109 â”‚             }
â”‚   â”‚   â”‚   â”‚  110 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  111 â”‚             {
â”‚   â”‚   â”‚   â”‚  112 â”‚                 _logger.LogError(ex, "Error getting sessions info");
â”‚   â”‚   â”‚   â”‚  113 â”‚                 throw new DataAccessException("Failed to retrieve sessions info", "GetAllSessions", "Session", ex);
â”‚   â”‚   â”‚   â”‚  114 â”‚             }
â”‚   â”‚   â”‚   â”‚  115 â”‚         }
â”‚   â”‚   â”‚   â”‚  116 â”‚ 
â”‚   â”‚   â”‚   â”‚  117 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  118 â”‚         public async Task<bool> DeleteSessionAsync(string sessionId)
â”‚   â”‚   â”‚   â”‚  119 â”‚         {
â”‚   â”‚   â”‚   â”‚  120 â”‚             if (string.IsNullOrEmpty(sessionId))
â”‚   â”‚   â”‚   â”‚  121 â”‚                 return false;
â”‚   â”‚   â”‚   â”‚  122 â”‚ 
â”‚   â”‚   â”‚   â”‚  123 â”‚             try
â”‚   â”‚   â”‚   â”‚  124 â”‚             {
â”‚   â”‚   â”‚   â”‚  125 â”‚                 _logger.LogInformation("Starting deletion of session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  126 â”‚ 
â”‚   â”‚   â”‚   â”‚  127 â”‚                 // Start a transaction to ensure all related data is deleted properly
â”‚   â”‚   â”‚   â”‚  128 â”‚                 using var transaction = await _context.Database.BeginTransactionAsync();
â”‚   â”‚   â”‚   â”‚  129 â”‚ 
â”‚   â”‚   â”‚   â”‚  130 â”‚                 try
â”‚   â”‚   â”‚   â”‚  131 â”‚                 {
â”‚   â”‚   â”‚   â”‚  132 â”‚                     // Get all controllers for this session
â”‚   â”‚   â”‚   â”‚  133 â”‚                     var controllers = await _context.Controllers
â”‚   â”‚   â”‚   â”‚  134 â”‚                         .Where(c => c.SessionId == sessionId)
â”‚   â”‚   â”‚   â”‚  135 â”‚                         .ToListAsync();
â”‚   â”‚   â”‚   â”‚  136 â”‚ 
â”‚   â”‚   â”‚   â”‚  137 â”‚                     if (!controllers.Any())
â”‚   â”‚   â”‚   â”‚  138 â”‚                     {
â”‚   â”‚   â”‚   â”‚  139 â”‚                         _logger.LogWarning("No controllers found for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  140 â”‚                         return false;
â”‚   â”‚   â”‚   â”‚  141 â”‚                     }
â”‚   â”‚   â”‚   â”‚  142 â”‚ 
â”‚   â”‚   â”‚   â”‚  143 â”‚                     int controllerCount = controllers.Count;
â”‚   â”‚   â”‚   â”‚  144 â”‚                     _logger.LogInformation("Found {ControllerCount} controllers to delete", controllerCount);
â”‚   â”‚   â”‚   â”‚  145 â”‚ 
â”‚   â”‚   â”‚   â”‚  146 â”‚                     // Remove all controllers - SQL cascade delete will handle related objects and properties
â”‚   â”‚   â”‚   â”‚  147 â”‚                     _context.Controllers.RemoveRange(controllers);
â”‚   â”‚   â”‚   â”‚  148 â”‚ 
â”‚   â”‚   â”‚   â”‚  149 â”‚                     // Save changes to apply the deletions
â”‚   â”‚   â”‚   â”‚  150 â”‚                     int rowsAffected = await _context.SaveChangesAsync();
â”‚   â”‚   â”‚   â”‚  151 â”‚ 
â”‚   â”‚   â”‚   â”‚  152 â”‚                     // Commit the transaction
â”‚   â”‚   â”‚   â”‚  153 â”‚                     await transaction.CommitAsync();
â”‚   â”‚   â”‚   â”‚  154 â”‚ 
â”‚   â”‚   â”‚   â”‚  155 â”‚                     _logger.LogInformation("Successfully deleted session {SessionId} with {ControllerCount} controllers. Rows affected: {RowsAffected}",
â”‚   â”‚   â”‚   â”‚  156 â”‚                         sessionId, controllerCount, rowsAffected);
â”‚   â”‚   â”‚   â”‚  157 â”‚ 
â”‚   â”‚   â”‚   â”‚  158 â”‚                     return true;
â”‚   â”‚   â”‚   â”‚  159 â”‚                 }
â”‚   â”‚   â”‚   â”‚  160 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  161 â”‚                 {
â”‚   â”‚   â”‚   â”‚  162 â”‚                     // If an error occurs, roll back the transaction
â”‚   â”‚   â”‚   â”‚  163 â”‚                     await transaction.RollbackAsync();
â”‚   â”‚   â”‚   â”‚  164 â”‚                     _logger.LogError(ex, "Error deleting session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  165 â”‚                     throw new DataAccessException($"Failed to delete session {sessionId}", "DeleteSession", "Session", ex);
â”‚   â”‚   â”‚   â”‚  166 â”‚                 }
â”‚   â”‚   â”‚   â”‚  167 â”‚             }
â”‚   â”‚   â”‚   â”‚  168 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  169 â”‚             {
â”‚   â”‚   â”‚   â”‚  170 â”‚                 _logger.LogError(ex, "Fatal error in DeleteSessionAsync for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  171 â”‚                 throw new DataAccessException("Failed to delete session", "DeleteSession", "Session", ex);
â”‚   â”‚   â”‚   â”‚  172 â”‚             }
â”‚   â”‚   â”‚   â”‚  173 â”‚         }
â”‚   â”‚   â”‚   â”‚  174 â”‚ 
â”‚   â”‚   â”‚   â”‚  175 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  176 â”‚         public async Task<SessionInfo> GetSessionInfoAsync(string sessionId)
â”‚   â”‚   â”‚   â”‚  177 â”‚         {
â”‚   â”‚   â”‚   â”‚  178 â”‚             if (string.IsNullOrEmpty(sessionId))
â”‚   â”‚   â”‚   â”‚  179 â”‚             {
â”‚   â”‚   â”‚   â”‚  180 â”‚                 return new SessionInfo
â”‚   â”‚   â”‚   â”‚  181 â”‚                 {
â”‚   â”‚   â”‚   â”‚  182 â”‚                     SessionId = string.Empty,
â”‚   â”‚   â”‚   â”‚  183 â”‚                     ControllerCount = 0,
â”‚   â”‚   â”‚   â”‚  184 â”‚                     Created = DateTime.MinValue
â”‚   â”‚   â”‚   â”‚  185 â”‚                 };
â”‚   â”‚   â”‚   â”‚  186 â”‚             }
â”‚   â”‚   â”‚   â”‚  187 â”‚ 
â”‚   â”‚   â”‚   â”‚  188 â”‚             try
â”‚   â”‚   â”‚   â”‚  189 â”‚             {
â”‚   â”‚   â”‚   â”‚  190 â”‚                 // Try to get controller count
â”‚   â”‚   â”‚   â”‚  191 â”‚                 int controllerCount = 0;
â”‚   â”‚   â”‚   â”‚  192 â”‚                 try
â”‚   â”‚   â”‚   â”‚  193 â”‚                 {
â”‚   â”‚   â”‚   â”‚  194 â”‚                     controllerCount = await _context.Controllers
â”‚   â”‚   â”‚   â”‚  195 â”‚                         .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  196 â”‚                         .Where(c => c.SessionId == sessionId)
â”‚   â”‚   â”‚   â”‚  197 â”‚                         .CountAsync();
â”‚   â”‚   â”‚   â”‚  198 â”‚                 }
â”‚   â”‚   â”‚   â”‚  199 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  200 â”‚                 {
â”‚   â”‚   â”‚   â”‚  201 â”‚                     _logger.LogError(ex, "Error getting controller count for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  202 â”‚                     // Continue with count = 0
â”‚   â”‚   â”‚   â”‚  203 â”‚                 }
â”‚   â”‚   â”‚   â”‚  204 â”‚ 
â”‚   â”‚   â”‚   â”‚  205 â”‚                 // Try to get first controller for metadata
â”‚   â”‚   â”‚   â”‚  206 â”‚                 test.Data.ParsedController firstController = null;
â”‚   â”‚   â”‚   â”‚  207 â”‚                 DateTime createdDate = DateTime.MinValue;
â”‚   â”‚   â”‚   â”‚  208 â”‚                 try
â”‚   â”‚   â”‚   â”‚  209 â”‚                 {
â”‚   â”‚   â”‚   â”‚  210 â”‚                     firstController = await _context.Controllers
â”‚   â”‚   â”‚   â”‚  211 â”‚                         .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  212 â”‚                         .Include(c => c.Properties)
â”‚   â”‚   â”‚   â”‚  213 â”‚                         .Where(c => c.SessionId == sessionId)
â”‚   â”‚   â”‚   â”‚  214 â”‚                         .OrderBy(c => c.Id)
â”‚   â”‚   â”‚   â”‚  215 â”‚                         .FirstOrDefaultAsync();
â”‚   â”‚   â”‚   â”‚  216 â”‚ 
â”‚   â”‚   â”‚   â”‚  217 â”‚                     createdDate = firstController?.Created ?? DateTime.MinValue;
â”‚   â”‚   â”‚   â”‚  218 â”‚                 }
â”‚   â”‚   â”‚   â”‚  219 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  220 â”‚                 {
â”‚   â”‚   â”‚   â”‚  221 â”‚                     _logger.LogError(ex, "Error getting controller for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  222 â”‚                     // Continue with null controller
â”‚   â”‚   â”‚   â”‚  223 â”‚                 }
â”‚   â”‚   â”‚   â”‚  224 â”‚ 
â”‚   â”‚   â”‚   â”‚  225 â”‚                 // Try to get file properties
â”‚   â”‚   â”‚   â”‚  226 â”‚                 string fileName = null;
â”‚   â”‚   â”‚   â”‚  227 â”‚                 string originalFilePath = null;
â”‚   â”‚   â”‚   â”‚  228 â”‚                 string projectId = null;
â”‚   â”‚   â”‚   â”‚  229 â”‚ 
â”‚   â”‚   â”‚   â”‚  230 â”‚                 if (firstController != null)
â”‚   â”‚   â”‚   â”‚  231 â”‚                 {
â”‚   â”‚   â”‚   â”‚  232 â”‚                     try
â”‚   â”‚   â”‚   â”‚  233 â”‚                     {
â”‚   â”‚   â”‚   â”‚  234 â”‚                         var fileNameProperty = firstController.Properties
â”‚   â”‚   â”‚   â”‚  235 â”‚                             .FirstOrDefault(p => p.Key == "OriginalFileName");
â”‚   â”‚   â”‚   â”‚  236 â”‚ 
â”‚   â”‚   â”‚   â”‚  237 â”‚                         fileName = fileNameProperty?.Value;
â”‚   â”‚   â”‚   â”‚  238 â”‚ 
â”‚   â”‚   â”‚   â”‚  239 â”‚                         var filePathProperty = firstController.Properties
â”‚   â”‚   â”‚   â”‚  240 â”‚                             .FirstOrDefault(p => p.Key == "OriginalFilePath");
â”‚   â”‚   â”‚   â”‚  241 â”‚ 
â”‚   â”‚   â”‚   â”‚  242 â”‚                         originalFilePath = filePathProperty?.Value;
â”‚   â”‚   â”‚   â”‚  243 â”‚ 
â”‚   â”‚   â”‚   â”‚  244 â”‚                         // Extract project ID from sessionId if it has the format "project_PROJECTID_XXXX"
â”‚   â”‚   â”‚   â”‚  245 â”‚                         if (sessionId.StartsWith("project_"))
â”‚   â”‚   â”‚   â”‚  246 â”‚                         {
â”‚   â”‚   â”‚   â”‚  247 â”‚                             var parts = sessionId.Split('_', 3);
â”‚   â”‚   â”‚   â”‚  248 â”‚                             if (parts.Length >= 3)
â”‚   â”‚   â”‚   â”‚  249 â”‚                             {
â”‚   â”‚   â”‚   â”‚  250 â”‚                                 projectId = parts[1];
â”‚   â”‚   â”‚   â”‚  251 â”‚                             }
â”‚   â”‚   â”‚   â”‚  252 â”‚                         }
â”‚   â”‚   â”‚   â”‚  253 â”‚                     }
â”‚   â”‚   â”‚   â”‚  254 â”‚                     catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  255 â”‚                     {
â”‚   â”‚   â”‚   â”‚  256 â”‚                         _logger.LogError(ex, "Error getting file properties for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  257 â”‚                         // Continue with null properties
â”‚   â”‚   â”‚   â”‚  258 â”‚                     }
â”‚   â”‚   â”‚   â”‚  259 â”‚                 }
â”‚   â”‚   â”‚   â”‚  260 â”‚ 
â”‚   â”‚   â”‚   â”‚  261 â”‚                 return new SessionInfo
â”‚   â”‚   â”‚   â”‚  262 â”‚                 {
â”‚   â”‚   â”‚   â”‚  263 â”‚                     SessionId = sessionId,
â”‚   â”‚   â”‚   â”‚  264 â”‚                     FileName = fileName,
â”‚   â”‚   â”‚   â”‚  265 â”‚                     OriginalFilePath = originalFilePath,
â”‚   â”‚   â”‚   â”‚  266 â”‚                     ProjectId = projectId,
â”‚   â”‚   â”‚   â”‚  267 â”‚                     ControllerCount = controllerCount,
â”‚   â”‚   â”‚   â”‚  268 â”‚                     Created = createdDate
â”‚   â”‚   â”‚   â”‚  269 â”‚                 };
â”‚   â”‚   â”‚   â”‚  270 â”‚             }
â”‚   â”‚   â”‚   â”‚  271 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  272 â”‚             {
â”‚   â”‚   â”‚   â”‚  273 â”‚                 _logger.LogError(ex, "Error getting session info for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  274 â”‚                 throw new DataAccessException("Failed to get session info", "GetSessionInfo", "Session", ex);
â”‚   â”‚   â”‚   â”‚  275 â”‚             }
â”‚   â”‚   â”‚   â”‚  276 â”‚         }
â”‚   â”‚   â”‚   â”‚  277 â”‚ 
â”‚   â”‚   â”‚   â”‚  278 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  279 â”‚         public async Task<string> SaveControllerBatchAsync(IEnumerable<Controller> controllers, string fileName = null, string sessionPrefix = null)
â”‚   â”‚   â”‚   â”‚  280 â”‚         {
â”‚   â”‚   â”‚   â”‚  281 â”‚             if (controllers == null)
â”‚   â”‚   â”‚   â”‚  282 â”‚                 throw new ArgumentNullException(nameof(controllers));
â”‚   â”‚   â”‚   â”‚  283 â”‚ 
â”‚   â”‚   â”‚   â”‚  284 â”‚             // Reset counters and start timer for debugging
â”‚   â”‚   â”‚   â”‚  285 â”‚             _timer.Restart();
â”‚   â”‚   â”‚   â”‚  286 â”‚             _pendingObjects = 0;
â”‚   â”‚   â”‚   â”‚  287 â”‚             _totalObjectsSaved = 0;
â”‚   â”‚   â”‚   â”‚  288 â”‚             _batchCount = 0;
â”‚   â”‚   â”‚   â”‚  289 â”‚             _controllerCount = 0;
â”‚   â”‚   â”‚   â”‚  290 â”‚ 
â”‚   â”‚   â”‚   â”‚  291 â”‚             _logger.LogInformation("Starting SaveControllerBatch with {ControllerCount} controllers", controllers.Count());
â”‚   â”‚   â”‚   â”‚  292 â”‚ 
â”‚   â”‚   â”‚   â”‚  293 â”‚             // Generate session ID with optional prefix
â”‚   â”‚   â”‚   â”‚  294 â”‚             var sessionId = sessionPrefix ?? string.Empty;
â”‚   â”‚   â”‚   â”‚  295 â”‚             sessionId += NUlid.Ulid.NewUlid().ToString();
â”‚   â”‚   â”‚   â”‚  296 â”‚ 
â”‚   â”‚   â”‚   â”‚  297 â”‚             var timestamp = DateTime.UtcNow;
â”‚   â”‚   â”‚   â”‚  298 â”‚ 
â”‚   â”‚   â”‚   â”‚  299 â”‚             _logger.LogInformation("Using session ID: {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  300 â”‚ 
â”‚   â”‚   â”‚   â”‚  301 â”‚             try
â”‚   â”‚   â”‚   â”‚  302 â”‚             {
â”‚   â”‚   â”‚   â”‚  303 â”‚                 // Configure SQLite for better performance during bulk insert
â”‚   â”‚   â”‚   â”‚  304 â”‚                 _logger.LogDebug("Configuring SQLite performance settings");
â”‚   â”‚   â”‚   â”‚  305 â”‚                 try
â”‚   â”‚   â”‚   â”‚  306 â”‚                 {
â”‚   â”‚   â”‚   â”‚  307 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA synchronous = OFF");
â”‚   â”‚   â”‚   â”‚  308 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA journal_mode = MEMORY");
â”‚   â”‚   â”‚   â”‚  309 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA temp_store = MEMORY");
â”‚   â”‚   â”‚   â”‚  310 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA cache_size = 10000");
â”‚   â”‚   â”‚   â”‚  311 â”‚                     _logger.LogDebug("SQLite performance settings applied successfully");
â”‚   â”‚   â”‚   â”‚  312 â”‚                 }
â”‚   â”‚   â”‚   â”‚  313 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  314 â”‚                 {
â”‚   â”‚   â”‚   â”‚  315 â”‚                     _logger.LogWarning(ex, "Error applying SQLite settings");
â”‚   â”‚   â”‚   â”‚  316 â”‚                     // Continue even if settings fail - they're optimizations, not requirements
â”‚   â”‚   â”‚   â”‚  317 â”‚                 }
â”‚   â”‚   â”‚   â”‚  318 â”‚ 
â”‚   â”‚   â”‚   â”‚  319 â”‚                 _logger.LogDebug("Beginning database transaction");
â”‚   â”‚   â”‚   â”‚  320 â”‚                 using var transaction = await _context.Database.BeginTransactionAsync();
â”‚   â”‚   â”‚   â”‚  321 â”‚                 try
â”‚   â”‚   â”‚   â”‚  322 â”‚                 {
â”‚   â”‚   â”‚   â”‚  323 â”‚                     foreach (var controller in controllers)
â”‚   â”‚   â”‚   â”‚  324 â”‚                     {
â”‚   â”‚   â”‚   â”‚  325 â”‚                         _controllerCount++;
â”‚   â”‚   â”‚   â”‚  326 â”‚                         _logger.LogDebug("Processing controller {ControllerNumber}/{TotalControllers}: {ControllerName} with {ObjectCount} objects",
â”‚   â”‚   â”‚   â”‚  327 â”‚                             _controllerCount, controllers.Count(), controller.Name, controller.Objects.Count);
â”‚   â”‚   â”‚   â”‚  328 â”‚ 
â”‚   â”‚   â”‚   â”‚  329 â”‚                         try
â”‚   â”‚   â”‚   â”‚  330 â”‚                         {
â”‚   â”‚   â”‚   â”‚  331 â”‚                             // Map domain model to database entity
â”‚   â”‚   â”‚   â”‚  332 â”‚                             var dbController = ControllerMapper.ToEntity(controller, sessionId);
â”‚   â”‚   â”‚   â”‚  333 â”‚ 
â”‚   â”‚   â”‚   â”‚  334 â”‚                             // Add original file path property if provided
â”‚   â”‚   â”‚   â”‚  335 â”‚                             if (!string.IsNullOrEmpty(fileName))
â”‚   â”‚   â”‚   â”‚  336 â”‚                             {
â”‚   â”‚   â”‚   â”‚  337 â”‚                                 dbController.Properties.Add(new test.Data.ControllerProperty
â”‚   â”‚   â”‚   â”‚  338 â”‚                                 {
â”‚   â”‚   â”‚   â”‚  339 â”‚                                     Key = "OriginalFilePath",
â”‚   â”‚   â”‚   â”‚  340 â”‚                                     Value = fileName
â”‚   â”‚   â”‚   â”‚  341 â”‚                                 });
â”‚   â”‚   â”‚   â”‚  342 â”‚ 
â”‚   â”‚   â”‚   â”‚  343 â”‚                                 // Also extract and store just the filename
â”‚   â”‚   â”‚   â”‚  344 â”‚                                 string justFileName = Path.GetFileName(fileName);
â”‚   â”‚   â”‚   â”‚  345 â”‚                                 dbController.Properties.Add(new test.Data.ControllerProperty
â”‚   â”‚   â”‚   â”‚  346 â”‚                                 {
â”‚   â”‚   â”‚   â”‚  347 â”‚                                     Key = "OriginalFileName",
â”‚   â”‚   â”‚   â”‚  348 â”‚                                     Value = justFileName
â”‚   â”‚   â”‚   â”‚  349 â”‚                                 });
â”‚   â”‚   â”‚   â”‚  350 â”‚                             }
â”‚   â”‚   â”‚   â”‚  351 â”‚ 
â”‚   â”‚   â”‚   â”‚  352 â”‚                             _logger.LogDebug("Adding controller '{ControllerName}' with {PropertyCount} properties",
â”‚   â”‚   â”‚   â”‚  353 â”‚                                 controller.Name, dbController.Properties.Count);
â”‚   â”‚   â”‚   â”‚  354 â”‚                             _context.Controllers.Add(dbController);
â”‚   â”‚   â”‚   â”‚  355 â”‚                             _pendingObjects++;
â”‚   â”‚   â”‚   â”‚  356 â”‚ 
â”‚   â”‚   â”‚   â”‚  357 â”‚                             // Save changes in batches
â”‚   â”‚   â”‚   â”‚  358 â”‚                             if (_pendingObjects >= BATCH_SIZE)
â”‚   â”‚   â”‚   â”‚  359 â”‚                             {
â”‚   â”‚   â”‚   â”‚  360 â”‚                                 await SaveBatchAsync("controller batch");
â”‚   â”‚   â”‚   â”‚  361 â”‚                             }
â”‚   â”‚   â”‚   â”‚  362 â”‚ 
â”‚   â”‚   â”‚   â”‚  363 â”‚                             // Save the controller to get its ID before saving children
â”‚   â”‚   â”‚   â”‚  364 â”‚                             if (_pendingObjects > 0)
â”‚   â”‚   â”‚   â”‚  365 â”‚                             {
â”‚   â”‚   â”‚   â”‚  366 â”‚                                 _logger.LogDebug("Saving controller to get its ID");
â”‚   â”‚   â”‚   â”‚  367 â”‚                                 await _context.SaveChangesAsync();
â”‚   â”‚   â”‚   â”‚  368 â”‚                                 _totalObjectsSaved += _pendingObjects;
â”‚   â”‚   â”‚   â”‚  369 â”‚                                 _pendingObjects = 0;
â”‚   â”‚   â”‚   â”‚  370 â”‚                             }
â”‚   â”‚   â”‚   â”‚  371 â”‚ 
â”‚   â”‚   â”‚   â”‚  372 â”‚                             // Process all objects for this controller
â”‚   â”‚   â”‚   â”‚  373 â”‚                             await SaveControllerObjectsAsync(controller.Objects, dbController.Id, null, sessionId);
â”‚   â”‚   â”‚   â”‚  374 â”‚                         }
â”‚   â”‚   â”‚   â”‚  375 â”‚                         catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  376 â”‚                         {
â”‚   â”‚   â”‚   â”‚  377 â”‚                             _logger.LogError(ex, "Error processing controller {ControllerName}", controller.Name);
â”‚   â”‚   â”‚   â”‚  378 â”‚                             throw;
â”‚   â”‚   â”‚   â”‚  379 â”‚                         }
â”‚   â”‚   â”‚   â”‚  380 â”‚                     }
â”‚   â”‚   â”‚   â”‚  381 â”‚ 
â”‚   â”‚   â”‚   â”‚  382 â”‚                     // Save any remaining changes
â”‚   â”‚   â”‚   â”‚  383 â”‚                     if (_pendingObjects > 0)
â”‚   â”‚   â”‚   â”‚  384 â”‚                     {
â”‚   â”‚   â”‚   â”‚  385 â”‚                         _logger.LogDebug("Saving final batch of {PendingObjectCount} objects", _pendingObjects);
â”‚   â”‚   â”‚   â”‚  386 â”‚                         await _context.SaveChangesAsync();
â”‚   â”‚   â”‚   â”‚  387 â”‚                         _totalObjectsSaved += _pendingObjects;
â”‚   â”‚   â”‚   â”‚  388 â”‚                         _pendingObjects = 0;
â”‚   â”‚   â”‚   â”‚  389 â”‚                         _logger.LogDebug("Final batch saved. Total objects saved: {TotalObjectsSaved}", _totalObjectsSaved);
â”‚   â”‚   â”‚   â”‚  390 â”‚                     }
â”‚   â”‚   â”‚   â”‚  391 â”‚ 
â”‚   â”‚   â”‚   â”‚  392 â”‚                     _logger.LogDebug("Committing transaction");
â”‚   â”‚   â”‚   â”‚  393 â”‚                     await transaction.CommitAsync();
â”‚   â”‚   â”‚   â”‚  394 â”‚                     _logger.LogInformation("Transaction committed successfully");
â”‚   â”‚   â”‚   â”‚  395 â”‚ 
â”‚   â”‚   â”‚   â”‚  396 â”‚                     // Reset SQLite configurations to normal
â”‚   â”‚   â”‚   â”‚  397 â”‚                     try
â”‚   â”‚   â”‚   â”‚  398 â”‚                     {
â”‚   â”‚   â”‚   â”‚  399 â”‚                         _logger.LogDebug("Resetting SQLite configurations");
â”‚   â”‚   â”‚   â”‚  400 â”‚                         await _context.Database.ExecuteSqlRawAsync("PRAGMA synchronous = NORMAL");
â”‚   â”‚   â”‚   â”‚  401 â”‚                         await _context.Database.ExecuteSqlRawAsync("PRAGMA journal_mode = DELETE");
â”‚   â”‚   â”‚   â”‚  402 â”‚                         await _context.Database.ExecuteSqlRawAsync("PRAGMA temp_store = DEFAULT");
â”‚   â”‚   â”‚   â”‚  403 â”‚                         _logger.LogDebug("SQLite configurations reset successfully");
â”‚   â”‚   â”‚   â”‚  404 â”‚                     }
â”‚   â”‚   â”‚   â”‚  405 â”‚                     catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  406 â”‚                     {
â”‚   â”‚   â”‚   â”‚  407 â”‚                         _logger.LogWarning(ex, "Error resetting SQLite configurations");
â”‚   â”‚   â”‚   â”‚  408 â”‚                         // Continue even if reset fails
â”‚   â”‚   â”‚   â”‚  409 â”‚                     }
â”‚   â”‚   â”‚   â”‚  410 â”‚ 
â”‚   â”‚   â”‚   â”‚  411 â”‚                     _timer.Stop();
â”‚   â”‚   â”‚   â”‚  412 â”‚                     _logger.LogInformation("SaveControllerBatch completed in {ElapsedMilliseconds}ms. Total objects saved: {TotalObjectsSaved}",
â”‚   â”‚   â”‚   â”‚  413 â”‚                         _timer.ElapsedMilliseconds, _totalObjectsSaved);
â”‚   â”‚   â”‚   â”‚  414 â”‚ 
â”‚   â”‚   â”‚   â”‚  415 â”‚                     return sessionId;
â”‚   â”‚   â”‚   â”‚  416 â”‚                 }
â”‚   â”‚   â”‚   â”‚  417 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  418 â”‚                 {
â”‚   â”‚   â”‚   â”‚  419 â”‚                     _logger.LogError(ex, "Error during save operation");
â”‚   â”‚   â”‚   â”‚  420 â”‚ 
â”‚   â”‚   â”‚   â”‚  421 â”‚                     try
â”‚   â”‚   â”‚   â”‚  422 â”‚                     {
â”‚   â”‚   â”‚   â”‚  423 â”‚                         _logger.LogDebug("Rolling back transaction");
â”‚   â”‚   â”‚   â”‚  424 â”‚                         await transaction.RollbackAsync();
â”‚   â”‚   â”‚   â”‚  425 â”‚                         _logger.LogDebug("Transaction rolled back");
â”‚   â”‚   â”‚   â”‚  426 â”‚                     }
â”‚   â”‚   â”‚   â”‚  427 â”‚                     catch (Exception rollbackEx)
â”‚   â”‚   â”‚   â”‚  428 â”‚                     {
â”‚   â”‚   â”‚   â”‚  429 â”‚                         _logger.LogError(rollbackEx, "Error rolling back transaction");
â”‚   â”‚   â”‚   â”‚  430 â”‚                     }
â”‚   â”‚   â”‚   â”‚  431 â”‚ 
â”‚   â”‚   â”‚   â”‚  432 â”‚                     throw new DataAccessException("Failed to save controllers", "SaveControllerBatch", "Controller", ex);
â”‚   â”‚   â”‚   â”‚  433 â”‚                 }
â”‚   â”‚   â”‚   â”‚  434 â”‚             }
â”‚   â”‚   â”‚   â”‚  435 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  436 â”‚             {
â”‚   â”‚   â”‚   â”‚  437 â”‚                 _logger.LogError(ex, "Fatal error in SaveControllerBatch");
â”‚   â”‚   â”‚   â”‚  438 â”‚                 throw new DataAccessException("Failed to save controllers", "SaveControllerBatch", "Controller", ex);
â”‚   â”‚   â”‚   â”‚  439 â”‚             }
â”‚   â”‚   â”‚   â”‚  440 â”‚             finally
â”‚   â”‚   â”‚   â”‚  441 â”‚             {
â”‚   â”‚   â”‚   â”‚  442 â”‚                 _logger.LogDebug("Cleaning up resources");
â”‚   â”‚   â”‚   â”‚  443 â”‚                 GC.Collect();
â”‚   â”‚   â”‚   â”‚  444 â”‚                 GC.WaitForPendingFinalizers();
â”‚   â”‚   â”‚   â”‚  445 â”‚                 _logger.LogDebug("Resources cleaned up");
â”‚   â”‚   â”‚   â”‚  446 â”‚             }
â”‚   â”‚   â”‚   â”‚  447 â”‚         }
â”‚   â”‚   â”‚   â”‚  448 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  449 â”‚         /// Saves controller objects recursively
â”‚   â”‚   â”‚   â”‚  450 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  451 â”‚         private async Task SaveControllerObjectsAsync(IEnumerable<ControllerObject> objects, int controllerId, int? parentId, string sessionId)
â”‚   â”‚   â”‚   â”‚  452 â”‚         {
â”‚   â”‚   â”‚   â”‚  453 â”‚             if (objects == null || !objects.Any())
â”‚   â”‚   â”‚   â”‚  454 â”‚                 return;
â”‚   â”‚   â”‚   â”‚  455 â”‚ 
â”‚   â”‚   â”‚   â”‚  456 â”‚             foreach (var obj in objects)
â”‚   â”‚   â”‚   â”‚  457 â”‚             {
â”‚   â”‚   â”‚   â”‚  458 â”‚                 await SaveObjectAsync(obj, controllerId, parentId, sessionId);
â”‚   â”‚   â”‚   â”‚  459 â”‚             }
â”‚   â”‚   â”‚   â”‚  460 â”‚         }
â”‚   â”‚   â”‚   â”‚  461 â”‚ 
â”‚   â”‚   â”‚   â”‚  462 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  463 â”‚         /// Saves a single controller object
â”‚   â”‚   â”‚   â”‚  464 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  465 â”‚         private async Task SaveObjectAsync(ControllerObject obj, int controllerId, int? parentId, string sessionId)
â”‚   â”‚   â”‚   â”‚  466 â”‚         {
â”‚   â”‚   â”‚   â”‚  467 â”‚             try
â”‚   â”‚   â”‚   â”‚  468 â”‚             {
â”‚   â”‚   â”‚   â”‚  469 â”‚                 if (string.IsNullOrEmpty(obj.Name))
â”‚   â”‚   â”‚   â”‚  470 â”‚                 {
â”‚   â”‚   â”‚   â”‚  471 â”‚                     _logger.LogWarning("Object name cannot be null or empty, Type: {ObjectType}, ParentId: {ParentId}",
â”‚   â”‚   â”‚   â”‚  472 â”‚                         obj.Type, parentId);
â”‚   â”‚   â”‚   â”‚  473 â”‚                     throw new ArgumentException("Object name cannot be empty", nameof(obj));
â”‚   â”‚   â”‚   â”‚  474 â”‚                 }
â”‚   â”‚   â”‚   â”‚  475 â”‚ 
â”‚   â”‚   â”‚   â”‚  476 â”‚                 // Check if value is too large and log details
â”‚   â”‚   â”‚   â”‚  477 â”‚                 if (obj.Value != null && obj.Value.Length > 10000)
â”‚   â”‚   â”‚   â”‚  478 â”‚                 {
â”‚   â”‚   â”‚   â”‚  479 â”‚                     _logger.LogDebug("Large value detected: Object {ObjectName}, Type: {ObjectType}, Size: {ValueSize} chars",
â”‚   â”‚   â”‚   â”‚  480 â”‚                         obj.Name, obj.Type, obj.Value.Length);
â”‚   â”‚   â”‚   â”‚  481 â”‚                 }
â”‚   â”‚   â”‚   â”‚  482 â”‚ 
â”‚   â”‚   â”‚   â”‚  483 â”‚                 // Process ByteCode specially
â”‚   â”‚   â”‚   â”‚  484 â”‚                 string processedValue;
â”‚   â”‚   â”‚   â”‚  485 â”‚                 if (obj.HasByteCode)
â”‚   â”‚   â”‚   â”‚  486 â”‚                 {
â”‚   â”‚   â”‚   â”‚  487 â”‚                     // Process ByteCode using the specialized processor
â”‚   â”‚   â”‚   â”‚  488 â”‚                     processedValue = _byteCodeProcessor.ProcessByteCode(obj.Value ?? string.Empty);
â”‚   â”‚   â”‚   â”‚  489 â”‚                 }
â”‚   â”‚   â”‚   â”‚  490 â”‚                 else
â”‚   â”‚   â”‚   â”‚  491 â”‚                 {
â”‚   â”‚   â”‚   â”‚  492 â”‚                     processedValue = obj.Value ?? string.Empty;
â”‚   â”‚   â”‚   â”‚  493 â”‚                 }
â”‚   â”‚   â”‚   â”‚  494 â”‚ 
â”‚   â”‚   â”‚   â”‚  495 â”‚                 var dbObject = new ParsedObject
â”‚   â”‚   â”‚   â”‚  496 â”‚                 {
â”‚   â”‚   â”‚   â”‚  497 â”‚                     ControllerId = controllerId,
â”‚   â”‚   â”‚   â”‚  498 â”‚                     ParentObjectId = parentId,
â”‚   â”‚   â”‚   â”‚  499 â”‚                     Type = obj.Type,
â”‚   â”‚   â”‚   â”‚  500 â”‚                     Name = obj.Name,
â”‚   â”‚   â”‚   â”‚  501 â”‚                     Alias = obj.Alias,
â”‚   â”‚   â”‚   â”‚  502 â”‚                     Value = processedValue,
â”‚   â”‚   â”‚   â”‚  503 â”‚                     HasByteCode = obj.HasByteCode,
â”‚   â”‚   â”‚   â”‚  504 â”‚                     SessionId = sessionId,
â”‚   â”‚   â”‚   â”‚  505 â”‚                     Properties = obj.Properties
â”‚   â”‚   â”‚   â”‚  506 â”‚     .Select(p => new test.Data.ObjectProperty
â”‚   â”‚   â”‚   â”‚  507 â”‚     {
â”‚   â”‚   â”‚   â”‚  508 â”‚         Key = p.Key ?? string.Empty,
â”‚   â”‚   â”‚   â”‚  509 â”‚         Value = p.Value ?? string.Empty
â”‚   â”‚   â”‚   â”‚  510 â”‚     })
â”‚   â”‚   â”‚   â”‚  511 â”‚     .ToList()
â”‚   â”‚   â”‚   â”‚  512 â”‚                 };
â”‚   â”‚   â”‚   â”‚  513 â”‚ 
â”‚   â”‚   â”‚   â”‚  514 â”‚                 _context.Objects.Add(dbObject);
â”‚   â”‚   â”‚   â”‚  515 â”‚                 _pendingObjects++;
â”‚   â”‚   â”‚   â”‚  516 â”‚ 
â”‚   â”‚   â”‚   â”‚  517 â”‚                 // Save changes in batches
â”‚   â”‚   â”‚   â”‚  518 â”‚                 if (_pendingObjects >= BATCH_SIZE)
â”‚   â”‚   â”‚   â”‚  519 â”‚                 {
â”‚   â”‚   â”‚   â”‚  520 â”‚                     await SaveBatchAsync("object batch");
â”‚   â”‚   â”‚   â”‚  521 â”‚                 }
â”‚   â”‚   â”‚   â”‚  522 â”‚ 
â”‚   â”‚   â”‚   â”‚  523 â”‚                 // We need to save the object to get its ID before adding children
â”‚   â”‚   â”‚   â”‚  524 â”‚                 if (obj.Children != null && obj.Children.Count > 0)
â”‚   â”‚   â”‚   â”‚  525 â”‚                 {
â”‚   â”‚   â”‚   â”‚  526 â”‚                     // Save this object to get its ID
â”‚   â”‚   â”‚   â”‚  527 â”‚                     await _context.SaveChangesAsync();
â”‚   â”‚   â”‚   â”‚  528 â”‚                     _totalObjectsSaved += _pendingObjects;
â”‚   â”‚   â”‚   â”‚  529 â”‚                     _pendingObjects = 0;
â”‚   â”‚   â”‚   â”‚  530 â”‚ 
â”‚   â”‚   â”‚   â”‚  531 â”‚                     int objectId = dbObject.Id;
â”‚   â”‚   â”‚   â”‚  532 â”‚                     int childCount = obj.Children.Count;
â”‚   â”‚   â”‚   â”‚  533 â”‚ 
â”‚   â”‚   â”‚   â”‚  534 â”‚                     if (childCount > 10)
â”‚   â”‚   â”‚   â”‚  535 â”‚                     {
â”‚   â”‚   â”‚   â”‚  536 â”‚                         _logger.LogDebug("Processing {ChildCount} children for object {ObjectName}, Type: {ObjectType}",
â”‚   â”‚   â”‚   â”‚  537 â”‚                             childCount, obj.Name, obj.Type);
â”‚   â”‚   â”‚   â”‚  538 â”‚                     }
â”‚   â”‚   â”‚   â”‚  539 â”‚ 
â”‚   â”‚   â”‚   â”‚  540 â”‚                     // Save all children
â”‚   â”‚   â”‚   â”‚  541 â”‚                     await SaveControllerObjectsAsync(obj.Children, controllerId, objectId, sessionId);
â”‚   â”‚   â”‚   â”‚  542 â”‚                 }
â”‚   â”‚   â”‚   â”‚  543 â”‚             }
â”‚   â”‚   â”‚   â”‚  544 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  545 â”‚             {
â”‚   â”‚   â”‚   â”‚  546 â”‚                 _logger.LogError(ex, "Error saving object {ObjectName}, Type: {ObjectType}", obj.Name, obj.Type);
â”‚   â”‚   â”‚   â”‚  547 â”‚                 throw;
â”‚   â”‚   â”‚   â”‚  548 â”‚             }
â”‚   â”‚   â”‚   â”‚  549 â”‚         }
â”‚   â”‚   â”‚   â”‚  550 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  551 â”‚         /// Saves a batch of changes with error handling
â”‚   â”‚   â”‚   â”‚  552 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  553 â”‚         private async Task SaveBatchAsync(string batchType)
â”‚   â”‚   â”‚   â”‚  554 â”‚         {
â”‚   â”‚   â”‚   â”‚  555 â”‚             _batchCount++;
â”‚   â”‚   â”‚   â”‚  556 â”‚             _logger.LogDebug("Saving {BatchType} {BatchNumber} with {PendingObjectCount} objects",
â”‚   â”‚   â”‚   â”‚  557 â”‚                 batchType, _batchCount, _pendingObjects);
â”‚   â”‚   â”‚   â”‚  558 â”‚             try
â”‚   â”‚   â”‚   â”‚  559 â”‚             {
â”‚   â”‚   â”‚   â”‚  560 â”‚                 await _context.SaveChangesAsync();
â”‚   â”‚   â”‚   â”‚  561 â”‚                 _totalObjectsSaved += _pendingObjects;
â”‚   â”‚   â”‚   â”‚  562 â”‚                 _logger.LogDebug("Batch {BatchNumber} saved successfully. Total objects saved: {TotalObjectsSaved}",
â”‚   â”‚   â”‚   â”‚  563 â”‚                     _batchCount, _totalObjectsSaved);
â”‚   â”‚   â”‚   â”‚  564 â”‚                 _pendingObjects = 0;
â”‚   â”‚   â”‚   â”‚  565 â”‚             }
â”‚   â”‚   â”‚   â”‚  566 â”‚             catch (DbUpdateException dbEx)
â”‚   â”‚   â”‚   â”‚  567 â”‚             {
â”‚   â”‚   â”‚   â”‚  568 â”‚                 var innerEx = dbEx.InnerException;
â”‚   â”‚   â”‚   â”‚  569 â”‚                 _logger.LogError(dbEx, "Database update error saving batch {BatchNumber}", _batchCount);
â”‚   â”‚   â”‚   â”‚  570 â”‚ 
â”‚   â”‚   â”‚   â”‚  571 â”‚                 if (innerEx is SqliteException sqlEx)
â”‚   â”‚   â”‚   â”‚  572 â”‚                 {
â”‚   â”‚   â”‚   â”‚  573 â”‚                     // Log detailed information for specific SQLite errors
â”‚   â”‚   â”‚   â”‚  574 â”‚                     _logger.LogError("SQLite error code: {SqliteErrorCode}, SQLState: {SqlState}",
â”‚   â”‚   â”‚   â”‚  575 â”‚                         sqlEx.SqliteErrorCode, sqlEx.SqlState);
â”‚   â”‚   â”‚   â”‚  576 â”‚ 
â”‚   â”‚   â”‚   â”‚  577 â”‚                     switch (sqlEx.SqliteErrorCode)
â”‚   â”‚   â”‚   â”‚  578 â”‚                     {
â”‚   â”‚   â”‚   â”‚  579 â”‚                         case 5: // SQLITE_BUSY
â”‚   â”‚   â”‚   â”‚  580 â”‚                             _logger.LogError("Database is locked. Another process might be using it.");
â”‚   â”‚   â”‚   â”‚  581 â”‚                             break;
â”‚   â”‚   â”‚   â”‚  582 â”‚                         case 8: // SQLITE_READONLY
â”‚   â”‚   â”‚   â”‚  583 â”‚                             _logger.LogError("Database is read-only.");
â”‚   â”‚   â”‚   â”‚  584 â”‚                             break;
â”‚   â”‚   â”‚   â”‚  585 â”‚                         case 13: // SQLITE_FULL
â”‚   â”‚   â”‚   â”‚  586 â”‚                             _logger.LogError("Database or disk is full.");
â”‚   â”‚   â”‚   â”‚  587 â”‚                             break;
â”‚   â”‚   â”‚   â”‚  588 â”‚                         case 19: // SQLITE_CONSTRAINT
â”‚   â”‚   â”‚   â”‚  589 â”‚                             _logger.LogError("Constraint violation.");
â”‚   â”‚   â”‚   â”‚  590 â”‚                             break;
â”‚   â”‚   â”‚   â”‚  591 â”‚                         case 1299: // SQLITE_IOERR_SHORT_READ (might vary)
â”‚   â”‚   â”‚   â”‚  592 â”‚                             _logger.LogError("Disk I/O error, short read.");
â”‚   â”‚   â”‚   â”‚  593 â”‚                             break;
â”‚   â”‚   â”‚   â”‚  594 â”‚                     }
â”‚   â”‚   â”‚   â”‚  595 â”‚                 }
â”‚   â”‚   â”‚   â”‚  596 â”‚ 
â”‚   â”‚   â”‚   â”‚  597 â”‚                 throw new DataAccessException("Database update error", "SaveBatch", "ParsedObject", dbEx);
â”‚   â”‚   â”‚   â”‚  598 â”‚             }
â”‚   â”‚   â”‚   â”‚  599 â”‚         }
â”‚   â”‚   â”‚   â”‚  600 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  601 â”‚         public async Task<IEnumerable<string>> GetSessionIdsByPrefixAsync(string prefix)
â”‚   â”‚   â”‚   â”‚  602 â”‚         {
â”‚   â”‚   â”‚   â”‚  603 â”‚             try
â”‚   â”‚   â”‚   â”‚  604 â”‚             {
â”‚   â”‚   â”‚   â”‚  605 â”‚                 return await _context.Controllers
â”‚   â”‚   â”‚   â”‚  606 â”‚                     .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  607 â”‚                     .Select(c => c.SessionId)
â”‚   â”‚   â”‚   â”‚  608 â”‚                     .Where(s => s.StartsWith(prefix))
â”‚   â”‚   â”‚   â”‚  609 â”‚                     .Distinct()
â”‚   â”‚   â”‚   â”‚  610 â”‚                     .OrderByDescending(s => s)
â”‚   â”‚   â”‚   â”‚  611 â”‚                     .ToListAsync();
â”‚   â”‚   â”‚   â”‚  612 â”‚             }
â”‚   â”‚   â”‚   â”‚  613 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  614 â”‚             {
â”‚   â”‚   â”‚   â”‚  615 â”‚                 _logger.LogError(ex, "Error getting session IDs by prefix {Prefix}", prefix);
â”‚   â”‚   â”‚   â”‚  616 â”‚                 throw new DataAccessException("Failed to get session IDs by prefix", "GetSessionIdsByPrefix", "Session", ex);
â”‚   â”‚   â”‚   â”‚  617 â”‚             }
â”‚   â”‚   â”‚   â”‚  618 â”‚         }
â”‚   â”‚   â”‚   â”‚  619 â”‚ 
â”‚   â”‚   â”‚   â”‚  620 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  621 â”‚         public async Task<IEnumerable<Controller>> GetControllersBySessionAsync(string sessionId, int skip = 0, int take = 50)
â”‚   â”‚   â”‚   â”‚  622 â”‚         {
â”‚   â”‚   â”‚   â”‚  623 â”‚             if (string.IsNullOrEmpty(sessionId))
â”‚   â”‚   â”‚   â”‚  624 â”‚                 return Enumerable.Empty<Controller>();
â”‚   â”‚   â”‚   â”‚  625 â”‚ 
â”‚   â”‚   â”‚   â”‚  626 â”‚             try
â”‚   â”‚   â”‚   â”‚  627 â”‚             {
â”‚   â”‚   â”‚   â”‚  628 â”‚                 using var transaction = await _context.Database.BeginTransactionAsync(System.Data.IsolationLevel.ReadUncommitted);
â”‚   â”‚   â”‚   â”‚  629 â”‚                 try
â”‚   â”‚   â”‚   â”‚  630 â”‚                 {
â”‚   â”‚   â”‚   â”‚  631 â”‚                     var dbControllers = await _context.Controllers
â”‚   â”‚   â”‚   â”‚  632 â”‚                         .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  633 â”‚                         .Include(c => c.Properties)
â”‚   â”‚   â”‚   â”‚  634 â”‚                         .Where(c => c.SessionId == sessionId)
â”‚   â”‚   â”‚   â”‚  635 â”‚                         .Skip(skip)
â”‚   â”‚   â”‚   â”‚  636 â”‚                         .Take(take)
â”‚   â”‚   â”‚   â”‚  637 â”‚                         .ToListAsync();
â”‚   â”‚   â”‚   â”‚  638 â”‚ 
â”‚   â”‚   â”‚   â”‚  639 â”‚                     var controllers = new List<Controller>();
â”‚   â”‚   â”‚   â”‚  640 â”‚ 
â”‚   â”‚   â”‚   â”‚  641 â”‚                     foreach (var dbController in dbControllers)
â”‚   â”‚   â”‚   â”‚  642 â”‚                     {
â”‚   â”‚   â”‚   â”‚  643 â”‚                         // Load all objects for this controller (including children)
â”‚   â”‚   â”‚   â”‚  644 â”‚                         await LoadControllerObjects(dbController);
â”‚   â”‚   â”‚   â”‚  645 â”‚ 
â”‚   â”‚   â”‚   â”‚  646 â”‚                         // Map to domain model
â”‚   â”‚   â”‚   â”‚  647 â”‚                         var controller = ControllerMapper.ToDomain(dbController);
â”‚   â”‚   â”‚   â”‚  648 â”‚                         if (controller != null)
â”‚   â”‚   â”‚   â”‚  649 â”‚                         {
â”‚   â”‚   â”‚   â”‚  650 â”‚                             controllers.Add(controller);
â”‚   â”‚   â”‚   â”‚  651 â”‚                         }
â”‚   â”‚   â”‚   â”‚  652 â”‚                     }
â”‚   â”‚   â”‚   â”‚  653 â”‚ 
â”‚   â”‚   â”‚   â”‚  654 â”‚                     await transaction.CommitAsync();
â”‚   â”‚   â”‚   â”‚  655 â”‚                     return controllers;
â”‚   â”‚   â”‚   â”‚  656 â”‚                 }
â”‚   â”‚   â”‚   â”‚  657 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  658 â”‚                 {
â”‚   â”‚   â”‚   â”‚  659 â”‚                     await transaction.RollbackAsync();
â”‚   â”‚   â”‚   â”‚  660 â”‚                     _logger.LogError(ex, "Error loading controllers for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  661 â”‚                     throw new DataAccessException("Failed to load controllers", "GetControllersBySession", "Controller", ex);
â”‚   â”‚   â”‚   â”‚  662 â”‚                 }
â”‚   â”‚   â”‚   â”‚  663 â”‚             }
â”‚   â”‚   â”‚   â”‚  664 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  665 â”‚             {
â”‚   â”‚   â”‚   â”‚  666 â”‚                 _logger.LogError(ex, "Fatal error in GetControllersBySession for session {SessionId}", sessionId);
â”‚   â”‚   â”‚   â”‚  667 â”‚                 throw new DataAccessException("Failed to load controllers", "GetControllersBySession", "Controller", ex);
â”‚   â”‚   â”‚   â”‚  668 â”‚             }
â”‚   â”‚   â”‚   â”‚  669 â”‚         }
â”‚   â”‚   â”‚   â”‚  670 â”‚ 
â”‚   â”‚   â”‚   â”‚  671 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  672 â”‚         /// Loads all objects for a controller (including children)
â”‚   â”‚   â”‚   â”‚  673 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  674 â”‚         private async Task LoadControllerObjects(test.Data.ParsedController controller)
â”‚   â”‚   â”‚   â”‚  675 â”‚         {
â”‚   â”‚   â”‚   â”‚  676 â”‚             try
â”‚   â”‚   â”‚   â”‚  677 â”‚             {
â”‚   â”‚   â”‚   â”‚  678 â”‚                 // Load all top-level objects for this controller (parent ID is null)
â”‚   â”‚   â”‚   â”‚  679 â”‚                 var topLevelObjects = await _context.Objects
â”‚   â”‚   â”‚   â”‚  680 â”‚                     .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  681 â”‚                     .Include(o => o.Properties)
â”‚   â”‚   â”‚   â”‚  682 â”‚                     .Where(o => o.ControllerId == controller.Id && o.ParentObjectId == null)
â”‚   â”‚   â”‚   â”‚  683 â”‚                     .ToListAsync();
â”‚   â”‚   â”‚   â”‚  684 â”‚ 
â”‚   â”‚   â”‚   â”‚  685 â”‚                 controller.Objects = topLevelObjects;
â”‚   â”‚   â”‚   â”‚  686 â”‚ 
â”‚   â”‚   â”‚   â”‚  687 â”‚                 // Load all children recursively
â”‚   â”‚   â”‚   â”‚  688 â”‚                 foreach (var obj in topLevelObjects)
â”‚   â”‚   â”‚   â”‚  689 â”‚                 {
â”‚   â”‚   â”‚   â”‚  690 â”‚                     await LoadObjectChildren(obj);
â”‚   â”‚   â”‚   â”‚  691 â”‚                 }
â”‚   â”‚   â”‚   â”‚  692 â”‚             }
â”‚   â”‚   â”‚   â”‚  693 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  694 â”‚             {
â”‚   â”‚   â”‚   â”‚  695 â”‚                 _logger.LogError(ex, "Error loading objects for controller {ControllerId}", controller.Id);
â”‚   â”‚   â”‚   â”‚  696 â”‚                 throw;
â”‚   â”‚   â”‚   â”‚  697 â”‚             }
â”‚   â”‚   â”‚   â”‚  698 â”‚         }
â”‚   â”‚   â”‚   â”‚  699 â”‚ 
â”‚   â”‚   â”‚   â”‚  700 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  701 â”‚         /// Loads all children of an object recursively
â”‚   â”‚   â”‚   â”‚  702 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  703 â”‚         private async Task LoadObjectChildren(test.Data.ParsedObject obj)
â”‚   â”‚   â”‚   â”‚  704 â”‚         {
â”‚   â”‚   â”‚   â”‚  705 â”‚             try
â”‚   â”‚   â”‚   â”‚  706 â”‚             {
â”‚   â”‚   â”‚   â”‚  707 â”‚                 var children = await _context.Objects
â”‚   â”‚   â”‚   â”‚  708 â”‚                     .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  709 â”‚                     .Include(o => o.Properties)
â”‚   â”‚   â”‚   â”‚  710 â”‚                     .Where(o => o.ParentObjectId == obj.Id)
â”‚   â”‚   â”‚   â”‚  711 â”‚                     .ToListAsync();
â”‚   â”‚   â”‚   â”‚  712 â”‚ 
â”‚   â”‚   â”‚   â”‚  713 â”‚                 obj.Children = children;
â”‚   â”‚   â”‚   â”‚  714 â”‚ 
â”‚   â”‚   â”‚   â”‚  715 â”‚                 foreach (var child in children)
â”‚   â”‚   â”‚   â”‚  716 â”‚                 {
â”‚   â”‚   â”‚   â”‚  717 â”‚                     await LoadObjectChildren(child);
â”‚   â”‚   â”‚   â”‚  718 â”‚                 }
â”‚   â”‚   â”‚   â”‚  719 â”‚             }
â”‚   â”‚   â”‚   â”‚  720 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  721 â”‚             {
â”‚   â”‚   â”‚   â”‚  722 â”‚                 _logger.LogError(ex, "Error loading children for object {ObjectId}", obj.Id);
â”‚   â”‚   â”‚   â”‚  723 â”‚                 throw;
â”‚   â”‚   â”‚   â”‚  724 â”‚             }
â”‚   â”‚   â”‚   â”‚  725 â”‚         }
â”‚   â”‚   â”‚   â”‚  726 â”‚ 
â”‚   â”‚   â”‚   â”‚  727 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  728 â”‚         public async Task<int> CleanupOldSessionsAsync(TimeSpan maxAge)
â”‚   â”‚   â”‚   â”‚  729 â”‚         {
â”‚   â”‚   â”‚   â”‚  730 â”‚             var cutoff = DateTime.UtcNow - maxAge;
â”‚   â”‚   â”‚   â”‚  731 â”‚             int removedCount = 0;
â”‚   â”‚   â”‚   â”‚  732 â”‚ 
â”‚   â”‚   â”‚   â”‚  733 â”‚             try
â”‚   â”‚   â”‚   â”‚  734 â”‚             {
â”‚   â”‚   â”‚   â”‚  735 â”‚                 _logger.LogInformation("Cleaning up sessions older than {Cutoff}", cutoff);
â”‚   â”‚   â”‚   â”‚  736 â”‚ 
â”‚   â”‚   â”‚   â”‚  737 â”‚                 var oldSessions = await _context.Controllers
â”‚   â”‚   â”‚   â”‚  738 â”‚                     .AsNoTracking()
â”‚   â”‚   â”‚   â”‚  739 â”‚                     .Where(c => c.Created < cutoff)
â”‚   â”‚   â”‚   â”‚  740 â”‚                     .Select(c => c.SessionId)
â”‚   â”‚   â”‚   â”‚  741 â”‚                     .Distinct()
â”‚   â”‚   â”‚   â”‚  742 â”‚                     .ToListAsync();
â”‚   â”‚   â”‚   â”‚  743 â”‚ 
â”‚   â”‚   â”‚   â”‚  744 â”‚                 _logger.LogInformation("Found {SessionCount} sessions to clean up", oldSessions.Count);
â”‚   â”‚   â”‚   â”‚  745 â”‚ 
â”‚   â”‚   â”‚   â”‚  746 â”‚                 foreach (var sessionId in oldSessions)
â”‚   â”‚   â”‚   â”‚  747 â”‚                 {
â”‚   â”‚   â”‚   â”‚  748 â”‚                     bool success = await DeleteSessionAsync(sessionId);
â”‚   â”‚   â”‚   â”‚  749 â”‚                     if (success)
â”‚   â”‚   â”‚   â”‚  750 â”‚                     {
â”‚   â”‚   â”‚   â”‚  751 â”‚                         removedCount++;
â”‚   â”‚   â”‚   â”‚  752 â”‚                     }
â”‚   â”‚   â”‚   â”‚  753 â”‚                 }
â”‚   â”‚   â”‚   â”‚  754 â”‚ 
â”‚   â”‚   â”‚   â”‚  755 â”‚                 _logger.LogInformation("Successfully removed {RemovedCount} old sessions", removedCount);
â”‚   â”‚   â”‚   â”‚  756 â”‚ 
â”‚   â”‚   â”‚   â”‚  757 â”‚                 // Force cleanup after large deletion
â”‚   â”‚   â”‚   â”‚  758 â”‚                 GC.Collect();
â”‚   â”‚   â”‚   â”‚  759 â”‚                 GC.WaitForPendingFinalizers();
â”‚   â”‚   â”‚   â”‚  760 â”‚ 
â”‚   â”‚   â”‚   â”‚  761 â”‚                 return removedCount;
â”‚   â”‚   â”‚   â”‚  762 â”‚             }
â”‚   â”‚   â”‚   â”‚  763 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  764 â”‚             {
â”‚   â”‚   â”‚   â”‚  765 â”‚                 _logger.LogError(ex, "Error cleaning up old sessions");
â”‚   â”‚   â”‚   â”‚  766 â”‚                 throw new DataAccessException("Failed to clean up old sessions", "CleanupOldSessions", "Session", ex);
â”‚   â”‚   â”‚   â”‚  767 â”‚             }
â”‚   â”‚   â”‚   â”‚  768 â”‚         }
â”‚   â”‚   â”‚   â”‚  769 â”‚ 
â”‚   â”‚   â”‚   â”‚  770 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  771 â”‚         public async Task OptimizeDatabaseAsync()
â”‚   â”‚   â”‚   â”‚  772 â”‚         {
â”‚   â”‚   â”‚   â”‚  773 â”‚             try
â”‚   â”‚   â”‚   â”‚  774 â”‚             {
â”‚   â”‚   â”‚   â”‚  775 â”‚                 _logger.LogInformation("Starting database optimization");
â”‚   â”‚   â”‚   â”‚  776 â”‚ 
â”‚   â”‚   â”‚   â”‚  777 â”‚                 // Run VACUUM to reclaim space and defragment the database
â”‚   â”‚   â”‚   â”‚  778 â”‚                 _logger.LogDebug("Running VACUUM...");
â”‚   â”‚   â”‚   â”‚  779 â”‚                 _timer.Restart();
â”‚   â”‚   â”‚   â”‚  780 â”‚                 await _context.Database.ExecuteSqlRawAsync("VACUUM");
â”‚   â”‚   â”‚   â”‚  781 â”‚                 _timer.Stop();
â”‚   â”‚   â”‚   â”‚  782 â”‚                 _logger.LogDebug("VACUUM completed in {ElapsedMilliseconds}ms", _timer.ElapsedMilliseconds);
â”‚   â”‚   â”‚   â”‚  783 â”‚ 
â”‚   â”‚   â”‚   â”‚  784 â”‚                 // Run ANALYZE to update statistics
â”‚   â”‚   â”‚   â”‚  785 â”‚                 _logger.LogDebug("Running ANALYZE...");
â”‚   â”‚   â”‚   â”‚  786 â”‚                 _timer.Restart();
â”‚   â”‚   â”‚   â”‚  787 â”‚                 await _context.Database.ExecuteSqlRawAsync("ANALYZE");
â”‚   â”‚   â”‚   â”‚  788 â”‚                 _timer.Stop();
â”‚   â”‚   â”‚   â”‚  789 â”‚                 _logger.LogDebug("ANALYZE completed in {ElapsedMilliseconds}ms", _timer.ElapsedMilliseconds);
â”‚   â”‚   â”‚   â”‚  790 â”‚ 
â”‚   â”‚   â”‚   â”‚  791 â”‚                 // Update indexed stats
â”‚   â”‚   â”‚   â”‚  792 â”‚                 _logger.LogDebug("Running PRAGMA optimize...");
â”‚   â”‚   â”‚   â”‚  793 â”‚                 _timer.Restart();
â”‚   â”‚   â”‚   â”‚  794 â”‚                 await _context.Database.ExecuteSqlRawAsync("PRAGMA optimize");
â”‚   â”‚   â”‚   â”‚  795 â”‚                 _timer.Stop();
â”‚   â”‚   â”‚   â”‚  796 â”‚                 _logger.LogDebug("PRAGMA optimize completed in {ElapsedMilliseconds}ms", _timer.ElapsedMilliseconds);
â”‚   â”‚   â”‚   â”‚  797 â”‚ 
â”‚   â”‚   â”‚   â”‚  798 â”‚                 // Check index usage
â”‚   â”‚   â”‚   â”‚  799 â”‚                 _logger.LogDebug("Checking index usage...");
â”‚   â”‚   â”‚   â”‚  800 â”‚                 try
â”‚   â”‚   â”‚   â”‚  801 â”‚                 {
â”‚   â”‚   â”‚   â”‚  802 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA index_list('Objects')");
â”‚   â”‚   â”‚   â”‚  803 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA index_list('Controllers')");
â”‚   â”‚   â”‚   â”‚  804 â”‚                     _logger.LogDebug("Index check completed");
â”‚   â”‚   â”‚   â”‚  805 â”‚                 }
â”‚   â”‚   â”‚   â”‚  806 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  807 â”‚                 {
â”‚   â”‚   â”‚   â”‚  808 â”‚                     _logger.LogWarning(ex, "Error checking indexes");
â”‚   â”‚   â”‚   â”‚  809 â”‚                 }
â”‚   â”‚   â”‚   â”‚  810 â”‚ 
â”‚   â”‚   â”‚   â”‚  811 â”‚                 _logger.LogInformation("Database optimization completed");
â”‚   â”‚   â”‚   â”‚  812 â”‚             }
â”‚   â”‚   â”‚   â”‚  813 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  814 â”‚             {
â”‚   â”‚   â”‚   â”‚  815 â”‚                 _logger.LogError(ex, "Error optimizing database");
â”‚   â”‚   â”‚   â”‚  816 â”‚                 // Fix: Pass Exception instead of string
â”‚   â”‚   â”‚   â”‚  817 â”‚                 throw new DataAccessException("Failed to optimize database", "OptimizeDatabase", null, ex);
â”‚   â”‚   â”‚   â”‚  818 â”‚             }
â”‚   â”‚   â”‚   â”‚  819 â”‚         }
â”‚   â”‚   â”‚   â”‚  820 â”‚ 
â”‚   â”‚   â”‚   â”‚  821 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  822 â”‚         public async Task<string> GetDatabaseHealthReportAsync()
â”‚   â”‚   â”‚   â”‚  823 â”‚         {
â”‚   â”‚   â”‚   â”‚  824 â”‚             var report = new StringBuilder();
â”‚   â”‚   â”‚   â”‚  825 â”‚             report.AppendLine("DATABASE HEALTH REPORT");
â”‚   â”‚   â”‚   â”‚  826 â”‚             report.AppendLine("=====================");
â”‚   â”‚   â”‚   â”‚  827 â”‚ 
â”‚   â”‚   â”‚   â”‚  828 â”‚             try
â”‚   â”‚   â”‚   â”‚  829 â”‚             {
â”‚   â”‚   â”‚   â”‚  830 â”‚                 // Get database file path and size
â”‚   â”‚   â”‚   â”‚  831 â”‚                 var dbPath = _context.Database.GetDbConnection().DataSource;
â”‚   â”‚   â”‚   â”‚  832 â”‚                 report.AppendLine($"Database path: {dbPath}");
â”‚   â”‚   â”‚   â”‚  833 â”‚ 
â”‚   â”‚   â”‚   â”‚  834 â”‚                 if (File.Exists(dbPath))
â”‚   â”‚   â”‚   â”‚  835 â”‚                 {
â”‚   â”‚   â”‚   â”‚  836 â”‚                     var fileInfo = new FileInfo(dbPath);
â”‚   â”‚   â”‚   â”‚  837 â”‚                     report.AppendLine($"Database size: {fileInfo.Length / 1024 / 1024} MB");
â”‚   â”‚   â”‚   â”‚  838 â”‚                     report.AppendLine($"Created: {fileInfo.CreationTime}");
â”‚   â”‚   â”‚   â”‚  839 â”‚                     report.AppendLine($"Last modified: {fileInfo.LastWriteTime}");
â”‚   â”‚   â”‚   â”‚  840 â”‚                 }
â”‚   â”‚   â”‚   â”‚  841 â”‚                 else
â”‚   â”‚   â”‚   â”‚  842 â”‚                 {
â”‚   â”‚   â”‚   â”‚  843 â”‚                     report.AppendLine("Database file not found!");
â”‚   â”‚   â”‚   â”‚  844 â”‚                 }
â”‚   â”‚   â”‚   â”‚  845 â”‚ 
â”‚   â”‚   â”‚   â”‚  846 â”‚                 // Count tables
â”‚   â”‚   â”‚   â”‚  847 â”‚                 var controllerCount = await _context.Controllers.CountAsync();
â”‚   â”‚   â”‚   â”‚  848 â”‚                 var objectCount = await _context.Objects.CountAsync();
â”‚   â”‚   â”‚   â”‚  849 â”‚ 
â”‚   â”‚   â”‚   â”‚  850 â”‚                 report.AppendLine($"Controller count: {controllerCount}");
â”‚   â”‚   â”‚   â”‚  851 â”‚                 report.AppendLine($"Object count: {objectCount}");
â”‚   â”‚   â”‚   â”‚  852 â”‚ 
â”‚   â”‚   â”‚   â”‚  853 â”‚                 // Get session count
â”‚   â”‚   â”‚   â”‚  854 â”‚                 var sessionCount = await _context.Controllers
â”‚   â”‚   â”‚   â”‚  855 â”‚                     .Select(c => c.SessionId)
â”‚   â”‚   â”‚   â”‚  856 â”‚                     .Distinct()
â”‚   â”‚   â”‚   â”‚  857 â”‚                     .CountAsync();
â”‚   â”‚   â”‚   â”‚  858 â”‚ 
â”‚   â”‚   â”‚   â”‚  859 â”‚                 report.AppendLine($"Session count: {sessionCount}");
â”‚   â”‚   â”‚   â”‚  860 â”‚ 
â”‚   â”‚   â”‚   â”‚  861 â”‚                 // Check for integrity errors
â”‚   â”‚   â”‚   â”‚  862 â”‚                 try
â”‚   â”‚   â”‚   â”‚  863 â”‚                 {
â”‚   â”‚   â”‚   â”‚  864 â”‚                     report.AppendLine("Running integrity check...");
â”‚   â”‚   â”‚   â”‚  865 â”‚                     await _context.Database.ExecuteSqlRawAsync("PRAGMA integrity_check");
â”‚   â”‚   â”‚   â”‚  866 â”‚                     report.AppendLine("Integrity check passed");
â”‚   â”‚   â”‚   â”‚  867 â”‚                 }
â”‚   â”‚   â”‚   â”‚  868 â”‚                 catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  869 â”‚                 {
â”‚   â”‚   â”‚   â”‚  870 â”‚                     report.AppendLine($"Integrity check failed: {ex.Message}");
â”‚   â”‚   â”‚   â”‚  871 â”‚                 }
â”‚   â”‚   â”‚   â”‚  872 â”‚ 
â”‚   â”‚   â”‚   â”‚  873 â”‚                 report.AppendLine("=====================");
â”‚   â”‚   â”‚   â”‚  874 â”‚ 
â”‚   â”‚   â”‚   â”‚  875 â”‚                 return report.ToString();
â”‚   â”‚   â”‚   â”‚  876 â”‚             }
â”‚   â”‚   â”‚   â”‚  877 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  878 â”‚             {
â”‚   â”‚   â”‚   â”‚  879 â”‚                 report.AppendLine($"Error generating health report: {ex.Message}");
â”‚   â”‚   â”‚   â”‚  880 â”‚                 if (ex.InnerException != null)
â”‚   â”‚   â”‚   â”‚  881 â”‚                 {
â”‚   â”‚   â”‚   â”‚  882 â”‚                     report.AppendLine($"Inner exception: {ex.InnerException.Message}");
â”‚   â”‚   â”‚   â”‚  883 â”‚                 }
â”‚   â”‚   â”‚   â”‚  884 â”‚                 report.AppendLine("=====================");
â”‚   â”‚   â”‚   â”‚  885 â”‚ 
â”‚   â”‚   â”‚   â”‚  886 â”‚                 _logger.LogError(ex, "Error generating database health report");
â”‚   â”‚   â”‚   â”‚  887 â”‚                 return report.ToString();
â”‚   â”‚   â”‚   â”‚  888 â”‚             }
â”‚   â”‚   â”‚   â”‚  889 â”‚         }
â”‚   â”‚   â”‚   â”‚  890 â”‚ 
â”‚   â”‚   â”‚   â”‚  891 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   â”‚  892 â”‚         public async Task<IEnumerable<SessionInfo>> GetSessionsByProjectAsync(string projectId)
â”‚   â”‚   â”‚   â”‚  893 â”‚         {
â”‚   â”‚   â”‚   â”‚  894 â”‚             if (string.IsNullOrEmpty(projectId))
â”‚   â”‚   â”‚   â”‚  895 â”‚                 return Enumerable.Empty<SessionInfo>();
â”‚   â”‚   â”‚   â”‚  896 â”‚ 
â”‚   â”‚   â”‚   â”‚  897 â”‚             try
â”‚   â”‚   â”‚   â”‚  898 â”‚             {
â”‚   â”‚   â”‚   â”‚  899 â”‚                 string prefix = $"project_{projectId}_";
â”‚   â”‚   â”‚   â”‚  900 â”‚                 var sessionIds = await GetSessionIdsByPrefixAsync(prefix);
â”‚   â”‚   â”‚   â”‚  901 â”‚ 
â”‚   â”‚   â”‚   â”‚  902 â”‚                 var result = new List<SessionInfo>();
â”‚   â”‚   â”‚   â”‚  903 â”‚                 foreach (var sessionId in sessionIds)
â”‚   â”‚   â”‚   â”‚  904 â”‚                 {
â”‚   â”‚   â”‚   â”‚  905 â”‚                     var sessionInfo = await GetSessionInfoAsync(sessionId);
â”‚   â”‚   â”‚   â”‚  906 â”‚                     if (sessionInfo != null)
â”‚   â”‚   â”‚   â”‚  907 â”‚                     {
â”‚   â”‚   â”‚   â”‚  908 â”‚                         result.Add(sessionInfo);
â”‚   â”‚   â”‚   â”‚  909 â”‚                     }
â”‚   â”‚   â”‚   â”‚  910 â”‚                 }
â”‚   â”‚   â”‚   â”‚  911 â”‚ 
â”‚   â”‚   â”‚   â”‚  912 â”‚                 return result;
â”‚   â”‚   â”‚   â”‚  913 â”‚             }
â”‚   â”‚   â”‚   â”‚  914 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  915 â”‚             {
â”‚   â”‚   â”‚   â”‚  916 â”‚                 _logger.LogError(ex, "Error getting sessions for project {ProjectId}", projectId);
â”‚   â”‚   â”‚   â”‚  917 â”‚                 throw new DataAccessException("Failed to get sessions by project", "GetSessionsByProject", "Session", ex);
â”‚   â”‚   â”‚   â”‚  918 â”‚             }
â”‚   â”‚   â”‚   â”‚  919 â”‚         }
â”‚   â”‚   â”‚   â”‚  920 â”‚ 
â”‚   â”‚   â”‚   â”‚  921 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  922 â”‚         /// Disposes the repository
â”‚   â”‚   â”‚   â”‚  923 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  924 â”‚         public void Dispose()
â”‚   â”‚   â”‚   â”‚  925 â”‚         {
â”‚   â”‚   â”‚   â”‚  926 â”‚             Dispose(true);
â”‚   â”‚   â”‚   â”‚  927 â”‚             GC.SuppressFinalize(this);
â”‚   â”‚   â”‚   â”‚  928 â”‚         }
â”‚   â”‚   â”‚   â”‚  929 â”‚ 
â”‚   â”‚   â”‚   â”‚  930 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  931 â”‚         /// Disposes the repository
â”‚   â”‚   â”‚   â”‚  932 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  933 â”‚         /// <param name="disposing">True if disposing, false if finalizing</param>
â”‚   â”‚   â”‚   â”‚  934 â”‚         protected virtual void Dispose(bool disposing)
â”‚   â”‚   â”‚   â”‚  935 â”‚         {
â”‚   â”‚   â”‚   â”‚  936 â”‚             if (!_disposed)
â”‚   â”‚   â”‚   â”‚  937 â”‚             {
â”‚   â”‚   â”‚   â”‚  938 â”‚                 if (disposing)
â”‚   â”‚   â”‚   â”‚  939 â”‚                 {
â”‚   â”‚   â”‚   â”‚  940 â”‚                     _context.Dispose();
â”‚   â”‚   â”‚   â”‚  941 â”‚                 }
â”‚   â”‚   â”‚   â”‚  942 â”‚                 _disposed = true;
â”‚   â”‚   â”‚   â”‚  943 â”‚             }
â”‚   â”‚   â”‚   â”‚  944 â”‚         }
â”‚   â”‚   â”‚   â”‚  945 â”‚     }
â”‚   â”‚   â”‚   â”‚  946 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ FileProjectRepository.cs (28.94 KB, 2025-03-11 09:48:27)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: FileProjectRepository.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚   â”‚       â”‚    2 â”‚ using System;
â”‚   â”‚       â”‚    3 â”‚ using System.Collections.Generic;
â”‚   â”‚       â”‚    4 â”‚ using System.IO;
â”‚   â”‚       â”‚    5 â”‚ using System.Linq;
â”‚   â”‚       â”‚    6 â”‚ using System.Text.Json;
â”‚   â”‚       â”‚    7 â”‚ using System.Threading.Tasks;
â”‚   â”‚       â”‚    8 â”‚ using test.Core.Domain;
â”‚   â”‚       â”‚    9 â”‚ using test.Core.Exceptions;
â”‚   â”‚       â”‚   10 â”‚ using test.Core.Interfaces;
â”‚   â”‚       â”‚   11 â”‚ 
â”‚   â”‚       â”‚   12 â”‚ 
â”‚   â”‚       â”‚   13 â”‚ 
â”‚   â”‚       â”‚   14 â”‚ namespace test.Infrastructure.Data
â”‚   â”‚       â”‚   15 â”‚ {
â”‚   â”‚       â”‚   16 â”‚     /// <summary>
â”‚   â”‚       â”‚   17 â”‚     /// File-based implementation of IProjectRepository
â”‚   â”‚       â”‚   18 â”‚     /// Projects are stored as JSON files in a directory structure
â”‚   â”‚       â”‚   19 â”‚     /// </summary>
â”‚   â”‚       â”‚   20 â”‚     public class FileProjectRepository : IProjectRepository
â”‚   â”‚       â”‚   21 â”‚     {
â”‚   â”‚       â”‚   22 â”‚         private readonly IFileSystem _fileSystem;
â”‚   â”‚       â”‚   23 â”‚         private readonly ILogger<FileProjectRepository> _logger;
â”‚   â”‚       â”‚   24 â”‚         private readonly string _baseProjectsDirectory;
â”‚   â”‚       â”‚   25 â”‚ 
â”‚   â”‚       â”‚   26 â”‚         private const string ProjectMetadataFileName = "project.json";
â”‚   â”‚       â”‚   27 â”‚ 
â”‚   â”‚       â”‚   28 â”‚         /// <summary>
â”‚   â”‚       â”‚   29 â”‚         /// Creates a new project repository
â”‚   â”‚       â”‚   30 â”‚         /// </summary>
â”‚   â”‚       â”‚   31 â”‚         /// <param name="fileSystem">The file system abstraction</param>
â”‚   â”‚       â”‚   32 â”‚         /// <param name="logger">The logger</param>
â”‚   â”‚       â”‚   33 â”‚         public FileProjectRepository(IFileSystem fileSystem, ILogger<FileProjectRepository> logger)
â”‚   â”‚       â”‚   34 â”‚         {
â”‚   â”‚       â”‚   35 â”‚             _fileSystem = fileSystem ?? throw new ArgumentNullException(nameof(fileSystem));
â”‚   â”‚       â”‚   36 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚   â”‚       â”‚   37 â”‚ 
â”‚   â”‚       â”‚   38 â”‚             // Projects are stored in the application data directory
â”‚   â”‚       â”‚   39 â”‚             _baseProjectsDirectory = Path.Combine(
â”‚   â”‚       â”‚   40 â”‚                 Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
â”‚   â”‚       â”‚   41 â”‚                 "PaapeConversionKit",
â”‚   â”‚       â”‚   42 â”‚                 "Projects"
â”‚   â”‚       â”‚   43 â”‚             );
â”‚   â”‚       â”‚   44 â”‚ 
â”‚   â”‚       â”‚   45 â”‚             // Ensure the directory exists
â”‚   â”‚       â”‚   46 â”‚             _fileSystem.CreateDirectory(_baseProjectsDirectory);
â”‚   â”‚       â”‚   47 â”‚         }
â”‚   â”‚       â”‚   48 â”‚ 
â”‚   â”‚       â”‚   49 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚   50 â”‚         public async Task<IEnumerable<Project>> GetAllAsync()
â”‚   â”‚       â”‚   51 â”‚         {
â”‚   â”‚       â”‚   52 â”‚             try
â”‚   â”‚       â”‚   53 â”‚             {
â”‚   â”‚       â”‚   54 â”‚                 var projects = new List<Project>();
â”‚   â”‚       â”‚   55 â”‚                 var projectDirectories = Directory.GetDirectories(_baseProjectsDirectory);
â”‚   â”‚       â”‚   56 â”‚ 
â”‚   â”‚       â”‚   57 â”‚                 foreach (var directory in projectDirectories)
â”‚   â”‚       â”‚   58 â”‚                 {
â”‚   â”‚       â”‚   59 â”‚                     var project = await LoadProjectFromDirectoryAsync(directory);
â”‚   â”‚       â”‚   60 â”‚                     if (project != null)
â”‚   â”‚       â”‚   61 â”‚                     {
â”‚   â”‚       â”‚   62 â”‚                         projects.Add(project);
â”‚   â”‚       â”‚   63 â”‚                     }
â”‚   â”‚       â”‚   64 â”‚                 }
â”‚   â”‚       â”‚   65 â”‚ 
â”‚   â”‚       â”‚   66 â”‚                 return projects;
â”‚   â”‚       â”‚   67 â”‚             }
â”‚   â”‚       â”‚   68 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚   69 â”‚             {
â”‚   â”‚       â”‚   70 â”‚                 _logger.LogError(ex, "Error retrieving all projects");
â”‚   â”‚       â”‚   71 â”‚                 throw new DataAccessException("Failed to retrieve all projects", "GetAll", "Project", ex);
â”‚   â”‚       â”‚   72 â”‚             }
â”‚   â”‚       â”‚   73 â”‚         }
â”‚   â”‚       â”‚   74 â”‚ 
â”‚   â”‚       â”‚   75 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚   76 â”‚         public async Task<Project> GetByIdAsync(string id)
â”‚   â”‚       â”‚   77 â”‚         {
â”‚   â”‚       â”‚   78 â”‚             if (string.IsNullOrEmpty(id))
â”‚   â”‚       â”‚   79 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(id));
â”‚   â”‚       â”‚   80 â”‚ 
â”‚   â”‚       â”‚   81 â”‚             try
â”‚   â”‚       â”‚   82 â”‚             {
â”‚   â”‚       â”‚   83 â”‚                 var projectDirectory = Path.Combine(_baseProjectsDirectory, id);
â”‚   â”‚       â”‚   84 â”‚                 if (!_fileSystem.DirectoryExists(projectDirectory))
â”‚   â”‚       â”‚   85 â”‚                 {
â”‚   â”‚       â”‚   86 â”‚                     throw new NotFoundException("Project", id);
â”‚   â”‚       â”‚   87 â”‚                 }
â”‚   â”‚       â”‚   88 â”‚ 
â”‚   â”‚       â”‚   89 â”‚                 return await LoadProjectFromDirectoryAsync(projectDirectory);
â”‚   â”‚       â”‚   90 â”‚             }
â”‚   â”‚       â”‚   91 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚   92 â”‚             {
â”‚   â”‚       â”‚   93 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚   94 â”‚             }
â”‚   â”‚       â”‚   95 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚   96 â”‚             {
â”‚   â”‚       â”‚   97 â”‚                 _logger.LogError(ex, "Error retrieving project with ID {ProjectId}", id);
â”‚   â”‚       â”‚   98 â”‚                 throw new DataAccessException($"Failed to retrieve project with ID {id}", "GetById", "Project", ex);
â”‚   â”‚       â”‚   99 â”‚             }
â”‚   â”‚       â”‚  100 â”‚         }
â”‚   â”‚       â”‚  101 â”‚ 
â”‚   â”‚       â”‚  102 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  103 â”‚         public async Task CreateAsync(Project project)
â”‚   â”‚       â”‚  104 â”‚         {
â”‚   â”‚       â”‚  105 â”‚             if (project == null)
â”‚   â”‚       â”‚  106 â”‚                 throw new ArgumentNullException(nameof(project));
â”‚   â”‚       â”‚  107 â”‚ 
â”‚   â”‚       â”‚  108 â”‚             try
â”‚   â”‚       â”‚  109 â”‚             {
â”‚   â”‚       â”‚  110 â”‚                 var projectDirectory = Path.Combine(_baseProjectsDirectory, project.Id);
â”‚   â”‚       â”‚  111 â”‚ 
â”‚   â”‚       â”‚  112 â”‚                 // Create project directory
â”‚   â”‚       â”‚  113 â”‚                 _fileSystem.CreateDirectory(projectDirectory);
â”‚   â”‚       â”‚  114 â”‚ 
â”‚   â”‚       â”‚  115 â”‚                 // Create subdirectories
â”‚   â”‚       â”‚  116 â”‚                 _fileSystem.CreateDirectory(Path.Combine(projectDirectory, "Files"));
â”‚   â”‚       â”‚  117 â”‚                 _fileSystem.CreateDirectory(Path.Combine(projectDirectory, "SharedTypes"));
â”‚   â”‚       â”‚  118 â”‚                 _fileSystem.CreateDirectory(Path.Combine(projectDirectory, "CustomTypes"));
â”‚   â”‚       â”‚  119 â”‚ 
â”‚   â”‚       â”‚  120 â”‚                 // Save project metadata
â”‚   â”‚       â”‚  121 â”‚                 await SaveProjectMetadataAsync(projectDirectory, project);
â”‚   â”‚       â”‚  122 â”‚ 
â”‚   â”‚       â”‚  123 â”‚                 _logger.LogInformation("Project created successfully with ID {ProjectId}", project.Id);
â”‚   â”‚       â”‚  124 â”‚             }
â”‚   â”‚       â”‚  125 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  126 â”‚             {
â”‚   â”‚       â”‚  127 â”‚                 _logger.LogError(ex, "Error creating project with ID {ProjectId}", project.Id);
â”‚   â”‚       â”‚  128 â”‚                 throw new DataAccessException($"Failed to create project with ID {project.Id}", "Create", "Project", ex);
â”‚   â”‚       â”‚  129 â”‚             }
â”‚   â”‚       â”‚  130 â”‚         }
â”‚   â”‚       â”‚  131 â”‚ 
â”‚   â”‚       â”‚  132 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  133 â”‚         public async Task UpdateAsync(Project project)
â”‚   â”‚       â”‚  134 â”‚         {
â”‚   â”‚       â”‚  135 â”‚             if (project == null)
â”‚   â”‚       â”‚  136 â”‚                 throw new ArgumentNullException(nameof(project));
â”‚   â”‚       â”‚  137 â”‚ 
â”‚   â”‚       â”‚  138 â”‚             try
â”‚   â”‚       â”‚  139 â”‚             {
â”‚   â”‚       â”‚  140 â”‚                 var projectDirectory = Path.Combine(_baseProjectsDirectory, project.Id);
â”‚   â”‚       â”‚  141 â”‚                 if (!_fileSystem.DirectoryExists(projectDirectory))
â”‚   â”‚       â”‚  142 â”‚                 {
â”‚   â”‚       â”‚  143 â”‚                     throw new NotFoundException("Project", project.Id);
â”‚   â”‚       â”‚  144 â”‚                 }
â”‚   â”‚       â”‚  145 â”‚ 
â”‚   â”‚       â”‚  146 â”‚                 // Save updated project metadata
â”‚   â”‚       â”‚  147 â”‚                 await SaveProjectMetadataAsync(projectDirectory, project);
â”‚   â”‚       â”‚  148 â”‚ 
â”‚   â”‚       â”‚  149 â”‚                 _logger.LogInformation("Project updated successfully with ID {ProjectId}", project.Id);
â”‚   â”‚       â”‚  150 â”‚             }
â”‚   â”‚       â”‚  151 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚  152 â”‚             {
â”‚   â”‚       â”‚  153 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚  154 â”‚             }
â”‚   â”‚       â”‚  155 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  156 â”‚             {
â”‚   â”‚       â”‚  157 â”‚                 _logger.LogError(ex, "Error updating project with ID {ProjectId}", project.Id);
â”‚   â”‚       â”‚  158 â”‚                 throw new DataAccessException($"Failed to update project with ID {project.Id}", "Update", "Project", ex);
â”‚   â”‚       â”‚  159 â”‚             }
â”‚   â”‚       â”‚  160 â”‚         }
â”‚   â”‚       â”‚  161 â”‚ 
â”‚   â”‚       â”‚  162 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  163 â”‚         public async Task<bool> DeleteAsync(string id)
â”‚   â”‚       â”‚  164 â”‚         {
â”‚   â”‚       â”‚  165 â”‚             if (string.IsNullOrEmpty(id))
â”‚   â”‚       â”‚  166 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(id));
â”‚   â”‚       â”‚  167 â”‚ 
â”‚   â”‚       â”‚  168 â”‚             try
â”‚   â”‚       â”‚  169 â”‚             {
â”‚   â”‚       â”‚  170 â”‚                 var projectDirectory = Path.Combine(_baseProjectsDirectory, id);
â”‚   â”‚       â”‚  171 â”‚                 if (!_fileSystem.DirectoryExists(projectDirectory))
â”‚   â”‚       â”‚  172 â”‚                 {
â”‚   â”‚       â”‚  173 â”‚                     return false;
â”‚   â”‚       â”‚  174 â”‚                 }
â”‚   â”‚       â”‚  175 â”‚ 
â”‚   â”‚       â”‚  176 â”‚                 // Delete the entire project directory
â”‚   â”‚       â”‚  177 â”‚                 Directory.Delete(projectDirectory, true);
â”‚   â”‚       â”‚  178 â”‚ 
â”‚   â”‚       â”‚  179 â”‚                 _logger.LogInformation("Project deleted successfully with ID {ProjectId}", id);
â”‚   â”‚       â”‚  180 â”‚                 return true;
â”‚   â”‚       â”‚  181 â”‚             }
â”‚   â”‚       â”‚  182 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  183 â”‚             {
â”‚   â”‚       â”‚  184 â”‚                 _logger.LogError(ex, "Error deleting project with ID {ProjectId}", id);
â”‚   â”‚       â”‚  185 â”‚                 throw new DataAccessException($"Failed to delete project with ID {id}", "Delete", "Project", ex);
â”‚   â”‚       â”‚  186 â”‚             }
â”‚   â”‚       â”‚  187 â”‚         }
â”‚   â”‚       â”‚  188 â”‚ 
â”‚   â”‚       â”‚  189 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  190 â”‚         public async Task<ImportedFile> ImportFileAsync(string projectId, string sourceFilePath)
â”‚   â”‚       â”‚  191 â”‚         {
â”‚   â”‚       â”‚  192 â”‚             if (string.IsNullOrEmpty(projectId))
â”‚   â”‚       â”‚  193 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(projectId));
â”‚   â”‚       â”‚  194 â”‚             if (string.IsNullOrEmpty(sourceFilePath))
â”‚   â”‚       â”‚  195 â”‚                 throw new ArgumentException("Source file path cannot be empty", nameof(sourceFilePath));
â”‚   â”‚       â”‚  196 â”‚ 
â”‚   â”‚       â”‚  197 â”‚             try
â”‚   â”‚       â”‚  198 â”‚             {
â”‚   â”‚       â”‚  199 â”‚                 // Ensure the project exists
â”‚   â”‚       â”‚  200 â”‚                 var project = await GetByIdAsync(projectId);
â”‚   â”‚       â”‚  201 â”‚                 var fileName = Path.GetFileName(sourceFilePath);
â”‚   â”‚       â”‚  202 â”‚                 var filesDirectory = Path.Combine(_baseProjectsDirectory, projectId, "Files");
â”‚   â”‚       â”‚  203 â”‚ 
â”‚   â”‚       â”‚  204 â”‚                 // Generate a unique destination file name if needed
â”‚   â”‚       â”‚  205 â”‚                 var destinationPath = Path.Combine(filesDirectory, fileName);
â”‚   â”‚       â”‚  206 â”‚                 int counter = 1;
â”‚   â”‚       â”‚  207 â”‚                 while (_fileSystem.FileExists(destinationPath))
â”‚   â”‚       â”‚  208 â”‚                 {
â”‚   â”‚       â”‚  209 â”‚                     var fileNameWithoutExt = Path.GetFileNameWithoutExtension(fileName);
â”‚   â”‚       â”‚  210 â”‚                     var extension = Path.GetExtension(fileName);
â”‚   â”‚       â”‚  211 â”‚                     destinationPath = Path.Combine(filesDirectory, $"{fileNameWithoutExt}_{counter}{extension}");
â”‚   â”‚       â”‚  212 â”‚                     counter++;
â”‚   â”‚       â”‚  213 â”‚                 }
â”‚   â”‚       â”‚  214 â”‚ 
â”‚   â”‚       â”‚  215 â”‚                 // Copy the file
â”‚   â”‚       â”‚  216 â”‚                 using (var sourceStream = _fileSystem.OpenRead(sourceFilePath))
â”‚   â”‚       â”‚  217 â”‚                 using (var destStream = _fileSystem.OpenWrite(destinationPath))
â”‚   â”‚       â”‚  218 â”‚                 {
â”‚   â”‚       â”‚  219 â”‚                     await sourceStream.CopyToAsync(destStream);
â”‚   â”‚       â”‚  220 â”‚                 }
â”‚   â”‚       â”‚  221 â”‚ 
â”‚   â”‚       â”‚  222 â”‚                 // Get file info
â”‚   â”‚       â”‚  223 â”‚                 var fileInfo = new FileInfo(destinationPath);
â”‚   â”‚       â”‚  224 â”‚                 var fileType = Path.GetExtension(destinationPath).TrimStart('.');
â”‚   â”‚       â”‚  225 â”‚ 
â”‚   â”‚       â”‚  226 â”‚                 // Create the imported file record
â”‚   â”‚       â”‚  227 â”‚                 var importedFile = project.ImportFile(
â”‚   â”‚       â”‚  228 â”‚                     destinationPath,
â”‚   â”‚       â”‚  229 â”‚                     Path.GetFileName(destinationPath),
â”‚   â”‚       â”‚  230 â”‚                     fileInfo.Length,
â”‚   â”‚       â”‚  231 â”‚                     fileType);
â”‚   â”‚       â”‚  232 â”‚ 
â”‚   â”‚       â”‚  233 â”‚                 // Update project metadata
â”‚   â”‚       â”‚  234 â”‚                 await SaveProjectMetadataAsync(Path.Combine(_baseProjectsDirectory, projectId), project);
â”‚   â”‚       â”‚  235 â”‚ 
â”‚   â”‚       â”‚  236 â”‚                 _logger.LogInformation("File {FileName} imported to project {ProjectId}", fileName, projectId);
â”‚   â”‚       â”‚  237 â”‚                 return importedFile;
â”‚   â”‚       â”‚  238 â”‚             }
â”‚   â”‚       â”‚  239 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚  240 â”‚             {
â”‚   â”‚       â”‚  241 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚  242 â”‚             }
â”‚   â”‚       â”‚  243 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  244 â”‚             {
â”‚   â”‚       â”‚  245 â”‚                 _logger.LogError(ex, "Error importing file {FileName} to project {ProjectId}",
â”‚   â”‚       â”‚  246 â”‚                     Path.GetFileName(sourceFilePath), projectId);
â”‚   â”‚       â”‚  247 â”‚                 throw new DataAccessException(
â”‚   â”‚       â”‚  248 â”‚                     $"Failed to import file {Path.GetFileName(sourceFilePath)} to project {projectId}",
â”‚   â”‚       â”‚  249 â”‚                     "ImportFile", "Project", ex);
â”‚   â”‚       â”‚  250 â”‚             }
â”‚   â”‚       â”‚  251 â”‚         }
â”‚   â”‚       â”‚  252 â”‚ 
â”‚   â”‚       â”‚  253 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  254 â”‚         public async Task<bool> RemoveFileAsync(string projectId, string filePath)
â”‚   â”‚       â”‚  255 â”‚         {
â”‚   â”‚       â”‚  256 â”‚             if (string.IsNullOrEmpty(projectId))
â”‚   â”‚       â”‚  257 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(projectId));
â”‚   â”‚       â”‚  258 â”‚             if (string.IsNullOrEmpty(filePath))
â”‚   â”‚       â”‚  259 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(filePath));
â”‚   â”‚       â”‚  260 â”‚ 
â”‚   â”‚       â”‚  261 â”‚             try
â”‚   â”‚       â”‚  262 â”‚             {
â”‚   â”‚       â”‚  263 â”‚                 // Ensure the project exists
â”‚   â”‚       â”‚  264 â”‚                 var project = await GetByIdAsync(projectId);
â”‚   â”‚       â”‚  265 â”‚ 
â”‚   â”‚       â”‚  266 â”‚                 // Remove from project metadata
â”‚   â”‚       â”‚  267 â”‚                 bool removed = project.RemoveFile(filePath);
â”‚   â”‚       â”‚  268 â”‚                 if (removed)
â”‚   â”‚       â”‚  269 â”‚                 {
â”‚   â”‚       â”‚  270 â”‚                     // Update project metadata
â”‚   â”‚       â”‚  271 â”‚                     await SaveProjectMetadataAsync(Path.Combine(_baseProjectsDirectory, projectId), project);
â”‚   â”‚       â”‚  272 â”‚ 
â”‚   â”‚       â”‚  273 â”‚                     // Delete the physical file if it exists
â”‚   â”‚       â”‚  274 â”‚                     if (_fileSystem.FileExists(filePath))
â”‚   â”‚       â”‚  275 â”‚                     {
â”‚   â”‚       â”‚  276 â”‚                         File.Delete(filePath);
â”‚   â”‚       â”‚  277 â”‚                     }
â”‚   â”‚       â”‚  278 â”‚ 
â”‚   â”‚       â”‚  279 â”‚                     _logger.LogInformation("File {FilePath} removed from project {ProjectId}", filePath, projectId);
â”‚   â”‚       â”‚  280 â”‚                 }
â”‚   â”‚       â”‚  281 â”‚ 
â”‚   â”‚       â”‚  282 â”‚                 return removed;
â”‚   â”‚       â”‚  283 â”‚             }
â”‚   â”‚       â”‚  284 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚  285 â”‚             {
â”‚   â”‚       â”‚  286 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚  287 â”‚             }
â”‚   â”‚       â”‚  288 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  289 â”‚             {
â”‚   â”‚       â”‚  290 â”‚                 _logger.LogError(ex, "Error removing file {FilePath} from project {ProjectId}", filePath, projectId);
â”‚   â”‚       â”‚  291 â”‚                 throw new DataAccessException(
â”‚   â”‚       â”‚  292 â”‚                     $"Failed to remove file from project {projectId}",
â”‚   â”‚       â”‚  293 â”‚                     "RemoveFile", "Project", ex);
â”‚   â”‚       â”‚  294 â”‚             }
â”‚   â”‚       â”‚  295 â”‚         }
â”‚   â”‚       â”‚  296 â”‚ 
â”‚   â”‚       â”‚  297 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  298 â”‚         public async Task<SharedType> AddSharedTypeAsync(
â”‚   â”‚       â”‚  299 â”‚             string projectId,
â”‚   â”‚       â”‚  300 â”‚             string sourceFilePath,
â”‚   â”‚       â”‚  301 â”‚             string typeName = null,
â”‚   â”‚       â”‚  302 â”‚             string category = null,
â”‚   â”‚       â”‚  303 â”‚             string description = null)
â”‚   â”‚       â”‚  304 â”‚         {
â”‚   â”‚       â”‚  305 â”‚             if (string.IsNullOrEmpty(projectId))
â”‚   â”‚       â”‚  306 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(projectId));
â”‚   â”‚       â”‚  307 â”‚             if (string.IsNullOrEmpty(sourceFilePath))
â”‚   â”‚       â”‚  308 â”‚                 throw new ArgumentException("Source file path cannot be empty", nameof(sourceFilePath));
â”‚   â”‚       â”‚  309 â”‚ 
â”‚   â”‚       â”‚  310 â”‚             try
â”‚   â”‚       â”‚  311 â”‚             {
â”‚   â”‚       â”‚  312 â”‚                 // Ensure the project exists
â”‚   â”‚       â”‚  313 â”‚                 var project = await GetByIdAsync(projectId);
â”‚   â”‚       â”‚  314 â”‚                 var fileName = Path.GetFileName(sourceFilePath);
â”‚   â”‚       â”‚  315 â”‚                 var sharedTypesDirectory = Path.Combine(_baseProjectsDirectory, projectId, "SharedTypes");
â”‚   â”‚       â”‚  316 â”‚ 
â”‚   â”‚       â”‚  317 â”‚                 // Generate a unique destination file name if needed
â”‚   â”‚       â”‚  318 â”‚                 var destinationPath = Path.Combine(sharedTypesDirectory, fileName);
â”‚   â”‚       â”‚  319 â”‚                 int counter = 1;
â”‚   â”‚       â”‚  320 â”‚                 while (_fileSystem.FileExists(destinationPath))
â”‚   â”‚       â”‚  321 â”‚                 {
â”‚   â”‚       â”‚  322 â”‚                     var fileNameWithoutExt = Path.GetFileNameWithoutExtension(fileName);
â”‚   â”‚       â”‚  323 â”‚                     var extension = Path.GetExtension(fileName);
â”‚   â”‚       â”‚  324 â”‚                     destinationPath = Path.Combine(sharedTypesDirectory, $"{fileNameWithoutExt}_{counter}{extension}");
â”‚   â”‚       â”‚  325 â”‚                     counter++;
â”‚   â”‚       â”‚  326 â”‚                 }
â”‚   â”‚       â”‚  327 â”‚ 
â”‚   â”‚       â”‚  328 â”‚                 // Copy the file
â”‚   â”‚       â”‚  329 â”‚                 using (var sourceStream = _fileSystem.OpenRead(sourceFilePath))
â”‚   â”‚       â”‚  330 â”‚                 using (var destStream = _fileSystem.OpenWrite(destinationPath))
â”‚   â”‚       â”‚  331 â”‚                 {
â”‚   â”‚       â”‚  332 â”‚                     await sourceStream.CopyToAsync(destStream);
â”‚   â”‚       â”‚  333 â”‚                 }
â”‚   â”‚       â”‚  334 â”‚ 
â”‚   â”‚       â”‚  335 â”‚                 // Get file info
â”‚   â”‚       â”‚  336 â”‚                 var fileInfo = new FileInfo(destinationPath);
â”‚   â”‚       â”‚  337 â”‚ 
â”‚   â”‚       â”‚  338 â”‚                 // Determine type name if not provided
â”‚   â”‚       â”‚  339 â”‚                 typeName ??= Path.GetFileNameWithoutExtension(destinationPath);
â”‚   â”‚       â”‚  340 â”‚                 category ??= "XML";
â”‚   â”‚       â”‚  341 â”‚                 description ??= "Imported shared type";
â”‚   â”‚       â”‚  342 â”‚ 
â”‚   â”‚       â”‚  343 â”‚                 // Add to project
â”‚   â”‚       â”‚  344 â”‚                 var sharedType = project.AddSharedType(
â”‚   â”‚       â”‚  345 â”‚                     typeName,
â”‚   â”‚       â”‚  346 â”‚                     Path.GetFileName(destinationPath),
â”‚   â”‚       â”‚  347 â”‚                     destinationPath,
â”‚   â”‚       â”‚  348 â”‚                     category,
â”‚   â”‚       â”‚  349 â”‚                     description,
â”‚   â”‚       â”‚  350 â”‚                     fileInfo.Length);
â”‚   â”‚       â”‚  351 â”‚ 
â”‚   â”‚       â”‚  352 â”‚                 // Update project metadata
â”‚   â”‚       â”‚  353 â”‚                 await SaveProjectMetadataAsync(Path.Combine(_baseProjectsDirectory, projectId), project);
â”‚   â”‚       â”‚  354 â”‚ 
â”‚   â”‚       â”‚  355 â”‚                 _logger.LogInformation("Shared type {TypeName} added to project {ProjectId}", typeName, projectId);
â”‚   â”‚       â”‚  356 â”‚                 return sharedType;
â”‚   â”‚       â”‚  357 â”‚             }
â”‚   â”‚       â”‚  358 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚  359 â”‚             {
â”‚   â”‚       â”‚  360 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚  361 â”‚             }
â”‚   â”‚       â”‚  362 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  363 â”‚             {
â”‚   â”‚       â”‚  364 â”‚                 _logger.LogError(ex, "Error adding shared type from {FileName} to project {ProjectId}",
â”‚   â”‚       â”‚  365 â”‚                     Path.GetFileName(sourceFilePath), projectId);
â”‚   â”‚       â”‚  366 â”‚                 throw new DataAccessException(
â”‚   â”‚       â”‚  367 â”‚                     $"Failed to add shared type to project {projectId}",
â”‚   â”‚       â”‚  368 â”‚                     "AddSharedType", "Project", ex);
â”‚   â”‚       â”‚  369 â”‚             }
â”‚   â”‚       â”‚  370 â”‚         }
â”‚   â”‚       â”‚  371 â”‚ 
â”‚   â”‚       â”‚  372 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  373 â”‚         public async Task<bool> UpdateSharedTypeDescriptionAsync(string projectId, string filePath, string description)
â”‚   â”‚       â”‚  374 â”‚         {
â”‚   â”‚       â”‚  375 â”‚             if (string.IsNullOrEmpty(projectId))
â”‚   â”‚       â”‚  376 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(projectId));
â”‚   â”‚       â”‚  377 â”‚             if (string.IsNullOrEmpty(filePath))
â”‚   â”‚       â”‚  378 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(filePath));
â”‚   â”‚       â”‚  379 â”‚ 
â”‚   â”‚       â”‚  380 â”‚             try
â”‚   â”‚       â”‚  381 â”‚             {
â”‚   â”‚       â”‚  382 â”‚                 // Ensure the project exists
â”‚   â”‚       â”‚  383 â”‚                 var project = await GetByIdAsync(projectId);
â”‚   â”‚       â”‚  384 â”‚ 
â”‚   â”‚       â”‚  385 â”‚                 // Update description
â”‚   â”‚       â”‚  386 â”‚                 bool updated = project.UpdateSharedTypeDescription(filePath, description);
â”‚   â”‚       â”‚  387 â”‚                 if (updated)
â”‚   â”‚       â”‚  388 â”‚                 {
â”‚   â”‚       â”‚  389 â”‚                     // Update project metadata
â”‚   â”‚       â”‚  390 â”‚                     await SaveProjectMetadataAsync(Path.Combine(_baseProjectsDirectory, projectId), project);
â”‚   â”‚       â”‚  391 â”‚                     _logger.LogInformation("Updated description for shared type in project {ProjectId}", projectId);
â”‚   â”‚       â”‚  392 â”‚                 }
â”‚   â”‚       â”‚  393 â”‚ 
â”‚   â”‚       â”‚  394 â”‚                 return updated;
â”‚   â”‚       â”‚  395 â”‚             }
â”‚   â”‚       â”‚  396 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚  397 â”‚             {
â”‚   â”‚       â”‚  398 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚  399 â”‚             }
â”‚   â”‚       â”‚  400 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  401 â”‚             {
â”‚   â”‚       â”‚  402 â”‚                 _logger.LogError(ex, "Error updating shared type description in project {ProjectId}", projectId);
â”‚   â”‚       â”‚  403 â”‚                 throw new DataAccessException(
â”‚   â”‚       â”‚  404 â”‚                     $"Failed to update shared type description in project {projectId}",
â”‚   â”‚       â”‚  405 â”‚                     "UpdateSharedTypeDescription", "Project", ex);
â”‚   â”‚       â”‚  406 â”‚             }
â”‚   â”‚       â”‚  407 â”‚         }
â”‚   â”‚       â”‚  408 â”‚ 
â”‚   â”‚       â”‚  409 â”‚         /// <inheritdoc/>
â”‚   â”‚       â”‚  410 â”‚         public async Task<bool> RemoveSharedTypeAsync(string projectId, string filePath)
â”‚   â”‚       â”‚  411 â”‚         {
â”‚   â”‚       â”‚  412 â”‚             if (string.IsNullOrEmpty(projectId))
â”‚   â”‚       â”‚  413 â”‚                 throw new ArgumentException("Project ID cannot be empty", nameof(projectId));
â”‚   â”‚       â”‚  414 â”‚             if (string.IsNullOrEmpty(filePath))
â”‚   â”‚       â”‚  415 â”‚                 throw new ArgumentException("File path cannot be empty", nameof(filePath));
â”‚   â”‚       â”‚  416 â”‚ 
â”‚   â”‚       â”‚  417 â”‚             try
â”‚   â”‚       â”‚  418 â”‚             {
â”‚   â”‚       â”‚  419 â”‚                 // Ensure the project exists
â”‚   â”‚       â”‚  420 â”‚                 var project = await GetByIdAsync(projectId);
â”‚   â”‚       â”‚  421 â”‚ 
â”‚   â”‚       â”‚  422 â”‚                 // Remove from project metadata
â”‚   â”‚       â”‚  423 â”‚                 bool removed = project.RemoveSharedType(filePath);
â”‚   â”‚       â”‚  424 â”‚                 if (removed)
â”‚   â”‚       â”‚  425 â”‚                 {
â”‚   â”‚       â”‚  426 â”‚                     // Update project metadata
â”‚   â”‚       â”‚  427 â”‚                     await SaveProjectMetadataAsync(Path.Combine(_baseProjectsDirectory, projectId), project);
â”‚   â”‚       â”‚  428 â”‚ 
â”‚   â”‚       â”‚  429 â”‚                     // Delete the physical file if it exists
â”‚   â”‚       â”‚  430 â”‚                     if (_fileSystem.FileExists(filePath))
â”‚   â”‚       â”‚  431 â”‚                     {
â”‚   â”‚       â”‚  432 â”‚                         File.Delete(filePath);
â”‚   â”‚       â”‚  433 â”‚                     }
â”‚   â”‚       â”‚  434 â”‚ 
â”‚   â”‚       â”‚  435 â”‚                     _logger.LogInformation("Shared type {FilePath} removed from project {ProjectId}", filePath, projectId);
â”‚   â”‚       â”‚  436 â”‚                 }
â”‚   â”‚       â”‚  437 â”‚ 
â”‚   â”‚       â”‚  438 â”‚                 return removed;
â”‚   â”‚       â”‚  439 â”‚             }
â”‚   â”‚       â”‚  440 â”‚             catch (NotFoundException)
â”‚   â”‚       â”‚  441 â”‚             {
â”‚   â”‚       â”‚  442 â”‚                 throw; // Let NotFoundException pass through
â”‚   â”‚       â”‚  443 â”‚             }
â”‚   â”‚       â”‚  444 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  445 â”‚             {
â”‚   â”‚       â”‚  446 â”‚                 _logger.LogError(ex, "Error removing shared type {FilePath} from project {ProjectId}", filePath, projectId);
â”‚   â”‚       â”‚  447 â”‚                 throw new DataAccessException(
â”‚   â”‚       â”‚  448 â”‚                     $"Failed to remove shared type from project {projectId}",
â”‚   â”‚       â”‚  449 â”‚                     "RemoveSharedType", "Project", ex);
â”‚   â”‚       â”‚  450 â”‚             }
â”‚   â”‚       â”‚  451 â”‚         }
â”‚   â”‚       â”‚  452 â”‚ 
â”‚   â”‚       â”‚  453 â”‚         #region Private Helper Methods
â”‚   â”‚       â”‚  454 â”‚ 
â”‚   â”‚       â”‚  455 â”‚         /// <summary>
â”‚   â”‚       â”‚  456 â”‚         /// Loads a project from its directory
â”‚   â”‚       â”‚  457 â”‚         /// </summary>
â”‚   â”‚       â”‚  458 â”‚         /// <param name="projectDirectory">The project directory path</param>
â”‚   â”‚       â”‚  459 â”‚         /// <returns>The loaded project or null if not found</returns>
â”‚   â”‚       â”‚  460 â”‚         private async Task<Project> LoadProjectFromDirectoryAsync(string projectDirectory)
â”‚   â”‚       â”‚  461 â”‚         {
â”‚   â”‚       â”‚  462 â”‚             var metadataPath = Path.Combine(projectDirectory, ProjectMetadataFileName);
â”‚   â”‚       â”‚  463 â”‚             if (!_fileSystem.FileExists(metadataPath))
â”‚   â”‚       â”‚  464 â”‚             {
â”‚   â”‚       â”‚  465 â”‚                 _logger.LogWarning("Project metadata file not found in directory {Directory}", projectDirectory);
â”‚   â”‚       â”‚  466 â”‚                 return null;
â”‚   â”‚       â”‚  467 â”‚             }
â”‚   â”‚       â”‚  468 â”‚ 
â”‚   â”‚       â”‚  469 â”‚             try
â”‚   â”‚       â”‚  470 â”‚             {
â”‚   â”‚       â”‚  471 â”‚                 var json = await _fileSystem.ReadAllTextAsync(metadataPath);
â”‚   â”‚       â”‚  472 â”‚                 var projectData = JsonSerializer.Deserialize<ProjectData>(json);
â”‚   â”‚       â”‚  473 â”‚ 
â”‚   â”‚       â”‚  474 â”‚                 // Extract project ID from directory name if not in metadata
â”‚   â”‚       â”‚  475 â”‚                 var projectId = projectData.Id ?? Path.GetFileName(projectDirectory);
â”‚   â”‚       â”‚  476 â”‚ 
â”‚   â”‚       â”‚  477 â”‚                 // Create project domain object
â”‚   â”‚       â”‚  478 â”‚                 var project = new Project(
â”‚   â”‚       â”‚  479 â”‚                     projectId,
â”‚   â”‚       â”‚  480 â”‚                     projectData.Name,
â”‚   â”‚       â”‚  481 â”‚                     projectData.Description);
â”‚   â”‚       â”‚  482 â”‚ 
â”‚   â”‚       â”‚  483 â”‚                 // Add imported files
â”‚   â”‚       â”‚  484 â”‚                 if (projectData.ImportedFiles != null)
â”‚   â”‚       â”‚  485 â”‚                 {
â”‚   â”‚       â”‚  486 â”‚                     foreach (var fileData in projectData.ImportedFiles)
â”‚   â”‚       â”‚  487 â”‚                     {
â”‚   â”‚       â”‚  488 â”‚                         try
â”‚   â”‚       â”‚  489 â”‚                         {
â”‚   â”‚       â”‚  490 â”‚                             var importedFile = new ImportedFile(
â”‚   â”‚       â”‚  491 â”‚                                 fileData.FilePath,
â”‚   â”‚       â”‚  492 â”‚                                 fileData.FileName,
â”‚   â”‚       â”‚  493 â”‚                                 fileData.FileSize,
â”‚   â”‚       â”‚  494 â”‚                                 fileData.FileType);
â”‚   â”‚       â”‚  495 â”‚ 
â”‚   â”‚       â”‚  496 â”‚                             // Add to project using reflection to avoid validation
â”‚   â”‚       â”‚  497 â”‚                             var importedFiles = typeof(Project).GetField("_importedFiles", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
â”‚   â”‚       â”‚  498 â”‚                                 ?.GetValue(project) as List<ImportedFile>;
â”‚   â”‚       â”‚  499 â”‚ 
â”‚   â”‚       â”‚  500 â”‚                             if (importedFiles != null)
â”‚   â”‚       â”‚  501 â”‚                             {
â”‚   â”‚       â”‚  502 â”‚                                 importedFiles.Add(importedFile);
â”‚   â”‚       â”‚  503 â”‚                             }
â”‚   â”‚       â”‚  504 â”‚                         }
â”‚   â”‚       â”‚  505 â”‚                         catch (Exception ex)
â”‚   â”‚       â”‚  506 â”‚                         {
â”‚   â”‚       â”‚  507 â”‚                             _logger.LogWarning(ex, "Error adding imported file {FileName} to project {ProjectId}",
â”‚   â”‚       â”‚  508 â”‚                                 fileData.FileName, projectId);
â”‚   â”‚       â”‚  509 â”‚                         }
â”‚   â”‚       â”‚  510 â”‚                     }
â”‚   â”‚       â”‚  511 â”‚                 }
â”‚   â”‚       â”‚  512 â”‚ 
â”‚   â”‚       â”‚  513 â”‚                 // Add shared types
â”‚   â”‚       â”‚  514 â”‚                 if (projectData.SharedTypes != null)
â”‚   â”‚       â”‚  515 â”‚                 {
â”‚   â”‚       â”‚  516 â”‚                     foreach (var typeData in projectData.SharedTypes)
â”‚   â”‚       â”‚  517 â”‚                     {
â”‚   â”‚       â”‚  518 â”‚                         try
â”‚   â”‚       â”‚  519 â”‚                         {
â”‚   â”‚       â”‚  520 â”‚                             var sharedType = new SharedType(
â”‚   â”‚       â”‚  521 â”‚                                 typeData.TypeName,
â”‚   â”‚       â”‚  522 â”‚                                 typeData.FileName,
â”‚   â”‚       â”‚  523 â”‚                                 typeData.FilePath,
â”‚   â”‚       â”‚  524 â”‚                                 typeData.Category,
â”‚   â”‚       â”‚  525 â”‚                                 typeData.Description,
â”‚   â”‚       â”‚  526 â”‚                                 typeData.FileSize);
â”‚   â”‚       â”‚  527 â”‚ 
â”‚   â”‚       â”‚  528 â”‚                             // Set additional properties
â”‚   â”‚       â”‚  529 â”‚                             typeof(SharedType).GetMethod("SetVariableCount")
â”‚   â”‚       â”‚  530 â”‚                                 ?.Invoke(sharedType, new object[] { typeData.VariableCount });
â”‚   â”‚       â”‚  531 â”‚ 
â”‚   â”‚       â”‚  532 â”‚                             typeof(SharedType).GetMethod("SetDefaultTargetName")
â”‚   â”‚       â”‚  533 â”‚                                 ?.Invoke(sharedType, new object[] { typeData.DefaultTargetName });
â”‚   â”‚       â”‚  534 â”‚ 
â”‚   â”‚       â”‚  535 â”‚                             // Add usages
â”‚   â”‚       â”‚  536 â”‚                             for (int i = 0; i < typeData.UsageCount; i++)
â”‚   â”‚       â”‚  537 â”‚                             {
â”‚   â”‚       â”‚  538 â”‚                                 typeof(SharedType).GetMethod("IncrementUsageCount")
â”‚   â”‚       â”‚  539 â”‚                                     ?.Invoke(sharedType, null);
â”‚   â”‚       â”‚  540 â”‚                             }
â”‚   â”‚       â”‚  541 â”‚ 
â”‚   â”‚       â”‚  542 â”‚                             // Add to project using reflection to avoid validation
â”‚   â”‚       â”‚  543 â”‚                             var sharedTypes = typeof(Project).GetField("_sharedTypes", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
â”‚   â”‚       â”‚  544 â”‚                                 ?.GetValue(project) as List<SharedType>;
â”‚   â”‚       â”‚  545 â”‚ 
â”‚   â”‚       â”‚  546 â”‚                             if (sharedTypes != null)
â”‚   â”‚       â”‚  547 â”‚                             {
â”‚   â”‚       â”‚  548 â”‚                                 sharedTypes.Add(sharedType);
â”‚   â”‚       â”‚  549 â”‚                             }
â”‚   â”‚       â”‚  550 â”‚                         }
â”‚   â”‚       â”‚  551 â”‚                         catch (Exception ex)
â”‚   â”‚       â”‚  552 â”‚                         {
â”‚   â”‚       â”‚  553 â”‚                             _logger.LogWarning(ex, "Error adding shared type {TypeName} to project {ProjectId}",
â”‚   â”‚       â”‚  554 â”‚                                 typeData.TypeName, projectId);
â”‚   â”‚       â”‚  555 â”‚                         }
â”‚   â”‚       â”‚  556 â”‚                     }
â”‚   â”‚       â”‚  557 â”‚                 }
â”‚   â”‚       â”‚  558 â”‚ 
â”‚   â”‚       â”‚  559 â”‚                 // Add custom type files
â”‚   â”‚       â”‚  560 â”‚                 if (projectData.CustomTypeFiles != null)
â”‚   â”‚       â”‚  561 â”‚                 {
â”‚   â”‚       â”‚  562 â”‚                     foreach (var fileData in projectData.CustomTypeFiles)
â”‚   â”‚       â”‚  563 â”‚                     {
â”‚   â”‚       â”‚  564 â”‚                         try
â”‚   â”‚       â”‚  565 â”‚                         {
â”‚   â”‚       â”‚  566 â”‚                             var customTypeFile = new CustomTypeFile(
â”‚   â”‚       â”‚  567 â”‚                                 fileData.FileName,
â”‚   â”‚       â”‚  568 â”‚                                 fileData.TypeCount,
â”‚   â”‚       â”‚  569 â”‚                                 fileData.Description);
â”‚   â”‚       â”‚  570 â”‚ 
â”‚   â”‚       â”‚  571 â”‚                             // Add to project using reflection to avoid validation
â”‚   â”‚       â”‚  572 â”‚                             var customTypeFiles = typeof(Project).GetField("_customTypeFiles", System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
â”‚   â”‚       â”‚  573 â”‚                                 ?.GetValue(project) as List<CustomTypeFile>;
â”‚   â”‚       â”‚  574 â”‚ 
â”‚   â”‚       â”‚  575 â”‚                             if (customTypeFiles != null)
â”‚   â”‚       â”‚  576 â”‚                             {
â”‚   â”‚       â”‚  577 â”‚                                 customTypeFiles.Add(customTypeFile);
â”‚   â”‚       â”‚  578 â”‚                             }
â”‚   â”‚       â”‚  579 â”‚                         }
â”‚   â”‚       â”‚  580 â”‚                         catch (Exception ex)
â”‚   â”‚       â”‚  581 â”‚                         {
â”‚   â”‚       â”‚  582 â”‚                             _logger.LogWarning(ex, "Error adding custom type file {FileName} to project {ProjectId}",
â”‚   â”‚       â”‚  583 â”‚                                 fileData.FileName, projectId);
â”‚   â”‚       â”‚  584 â”‚                         }
â”‚   â”‚       â”‚  585 â”‚                     }
â”‚   â”‚       â”‚  586 â”‚                 }
â”‚   â”‚       â”‚  587 â”‚ 
â”‚   â”‚       â”‚  588 â”‚                 return project;
â”‚   â”‚       â”‚  589 â”‚             }
â”‚   â”‚       â”‚  590 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  591 â”‚             {
â”‚   â”‚       â”‚  592 â”‚                 _logger.LogError(ex, "Error deserializing project metadata in directory {Directory}", projectDirectory);
â”‚   â”‚       â”‚  593 â”‚                 return null;
â”‚   â”‚       â”‚  594 â”‚             }
â”‚   â”‚       â”‚  595 â”‚         }
â”‚   â”‚       â”‚  596 â”‚ 
â”‚   â”‚       â”‚  597 â”‚         /// <summary>
â”‚   â”‚       â”‚  598 â”‚         /// Saves project metadata to the specified directory
â”‚   â”‚       â”‚  599 â”‚         /// </summary>
â”‚   â”‚       â”‚  600 â”‚         /// <param name="projectDirectory">The project directory</param>
â”‚   â”‚       â”‚  601 â”‚         /// <param name="project">The project to save</param>
â”‚   â”‚       â”‚  602 â”‚         private async Task SaveProjectMetadataAsync(string projectDirectory, Project project)
â”‚   â”‚       â”‚  603 â”‚         {
â”‚   â”‚       â”‚  604 â”‚             var projectData = new ProjectData
â”‚   â”‚       â”‚  605 â”‚             {
â”‚   â”‚       â”‚  606 â”‚                 Id = project.Id,
â”‚   â”‚       â”‚  607 â”‚                 Name = project.Name,
â”‚   â”‚       â”‚  608 â”‚                 Description = project.Description,
â”‚   â”‚       â”‚  609 â”‚                 Created = project.Created,
â”‚   â”‚       â”‚  610 â”‚                 LastModified = project.LastModified,
â”‚   â”‚       â”‚  611 â”‚                 ImportedFiles = project.ImportedFiles.Select(f => new ImportedFileData
â”‚   â”‚       â”‚  612 â”‚                 {
â”‚   â”‚       â”‚  613 â”‚                     FileName = f.FileName,
â”‚   â”‚       â”‚  614 â”‚                     FilePath = f.FilePath,
â”‚   â”‚       â”‚  615 â”‚                     FileSize = f.FileSize,
â”‚   â”‚       â”‚  616 â”‚                     FileType = f.FileType,
â”‚   â”‚       â”‚  617 â”‚                     ImportDate = f.ImportDate,
â”‚   â”‚       â”‚  618 â”‚                     Status = f.Status
â”‚   â”‚       â”‚  619 â”‚                 }).ToList(),
â”‚   â”‚       â”‚  620 â”‚                 SharedTypes = project.SharedTypes.Select(t => new SharedTypeData
â”‚   â”‚       â”‚  621 â”‚                 {
â”‚   â”‚       â”‚  622 â”‚                     TypeName = t.TypeName,
â”‚   â”‚       â”‚  623 â”‚                     FileName = t.FileName,
â”‚   â”‚       â”‚  624 â”‚                     FilePath = t.FilePath,
â”‚   â”‚       â”‚  625 â”‚                     Category = t.Category,
â”‚   â”‚       â”‚  626 â”‚                     Description = t.Description,
â”‚   â”‚       â”‚  627 â”‚                     ImportDate = t.ImportDate,
â”‚   â”‚       â”‚  628 â”‚                     FileSize = t.FileSize,
â”‚   â”‚       â”‚  629 â”‚                     UsageCount = t.UsageCount,
â”‚   â”‚       â”‚  630 â”‚                     VariableCount = t.VariableCount,
â”‚   â”‚       â”‚  631 â”‚                     DefaultTargetName = t.DefaultTargetName
â”‚   â”‚       â”‚  632 â”‚                 }).ToList(),
â”‚   â”‚       â”‚  633 â”‚                 CustomTypeFiles = project.CustomTypeFiles.Select(f => new CustomTypeFileData
â”‚   â”‚       â”‚  634 â”‚                 {
â”‚   â”‚       â”‚  635 â”‚                     FileName = f.FileName,
â”‚   â”‚       â”‚  636 â”‚                     TypeCount = f.TypeCount,
â”‚   â”‚       â”‚  637 â”‚                     LastModified = f.LastModified,
â”‚   â”‚       â”‚  638 â”‚                     Description = f.Description
â”‚   â”‚       â”‚  639 â”‚                 }).ToList()
â”‚   â”‚       â”‚  640 â”‚             };
â”‚   â”‚       â”‚  641 â”‚ 
â”‚   â”‚       â”‚  642 â”‚             var options = new JsonSerializerOptions { WriteIndented = true };
â”‚   â”‚       â”‚  643 â”‚             var json = JsonSerializer.Serialize(projectData, options);
â”‚   â”‚       â”‚  644 â”‚             var metadataPath = Path.Combine(projectDirectory, ProjectMetadataFileName);
â”‚   â”‚       â”‚  645 â”‚             await _fileSystem.WriteAllTextAsync(metadataPath, json);
â”‚   â”‚       â”‚  646 â”‚         }
â”‚   â”‚       â”‚  647 â”‚ 
â”‚   â”‚       â”‚  648 â”‚         #endregion
â”‚   â”‚       â”‚  649 â”‚ 
â”‚   â”‚       â”‚  650 â”‚         #region DTO Classes for Serialization
â”‚   â”‚       â”‚  651 â”‚ 
â”‚   â”‚       â”‚  652 â”‚         /// <summary>
â”‚   â”‚       â”‚  653 â”‚         /// Data transfer object for project metadata serialization
â”‚   â”‚       â”‚  654 â”‚         /// </summary>
â”‚   â”‚       â”‚  655 â”‚         private class ProjectData
â”‚   â”‚       â”‚  656 â”‚         {
â”‚   â”‚       â”‚  657 â”‚             public string Id { get; set; }
â”‚   â”‚       â”‚  658 â”‚             public string Name { get; set; }
â”‚   â”‚       â”‚  659 â”‚             public string Description { get; set; }
â”‚   â”‚       â”‚  660 â”‚             public DateTime Created { get; set; }
â”‚   â”‚       â”‚  661 â”‚             public DateTime LastModified { get; set; }
â”‚   â”‚       â”‚  662 â”‚             public List<ImportedFileData> ImportedFiles { get; set; } = new();
â”‚   â”‚       â”‚  663 â”‚             public List<SharedTypeData> SharedTypes { get; set; } = new();
â”‚   â”‚       â”‚  664 â”‚             public List<CustomTypeFileData> CustomTypeFiles { get; set; } = new();
â”‚   â”‚       â”‚  665 â”‚         }
â”‚   â”‚       â”‚  666 â”‚ 
â”‚   â”‚       â”‚  667 â”‚         private class ImportedFileData
â”‚   â”‚       â”‚  668 â”‚         {
â”‚   â”‚       â”‚  669 â”‚             public string FileName { get; set; }
â”‚   â”‚       â”‚  670 â”‚             public string FilePath { get; set; }
â”‚   â”‚       â”‚  671 â”‚             public long FileSize { get; set; }
â”‚   â”‚       â”‚  672 â”‚             public string FileType { get; set; }
â”‚   â”‚       â”‚  673 â”‚             public DateTime ImportDate { get; set; }
â”‚   â”‚       â”‚  674 â”‚             public string Status { get; set; }
â”‚   â”‚       â”‚  675 â”‚         }
â”‚   â”‚       â”‚  676 â”‚ 
â”‚   â”‚       â”‚  677 â”‚         private class SharedTypeData
â”‚   â”‚       â”‚  678 â”‚         {
â”‚   â”‚       â”‚  679 â”‚             public string TypeName { get; set; }
â”‚   â”‚       â”‚  680 â”‚             public string FileName { get; set; }
â”‚   â”‚       â”‚  681 â”‚             public string FilePath { get; set; }
â”‚   â”‚       â”‚  682 â”‚             public string Category { get; set; }
â”‚   â”‚       â”‚  683 â”‚             public string Description { get; set; }
â”‚   â”‚       â”‚  684 â”‚             public DateTime ImportDate { get; set; }
â”‚   â”‚       â”‚  685 â”‚             public long FileSize { get; set; }
â”‚   â”‚       â”‚  686 â”‚             public int UsageCount { get; set; }
â”‚   â”‚       â”‚  687 â”‚             public int VariableCount { get; set; }
â”‚   â”‚       â”‚  688 â”‚             public string DefaultTargetName { get; set; }
â”‚   â”‚       â”‚  689 â”‚         }
â”‚   â”‚       â”‚  690 â”‚ 
â”‚   â”‚       â”‚  691 â”‚         private class CustomTypeFileData
â”‚   â”‚       â”‚  692 â”‚         {
â”‚   â”‚       â”‚  693 â”‚             public string FileName { get; set; }
â”‚   â”‚       â”‚  694 â”‚             public int TypeCount { get; set; }
â”‚   â”‚       â”‚  695 â”‚             public DateTime LastModified { get; set; }
â”‚   â”‚       â”‚  696 â”‚             public string Description { get; set; }
â”‚   â”‚       â”‚  697 â”‚         }
â”‚   â”‚       â”‚  698 â”‚ 
â”‚   â”‚       â”‚  699 â”‚         #endregion
â”‚   â”‚       â”‚  700 â”‚     }
â”‚   â”‚       â”‚  701 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   ğŸ“ FileSystem
â”‚   â”‚   â””â”€â”€ ğŸ“„ PhysicalFileSystem.cs (977.00 B, 2025-03-11 09:48:27)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: PhysicalFileSystem.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using test.Core.Interfaces;
â”‚   â”‚       â”‚    2 â”‚ using System;
â”‚   â”‚       â”‚    3 â”‚ using System.Collections.Generic;
â”‚   â”‚       â”‚    4 â”‚ using System.IO;
â”‚   â”‚       â”‚    5 â”‚ using System.Linq;
â”‚   â”‚       â”‚    6 â”‚ using System.Text;
â”‚   â”‚       â”‚    7 â”‚ using System.Threading.Tasks;
â”‚   â”‚       â”‚    8 â”‚ 
â”‚   â”‚       â”‚    9 â”‚ namespace test.Infrastructure.FileSystem
â”‚   â”‚       â”‚   10 â”‚ {
â”‚   â”‚       â”‚   11 â”‚     /// <summary>
â”‚   â”‚       â”‚   12 â”‚     /// Concrete implementation of IFileSystem that uses the physical file system
â”‚   â”‚       â”‚   13 â”‚     /// </summary>
â”‚   â”‚       â”‚   14 â”‚     public class PhysicalFileSystem : IFileSystem
â”‚   â”‚       â”‚   15 â”‚     {
â”‚   â”‚       â”‚   16 â”‚         public Task<string> ReadAllTextAsync(string path) => File.ReadAllTextAsync(path);
â”‚   â”‚       â”‚   17 â”‚         public Task WriteAllTextAsync(string path, string content) => File.WriteAllTextAsync(path, content);
â”‚   â”‚       â”‚   18 â”‚         public bool FileExists(string path) => File.Exists(path);
â”‚   â”‚       â”‚   19 â”‚         public Stream OpenRead(string path) => File.OpenRead(path);
â”‚   â”‚       â”‚   20 â”‚         public Stream OpenWrite(string path) => File.OpenWrite(path);
â”‚   â”‚       â”‚   21 â”‚         public void CreateDirectory(string path) => Directory.CreateDirectory(path);
â”‚   â”‚       â”‚   22 â”‚         public bool DirectoryExists(string path) => Directory.Exists(path);
â”‚   â”‚       â”‚   23 â”‚     }
â”‚   â”‚       â”‚   24 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   ğŸ“ Logging
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ApplicationErrorHandler.cs (4.22 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ApplicationErrorHandler.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using test.Core.Exceptions;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    7 â”‚ using System.IO;
â”‚   â”‚   â”‚   â”‚    8 â”‚ 
â”‚   â”‚   â”‚   â”‚    9 â”‚ namespace test.Infrastructure.Logging
â”‚   â”‚   â”‚   â”‚   10 â”‚ {
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// Implementation of the error handler that logs errors and shows UI notifications
â”‚   â”‚   â”‚   â”‚   13 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   14 â”‚     public class ApplicationErrorHandler : IErrorHandler
â”‚   â”‚   â”‚   â”‚   15 â”‚     {
â”‚   â”‚   â”‚   â”‚   16 â”‚         private readonly ILogger<ApplicationErrorHandler> _logger;
â”‚   â”‚   â”‚   â”‚   17 â”‚         private readonly IDialogService _dialogService;
â”‚   â”‚   â”‚   â”‚   18 â”‚ 
â”‚   â”‚   â”‚   â”‚   19 â”‚         public ApplicationErrorHandler(
â”‚   â”‚   â”‚   â”‚   20 â”‚             ILogger<ApplicationErrorHandler> logger,
â”‚   â”‚   â”‚   â”‚   21 â”‚             IDialogService dialogService)
â”‚   â”‚   â”‚   â”‚   22 â”‚         {
â”‚   â”‚   â”‚   â”‚   23 â”‚             _logger = logger;
â”‚   â”‚   â”‚   â”‚   24 â”‚             _dialogService = dialogService;
â”‚   â”‚   â”‚   â”‚   25 â”‚         }
â”‚   â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   â”‚   27 â”‚         public void HandleException(Exception ex, string context)
â”‚   â”‚   â”‚   â”‚   28 â”‚         {
â”‚   â”‚   â”‚   â”‚   29 â”‚             // Log based on exception type
â”‚   â”‚   â”‚   â”‚   30 â”‚             switch (ex)
â”‚   â”‚   â”‚   â”‚   31 â”‚             {
â”‚   â”‚   â”‚   â”‚   32 â”‚                 case BusinessRuleException:
â”‚   â”‚   â”‚   â”‚   33 â”‚                     _logger.LogWarning(ex, "Business rule violation in {Context}: {Message}",
â”‚   â”‚   â”‚   â”‚   34 â”‚                         context, ex.Message);
â”‚   â”‚   â”‚   â”‚   35 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   â”‚   37 â”‚                 case NotFoundException notFoundEx:
â”‚   â”‚   â”‚   â”‚   38 â”‚                     _logger.LogInformation(ex, "Not found in {Context}: {EntityType} {EntityId}",
â”‚   â”‚   â”‚   â”‚   39 â”‚                         context, notFoundEx.EntityType, notFoundEx.EntityId);
â”‚   â”‚   â”‚   â”‚   40 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   â”‚   42 â”‚                 case ParsingException parsingEx:
â”‚   â”‚   â”‚   â”‚   43 â”‚                     _logger.LogError(ex, "Parsing error in {Context} for file {FilePath} ({FileType}): {Message}",
â”‚   â”‚   â”‚   â”‚   44 â”‚                         context, parsingEx.FilePath, parsingEx.FileType, ex.Message);
â”‚   â”‚   â”‚   â”‚   45 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   46 â”‚ 
â”‚   â”‚   â”‚   â”‚   47 â”‚                 case DataAccessException dataEx:
â”‚   â”‚   â”‚   â”‚   48 â”‚                     _logger.LogError(ex, "Data access error in {Context}, operation: {Operation}, entity: {EntityType}: {Message}",
â”‚   â”‚   â”‚   â”‚   49 â”‚                         context, dataEx.Operation, dataEx.EntityType, ex.Message);
â”‚   â”‚   â”‚   â”‚   50 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   51 â”‚ 
â”‚   â”‚   â”‚   â”‚   52 â”‚                 default:
â”‚   â”‚   â”‚   â”‚   53 â”‚                     _logger.LogError(ex, "Unexpected error in {Context}: {Message}",
â”‚   â”‚   â”‚   â”‚   54 â”‚                         context, ex.Message);
â”‚   â”‚   â”‚   â”‚   55 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   56 â”‚             }
â”‚   â”‚   â”‚   â”‚   57 â”‚         }
â”‚   â”‚   â”‚   â”‚   58 â”‚ 
â”‚   â”‚   â”‚   â”‚   59 â”‚         public async Task HandleExceptionWithUIAsync(Exception ex, string context)
â”‚   â”‚   â”‚   â”‚   60 â”‚         {
â”‚   â”‚   â”‚   â”‚   61 â”‚             // Log first
â”‚   â”‚   â”‚   â”‚   62 â”‚             HandleException(ex, context);
â”‚   â”‚   â”‚   â”‚   63 â”‚ 
â”‚   â”‚   â”‚   â”‚   64 â”‚             // Then show UI based on exception type
â”‚   â”‚   â”‚   â”‚   65 â”‚             switch (ex)
â”‚   â”‚   â”‚   â”‚   66 â”‚             {
â”‚   â”‚   â”‚   â”‚   67 â”‚                 case BusinessRuleException:
â”‚   â”‚   â”‚   â”‚   68 â”‚                     await _dialogService.ShowErrorDialogAsync(
â”‚   â”‚   â”‚   â”‚   69 â”‚                         "Business Rule Violation",
â”‚   â”‚   â”‚   â”‚   70 â”‚                         ex.Message);
â”‚   â”‚   â”‚   â”‚   71 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   â”‚   73 â”‚                 case NotFoundException:
â”‚   â”‚   â”‚   â”‚   74 â”‚                     await _dialogService.ShowErrorDialogAsync(
â”‚   â”‚   â”‚   â”‚   75 â”‚                         "Not Found",
â”‚   â”‚   â”‚   â”‚   76 â”‚                         ex.Message);
â”‚   â”‚   â”‚   â”‚   77 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   78 â”‚ 
â”‚   â”‚   â”‚   â”‚   79 â”‚                 case ParsingException parsingEx:
â”‚   â”‚   â”‚   â”‚   80 â”‚                     await _dialogService.ShowErrorDialogAsync(
â”‚   â”‚   â”‚   â”‚   81 â”‚                         "Parsing Error",
â”‚   â”‚   â”‚   â”‚   82 â”‚                         $"Error parsing file '{Path.GetFileName(parsingEx.FilePath)}':\n\n{ex.Message}");
â”‚   â”‚   â”‚   â”‚   83 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   84 â”‚ 
â”‚   â”‚   â”‚   â”‚   85 â”‚                 case DataAccessException:
â”‚   â”‚   â”‚   â”‚   86 â”‚                     await _dialogService.ShowErrorDialogAsync(
â”‚   â”‚   â”‚   â”‚   87 â”‚                         "Data Access Error",
â”‚   â”‚   â”‚   â”‚   88 â”‚                         $"A data access error occurred:\n\n{ex.Message}");
â”‚   â”‚   â”‚   â”‚   89 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   90 â”‚ 
â”‚   â”‚   â”‚   â”‚   91 â”‚                 default:
â”‚   â”‚   â”‚   â”‚   92 â”‚                     await _dialogService.ShowErrorDialogAsync(
â”‚   â”‚   â”‚   â”‚   93 â”‚                         "Error",
â”‚   â”‚   â”‚   â”‚   94 â”‚                         $"An unexpected error occurred:\n\n{ex.Message}");
â”‚   â”‚   â”‚   â”‚   95 â”‚                     break;
â”‚   â”‚   â”‚   â”‚   96 â”‚             }
â”‚   â”‚   â”‚   â”‚   97 â”‚         }
â”‚   â”‚   â”‚   â”‚   98 â”‚ 
â”‚   â”‚   â”‚   â”‚   99 â”‚         public void LogWarning(string message, string context)
â”‚   â”‚   â”‚   â”‚  100 â”‚         {
â”‚   â”‚   â”‚   â”‚  101 â”‚             _logger.LogWarning("{Message} in {Context}", message, context);
â”‚   â”‚   â”‚   â”‚  102 â”‚         }
â”‚   â”‚   â”‚   â”‚  103 â”‚ 
â”‚   â”‚   â”‚   â”‚  104 â”‚         public void TrackEvent(string name, IDictionary<string, string> properties = null)
â”‚   â”‚   â”‚   â”‚  105 â”‚         {
â”‚   â”‚   â”‚   â”‚  106 â”‚             var logProperties = properties != null
â”‚   â”‚   â”‚   â”‚  107 â”‚                 ? new Dictionary<string, string>(properties)
â”‚   â”‚   â”‚   â”‚  108 â”‚                 : new Dictionary<string, string>();
â”‚   â”‚   â”‚   â”‚  109 â”‚ 
â”‚   â”‚   â”‚   â”‚  110 â”‚             _logger.LogInformation("Event: {EventName}, Properties: {@Properties}",
â”‚   â”‚   â”‚   â”‚  111 â”‚                 name, logProperties);
â”‚   â”‚   â”‚   â”‚  112 â”‚         }
â”‚   â”‚   â”‚   â”‚  113 â”‚     }
â”‚   â”‚   â”‚   â”‚  114 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ErrorHandlingExtensions.cs (3.66 KB, 2025-03-11 09:48:27)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: ErrorHandlingExtensions.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using test.Core.Exceptions;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using System;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Diagnostics;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    7 â”‚ 
â”‚   â”‚   â”‚   â”‚    8 â”‚ namespace test.Infrastructure.Logging
â”‚   â”‚   â”‚   â”‚    9 â”‚ {
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Extensions for adding error handling capabilities to the application
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public static class ErrorHandlingExtensions
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   16 â”‚         /// Executes a function with error handling
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   18 â”‚         public static async Task<TResult> WithErrorHandlingAsync<TResult>(
â”‚   â”‚   â”‚   â”‚   19 â”‚             this IErrorHandler errorHandler,
â”‚   â”‚   â”‚   â”‚   20 â”‚             Func<Task<TResult>> func,
â”‚   â”‚   â”‚   â”‚   21 â”‚             string context,
â”‚   â”‚   â”‚   â”‚   22 â”‚             bool showUI = false)
â”‚   â”‚   â”‚   â”‚   23 â”‚         {
â”‚   â”‚   â”‚   â”‚   24 â”‚             try
â”‚   â”‚   â”‚   â”‚   25 â”‚             {
â”‚   â”‚   â”‚   â”‚   26 â”‚                 return await func();
â”‚   â”‚   â”‚   â”‚   27 â”‚             }
â”‚   â”‚   â”‚   â”‚   28 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚   29 â”‚             {
â”‚   â”‚   â”‚   â”‚   30 â”‚                 if (showUI)
â”‚   â”‚   â”‚   â”‚   31 â”‚                 {
â”‚   â”‚   â”‚   â”‚   32 â”‚                     await errorHandler.HandleExceptionWithUIAsync(ex, context);
â”‚   â”‚   â”‚   â”‚   33 â”‚                 }
â”‚   â”‚   â”‚   â”‚   34 â”‚                 else
â”‚   â”‚   â”‚   â”‚   35 â”‚                 {
â”‚   â”‚   â”‚   â”‚   36 â”‚                     errorHandler.HandleException(ex, context);
â”‚   â”‚   â”‚   â”‚   37 â”‚                 }
â”‚   â”‚   â”‚   â”‚   38 â”‚ 
â”‚   â”‚   â”‚   â”‚   39 â”‚                 // Re-throw domain exceptions, but wrap others
â”‚   â”‚   â”‚   â”‚   40 â”‚                 if (ex is DomainExceptionBase)
â”‚   â”‚   â”‚   â”‚   41 â”‚                 {
â”‚   â”‚   â”‚   â”‚   42 â”‚                     throw;
â”‚   â”‚   â”‚   â”‚   43 â”‚                 }
â”‚   â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   â”‚   45 â”‚                 throw new ApplicationException($"Error in {context}: {ex.Message}", ex);
â”‚   â”‚   â”‚   â”‚   46 â”‚             }
â”‚   â”‚   â”‚   â”‚   47 â”‚         }
â”‚   â”‚   â”‚   â”‚   48 â”‚ 
â”‚   â”‚   â”‚   â”‚   49 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   50 â”‚         /// Executes an action with error handling
â”‚   â”‚   â”‚   â”‚   51 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   52 â”‚         public static async Task WithErrorHandlingAsync(
â”‚   â”‚   â”‚   â”‚   53 â”‚             this IErrorHandler errorHandler,
â”‚   â”‚   â”‚   â”‚   54 â”‚             Func<Task> action,
â”‚   â”‚   â”‚   â”‚   55 â”‚             string context,
â”‚   â”‚   â”‚   â”‚   56 â”‚             bool showUI = false)
â”‚   â”‚   â”‚   â”‚   57 â”‚         {
â”‚   â”‚   â”‚   â”‚   58 â”‚             try
â”‚   â”‚   â”‚   â”‚   59 â”‚             {
â”‚   â”‚   â”‚   â”‚   60 â”‚                 await action();
â”‚   â”‚   â”‚   â”‚   61 â”‚             }
â”‚   â”‚   â”‚   â”‚   62 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚   63 â”‚             {
â”‚   â”‚   â”‚   â”‚   64 â”‚                 if (showUI)
â”‚   â”‚   â”‚   â”‚   65 â”‚                 {
â”‚   â”‚   â”‚   â”‚   66 â”‚                     await errorHandler.HandleExceptionWithUIAsync(ex, context);
â”‚   â”‚   â”‚   â”‚   67 â”‚                 }
â”‚   â”‚   â”‚   â”‚   68 â”‚                 else
â”‚   â”‚   â”‚   â”‚   69 â”‚                 {
â”‚   â”‚   â”‚   â”‚   70 â”‚                     errorHandler.HandleException(ex, context);
â”‚   â”‚   â”‚   â”‚   71 â”‚                 }
â”‚   â”‚   â”‚   â”‚   72 â”‚ 
â”‚   â”‚   â”‚   â”‚   73 â”‚                 // Re-throw domain exceptions, but wrap others
â”‚   â”‚   â”‚   â”‚   74 â”‚                 if (ex is DomainExceptionBase)
â”‚   â”‚   â”‚   â”‚   75 â”‚                 {
â”‚   â”‚   â”‚   â”‚   76 â”‚                     throw;
â”‚   â”‚   â”‚   â”‚   77 â”‚                 }
â”‚   â”‚   â”‚   â”‚   78 â”‚ 
â”‚   â”‚   â”‚   â”‚   79 â”‚                 throw new ApplicationException($"Error in {context}: {ex.Message}", ex);
â”‚   â”‚   â”‚   â”‚   80 â”‚             }
â”‚   â”‚   â”‚   â”‚   81 â”‚         }
â”‚   â”‚   â”‚   â”‚   82 â”‚ 
â”‚   â”‚   â”‚   â”‚   83 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   84 â”‚         /// Adds operation timing and logging
â”‚   â”‚   â”‚   â”‚   85 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   86 â”‚         public static async Task<T> WithTimingAsync<T>(
â”‚   â”‚   â”‚   â”‚   87 â”‚             this IErrorHandler errorHandler,
â”‚   â”‚   â”‚   â”‚   88 â”‚             Func<Task<T>> func,
â”‚   â”‚   â”‚   â”‚   89 â”‚             string operationName)
â”‚   â”‚   â”‚   â”‚   90 â”‚         {
â”‚   â”‚   â”‚   â”‚   91 â”‚             var stopwatch = Stopwatch.StartNew();
â”‚   â”‚   â”‚   â”‚   92 â”‚ 
â”‚   â”‚   â”‚   â”‚   93 â”‚             try
â”‚   â”‚   â”‚   â”‚   94 â”‚             {
â”‚   â”‚   â”‚   â”‚   95 â”‚                 var result = await func();
â”‚   â”‚   â”‚   â”‚   96 â”‚                 stopwatch.Stop();
â”‚   â”‚   â”‚   â”‚   97 â”‚ 
â”‚   â”‚   â”‚   â”‚   98 â”‚                 errorHandler.TrackEvent("OperationTiming", new Dictionary<string, string>
â”‚   â”‚   â”‚   â”‚   99 â”‚                 {
â”‚   â”‚   â”‚   â”‚  100 â”‚                     ["Operation"] = operationName,
â”‚   â”‚   â”‚   â”‚  101 â”‚                     ["DurationMs"] = stopwatch.ElapsedMilliseconds.ToString(),
â”‚   â”‚   â”‚   â”‚  102 â”‚                     ["Success"] = "true"
â”‚   â”‚   â”‚   â”‚  103 â”‚                 });
â”‚   â”‚   â”‚   â”‚  104 â”‚ 
â”‚   â”‚   â”‚   â”‚  105 â”‚                 return result;
â”‚   â”‚   â”‚   â”‚  106 â”‚             }
â”‚   â”‚   â”‚   â”‚  107 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   â”‚  108 â”‚             {
â”‚   â”‚   â”‚   â”‚  109 â”‚                 stopwatch.Stop();
â”‚   â”‚   â”‚   â”‚  110 â”‚ 
â”‚   â”‚   â”‚   â”‚  111 â”‚                 errorHandler.TrackEvent("OperationTiming", new Dictionary<string, string>
â”‚   â”‚   â”‚   â”‚  112 â”‚                 {
â”‚   â”‚   â”‚   â”‚  113 â”‚                     ["Operation"] = operationName,
â”‚   â”‚   â”‚   â”‚  114 â”‚                     ["DurationMs"] = stopwatch.ElapsedMilliseconds.ToString(),
â”‚   â”‚   â”‚   â”‚  115 â”‚                     ["Success"] = "false",
â”‚   â”‚   â”‚   â”‚  116 â”‚                     ["ExceptionType"] = ex.GetType().Name
â”‚   â”‚   â”‚   â”‚  117 â”‚                 });
â”‚   â”‚   â”‚   â”‚  118 â”‚ 
â”‚   â”‚   â”‚   â”‚  119 â”‚                 throw;
â”‚   â”‚   â”‚   â”‚  120 â”‚             }
â”‚   â”‚   â”‚   â”‚  121 â”‚         }
â”‚   â”‚   â”‚   â”‚  122 â”‚     }
â”‚   â”‚   â”‚   â”‚  123 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ LoggingService.cs (5.31 KB, 2025-03-12 14:30:48)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: LoggingService.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚   â”‚       â”‚    2 â”‚ using Serilog;
â”‚   â”‚       â”‚    3 â”‚ using Serilog.Core;
â”‚   â”‚       â”‚    4 â”‚ using Serilog.Events;
â”‚   â”‚       â”‚    5 â”‚ using System;
â”‚   â”‚       â”‚    6 â”‚ using System.IO;
â”‚   â”‚       â”‚    7 â”‚ using test.Core.Interfaces;
â”‚   â”‚       â”‚    8 â”‚ 
â”‚   â”‚       â”‚    9 â”‚ namespace test.Infrastructure.Logging
â”‚   â”‚       â”‚   10 â”‚ {
â”‚   â”‚       â”‚   11 â”‚     public class LoggingService : ILoggingService, IDisposable
â”‚   â”‚       â”‚   12 â”‚     {
â”‚   â”‚       â”‚   13 â”‚         private readonly string _logDirectory;
â”‚   â”‚       â”‚   14 â”‚         private bool _isEnabled;
â”‚   â”‚       â”‚   15 â”‚         private readonly ILogger<LoggingService> _logger;
â”‚   â”‚       â”‚   16 â”‚         private LogEventLevel _currentLevel = LogEventLevel.Information;
â”‚   â”‚       â”‚   17 â”‚         private bool _disposed;
â”‚   â”‚       â”‚   18 â”‚ 
â”‚   â”‚       â”‚   19 â”‚         public bool IsLoggingEnabled => _isEnabled;
â”‚   â”‚       â”‚   20 â”‚ 
â”‚   â”‚       â”‚   21 â”‚         public string LogFilePath { get; private set; }
â”‚   â”‚       â”‚   22 â”‚ 
â”‚   â”‚       â”‚   23 â”‚         public LoggingService(ILogger<LoggingService> logger)
â”‚   â”‚       â”‚   24 â”‚         {
â”‚   â”‚       â”‚   25 â”‚             _logger = logger;
â”‚   â”‚       â”‚   26 â”‚             _logDirectory = Path.Combine(
â”‚   â”‚       â”‚   27 â”‚                 Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
â”‚   â”‚       â”‚   28 â”‚                 "PaapeConversionKit",
â”‚   â”‚       â”‚   29 â”‚                 "Logs"
â”‚   â”‚       â”‚   30 â”‚             );
â”‚   â”‚       â”‚   31 â”‚ 
â”‚   â”‚       â”‚   32 â”‚             // Ensure the log directory exists
â”‚   â”‚       â”‚   33 â”‚             Directory.CreateDirectory(_logDirectory);
â”‚   â”‚       â”‚   34 â”‚ 
â”‚   â”‚       â”‚   35 â”‚             // Set the log file path - using date in filename for daily rolling
â”‚   â”‚       â”‚   36 â”‚             LogFilePath = Path.Combine(_logDirectory, $"app_{DateTime.Now:yyyyMMdd}.log");
â”‚   â”‚       â”‚   37 â”‚ 
â”‚   â”‚       â”‚   38 â”‚             _logger?.LogDebug("LoggingService initialized. Path: {LogFilePath}", LogFilePath);
â”‚   â”‚       â”‚   39 â”‚ 
â”‚   â”‚       â”‚   40 â”‚             // Initialize the global logger with just console and debug (file will be added when enabled)
â”‚   â”‚       â”‚   41 â”‚             ReconfigureGlobalLogger(false);
â”‚   â”‚       â”‚   42 â”‚         }
â”‚   â”‚       â”‚   43 â”‚ 
â”‚   â”‚       â”‚   44 â”‚         public void EnableLogging(bool enable)
â”‚   â”‚       â”‚   45 â”‚         {
â”‚   â”‚       â”‚   46 â”‚             try
â”‚   â”‚       â”‚   47 â”‚             {
â”‚   â”‚       â”‚   48 â”‚                 if (enable == _isEnabled)
â”‚   â”‚       â”‚   49 â”‚                 {
â”‚   â”‚       â”‚   50 â”‚                     // No change in state, just return
â”‚   â”‚       â”‚   51 â”‚                     return;
â”‚   â”‚       â”‚   52 â”‚                 }
â”‚   â”‚       â”‚   53 â”‚ 
â”‚   â”‚       â”‚   54 â”‚                 _isEnabled = enable;
â”‚   â”‚       â”‚   55 â”‚ 
â”‚   â”‚       â”‚   56 â”‚                 // Reconfigure the global logger based on the enabled state
â”‚   â”‚       â”‚   57 â”‚                 ReconfigureGlobalLogger(_isEnabled);
â”‚   â”‚       â”‚   58 â”‚ 
â”‚   â”‚       â”‚   59 â”‚                 if (enable)
â”‚   â”‚       â”‚   60 â”‚                 {
â”‚   â”‚       â”‚   61 â”‚                     Log.Information("Logging enabled at {Timestamp}", DateTime.Now);
â”‚   â”‚       â”‚   62 â”‚                     _logger?.LogInformation("Logging enabled");
â”‚   â”‚       â”‚   63 â”‚                 }
â”‚   â”‚       â”‚   64 â”‚                 else
â”‚   â”‚       â”‚   65 â”‚                 {
â”‚   â”‚       â”‚   66 â”‚                     _logger?.LogInformation("Logging disabled");
â”‚   â”‚       â”‚   67 â”‚                 }
â”‚   â”‚       â”‚   68 â”‚             }
â”‚   â”‚       â”‚   69 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚   70 â”‚             {
â”‚   â”‚       â”‚   71 â”‚                 _logger?.LogError(ex, "Error while {Action} logging", enable ? "enabling" : "disabling");
â”‚   â”‚       â”‚   72 â”‚                 Console.WriteLine($"Error {(enable ? "enabling" : "disabling")} logging: {ex.Message}");
â”‚   â”‚       â”‚   73 â”‚             }
â”‚   â”‚       â”‚   74 â”‚         }
â”‚   â”‚       â”‚   75 â”‚ 
â”‚   â”‚       â”‚   76 â”‚         public void SetLogLevel(LogEventLevel level)
â”‚   â”‚       â”‚   77 â”‚         {
â”‚   â”‚       â”‚   78 â”‚             try
â”‚   â”‚       â”‚   79 â”‚             {
â”‚   â”‚       â”‚   80 â”‚                 if (level == _currentLevel)
â”‚   â”‚       â”‚   81 â”‚                 {
â”‚   â”‚       â”‚   82 â”‚                     // No change in level, just return
â”‚   â”‚       â”‚   83 â”‚                     return;
â”‚   â”‚       â”‚   84 â”‚                 }
â”‚   â”‚       â”‚   85 â”‚ 
â”‚   â”‚       â”‚   86 â”‚                 _currentLevel = level;
â”‚   â”‚       â”‚   87 â”‚                 _logger?.LogInformation("Log level changed to {Level}", level);
â”‚   â”‚       â”‚   88 â”‚ 
â”‚   â”‚       â”‚   89 â”‚                 // Reconfigure the global logger with the new level
â”‚   â”‚       â”‚   90 â”‚                 ReconfigureGlobalLogger(_isEnabled);
â”‚   â”‚       â”‚   91 â”‚ 
â”‚   â”‚       â”‚   92 â”‚                 // Log directly to confirm level change
â”‚   â”‚       â”‚   93 â”‚                 Log.Write(level, "Log level changed to {Level}", level);
â”‚   â”‚       â”‚   94 â”‚             }
â”‚   â”‚       â”‚   95 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚   96 â”‚             {
â”‚   â”‚       â”‚   97 â”‚                 _logger?.LogError(ex, "Error while setting log level to {Level}", level);
â”‚   â”‚       â”‚   98 â”‚                 Console.WriteLine($"Error setting log level: {ex.Message}");
â”‚   â”‚       â”‚   99 â”‚             }
â”‚   â”‚       â”‚  100 â”‚         }
â”‚   â”‚       â”‚  101 â”‚ 
â”‚   â”‚       â”‚  102 â”‚         private void ReconfigureGlobalLogger(bool includeFileSink)
â”‚   â”‚       â”‚  103 â”‚         {
â”‚   â”‚       â”‚  104 â”‚             try
â”‚   â”‚       â”‚  105 â”‚             {
â”‚   â”‚       â”‚  106 â”‚                 // Start with a clean configuration
â”‚   â”‚       â”‚  107 â”‚                 var loggerConfig = new LoggerConfiguration()
â”‚   â”‚       â”‚  108 â”‚                     .MinimumLevel.Is(_currentLevel)
â”‚   â”‚       â”‚  109 â”‚                     .WriteTo.Console()
â”‚   â”‚       â”‚  110 â”‚                     .WriteTo.Debug();
â”‚   â”‚       â”‚  111 â”‚ 
â”‚   â”‚       â”‚  112 â”‚                 // Add file sink if logging is enabled
â”‚   â”‚       â”‚  113 â”‚                 if (includeFileSink)
â”‚   â”‚       â”‚  114 â”‚                 {
â”‚   â”‚       â”‚  115 â”‚                     loggerConfig = loggerConfig.WriteTo.File(
â”‚   â”‚       â”‚  116 â”‚                         LogFilePath,
â”‚   â”‚       â”‚  117 â”‚                         rollingInterval: RollingInterval.Day,
â”‚   â”‚       â”‚  118 â”‚                         outputTemplate: "{Timestamp:yyyy-MM-dd HH:mm:ss.fff} [{Level:u3}] {Message:lj}{NewLine}{Exception}",
â”‚   â”‚       â”‚  119 â”‚                         shared: true);
â”‚   â”‚       â”‚  120 â”‚                 }
â”‚   â”‚       â”‚  121 â”‚ 
â”‚   â”‚       â”‚  122 â”‚                 // Set the global logger
â”‚   â”‚       â”‚  123 â”‚                 Log.Logger = loggerConfig.CreateLogger();
â”‚   â”‚       â”‚  124 â”‚             }
â”‚   â”‚       â”‚  125 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  126 â”‚             {
â”‚   â”‚       â”‚  127 â”‚                 _logger?.LogError(ex, "Failed to reconfigure global logger");
â”‚   â”‚       â”‚  128 â”‚                 Console.WriteLine($"Error configuring logger: {ex.Message}");
â”‚   â”‚       â”‚  129 â”‚             }
â”‚   â”‚       â”‚  130 â”‚         }
â”‚   â”‚       â”‚  131 â”‚ 
â”‚   â”‚       â”‚  132 â”‚         public void Dispose()
â”‚   â”‚       â”‚  133 â”‚         {
â”‚   â”‚       â”‚  134 â”‚             Dispose(true);
â”‚   â”‚       â”‚  135 â”‚             GC.SuppressFinalize(this);
â”‚   â”‚       â”‚  136 â”‚         }
â”‚   â”‚       â”‚  137 â”‚ 
â”‚   â”‚       â”‚  138 â”‚         protected virtual void Dispose(bool disposing)
â”‚   â”‚       â”‚  139 â”‚         {
â”‚   â”‚       â”‚  140 â”‚             if (!_disposed)
â”‚   â”‚       â”‚  141 â”‚             {
â”‚   â”‚       â”‚  142 â”‚                 if (disposing)
â”‚   â”‚       â”‚  143 â”‚                 {
â”‚   â”‚       â”‚  144 â”‚                     try
â”‚   â”‚       â”‚  145 â”‚                     {
â”‚   â”‚       â”‚  146 â”‚                         // Log disposing and flush
â”‚   â”‚       â”‚  147 â”‚                         Log.Information("LoggingService disposing at {Time}", DateTime.Now);
â”‚   â”‚       â”‚  148 â”‚                         Log.CloseAndFlush();
â”‚   â”‚       â”‚  149 â”‚                     }
â”‚   â”‚       â”‚  150 â”‚                     catch
â”‚   â”‚       â”‚  151 â”‚                     {
â”‚   â”‚       â”‚  152 â”‚                         // Ignore errors during disposal
â”‚   â”‚       â”‚  153 â”‚                     }
â”‚   â”‚       â”‚  154 â”‚                 }
â”‚   â”‚       â”‚  155 â”‚ 
â”‚   â”‚       â”‚  156 â”‚                 _disposed = true;
â”‚   â”‚       â”‚  157 â”‚             }
â”‚   â”‚       â”‚  158 â”‚         }
â”‚   â”‚       â”‚  159 â”‚     }
â”‚   â”‚       â”‚  160 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   ğŸ“ Processing
â”‚   â”‚   â””â”€â”€ ğŸ“„ ByteCodeProcessor.cs (3.80 KB, 2025-03-11 15:29:48)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: ByteCodeProcessor.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚       â”‚    2 â”‚ using System.Text;
â”‚   â”‚       â”‚    3 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚       â”‚    4 â”‚ 
â”‚   â”‚       â”‚    5 â”‚ namespace test.Infrastructure.Processing
â”‚   â”‚       â”‚    6 â”‚ {
â”‚   â”‚       â”‚    7 â”‚     /// <summary>
â”‚   â”‚       â”‚    8 â”‚     /// Utility class for processing ByteCode in controller objects
â”‚   â”‚       â”‚    9 â”‚     /// </summary>
â”‚   â”‚       â”‚   10 â”‚     public class ByteCodeProcessor
â”‚   â”‚       â”‚   11 â”‚     {
â”‚   â”‚       â”‚   12 â”‚         private readonly ILogger<ByteCodeProcessor> _logger;
â”‚   â”‚       â”‚   13 â”‚ 
â”‚   â”‚       â”‚   14 â”‚         public ByteCodeProcessor(ILogger<ByteCodeProcessor> logger)
â”‚   â”‚       â”‚   15 â”‚         {
â”‚   â”‚       â”‚   16 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚   â”‚       â”‚   17 â”‚         }
â”‚   â”‚       â”‚   18 â”‚ 
â”‚   â”‚       â”‚   19 â”‚         /// <summary>
â”‚   â”‚       â”‚   20 â”‚         /// Processes ByteCode by cleaning and normalizing it
â”‚   â”‚       â”‚   21 â”‚         /// </summary>
â”‚   â”‚       â”‚   22 â”‚         /// <param name="byteCode">The raw ByteCode to process</param>
â”‚   â”‚       â”‚   23 â”‚         /// <returns>Processed ByteCode or empty string if input is null or processing fails</returns>
â”‚   â”‚       â”‚   24 â”‚         public string ProcessByteCode(string byteCode)
â”‚   â”‚       â”‚   25 â”‚         {
â”‚   â”‚       â”‚   26 â”‚             if (string.IsNullOrEmpty(byteCode))
â”‚   â”‚       â”‚   27 â”‚             {
â”‚   â”‚       â”‚   28 â”‚                 return string.Empty;
â”‚   â”‚       â”‚   29 â”‚             }
â”‚   â”‚       â”‚   30 â”‚ 
â”‚   â”‚       â”‚   31 â”‚             try
â”‚   â”‚       â”‚   32 â”‚             {
â”‚   â”‚       â”‚   33 â”‚                 // Log large ByteCode for debugging
â”‚   â”‚       â”‚   34 â”‚                 if (byteCode.Length > 50000)
â”‚   â”‚       â”‚   35 â”‚                 {
â”‚   â”‚       â”‚   36 â”‚                     _logger.LogDebug("Processing large ByteCode, size: {ByteCodeLength} chars", byteCode.Length);
â”‚   â”‚       â”‚   37 â”‚                 }
â”‚   â”‚       â”‚   38 â”‚ 
â”‚   â”‚       â”‚   39 â”‚                 // Optimize string processing by reducing allocations
â”‚   â”‚       â”‚   40 â”‚                 var sb = new StringBuilder(byteCode.Length);
â”‚   â”‚       â”‚   41 â”‚ 
â”‚   â”‚       â”‚   42 â”‚                 // Process in one pass to reduce allocations
â”‚   â”‚       â”‚   43 â”‚                 foreach (var c in byteCode)
â”‚   â”‚       â”‚   44 â”‚                 {
â”‚   â”‚       â”‚   45 â”‚                     if (c == '\r')
â”‚   â”‚       â”‚   46 â”‚                     {
â”‚   â”‚       â”‚   47 â”‚                         // Skip carriage returns as we'll normalize to just newlines
â”‚   â”‚       â”‚   48 â”‚                         continue;
â”‚   â”‚       â”‚   49 â”‚                     }
â”‚   â”‚       â”‚   50 â”‚                     if (!char.IsControl(c) || c == '\n')
â”‚   â”‚       â”‚   51 â”‚                     {
â”‚   â”‚       â”‚   52 â”‚                         sb.Append(c);
â”‚   â”‚       â”‚   53 â”‚                     }
â”‚   â”‚       â”‚   54 â”‚                 }
â”‚   â”‚       â”‚   55 â”‚ 
â”‚   â”‚       â”‚   56 â”‚                 // Remove BOM and zero-width space at beginning and end
â”‚   â”‚       â”‚   57 â”‚                 var result = sb.ToString();
â”‚   â”‚       â”‚   58 â”‚                 if (result.Length > 0)
â”‚   â”‚       â”‚   59 â”‚                 {
â”‚   â”‚       â”‚   60 â”‚                     if (result[0] == '\uFEFF' || result[0] == '\u200B')
â”‚   â”‚       â”‚   61 â”‚                     {
â”‚   â”‚       â”‚   62 â”‚                         result = result.Substring(1);
â”‚   â”‚       â”‚   63 â”‚                     }
â”‚   â”‚       â”‚   64 â”‚                     if (result.Length > 0 && (result[result.Length - 1] == '\uFEFF' || result[result.Length - 1] == '\u200B'))
â”‚   â”‚       â”‚   65 â”‚                     {
â”‚   â”‚       â”‚   66 â”‚                         result = result.Substring(0, result.Length - 1);
â”‚   â”‚       â”‚   67 â”‚                     }
â”‚   â”‚       â”‚   68 â”‚                 }
â”‚   â”‚       â”‚   69 â”‚ 
â”‚   â”‚       â”‚   70 â”‚                 // Log processing results for large ByteCode
â”‚   â”‚       â”‚   71 â”‚                 if (byteCode.Length > 50000)
â”‚   â”‚       â”‚   72 â”‚                 {
â”‚   â”‚       â”‚   73 â”‚                     _logger.LogDebug("Finished processing large ByteCode, original size: {OriginalSize}, new size: {NewSize}",
â”‚   â”‚       â”‚   74 â”‚                         byteCode.Length, result.Length);
â”‚   â”‚       â”‚   75 â”‚                 }
â”‚   â”‚       â”‚   76 â”‚ 
â”‚   â”‚       â”‚   77 â”‚                 return string.IsNullOrEmpty(result) ? string.Empty : result;
â”‚   â”‚       â”‚   78 â”‚             }
â”‚   â”‚       â”‚   79 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚   80 â”‚             {
â”‚   â”‚       â”‚   81 â”‚                 _logger.LogError(ex, "Error processing ByteCode: {ErrorMessage}", ex.Message);
â”‚   â”‚       â”‚   82 â”‚                 // Return empty string on error rather than crashing
â”‚   â”‚       â”‚   83 â”‚                 return string.Empty;
â”‚   â”‚       â”‚   84 â”‚             }
â”‚   â”‚       â”‚   85 â”‚         }
â”‚   â”‚       â”‚   86 â”‚ 
â”‚   â”‚       â”‚   87 â”‚         /// <summary>
â”‚   â”‚       â”‚   88 â”‚         /// Checks if the given object type is a ByteCode type
â”‚   â”‚       â”‚   89 â”‚         /// </summary>
â”‚   â”‚       â”‚   90 â”‚         /// <param name="objectType">The object type to check</param>
â”‚   â”‚       â”‚   91 â”‚         /// <returns>True if it's a ByteCode type, false otherwise</returns>
â”‚   â”‚       â”‚   92 â”‚         public static bool IsByteCodeType(string objectType)
â”‚   â”‚       â”‚   93 â”‚         {
â”‚   â”‚       â”‚   94 â”‚             if (string.IsNullOrEmpty(objectType))
â”‚   â”‚       â”‚   95 â”‚                 return false;
â”‚   â”‚       â”‚   96 â”‚ 
â”‚   â”‚       â”‚   97 â”‚             // Standard ByteCode types
â”‚   â”‚       â”‚   98 â”‚             return objectType.Equals("InfinityProgram", StringComparison.OrdinalIgnoreCase) ||
â”‚   â”‚       â”‚   99 â”‚                    objectType.Equals("InfinityFunction", StringComparison.OrdinalIgnoreCase);
â”‚   â”‚       â”‚  100 â”‚         }
â”‚   â”‚       â”‚  101 â”‚     }
â”‚   â”‚       â”‚  102 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   ğŸ“ UI
â”‚   â”‚   â”‚   ğŸ“ Converters
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ BoolToMarginConverter.cs (2.08 KB, 2025-03-12 07:55:51)
â”‚   â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚       â”‚ FILE CONTENT: BoolToMarginConverter.cs
â”‚   â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚       â”‚    1 â”‚ ï»¿using Avalonia;
â”‚   â”‚   â”‚       â”‚    2 â”‚ using Avalonia.Data.Converters;
â”‚   â”‚   â”‚       â”‚    3 â”‚ using System;
â”‚   â”‚   â”‚       â”‚    4 â”‚ using System.Globalization;
â”‚   â”‚   â”‚       â”‚    5 â”‚ 
â”‚   â”‚   â”‚       â”‚    6 â”‚ namespace test.Infrastructure.UI.Converters
â”‚   â”‚   â”‚       â”‚    7 â”‚ {
â”‚   â”‚   â”‚       â”‚    8 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚    9 â”‚     /// Converts a boolean value to a margin
â”‚   â”‚   â”‚       â”‚   10 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   11 â”‚     public class BoolToMarginConverter : IValueConverter
â”‚   â”‚   â”‚       â”‚   12 â”‚     {
â”‚   â”‚   â”‚       â”‚   13 â”‚         public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
â”‚   â”‚   â”‚       â”‚   14 â”‚         {
â”‚   â”‚   â”‚       â”‚   15 â”‚             return (bool)value ? new Thickness(250, 0, 0, 0) : new Thickness(50, 0, 0, 0);
â”‚   â”‚   â”‚       â”‚   16 â”‚         }
â”‚   â”‚   â”‚       â”‚   17 â”‚ 
â”‚   â”‚   â”‚       â”‚   18 â”‚         public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
â”‚   â”‚   â”‚       â”‚   19 â”‚         {
â”‚   â”‚   â”‚       â”‚   20 â”‚             throw new NotImplementedException();
â”‚   â”‚   â”‚       â”‚   21 â”‚         }
â”‚   â”‚   â”‚       â”‚   22 â”‚     }
â”‚   â”‚   â”‚       â”‚   23 â”‚ 
â”‚   â”‚   â”‚       â”‚   24 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   25 â”‚     /// Converts a boolean value to a prefix/suffix string
â”‚   â”‚   â”‚       â”‚   26 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   27 â”‚     public class BoolToPrefixSuffixConverter : IValueConverter
â”‚   â”‚   â”‚       â”‚   28 â”‚     {
â”‚   â”‚   â”‚       â”‚   29 â”‚         public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
â”‚   â”‚   â”‚       â”‚   30 â”‚         {
â”‚   â”‚   â”‚       â”‚   31 â”‚             if (value is bool isPrefix)
â”‚   â”‚   â”‚       â”‚   32 â”‚             {
â”‚   â”‚   â”‚       â”‚   33 â”‚                 return isPrefix ? "(Prefix)" : "(Suffix)";
â”‚   â”‚   â”‚       â”‚   34 â”‚             }
â”‚   â”‚   â”‚       â”‚   35 â”‚             return "(Suffix)";
â”‚   â”‚   â”‚       â”‚   36 â”‚         }
â”‚   â”‚   â”‚       â”‚   37 â”‚ 
â”‚   â”‚   â”‚       â”‚   38 â”‚         public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
â”‚   â”‚   â”‚       â”‚   39 â”‚         {
â”‚   â”‚   â”‚       â”‚   40 â”‚             if (value is string strValue)
â”‚   â”‚   â”‚       â”‚   41 â”‚             {
â”‚   â”‚   â”‚       â”‚   42 â”‚                 return strValue.Contains("Prefix", StringComparison.OrdinalIgnoreCase);
â”‚   â”‚   â”‚       â”‚   43 â”‚             }
â”‚   â”‚   â”‚       â”‚   44 â”‚             return false;
â”‚   â”‚   â”‚       â”‚   45 â”‚         }
â”‚   â”‚   â”‚       â”‚   46 â”‚     }
â”‚   â”‚   â”‚       â”‚   47 â”‚ 
â”‚   â”‚   â”‚       â”‚   48 â”‚     /// <summary>
â”‚   â”‚   â”‚       â”‚   49 â”‚     /// Subtracts an offset from a number
â”‚   â”‚   â”‚       â”‚   50 â”‚     /// </summary>
â”‚   â”‚   â”‚       â”‚   51 â”‚     public class NumberLessOffsetConverter : IValueConverter
â”‚   â”‚   â”‚       â”‚   52 â”‚     {
â”‚   â”‚   â”‚       â”‚   53 â”‚         public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
â”‚   â”‚   â”‚       â”‚   54 â”‚         {
â”‚   â”‚   â”‚       â”‚   55 â”‚             if (value is double width && parameter is string offset)
â”‚   â”‚   â”‚       â”‚   56 â”‚             {
â”‚   â”‚   â”‚       â”‚   57 â”‚                 return width - double.Parse(offset);
â”‚   â”‚   â”‚       â”‚   58 â”‚             }
â”‚   â”‚   â”‚       â”‚   59 â”‚             return value;
â”‚   â”‚   â”‚       â”‚   60 â”‚         }
â”‚   â”‚   â”‚       â”‚   61 â”‚ 
â”‚   â”‚   â”‚       â”‚   62 â”‚         public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
â”‚   â”‚   â”‚       â”‚   63 â”‚         {
â”‚   â”‚   â”‚       â”‚   64 â”‚             throw new NotImplementedException();
â”‚   â”‚   â”‚       â”‚   65 â”‚         }
â”‚   â”‚   â”‚       â”‚   66 â”‚     }
â”‚   â”‚   â”‚       â”‚   67 â”‚ }
â”‚   â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AvaloniaDialogService.cs (6.08 KB, 2025-03-12 11:30:34)
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚ FILE CONTENT: AvaloniaDialogService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚   â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚   â”‚   â”‚   â”‚    2 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚   â”‚    3 â”‚ using test.Views;
â”‚   â”‚   â”‚   â”‚    4 â”‚ using SukiUI.Controls;
â”‚   â”‚   â”‚   â”‚    5 â”‚ using System.Collections.Generic;
â”‚   â”‚   â”‚   â”‚    6 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚   â”‚    7 â”‚ 
â”‚   â”‚   â”‚   â”‚    8 â”‚ namespace test.Infrastructure.UI
â”‚   â”‚   â”‚   â”‚    9 â”‚ {
â”‚   â”‚   â”‚   â”‚   10 â”‚     /// <summary>
â”‚   â”‚   â”‚   â”‚   11 â”‚     /// Avalonia implementation of the dialog service
â”‚   â”‚   â”‚   â”‚   12 â”‚     /// </summary>
â”‚   â”‚   â”‚   â”‚   13 â”‚     public class AvaloniaDialogService : IDialogService
â”‚   â”‚   â”‚   â”‚   14 â”‚     {
â”‚   â”‚   â”‚   â”‚   15 â”‚         private readonly Window _mainWindow;
â”‚   â”‚   â”‚   â”‚   16 â”‚ 
â”‚   â”‚   â”‚   â”‚   17 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   18 â”‚         /// Creates a new Avalonia dialog service
â”‚   â”‚   â”‚   â”‚   19 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   20 â”‚         /// <param name="mainWindow">The main 
â”‚   â”‚   â”‚   â”‚   21 â”‚         /// window</param>
â”‚   â”‚   â”‚   â”‚   22 â”‚         public AvaloniaDialogService(Window mainWindow)
â”‚   â”‚   â”‚   â”‚   23 â”‚         {
â”‚   â”‚   â”‚   â”‚   24 â”‚             _mainWindow = mainWindow;
â”‚   â”‚   â”‚   â”‚   25 â”‚         }
â”‚   â”‚   â”‚   â”‚   26 â”‚ 
â”‚   â”‚   â”‚   â”‚   27 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   28 â”‚         /// Shows a file open dialog
â”‚   â”‚   â”‚   â”‚   29 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   30 â”‚         public async Task<string[]> ShowOpenFileDialogAsync(string title, IEnumerable<FileDialogFilter> filters, bool allowMultiple = false)
â”‚   â”‚   â”‚   â”‚   31 â”‚         {
â”‚   â”‚   â”‚   â”‚   32 â”‚             var dialog = new OpenFileDialog
â”‚   â”‚   â”‚   â”‚   33 â”‚             {
â”‚   â”‚   â”‚   â”‚   34 â”‚                 Title = title,
â”‚   â”‚   â”‚   â”‚   35 â”‚                 AllowMultiple = allowMultiple,
â”‚   â”‚   â”‚   â”‚   36 â”‚                 Filters = new List<FileDialogFilter>(filters)
â”‚   â”‚   â”‚   â”‚   37 â”‚             };
â”‚   â”‚   â”‚   â”‚   38 â”‚ 
â”‚   â”‚   â”‚   â”‚   39 â”‚             return await dialog.ShowAsync(_mainWindow);
â”‚   â”‚   â”‚   â”‚   40 â”‚         }
â”‚   â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   â”‚   42 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   43 â”‚         /// Shows a file save dialog
â”‚   â”‚   â”‚   â”‚   44 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   45 â”‚         public async Task<string> ShowSaveFileDialogAsync(string title, string defaultExtension, IEnumerable<FileDialogFilter> filters)
â”‚   â”‚   â”‚   â”‚   46 â”‚         {
â”‚   â”‚   â”‚   â”‚   47 â”‚             var dialog = new SaveFileDialog
â”‚   â”‚   â”‚   â”‚   48 â”‚             {
â”‚   â”‚   â”‚   â”‚   49 â”‚                 Title = title,
â”‚   â”‚   â”‚   â”‚   50 â”‚                 DefaultExtension = defaultExtension,
â”‚   â”‚   â”‚   â”‚   51 â”‚                 Filters = new List<FileDialogFilter>(filters)
â”‚   â”‚   â”‚   â”‚   52 â”‚             };
â”‚   â”‚   â”‚   â”‚   53 â”‚ 
â”‚   â”‚   â”‚   â”‚   54 â”‚             return await dialog.ShowAsync(_mainWindow);
â”‚   â”‚   â”‚   â”‚   55 â”‚         }
â”‚   â”‚   â”‚   â”‚   56 â”‚ 
â”‚   â”‚   â”‚   â”‚   57 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   58 â”‚         /// Shows a folder selection dialog
â”‚   â”‚   â”‚   â”‚   59 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   60 â”‚         public async Task<string> ShowOpenFolderDialogAsync(string title)
â”‚   â”‚   â”‚   â”‚   61 â”‚         {
â”‚   â”‚   â”‚   â”‚   62 â”‚             var dialog = new OpenFolderDialog
â”‚   â”‚   â”‚   â”‚   63 â”‚             {
â”‚   â”‚   â”‚   â”‚   64 â”‚                 Title = title
â”‚   â”‚   â”‚   â”‚   65 â”‚             };
â”‚   â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   â”‚   67 â”‚             return await dialog.ShowAsync(_mainWindow);
â”‚   â”‚   â”‚   â”‚   68 â”‚         }
â”‚   â”‚   â”‚   â”‚   69 â”‚ 
â”‚   â”‚   â”‚   â”‚   70 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚   71 â”‚         /// Shows a confirmation dialog
â”‚   â”‚   â”‚   â”‚   72 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚   73 â”‚         public async Task<bool> ShowConfirmDialogAsync(string title, string message)
â”‚   â”‚   â”‚   â”‚   74 â”‚         {
â”‚   â”‚   â”‚   â”‚   75 â”‚             var dialog = new SukiWindow
â”‚   â”‚   â”‚   â”‚   76 â”‚             {
â”‚   â”‚   â”‚   â”‚   77 â”‚                 Title = title,
â”‚   â”‚   â”‚   â”‚   78 â”‚                 Width = 400,
â”‚   â”‚   â”‚   â”‚   79 â”‚                 Height = 180,
â”‚   â”‚   â”‚   â”‚   80 â”‚                 WindowStartupLocation = WindowStartupLocation.CenterOwner
â”‚   â”‚   â”‚   â”‚   81 â”‚             };
â”‚   â”‚   â”‚   â”‚   82 â”‚ 
â”‚   â”‚   â”‚   â”‚   83 â”‚             var panel = new StackPanel { Margin = new Avalonia.Thickness(20) };
â”‚   â”‚   â”‚   â”‚   84 â”‚             panel.Children.Add(new TextBlock
â”‚   â”‚   â”‚   â”‚   85 â”‚             {
â”‚   â”‚   â”‚   â”‚   86 â”‚                 Text = message,
â”‚   â”‚   â”‚   â”‚   87 â”‚                 TextWrapping = Avalonia.Media.TextWrapping.Wrap,
â”‚   â”‚   â”‚   â”‚   88 â”‚                 Margin = new Avalonia.Thickness(0, 0, 0, 20)
â”‚   â”‚   â”‚   â”‚   89 â”‚             });
â”‚   â”‚   â”‚   â”‚   90 â”‚ 
â”‚   â”‚   â”‚   â”‚   91 â”‚             var buttonPanel = new StackPanel
â”‚   â”‚   â”‚   â”‚   92 â”‚             {
â”‚   â”‚   â”‚   â”‚   93 â”‚                 Orientation = Avalonia.Layout.Orientation.Horizontal,
â”‚   â”‚   â”‚   â”‚   94 â”‚                 HorizontalAlignment = Avalonia.Layout.HorizontalAlignment.Right,
â”‚   â”‚   â”‚   â”‚   95 â”‚                 Spacing = 10
â”‚   â”‚   â”‚   â”‚   96 â”‚             };
â”‚   â”‚   â”‚   â”‚   97 â”‚ 
â”‚   â”‚   â”‚   â”‚   98 â”‚             var cancelButton = new Button
â”‚   â”‚   â”‚   â”‚   99 â”‚             {
â”‚   â”‚   â”‚   â”‚  100 â”‚                 Content = "Cancel",
â”‚   â”‚   â”‚   â”‚  101 â”‚                 Classes = { "Basic" },
â”‚   â”‚   â”‚   â”‚  102 â”‚                 MinWidth = 80
â”‚   â”‚   â”‚   â”‚  103 â”‚             };
â”‚   â”‚   â”‚   â”‚  104 â”‚ 
â”‚   â”‚   â”‚   â”‚  105 â”‚             var confirmButton = new Button
â”‚   â”‚   â”‚   â”‚  106 â”‚             {
â”‚   â”‚   â”‚   â”‚  107 â”‚                 Content = "Confirm",
â”‚   â”‚   â”‚   â”‚  108 â”‚                 Classes = { "Accent" },
â”‚   â”‚   â”‚   â”‚  109 â”‚                 MinWidth = 80
â”‚   â”‚   â”‚   â”‚  110 â”‚             };
â”‚   â”‚   â”‚   â”‚  111 â”‚ 
â”‚   â”‚   â”‚   â”‚  112 â”‚             bool confirmed = false;
â”‚   â”‚   â”‚   â”‚  113 â”‚ 
â”‚   â”‚   â”‚   â”‚  114 â”‚             confirmButton.Click += (s, e) =>
â”‚   â”‚   â”‚   â”‚  115 â”‚             {
â”‚   â”‚   â”‚   â”‚  116 â”‚                 confirmed = true;
â”‚   â”‚   â”‚   â”‚  117 â”‚                 dialog.Close();
â”‚   â”‚   â”‚   â”‚  118 â”‚             };
â”‚   â”‚   â”‚   â”‚  119 â”‚ 
â”‚   â”‚   â”‚   â”‚  120 â”‚             cancelButton.Click += (s, e) =>
â”‚   â”‚   â”‚   â”‚  121 â”‚             {
â”‚   â”‚   â”‚   â”‚  122 â”‚                 dialog.Close();
â”‚   â”‚   â”‚   â”‚  123 â”‚             };
â”‚   â”‚   â”‚   â”‚  124 â”‚ 
â”‚   â”‚   â”‚   â”‚  125 â”‚             buttonPanel.Children.Add(cancelButton);
â”‚   â”‚   â”‚   â”‚  126 â”‚             buttonPanel.Children.Add(confirmButton);
â”‚   â”‚   â”‚   â”‚  127 â”‚             panel.Children.Add(buttonPanel);
â”‚   â”‚   â”‚   â”‚  128 â”‚ 
â”‚   â”‚   â”‚   â”‚  129 â”‚             dialog.Content = new GlassCard
â”‚   â”‚   â”‚   â”‚  130 â”‚             {
â”‚   â”‚   â”‚   â”‚  131 â”‚                 Content = panel,
â”‚   â”‚   â”‚   â”‚  132 â”‚                 Margin = new Avalonia.Thickness(10)
â”‚   â”‚   â”‚   â”‚  133 â”‚             };
â”‚   â”‚   â”‚   â”‚  134 â”‚ 
â”‚   â”‚   â”‚   â”‚  135 â”‚             await dialog.ShowDialog(_mainWindow);
â”‚   â”‚   â”‚   â”‚  136 â”‚             return confirmed;
â”‚   â”‚   â”‚   â”‚  137 â”‚         }
â”‚   â”‚   â”‚   â”‚  138 â”‚ 
â”‚   â”‚   â”‚   â”‚  139 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  140 â”‚         /// Shows an error dialog
â”‚   â”‚   â”‚   â”‚  141 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  142 â”‚         public async Task ShowErrorDialogAsync(string title, string message)
â”‚   â”‚   â”‚   â”‚  143 â”‚         {
â”‚   â”‚   â”‚   â”‚  144 â”‚             var dialog = new SukiWindow
â”‚   â”‚   â”‚   â”‚  145 â”‚             {
â”‚   â”‚   â”‚   â”‚  146 â”‚                 Title = title,
â”‚   â”‚   â”‚   â”‚  147 â”‚                 Width = 400,
â”‚   â”‚   â”‚   â”‚  148 â”‚                 Height = 180,
â”‚   â”‚   â”‚   â”‚  149 â”‚                 WindowStartupLocation = WindowStartupLocation.CenterOwner
â”‚   â”‚   â”‚   â”‚  150 â”‚             };
â”‚   â”‚   â”‚   â”‚  151 â”‚ 
â”‚   â”‚   â”‚   â”‚  152 â”‚             var panel = new StackPanel { Margin = new Avalonia.Thickness(20) };
â”‚   â”‚   â”‚   â”‚  153 â”‚             panel.Children.Add(new TextBlock
â”‚   â”‚   â”‚   â”‚  154 â”‚             {
â”‚   â”‚   â”‚   â”‚  155 â”‚                 Text = message,
â”‚   â”‚   â”‚   â”‚  156 â”‚                 TextWrapping = Avalonia.Media.TextWrapping.Wrap,
â”‚   â”‚   â”‚   â”‚  157 â”‚                 Margin = new Avalonia.Thickness(0, 0, 0, 20)
â”‚   â”‚   â”‚   â”‚  158 â”‚             });
â”‚   â”‚   â”‚   â”‚  159 â”‚ 
â”‚   â”‚   â”‚   â”‚  160 â”‚             var buttonPanel = new StackPanel
â”‚   â”‚   â”‚   â”‚  161 â”‚             {
â”‚   â”‚   â”‚   â”‚  162 â”‚                 Orientation = Avalonia.Layout.Orientation.Horizontal,
â”‚   â”‚   â”‚   â”‚  163 â”‚                 HorizontalAlignment = Avalonia.Layout.HorizontalAlignment.Right
â”‚   â”‚   â”‚   â”‚  164 â”‚             };
â”‚   â”‚   â”‚   â”‚  165 â”‚ 
â”‚   â”‚   â”‚   â”‚  166 â”‚             var okButton = new Button
â”‚   â”‚   â”‚   â”‚  167 â”‚             {
â”‚   â”‚   â”‚   â”‚  168 â”‚                 Content = "OK",
â”‚   â”‚   â”‚   â”‚  169 â”‚                 Classes = { "Accent" },
â”‚   â”‚   â”‚   â”‚  170 â”‚                 MinWidth = 80
â”‚   â”‚   â”‚   â”‚  171 â”‚             };
â”‚   â”‚   â”‚   â”‚  172 â”‚ 
â”‚   â”‚   â”‚   â”‚  173 â”‚             okButton.Click += (s, e) => dialog.Close();
â”‚   â”‚   â”‚   â”‚  174 â”‚             buttonPanel.Children.Add(okButton);
â”‚   â”‚   â”‚   â”‚  175 â”‚             panel.Children.Add(buttonPanel);
â”‚   â”‚   â”‚   â”‚  176 â”‚ 
â”‚   â”‚   â”‚   â”‚  177 â”‚             dialog.Content = new GlassCard
â”‚   â”‚   â”‚   â”‚  178 â”‚             {
â”‚   â”‚   â”‚   â”‚  179 â”‚                 Content = panel,
â”‚   â”‚   â”‚   â”‚  180 â”‚                 Margin = new Avalonia.Thickness(10)
â”‚   â”‚   â”‚   â”‚  181 â”‚             };
â”‚   â”‚   â”‚   â”‚  182 â”‚ 
â”‚   â”‚   â”‚   â”‚  183 â”‚             await dialog.ShowDialog(_mainWindow);
â”‚   â”‚   â”‚   â”‚  184 â”‚         }
â”‚   â”‚   â”‚   â”‚  185 â”‚ 
â”‚   â”‚   â”‚   â”‚  186 â”‚         /// <summary>
â”‚   â”‚   â”‚   â”‚  187 â”‚         /// Shows a text input dialog
â”‚   â”‚   â”‚   â”‚  188 â”‚         /// </summary>
â”‚   â”‚   â”‚   â”‚  189 â”‚         public async Task<string> ShowInputDialogAsync(string title, string message, string defaultValue = "")
â”‚   â”‚   â”‚   â”‚  190 â”‚         {
â”‚   â”‚   â”‚   â”‚  191 â”‚             var inputDialog = new TextInputDialog
â”‚   â”‚   â”‚   â”‚  192 â”‚             {
â”‚   â”‚   â”‚   â”‚  193 â”‚                 Title = title,
â”‚   â”‚   â”‚   â”‚  194 â”‚                 Message = message,
â”‚   â”‚   â”‚   â”‚  195 â”‚                 DefaultValue = defaultValue
â”‚   â”‚   â”‚   â”‚  196 â”‚             };
â”‚   â”‚   â”‚   â”‚  197 â”‚ 
â”‚   â”‚   â”‚   â”‚  198 â”‚             return await inputDialog.ShowAsync(_mainWindow);
â”‚   â”‚   â”‚   â”‚  199 â”‚         }
â”‚   â”‚   â”‚   â”‚  200 â”‚     }
â”‚   â”‚   â”‚   â”‚  201 â”‚ }
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â””â”€â”€ ğŸ“„ AvaloniaNavigationService.cs (9.87 KB, 2025-03-12 15:13:47)
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚ FILE CONTENT: AvaloniaNavigationService.cs
â”‚   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚       â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚   â”‚       â”‚    2 â”‚ using Avalonia.Threading;
â”‚   â”‚       â”‚    3 â”‚ using Microsoft.Extensions.DependencyInjection;
â”‚   â”‚       â”‚    4 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚       â”‚    5 â”‚ using System;
â”‚   â”‚       â”‚    6 â”‚ using System.Collections.Generic;
â”‚   â”‚       â”‚    7 â”‚ using test.Core.Interfaces;
â”‚   â”‚       â”‚    8 â”‚ using test.ViewModels;
â”‚   â”‚       â”‚    9 â”‚ using test.Views;
â”‚   â”‚       â”‚   10 â”‚ 
â”‚   â”‚       â”‚   11 â”‚ namespace test.Infrastructure.UI
â”‚   â”‚       â”‚   12 â”‚ {
â”‚   â”‚       â”‚   13 â”‚     /// <summary>
â”‚   â”‚       â”‚   14 â”‚     /// Avalonia implementation of the navigation service
â”‚   â”‚       â”‚   15 â”‚     /// </summary>
â”‚   â”‚       â”‚   16 â”‚     public class AvaloniaNavigationService : INavigationService
â”‚   â”‚       â”‚   17 â”‚     {
â”‚   â”‚       â”‚   18 â”‚         private readonly ILogger<AvaloniaNavigationService> _logger;
â”‚   â”‚       â”‚   19 â”‚         private readonly IServiceProvider _serviceProvider;
â”‚   â”‚       â”‚   20 â”‚         private ContentControl _contentControl;
â”‚   â”‚       â”‚   21 â”‚         private readonly Window _window;
â”‚   â”‚       â”‚   22 â”‚         private readonly Dictionary<string, Type> _viewMappings = new();
â”‚   â”‚       â”‚   23 â”‚         private string _currentView;
â”‚   â”‚       â”‚   24 â”‚ 
â”‚   â”‚       â”‚   25 â”‚         /// <summary>
â”‚   â”‚       â”‚   26 â”‚         /// Gets the name of the currently active view
â”‚   â”‚       â”‚   27 â”‚         /// </summary>
â”‚   â”‚       â”‚   28 â”‚         public string CurrentView => _currentView;
â”‚   â”‚       â”‚   29 â”‚ 
â”‚   â”‚       â”‚   30 â”‚         /// <summary>
â”‚   â”‚       â”‚   31 â”‚         /// Event raised when navigation occurs
â”‚   â”‚       â”‚   32 â”‚         /// </summary>
â”‚   â”‚       â”‚   33 â”‚         public event EventHandler<NavigationEventArgs> Navigated;
â”‚   â”‚       â”‚   34 â”‚ 
â”‚   â”‚       â”‚   35 â”‚         /// <summary>
â”‚   â”‚       â”‚   36 â”‚         /// Creates a new Avalonia navigation service
â”‚   â”‚       â”‚   37 â”‚         /// </summary>
â”‚   â”‚       â”‚   38 â”‚         /// <param name="logger">The logger</param>
â”‚   â”‚       â”‚   39 â”‚         /// <param name="serviceProvider">The service provider</param>
â”‚   â”‚       â”‚   40 â”‚         /// <param name="window">The main window</param>
â”‚   â”‚       â”‚   41 â”‚         public AvaloniaNavigationService(
â”‚   â”‚       â”‚   42 â”‚             ILogger<AvaloniaNavigationService> logger,
â”‚   â”‚       â”‚   43 â”‚             IServiceProvider serviceProvider,
â”‚   â”‚       â”‚   44 â”‚             Window window)
â”‚   â”‚       â”‚   45 â”‚         {
â”‚   â”‚       â”‚   46 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚   â”‚       â”‚   47 â”‚             _serviceProvider = serviceProvider ?? throw new ArgumentNullException(nameof(serviceProvider));
â”‚   â”‚       â”‚   48 â”‚             _window = window ?? throw new ArgumentNullException(nameof(window));
â”‚   â”‚       â”‚   49 â”‚ 
â”‚   â”‚       â”‚   50 â”‚             // Try to find the MainContent control immediately
â”‚   â”‚       â”‚   51 â”‚             _contentControl = _window.FindControl<ContentControl>("MainContent");
â”‚   â”‚       â”‚   52 â”‚ 
â”‚   â”‚       â”‚   53 â”‚             if (_contentControl == null)
â”‚   â”‚       â”‚   54 â”‚             {
â”‚   â”‚       â”‚   55 â”‚                 _logger.LogWarning("MainContent control not found during initialization, will try again later");
â”‚   â”‚       â”‚   56 â”‚ 
â”‚   â”‚       â”‚   57 â”‚                 // Schedule another attempt once the UI is loaded
â”‚   â”‚       â”‚   58 â”‚                 Dispatcher.UIThread.Post(() => {
â”‚   â”‚       â”‚   59 â”‚                     _contentControl = _window.FindControl<ContentControl>("MainContent");
â”‚   â”‚       â”‚   60 â”‚                     _logger.LogInformation("Second attempt to find MainContent: {Result}",
â”‚   â”‚       â”‚   61 â”‚                         _contentControl != null ? "Success" : "Failed");
â”‚   â”‚       â”‚   62 â”‚                 }, DispatcherPriority.Loaded);
â”‚   â”‚       â”‚   63 â”‚             }
â”‚   â”‚       â”‚   64 â”‚             else
â”‚   â”‚       â”‚   65 â”‚             {
â”‚   â”‚       â”‚   66 â”‚                 _logger.LogInformation("Successfully located MainContent control during initialization");
â”‚   â”‚       â”‚   67 â”‚             }
â”‚   â”‚       â”‚   68 â”‚ 
â”‚   â”‚       â”‚   69 â”‚             RegisterViews();
â”‚   â”‚       â”‚   70 â”‚         }
â”‚   â”‚       â”‚   71 â”‚ 
â”‚   â”‚       â”‚   72 â”‚         /// <summary>
â”‚   â”‚       â”‚   73 â”‚         /// Navigates to the specified view
â”‚   â”‚       â”‚   74 â”‚         /// </summary>
â”‚   â”‚       â”‚   75 â”‚         /// <param name="viewName">The name of the view to navigate to</param>
â”‚   â”‚       â”‚   76 â”‚         /// <param name="parameter">Optional parameter to pass to the view</param>
â”‚   â”‚       â”‚   77 â”‚         /// <returns>True if navigation was successful, false otherwise</returns>
â”‚   â”‚       â”‚   78 â”‚         public bool NavigateTo(string viewName, object parameter = null)
â”‚   â”‚       â”‚   79 â”‚         {
â”‚   â”‚       â”‚   80 â”‚             if (string.IsNullOrEmpty(viewName))
â”‚   â”‚       â”‚   81 â”‚             {
â”‚   â”‚       â”‚   82 â”‚                 _logger.LogWarning("Navigation attempted with null or empty view name");
â”‚   â”‚       â”‚   83 â”‚                 return false;
â”‚   â”‚       â”‚   84 â”‚             }
â”‚   â”‚       â”‚   85 â”‚ 
â”‚   â”‚       â”‚   86 â”‚             if (!CanNavigate(viewName))
â”‚   â”‚       â”‚   87 â”‚             {
â”‚   â”‚       â”‚   88 â”‚                 _logger.LogWarning("View {ViewName} is not registered", viewName);
â”‚   â”‚       â”‚   89 â”‚                 return false;
â”‚   â”‚       â”‚   90 â”‚             }
â”‚   â”‚       â”‚   91 â”‚ 
â”‚   â”‚       â”‚   92 â”‚             try
â”‚   â”‚       â”‚   93 â”‚             {
â”‚   â”‚       â”‚   94 â”‚                 _logger.LogDebug("Beginning navigation to {ViewName}", viewName);
â”‚   â”‚       â”‚   95 â”‚ 
â”‚   â”‚       â”‚   96 â”‚                 // Make one more attempt to find the content control if it wasn't found initially
â”‚   â”‚       â”‚   97 â”‚                 if (_contentControl == null)
â”‚   â”‚       â”‚   98 â”‚                 {
â”‚   â”‚       â”‚   99 â”‚                     _contentControl = _window.FindControl<ContentControl>("MainContent");
â”‚   â”‚       â”‚  100 â”‚                     _logger.LogDebug("Attempted to find MainContent during navigation: {Result}",
â”‚   â”‚       â”‚  101 â”‚                         _contentControl != null ? "Success" : "Failed");
â”‚   â”‚       â”‚  102 â”‚ 
â”‚   â”‚       â”‚  103 â”‚                     if (_contentControl == null)
â”‚   â”‚       â”‚  104 â”‚                     {
â”‚   â”‚       â”‚  105 â”‚                         _logger.LogError("Cannot navigate: MainContent control not found");
â”‚   â”‚       â”‚  106 â”‚                         return false;
â”‚   â”‚       â”‚  107 â”‚                     }
â”‚   â”‚       â”‚  108 â”‚                 }
â”‚   â”‚       â”‚  109 â”‚ 
â”‚   â”‚       â”‚  110 â”‚                 // Get the view type
â”‚   â”‚       â”‚  111 â”‚                 var viewType = _viewMappings[viewName];
â”‚   â”‚       â”‚  112 â”‚                 _logger.LogDebug("Creating view instance of type {ViewType}", viewType.Name);
â”‚   â”‚       â”‚  113 â”‚ 
â”‚   â”‚       â”‚  114 â”‚                 // Create view instance
â”‚   â”‚       â”‚  115 â”‚                 Control viewInstance;
â”‚   â”‚       â”‚  116 â”‚ 
â”‚   â”‚       â”‚  117 â”‚                 // Special handling for Settings view
â”‚   â”‚       â”‚  118 â”‚                 if (viewName == "Settings")
â”‚   â”‚       â”‚  119 â”‚                 {
â”‚   â”‚       â”‚  120 â”‚                     try
â”‚   â”‚       â”‚  121 â”‚                     {
â”‚   â”‚       â”‚  122 â”‚                         // Get both the view and view model from the service provider
â”‚   â”‚       â”‚  123 â”‚                         var settingsViewModel = _serviceProvider.GetService<SettingsViewModel>();
â”‚   â”‚       â”‚  124 â”‚ 
â”‚   â”‚       â”‚  125 â”‚                         if (settingsViewModel == null)
â”‚   â”‚       â”‚  126 â”‚                         {
â”‚   â”‚       â”‚  127 â”‚                             _logger.LogError("Failed to resolve SettingsViewModel from service provider");
â”‚   â”‚       â”‚  128 â”‚                         }
â”‚   â”‚       â”‚  129 â”‚ 
â”‚   â”‚       â”‚  130 â”‚                         // Try to get the Settings view from DI
â”‚   â”‚       â”‚  131 â”‚                         viewInstance = _serviceProvider.GetService<SettingsView>();
â”‚   â”‚       â”‚  132 â”‚ 
â”‚   â”‚       â”‚  133 â”‚                         if (viewInstance == null)
â”‚   â”‚       â”‚  134 â”‚                         {
â”‚   â”‚       â”‚  135 â”‚                             _logger.LogWarning("SettingsView could not be resolved from DI, creating manually");
â”‚   â”‚       â”‚  136 â”‚                             viewInstance = new SettingsView();
â”‚   â”‚       â”‚  137 â”‚                         }
â”‚   â”‚       â”‚  138 â”‚ 
â”‚   â”‚       â”‚  139 â”‚                         // Ensure the view has a view model
â”‚   â”‚       â”‚  140 â”‚                         if (settingsViewModel != null && viewInstance.DataContext == null)
â”‚   â”‚       â”‚  141 â”‚                         {
â”‚   â”‚       â”‚  142 â”‚                             viewInstance.DataContext = settingsViewModel;
â”‚   â”‚       â”‚  143 â”‚                             _logger.LogDebug("Assigned SettingsViewModel to SettingsView");
â”‚   â”‚       â”‚  144 â”‚                         }
â”‚   â”‚       â”‚  145 â”‚                     }
â”‚   â”‚       â”‚  146 â”‚                     catch (Exception ex)
â”‚   â”‚       â”‚  147 â”‚                     {
â”‚   â”‚       â”‚  148 â”‚                         _logger.LogError(ex, "Error creating SettingsView");
â”‚   â”‚       â”‚  149 â”‚                         viewInstance = new SettingsView(); // Fallback to creating it directly
â”‚   â”‚       â”‚  150 â”‚                     }
â”‚   â”‚       â”‚  151 â”‚                 }
â”‚   â”‚       â”‚  152 â”‚                 else
â”‚   â”‚       â”‚  153 â”‚                 {
â”‚   â”‚       â”‚  154 â”‚                     // For other views, create using ActivatorUtilities
â”‚   â”‚       â”‚  155 â”‚                     viewInstance = (Control)ActivatorUtilities.CreateInstance(_serviceProvider, viewType);
â”‚   â”‚       â”‚  156 â”‚                 }
â”‚   â”‚       â”‚  157 â”‚ 
â”‚   â”‚       â”‚  158 â”‚                 if (viewInstance == null)
â”‚   â”‚       â”‚  159 â”‚                 {
â”‚   â”‚       â”‚  160 â”‚                     _logger.LogError("Failed to create view instance for {ViewName}", viewName);
â”‚   â”‚       â”‚  161 â”‚                     return false;
â”‚   â”‚       â”‚  162 â”‚                 }
â”‚   â”‚       â”‚  163 â”‚ 
â”‚   â”‚       â”‚  164 â”‚                 // Update the content control on the UI thread
â”‚   â”‚       â”‚  165 â”‚                 Dispatcher.UIThread.Post(() =>
â”‚   â”‚       â”‚  166 â”‚                 {
â”‚   â”‚       â”‚  167 â”‚                     _logger?.LogDebug("Setting Content property of MainContent to {ViewType}", viewInstance.GetType().Name);
â”‚   â”‚       â”‚  168 â”‚ 
â”‚   â”‚       â”‚  169 â”‚                     // Get the MainViewModel from the window's DataContext
â”‚   â”‚       â”‚  170 â”‚                     if (_window.DataContext is MainViewModel mainViewModel)
â”‚   â”‚       â”‚  171 â”‚                     {
â”‚   â”‚       â”‚  172 â”‚                         // Update the view model's CurrentView property
â”‚   â”‚       â”‚  173 â”‚                         mainViewModel.CurrentView = viewInstance;
â”‚   â”‚       â”‚  174 â”‚                         _logger?.LogDebug("Updated MainViewModel.CurrentView to {ViewType}", viewInstance.GetType().Name);
â”‚   â”‚       â”‚  175 â”‚                     }
â”‚   â”‚       â”‚  176 â”‚                     else
â”‚   â”‚       â”‚  177 â”‚                     {
â”‚   â”‚       â”‚  178 â”‚                         // If we can't update the view model, set the content directly
â”‚   â”‚       â”‚  179 â”‚                         _contentControl.Content = viewInstance;
â”‚   â”‚       â”‚  180 â”‚                     }
â”‚   â”‚       â”‚  181 â”‚ 
â”‚   â”‚       â”‚  182 â”‚                     // Update current view
â”‚   â”‚       â”‚  183 â”‚                     _currentView = viewName;
â”‚   â”‚       â”‚  184 â”‚ 
â”‚   â”‚       â”‚  185 â”‚                     // Raise navigated event
â”‚   â”‚       â”‚  186 â”‚                     Navigated?.Invoke(this, new NavigationEventArgs(viewName, viewInstance));
â”‚   â”‚       â”‚  187 â”‚ 
â”‚   â”‚       â”‚  188 â”‚                     _logger?.LogInformation("Successfully navigated to {ViewName}", viewName);
â”‚   â”‚       â”‚  189 â”‚                 }, DispatcherPriority.Render);
â”‚   â”‚       â”‚  190 â”‚ 
â”‚   â”‚       â”‚  191 â”‚                 return true;
â”‚   â”‚       â”‚  192 â”‚             }
â”‚   â”‚       â”‚  193 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  194 â”‚             {
â”‚   â”‚       â”‚  195 â”‚                 _logger.LogError(ex, "Error navigating to view {ViewName}", viewName);
â”‚   â”‚       â”‚  196 â”‚                 return false;
â”‚   â”‚       â”‚  197 â”‚             }
â”‚   â”‚       â”‚  198 â”‚         }
â”‚   â”‚       â”‚  199 â”‚ 
â”‚   â”‚       â”‚  200 â”‚         /// <summary>
â”‚   â”‚       â”‚  201 â”‚         /// Checks if navigation to the specified view is possible
â”‚   â”‚       â”‚  202 â”‚         /// </summary>
â”‚   â”‚       â”‚  203 â”‚         /// <param name="viewName">The name of the view to check</param>
â”‚   â”‚       â”‚  204 â”‚         /// <returns>True if navigation is possible, false otherwise</returns>
â”‚   â”‚       â”‚  205 â”‚         public bool CanNavigate(string viewName)
â”‚   â”‚       â”‚  206 â”‚         {
â”‚   â”‚       â”‚  207 â”‚             return !string.IsNullOrEmpty(viewName) && _viewMappings.ContainsKey(viewName);
â”‚   â”‚       â”‚  208 â”‚         }
â”‚   â”‚       â”‚  209 â”‚ 
â”‚   â”‚       â”‚  210 â”‚         /// <summary>
â”‚   â”‚       â”‚  211 â”‚         /// Registers available views
â”‚   â”‚       â”‚  212 â”‚         /// </summary>
â”‚   â”‚       â”‚  213 â”‚         private void RegisterViews()
â”‚   â”‚       â”‚  214 â”‚         {
â”‚   â”‚       â”‚  215 â”‚             try
â”‚   â”‚       â”‚  216 â”‚             {
â”‚   â”‚       â”‚  217 â”‚                 // Register views
â”‚   â”‚       â”‚  218 â”‚                 _viewMappings.Add("Converters", typeof(test.Views.ConvertersView));
â”‚   â”‚       â”‚  219 â”‚ 
â”‚   â”‚       â”‚  220 â”‚                 // Add SettingsView with the correct type
â”‚   â”‚       â”‚  221 â”‚                 _viewMappings.Add("Settings", typeof(test.Views.SettingsView));
â”‚   â”‚       â”‚  222 â”‚ 
â”‚   â”‚       â”‚  223 â”‚                 // Use UserControl as fallback for other views
â”‚   â”‚       â”‚  224 â”‚                 _viewMappings.Add("Dashboard", typeof(UserControl));
â”‚   â”‚       â”‚  225 â”‚                 _viewMappings.Add("Projects", typeof(UserControl));
â”‚   â”‚       â”‚  226 â”‚                 _viewMappings.Add("Analysis", typeof(UserControl));
â”‚   â”‚       â”‚  227 â”‚                 _viewMappings.Add("Diff", typeof(UserControl));
â”‚   â”‚       â”‚  228 â”‚                 _viewMappings.Add("Databases", typeof(UserControl));
â”‚   â”‚       â”‚  229 â”‚                 _viewMappings.Add("Help", typeof(UserControl));
â”‚   â”‚       â”‚  230 â”‚                 _viewMappings.Add("Reports", typeof(UserControl));
â”‚   â”‚       â”‚  231 â”‚ 
â”‚   â”‚       â”‚  232 â”‚                 _logger.LogInformation("Registered {Count} views", _viewMappings.Count);
â”‚   â”‚       â”‚  233 â”‚             }
â”‚   â”‚       â”‚  234 â”‚             catch (Exception ex)
â”‚   â”‚       â”‚  235 â”‚             {
â”‚   â”‚       â”‚  236 â”‚                 _logger.LogError(ex, "Error registering views");
â”‚   â”‚       â”‚  237 â”‚             }
â”‚   â”‚       â”‚  238 â”‚         }
â”‚   â”‚       â”‚  239 â”‚     }
â”‚   â”‚       â”‚  240 â”‚ }
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ AppBootstrapper.cs (3.11 KB, 2025-03-12 14:41:14)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: AppBootstrapper.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.DependencyInjection;
â”‚   â”‚   â”‚    2 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    3 â”‚ using Serilog;
â”‚   â”‚   â”‚    4 â”‚ using Serilog.Events;
â”‚   â”‚   â”‚    5 â”‚ using System;
â”‚   â”‚   â”‚    6 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚    7 â”‚ using test.Infrastructure;
â”‚   â”‚   â”‚    8 â”‚ using test.Core.Domain;
â”‚   â”‚   â”‚    9 â”‚ using test;
â”‚   â”‚   â”‚   10 â”‚ using test.Application.Services;
â”‚   â”‚   â”‚   11 â”‚ using test.ViewModels;
â”‚   â”‚   â”‚   12 â”‚ 
â”‚   â”‚   â”‚   13 â”‚ namespace test.Application
â”‚   â”‚   â”‚   14 â”‚ {
â”‚   â”‚   â”‚   15 â”‚     /// <summary>
â”‚   â”‚   â”‚   16 â”‚     /// Bootstrapper for the application
â”‚   â”‚   â”‚   17 â”‚     /// </summary>
â”‚   â”‚   â”‚   18 â”‚     public class AppBootstrapper
â”‚   â”‚   â”‚   19 â”‚     {
â”‚   â”‚   â”‚   20 â”‚         /// <summary>
â”‚   â”‚   â”‚   21 â”‚         /// The service provider
â”‚   â”‚   â”‚   22 â”‚         /// </summary>
â”‚   â”‚   â”‚   23 â”‚         public IServiceProvider ServiceProvider { get; private set; }
â”‚   â”‚   â”‚   24 â”‚ 
â”‚   â”‚   â”‚   25 â”‚         /// <summary>
â”‚   â”‚   â”‚   26 â”‚         /// Creates a new application bootstrapper
â”‚   â”‚   â”‚   27 â”‚         /// </summary>
â”‚   â”‚   â”‚   28 â”‚         public AppBootstrapper(Avalonia.Controls.Window mainWindow)
â”‚   â”‚   â”‚   29 â”‚         {
â”‚   â”‚   â”‚   30 â”‚             // Create service collection
â”‚   â”‚   â”‚   31 â”‚             var services = new ServiceCollection();
â”‚   â”‚   â”‚   32 â”‚             ConfigureServices(services, mainWindow);
â”‚   â”‚   â”‚   33 â”‚             ServiceProvider = services.BuildServiceProvider();
â”‚   â”‚   â”‚   34 â”‚         }
â”‚   â”‚   â”‚   35 â”‚ 
â”‚   â”‚   â”‚   36 â”‚         /// <summary>
â”‚   â”‚   â”‚   37 â”‚         /// Configures application services
â”‚   â”‚   â”‚   38 â”‚         /// </summary>
â”‚   â”‚   â”‚   39 â”‚         /// <param name="services">The service collection</param>
â”‚   â”‚   â”‚   40 â”‚         /// <param name="mainWindow">The main window</param>
â”‚   â”‚   â”‚   41 â”‚         private void ConfigureServices(IServiceCollection services, Avalonia.Controls.Window mainWindow)
â”‚   â”‚   â”‚   42 â”‚         {
â”‚   â”‚   â”‚   43 â”‚             // Initialize Serilog's global logger with just console & debug output
â”‚   â”‚   â”‚   44 â”‚             // This ensures logs appear immediately in the console/debug output
â”‚   â”‚   â”‚   45 â”‚             // The file logger will be added by LoggingService when enabled
â”‚   â”‚   â”‚   46 â”‚             Log.Logger = new LoggerConfiguration()
â”‚   â”‚   â”‚   47 â”‚                 .MinimumLevel.Debug() // Start with Debug level - LoggingService will adjust this
â”‚   â”‚   â”‚   48 â”‚                 .WriteTo.Console()
â”‚   â”‚   â”‚   49 â”‚                 .WriteTo.Debug()
â”‚   â”‚   â”‚   50 â”‚                 .CreateLogger();
â”‚   â”‚   â”‚   51 â”‚ 
â”‚   â”‚   â”‚   52 â”‚             // Configure logging
â”‚   â”‚   â”‚   53 â”‚             services.AddLogging(builder =>
â”‚   â”‚   â”‚   54 â”‚             {
â”‚   â”‚   â”‚   55 â”‚                 // Use Serilog for logging
â”‚   â”‚   â”‚   56 â”‚                 builder.AddSerilog(Log.Logger, dispose: false); // Don't dispose when container is disposed
â”‚   â”‚   â”‚   57 â”‚             });
â”‚   â”‚   â”‚   58 â”‚ 
â”‚   â”‚   â”‚   59 â”‚             // Register application services
â”‚   â”‚   â”‚   60 â”‚             services.AddApplicationServices();
â”‚   â”‚   â”‚   61 â”‚ 
â”‚   â”‚   â”‚   62 â”‚             // Register UI services
â”‚   â”‚   â”‚   63 â”‚             services.AddUIServices(mainWindow);
â”‚   â”‚   â”‚   64 â”‚ 
â”‚   â”‚   â”‚   65 â”‚             // Register view models
â”‚   â”‚   â”‚   66 â”‚             services.AddViewModels();
â”‚   â”‚   â”‚   67 â”‚         }
â”‚   â”‚   â”‚   68 â”‚ 
â”‚   â”‚   â”‚   69 â”‚         /// <summary>
â”‚   â”‚   â”‚   70 â”‚         /// Gets a service from the service provider
â”‚   â”‚   â”‚   71 â”‚         /// </summary>
â”‚   â”‚   â”‚   72 â”‚         /// <typeparam name="T">The service type</typeparam>
â”‚   â”‚   â”‚   73 â”‚         /// <returns>The service</returns>
â”‚   â”‚   â”‚   74 â”‚         public T GetService<T>() where T : class
â”‚   â”‚   â”‚   75 â”‚         {
â”‚   â”‚   â”‚   76 â”‚             return ServiceProvider.GetService<T>();
â”‚   â”‚   â”‚   77 â”‚         }
â”‚   â”‚   â”‚   78 â”‚ 
â”‚   â”‚   â”‚   79 â”‚         /// <summary>
â”‚   â”‚   â”‚   80 â”‚         /// Gets a required service from the service provider
â”‚   â”‚   â”‚   81 â”‚         /// </summary>
â”‚   â”‚   â”‚   82 â”‚         /// <typeparam name="T">The service type</typeparam>
â”‚   â”‚   â”‚   83 â”‚         /// <returns>The service</returns>
â”‚   â”‚   â”‚   84 â”‚         /// <exception cref="InvalidOperationException">Thrown if the service is not found</exception>
â”‚   â”‚   â”‚   85 â”‚         public T GetRequiredService<T>() where T : class
â”‚   â”‚   â”‚   86 â”‚         {
â”‚   â”‚   â”‚   87 â”‚             return ServiceProvider.GetRequiredService<T>();
â”‚   â”‚   â”‚   88 â”‚         }
â”‚   â”‚   â”‚   89 â”‚     }
â”‚   â”‚   â”‚   90 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ AppSettings.cs (1.81 KB, 2025-03-12 07:56:25)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: AppSettings.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using System;
â”‚   â”‚   â”‚    2 â”‚ 
â”‚   â”‚   â”‚    3 â”‚ namespace test.Infrastructure
â”‚   â”‚   â”‚    4 â”‚ {
â”‚   â”‚   â”‚    5 â”‚     /// <summary>
â”‚   â”‚   â”‚    6 â”‚     /// Application settings data model
â”‚   â”‚   â”‚    7 â”‚     /// </summary>
â”‚   â”‚   â”‚    8 â”‚     public class AppSettings
â”‚   â”‚   â”‚    9 â”‚     {
â”‚   â”‚   â”‚   10 â”‚         /// <summary>
â”‚   â”‚   â”‚   11 â”‚         /// Indicates if logging is enabled
â”‚   â”‚   â”‚   12 â”‚         /// </summary>
â”‚   â”‚   â”‚   13 â”‚         public bool EnableLogging { get; set; } = true;
â”‚   â”‚   â”‚   14 â”‚ 
â”‚   â”‚   â”‚   15 â”‚         /// <summary>
â”‚   â”‚   â”‚   16 â”‚         /// The log level as a string
â”‚   â”‚   â”‚   17 â”‚         /// </summary>
â”‚   â”‚   â”‚   18 â”‚         public string LogLevel { get; set; } = "Information";
â”‚   â”‚   â”‚   19 â”‚ 
â”‚   â”‚   â”‚   20 â”‚         /// <summary>
â”‚   â”‚   â”‚   21 â”‚         /// Indicates if logs should be deleted on exit
â”‚   â”‚   â”‚   22 â”‚         /// </summary>
â”‚   â”‚   â”‚   23 â”‚         public bool DeleteLogsOnExit { get; set; } = false;
â”‚   â”‚   â”‚   24 â”‚ 
â”‚   â”‚   â”‚   25 â”‚         /// <summary>
â”‚   â”‚   â”‚   26 â”‚         /// Indicates if the light theme is used
â”‚   â”‚   â”‚   27 â”‚         /// </summary>
â”‚   â”‚   â”‚   28 â”‚         public bool IsLightTheme { get; set; } = false;
â”‚   â”‚   â”‚   29 â”‚     }
â”‚   â”‚   â”‚   30 â”‚ 
â”‚   â”‚   â”‚   31 â”‚     /// <summary>
â”‚   â”‚   â”‚   32 â”‚     /// Interface for managing application settings
â”‚   â”‚   â”‚   33 â”‚     /// </summary>
â”‚   â”‚   â”‚   34 â”‚     public interface ISettingsManager
â”‚   â”‚   â”‚   35 â”‚     {
â”‚   â”‚   â”‚   36 â”‚         /// <summary>
â”‚   â”‚   â”‚   37 â”‚         /// Gets the current application settings
â”‚   â”‚   â”‚   38 â”‚         /// </summary>
â”‚   â”‚   â”‚   39 â”‚         /// <returns>The current settings</returns>
â”‚   â”‚   â”‚   40 â”‚         AppSettings GetCurrentSettings();
â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   42 â”‚         /// <summary>
â”‚   â”‚   â”‚   43 â”‚         /// Gets the path to the settings file
â”‚   â”‚   â”‚   44 â”‚         /// </summary>
â”‚   â”‚   â”‚   45 â”‚         /// <returns>The settings file path</returns>
â”‚   â”‚   â”‚   46 â”‚         string GetSettingsPath();
â”‚   â”‚   â”‚   47 â”‚ 
â”‚   â”‚   â”‚   48 â”‚         /// <summary>
â”‚   â”‚   â”‚   49 â”‚         /// Saves application settings
â”‚   â”‚   â”‚   50 â”‚         /// </summary>
â”‚   â”‚   â”‚   51 â”‚         /// <param name="settings">The settings to save</param>
â”‚   â”‚   â”‚   52 â”‚         /// <returns>A task that completes when settings are saved</returns>
â”‚   â”‚   â”‚   53 â”‚         System.Threading.Tasks.Task SaveSettingsAsync(AppSettings settings);
â”‚   â”‚   â”‚   54 â”‚ 
â”‚   â”‚   â”‚   55 â”‚         /// <summary>
â”‚   â”‚   â”‚   56 â”‚         /// Loads application settings
â”‚   â”‚   â”‚   57 â”‚         /// </summary>
â”‚   â”‚   â”‚   58 â”‚         /// <returns>The loaded settings</returns>
â”‚   â”‚   â”‚   59 â”‚         System.Threading.Tasks.Task<AppSettings> LoadSettingsAsync();
â”‚   â”‚   â”‚   60 â”‚     }
â”‚   â”‚   â”‚   61 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ ServiceCollectionExtensions.cs (4.45 KB, 2025-03-12 14:31:40)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: ServiceCollectionExtensions.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.DependencyInjection;
â”‚   â”‚   â”‚    2 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    3 â”‚ using Serilog.Core;
â”‚   â”‚   â”‚    4 â”‚ using System;
â”‚   â”‚   â”‚    5 â”‚ using test.Application.Services;
â”‚   â”‚   â”‚    6 â”‚ using test.Application.Services.Parsers;
â”‚   â”‚   â”‚    7 â”‚ using test.Application.Services.Writers;
â”‚   â”‚   â”‚    8 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚    9 â”‚ using test.Data;
â”‚   â”‚   â”‚   10 â”‚ using test.Infrastructure.Data;
â”‚   â”‚   â”‚   11 â”‚ using test.Infrastructure.FileSystem;
â”‚   â”‚   â”‚   12 â”‚ using test.Infrastructure.Logging;
â”‚   â”‚   â”‚   13 â”‚ using test.Infrastructure.Processing;
â”‚   â”‚   â”‚   14 â”‚ using test.Infrastructure.UI;
â”‚   â”‚   â”‚   15 â”‚ using test.ViewModels;
â”‚   â”‚   â”‚   16 â”‚ using Avalonia.Controls;
â”‚   â”‚   â”‚   17 â”‚ using test.Infrastructure;
â”‚   â”‚   â”‚   18 â”‚ using test.Views;
â”‚   â”‚   â”‚   19 â”‚ 
â”‚   â”‚   â”‚   20 â”‚ namespace test.Infrastructure
â”‚   â”‚   â”‚   21 â”‚ {
â”‚   â”‚   â”‚   22 â”‚     /// <summary>
â”‚   â”‚   â”‚   23 â”‚     /// Extensions for service collection to register application services
â”‚   â”‚   â”‚   24 â”‚     /// </summary>
â”‚   â”‚   â”‚   25 â”‚     public static class ServiceCollectionExtensions
â”‚   â”‚   â”‚   26 â”‚     {
â”‚   â”‚   â”‚   27 â”‚         /// <summary>
â”‚   â”‚   â”‚   28 â”‚         /// Registers all application services
â”‚   â”‚   â”‚   29 â”‚         /// </summary>
â”‚   â”‚   â”‚   30 â”‚         /// <param name="services">The service collection</param>
â”‚   â”‚   â”‚   31 â”‚         /// <returns>The service collection</returns>
â”‚   â”‚   â”‚   32 â”‚         public static IServiceCollection AddApplicationServices(this IServiceCollection services)
â”‚   â”‚   â”‚   33 â”‚         {
â”‚   â”‚   â”‚   34 â”‚             // Register infrastructure services
â”‚   â”‚   â”‚   35 â”‚             services.AddSingleton<IFileSystem, PhysicalFileSystem>();
â”‚   â”‚   â”‚   36 â”‚             services.AddSingleton<IErrorHandler, ApplicationErrorHandler>();
â”‚   â”‚   â”‚   37 â”‚             services.AddSingleton<ISettingsManager, SettingsManager>();
â”‚   â”‚   â”‚   38 â”‚             services.AddSingleton<ILoggingService, LoggingService>();
â”‚   â”‚   â”‚   39 â”‚ 
â”‚   â”‚   â”‚   40 â”‚             // Register ByteCode processor
â”‚   â”‚   â”‚   41 â”‚             services.AddSingleton<ByteCodeProcessor>();
â”‚   â”‚   â”‚   42 â”‚ 
â”‚   â”‚   â”‚   43 â”‚             // Register repositories
â”‚   â”‚   â”‚   44 â”‚             services.AddSingleton<ParserDbContext>();
â”‚   â”‚   â”‚   45 â”‚             services.AddSingleton<IControllerRepository, EfControllerRepository>();
â”‚   â”‚   â”‚   46 â”‚             services.AddSingleton<IProjectRepository, FileProjectRepository>();
â”‚   â”‚   â”‚   47 â”‚ 
â”‚   â”‚   â”‚   48 â”‚             // Register application services
â”‚   â”‚   â”‚   49 â”‚             services.AddTransient<ProjectService>();
â”‚   â”‚   â”‚   50 â”‚             services.AddTransient<ControllerService>();
â”‚   â”‚   â”‚   51 â”‚             services.AddTransient<ParsingService>();
â”‚   â”‚   â”‚   52 â”‚             services.AddTransient<IExportService, ExportService>();
â”‚   â”‚   â”‚   53 â”‚             services.AddTransient<IComparisonService, ComparisonService>();
â”‚   â”‚   â”‚   54 â”‚             services.AddSingleton<IControllerModelService, ControllerModelService>();
â”‚   â”‚   â”‚   55 â”‚ 
â”‚   â”‚   â”‚   56 â”‚             // Register ObjectSet parsers and writers
â”‚   â”‚   â”‚   57 â”‚             services.AddTransient<IObjectSetParser, ObjectSetParserImpl>();
â”‚   â”‚   â”‚   58 â”‚             services.AddTransient<IObjectSetWriter, ObjectSetWriterImpl>();
â”‚   â”‚   â”‚   59 â”‚ 
â”‚   â”‚   â”‚   60 â”‚             // Add the XML modification service
â”‚   â”‚   â”‚   61 â”‚             services.AddTransient<IXmlModificationService, XmlModificationService>();
â”‚   â”‚   â”‚   62 â”‚ 
â”‚   â”‚   â”‚   63 â”‚             return services;
â”‚   â”‚   â”‚   64 â”‚         }
â”‚   â”‚   â”‚   65 â”‚ 
â”‚   â”‚   â”‚   66 â”‚         /// <summary>
â”‚   â”‚   â”‚   67 â”‚         /// Registers UI-related services
â”‚   â”‚   â”‚   68 â”‚         /// </summary>
â”‚   â”‚   â”‚   69 â”‚         /// <param name="services">The service collection</param>
â”‚   â”‚   â”‚   70 â”‚         /// <param name="mainWindow">The main window</param>
â”‚   â”‚   â”‚   71 â”‚         /// <returns>The service collection</returns>
â”‚   â”‚   â”‚   72 â”‚         public static IServiceCollection AddUIServices(this IServiceCollection services, Window mainWindow)
â”‚   â”‚   â”‚   73 â”‚         {
â”‚   â”‚   â”‚   74 â”‚             // Register dialog service
â”‚   â”‚   â”‚   75 â”‚             services.AddSingleton<IDialogService>(provider =>
â”‚   â”‚   â”‚   76 â”‚                 new AvaloniaDialogService(mainWindow));
â”‚   â”‚   â”‚   77 â”‚ 
â”‚   â”‚   â”‚   78 â”‚             // Register navigation service
â”‚   â”‚   â”‚   79 â”‚             services.AddSingleton<INavigationService>(provider =>
â”‚   â”‚   â”‚   80 â”‚             {
â”‚   â”‚   â”‚   81 â”‚                 var logger = provider.GetRequiredService<ILogger<AvaloniaNavigationService>>();
â”‚   â”‚   â”‚   82 â”‚                 return new AvaloniaNavigationService(
â”‚   â”‚   â”‚   83 â”‚                     logger,
â”‚   â”‚   â”‚   84 â”‚                     provider,
â”‚   â”‚   â”‚   85 â”‚                     mainWindow);
â”‚   â”‚   â”‚   86 â”‚             });
â”‚   â”‚   â”‚   87 â”‚ 
â”‚   â”‚   â”‚   88 â”‚             return services;
â”‚   â”‚   â”‚   89 â”‚         }
â”‚   â”‚   â”‚   90 â”‚ 
â”‚   â”‚   â”‚   91 â”‚         /// <summary>
â”‚   â”‚   â”‚   92 â”‚         /// Registers view models
â”‚   â”‚   â”‚   93 â”‚         /// </summary>
â”‚   â”‚   â”‚   94 â”‚         /// <param name="services">The service collection</param>
â”‚   â”‚   â”‚   95 â”‚         /// <returns>The service collection</returns>
â”‚   â”‚   â”‚   96 â”‚         public static IServiceCollection AddViewModels(this IServiceCollection services)
â”‚   â”‚   â”‚   97 â”‚         {
â”‚   â”‚   â”‚   98 â”‚             // Main view model
â”‚   â”‚   â”‚   99 â”‚             services.AddSingleton<MainViewModel>();
â”‚   â”‚   â”‚  100 â”‚ 
â”‚   â”‚   â”‚  101 â”‚             // Settings view model - register as singleton to maintain state
â”‚   â”‚   â”‚  102 â”‚             services.AddSingleton<SettingsViewModel>();
â”‚   â”‚   â”‚  103 â”‚ 
â”‚   â”‚   â”‚  104 â”‚             // Register Settings view explicitly to ensure it can be resolved
â”‚   â”‚   â”‚  105 â”‚             services.AddTransient<SettingsView>();
â”‚   â”‚   â”‚  106 â”‚ 
â”‚   â”‚   â”‚  107 â”‚             // Feature view models
â”‚   â”‚   â”‚  108 â”‚             services.AddTransient<ProjectsViewModel>();
â”‚   â”‚   â”‚  109 â”‚             services.AddTransient<ObjectSetViewModel>();
â”‚   â”‚   â”‚  110 â”‚ 
â”‚   â”‚   â”‚  111 â”‚             // Add more view models as needed
â”‚   â”‚   â”‚  112 â”‚ 
â”‚   â”‚   â”‚  113 â”‚             return services;
â”‚   â”‚   â”‚  114 â”‚         }
â”‚   â”‚   â”‚  115 â”‚     }
â”‚   â”‚   â”‚  116 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ ğŸ“„ SettingsManager.cs (9.40 KB, 2025-03-12 14:46:39)
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚ FILE CONTENT: SettingsManager.cs
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚   â”‚    1 â”‚ ï»¿using Microsoft.Extensions.Logging;
â”‚   â”‚   â”‚    2 â”‚ using Serilog.Core;
â”‚   â”‚   â”‚    3 â”‚ using Serilog.Events;
â”‚   â”‚   â”‚    4 â”‚ using System;
â”‚   â”‚   â”‚    5 â”‚ using System.IO;
â”‚   â”‚   â”‚    6 â”‚ using System.Text.Json;
â”‚   â”‚   â”‚    7 â”‚ using System.Threading.Tasks;
â”‚   â”‚   â”‚    8 â”‚ using test.Core.Interfaces;
â”‚   â”‚   â”‚    9 â”‚ 
â”‚   â”‚   â”‚   10 â”‚ namespace test.Infrastructure
â”‚   â”‚   â”‚   11 â”‚ {
â”‚   â”‚   â”‚   12 â”‚     /// <summary>
â”‚   â”‚   â”‚   13 â”‚     /// Implementation of settings manager for application settings
â”‚   â”‚   â”‚   14 â”‚     /// </summary>
â”‚   â”‚   â”‚   15 â”‚     public class SettingsManager : ISettingsManager, IDisposable
â”‚   â”‚   â”‚   16 â”‚     {
â”‚   â”‚   â”‚   17 â”‚         private readonly ILogger<SettingsManager> _logger;
â”‚   â”‚   â”‚   18 â”‚         private readonly IFileSystem _fileSystem;
â”‚   â”‚   â”‚   19 â”‚         private AppSettings _currentSettings;
â”‚   â”‚   â”‚   20 â”‚         private readonly string _settingsPath;
â”‚   â”‚   â”‚   21 â”‚         private bool _disposed;
â”‚   â”‚   â”‚   22 â”‚ 
â”‚   â”‚   â”‚   23 â”‚         /// <summary>
â”‚   â”‚   â”‚   24 â”‚         /// Creates a new settings manager
â”‚   â”‚   â”‚   25 â”‚         /// </summary>
â”‚   â”‚   â”‚   26 â”‚         public SettingsManager(
â”‚   â”‚   â”‚   27 â”‚             ILogger<SettingsManager> logger,
â”‚   â”‚   â”‚   28 â”‚             IFileSystem fileSystem)
â”‚   â”‚   â”‚   29 â”‚         {
â”‚   â”‚   â”‚   30 â”‚             _logger = logger ?? throw new ArgumentNullException(nameof(logger));
â”‚   â”‚   â”‚   31 â”‚             _fileSystem = fileSystem ?? throw new ArgumentNullException(nameof(fileSystem));
â”‚   â”‚   â”‚   32 â”‚ 
â”‚   â”‚   â”‚   33 â”‚             // Determine settings path
â”‚   â”‚   â”‚   34 â”‚             var appDataFolder = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
â”‚   â”‚   â”‚   35 â”‚             var appFolder = Path.Combine(appDataFolder, "PaapeConversionKit");
â”‚   â”‚   â”‚   36 â”‚ 
â”‚   â”‚   â”‚   37 â”‚             // Ensure directory exists
â”‚   â”‚   â”‚   38 â”‚             _fileSystem.CreateDirectory(appFolder);
â”‚   â”‚   â”‚   39 â”‚ 
â”‚   â”‚   â”‚   40 â”‚             _settingsPath = Path.Combine(appFolder, "settings.json");
â”‚   â”‚   â”‚   41 â”‚ 
â”‚   â”‚   â”‚   42 â”‚             // Load or create default settings
â”‚   â”‚   â”‚   43 â”‚             _currentSettings = LoadSettings();
â”‚   â”‚   â”‚   44 â”‚ 
â”‚   â”‚   â”‚   45 â”‚             // Apply the settings immediately
â”‚   â”‚   â”‚   46 â”‚             ApplyInitialSettings();
â”‚   â”‚   â”‚   47 â”‚         }
â”‚   â”‚   â”‚   48 â”‚ 
â”‚   â”‚   â”‚   49 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   50 â”‚         public AppSettings GetCurrentSettings()
â”‚   â”‚   â”‚   51 â”‚         {
â”‚   â”‚   â”‚   52 â”‚             return _currentSettings;
â”‚   â”‚   â”‚   53 â”‚         }
â”‚   â”‚   â”‚   54 â”‚ 
â”‚   â”‚   â”‚   55 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   56 â”‚         public string GetSettingsPath()
â”‚   â”‚   â”‚   57 â”‚         {
â”‚   â”‚   â”‚   58 â”‚             return _settingsPath;
â”‚   â”‚   â”‚   59 â”‚         }
â”‚   â”‚   â”‚   60 â”‚ 
â”‚   â”‚   â”‚   61 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   62 â”‚         public async Task SaveSettingsAsync(AppSettings settings)
â”‚   â”‚   â”‚   63 â”‚         {
â”‚   â”‚   â”‚   64 â”‚             if (settings == null)
â”‚   â”‚   â”‚   65 â”‚                 throw new ArgumentNullException(nameof(settings));
â”‚   â”‚   â”‚   66 â”‚ 
â”‚   â”‚   â”‚   67 â”‚             try
â”‚   â”‚   â”‚   68 â”‚             {
â”‚   â”‚   â”‚   69 â”‚                 var json = JsonSerializer.Serialize(settings, new JsonSerializerOptions { WriteIndented = true });
â”‚   â”‚   â”‚   70 â”‚                 await _fileSystem.WriteAllTextAsync(_settingsPath, json);
â”‚   â”‚   â”‚   71 â”‚                 _currentSettings = settings;
â”‚   â”‚   â”‚   72 â”‚                 _logger.LogInformation("Settings saved successfully");
â”‚   â”‚   â”‚   73 â”‚             }
â”‚   â”‚   â”‚   74 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚   75 â”‚             {
â”‚   â”‚   â”‚   76 â”‚                 _logger.LogError(ex, "Error saving settings");
â”‚   â”‚   â”‚   77 â”‚                 throw;
â”‚   â”‚   â”‚   78 â”‚             }
â”‚   â”‚   â”‚   79 â”‚         }
â”‚   â”‚   â”‚   80 â”‚ 
â”‚   â”‚   â”‚   81 â”‚         /// <inheritdoc/>
â”‚   â”‚   â”‚   82 â”‚         public async Task<AppSettings> LoadSettingsAsync()
â”‚   â”‚   â”‚   83 â”‚         {
â”‚   â”‚   â”‚   84 â”‚             try
â”‚   â”‚   â”‚   85 â”‚             {
â”‚   â”‚   â”‚   86 â”‚                 if (_fileSystem.FileExists(_settingsPath))
â”‚   â”‚   â”‚   87 â”‚                 {
â”‚   â”‚   â”‚   88 â”‚                     var json = await _fileSystem.ReadAllTextAsync(_settingsPath);
â”‚   â”‚   â”‚   89 â”‚                     var settings = JsonSerializer.Deserialize<AppSettings>(json);
â”‚   â”‚   â”‚   90 â”‚ 
â”‚   â”‚   â”‚   91 â”‚                     if (settings != null)
â”‚   â”‚   â”‚   92 â”‚                     {
â”‚   â”‚   â”‚   93 â”‚                         _currentSettings = settings;
â”‚   â”‚   â”‚   94 â”‚                         _logger.LogInformation("Settings loaded successfully");
â”‚   â”‚   â”‚   95 â”‚ 
â”‚   â”‚   â”‚   96 â”‚                         // Apply the loaded settings
â”‚   â”‚   â”‚   97 â”‚                         ApplySettings(_currentSettings);
â”‚   â”‚   â”‚   98 â”‚ 
â”‚   â”‚   â”‚   99 â”‚                         return settings;
â”‚   â”‚   â”‚  100 â”‚                     }
â”‚   â”‚   â”‚  101 â”‚                 }
â”‚   â”‚   â”‚  102 â”‚ 
â”‚   â”‚   â”‚  103 â”‚                 // If we get here, either the file doesn't exist or deserialization failed
â”‚   â”‚   â”‚  104 â”‚                 _logger.LogInformation("Creating default settings");
â”‚   â”‚   â”‚  105 â”‚                 _currentSettings = new AppSettings();
â”‚   â”‚   â”‚  106 â”‚                 await SaveSettingsAsync(_currentSettings);
â”‚   â”‚   â”‚  107 â”‚                 return _currentSettings;
â”‚   â”‚   â”‚  108 â”‚             }
â”‚   â”‚   â”‚  109 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  110 â”‚             {
â”‚   â”‚   â”‚  111 â”‚                 _logger.LogError(ex, "Error loading settings");
â”‚   â”‚   â”‚  112 â”‚                 _currentSettings = new AppSettings();
â”‚   â”‚   â”‚  113 â”‚                 return _currentSettings;
â”‚   â”‚   â”‚  114 â”‚             }
â”‚   â”‚   â”‚  115 â”‚         }
â”‚   â”‚   â”‚  116 â”‚ 
â”‚   â”‚   â”‚  117 â”‚         /// <summary>
â”‚   â”‚   â”‚  118 â”‚         /// Loads settings synchronously
â”‚   â”‚   â”‚  119 â”‚         /// </summary>
â”‚   â”‚   â”‚  120 â”‚         private AppSettings LoadSettings()
â”‚   â”‚   â”‚  121 â”‚         {
â”‚   â”‚   â”‚  122 â”‚             try
â”‚   â”‚   â”‚  123 â”‚             {
â”‚   â”‚   â”‚  124 â”‚                 if (_fileSystem.FileExists(_settingsPath))
â”‚   â”‚   â”‚  125 â”‚                 {
â”‚   â”‚   â”‚  126 â”‚                     using var stream = _fileSystem.OpenRead(_settingsPath);
â”‚   â”‚   â”‚  127 â”‚                     using var reader = new StreamReader(stream);
â”‚   â”‚   â”‚  128 â”‚                     var json = reader.ReadToEnd();
â”‚   â”‚   â”‚  129 â”‚                     var settings = JsonSerializer.Deserialize<AppSettings>(json);
â”‚   â”‚   â”‚  130 â”‚ 
â”‚   â”‚   â”‚  131 â”‚                     if (settings != null)
â”‚   â”‚   â”‚  132 â”‚                     {
â”‚   â”‚   â”‚  133 â”‚                         _logger.LogInformation("Settings loaded successfully");
â”‚   â”‚   â”‚  134 â”‚                         return settings;
â”‚   â”‚   â”‚  135 â”‚                     }
â”‚   â”‚   â”‚  136 â”‚                 }
â”‚   â”‚   â”‚  137 â”‚ 
â”‚   â”‚   â”‚  138 â”‚                 // If we get here, either the file doesn't exist or deserialization failed
â”‚   â”‚   â”‚  139 â”‚                 _logger.LogInformation("Creating default settings");
â”‚   â”‚   â”‚  140 â”‚                 return new AppSettings();
â”‚   â”‚   â”‚  141 â”‚             }
â”‚   â”‚   â”‚  142 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  143 â”‚             {
â”‚   â”‚   â”‚  144 â”‚                 _logger.LogError(ex, "Error loading settings");
â”‚   â”‚   â”‚  145 â”‚                 return new AppSettings();
â”‚   â”‚   â”‚  146 â”‚             }
â”‚   â”‚   â”‚  147 â”‚         }
â”‚   â”‚   â”‚  148 â”‚ 
â”‚   â”‚   â”‚  149 â”‚         /// <summary>
â”‚   â”‚   â”‚  150 â”‚         /// Applies initial settings after loading
â”‚   â”‚   â”‚  151 â”‚         /// </summary>
â”‚   â”‚   â”‚  152 â”‚         private void ApplyInitialSettings()
â”‚   â”‚   â”‚  153 â”‚         {
â”‚   â”‚   â”‚  154 â”‚             try
â”‚   â”‚   â”‚  155 â”‚             {
â”‚   â”‚   â”‚  156 â”‚                 ApplySettings(_currentSettings);
â”‚   â”‚   â”‚  157 â”‚             }
â”‚   â”‚   â”‚  158 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  159 â”‚             {
â”‚   â”‚   â”‚  160 â”‚                 _logger.LogError(ex, "Error applying initial settings");
â”‚   â”‚   â”‚  161 â”‚             }
â”‚   â”‚   â”‚  162 â”‚         }
â”‚   â”‚   â”‚  163 â”‚ 
â”‚   â”‚   â”‚  164 â”‚         /// <summary>
â”‚   â”‚   â”‚  165 â”‚         /// Applies settings to the system
â”‚   â”‚   â”‚  166 â”‚         /// </summary>
â”‚   â”‚   â”‚  167 â”‚         private void ApplySettings(AppSettings settings)
â”‚   â”‚   â”‚  168 â”‚         {
â”‚   â”‚   â”‚  169 â”‚             if (settings == null) return;
â”‚   â”‚   â”‚  170 â”‚ 
â”‚   â”‚   â”‚  171 â”‚             try
â”‚   â”‚   â”‚  172 â”‚             {
â”‚   â”‚   â”‚  173 â”‚                 // Get the logging service to apply log level
â”‚   â”‚   â”‚  174 â”‚                 var loggingService = GetLoggingService();
â”‚   â”‚   â”‚  175 â”‚                 if (loggingService != null)
â”‚   â”‚   â”‚  176 â”‚                 {
â”‚   â”‚   â”‚  177 â”‚                     // Apply log level if it can be parsed
â”‚   â”‚   â”‚  178 â”‚                     if (Enum.TryParse<LogEventLevel>(settings.LogLevel, out var level))
â”‚   â”‚   â”‚  179 â”‚                     {
â”‚   â”‚   â”‚  180 â”‚                         loggingService.SetLogLevel(level);
â”‚   â”‚   â”‚  181 â”‚                         _logger.LogDebug("Applied log level from settings: {Level}", level);
â”‚   â”‚   â”‚  182 â”‚                     }
â”‚   â”‚   â”‚  183 â”‚ 
â”‚   â”‚   â”‚  184 â”‚                     // Apply logging enabled setting
â”‚   â”‚   â”‚  185 â”‚                     loggingService.EnableLogging(settings.EnableLogging);
â”‚   â”‚   â”‚  186 â”‚                     _logger.LogDebug("Applied logging enabled from settings: {Enabled}", settings.EnableLogging);
â”‚   â”‚   â”‚  187 â”‚                 }
â”‚   â”‚   â”‚  188 â”‚             }
â”‚   â”‚   â”‚  189 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  190 â”‚             {
â”‚   â”‚   â”‚  191 â”‚                 _logger.LogError(ex, "Error applying settings");
â”‚   â”‚   â”‚  192 â”‚             }
â”‚   â”‚   â”‚  193 â”‚         }
â”‚   â”‚   â”‚  194 â”‚ 
â”‚   â”‚   â”‚  195 â”‚         /// <summary>
â”‚   â”‚   â”‚  196 â”‚         /// Gets the logging service from the global service provider
â”‚   â”‚   â”‚  197 â”‚         /// This is a fallback method to apply settings when the service isn't explicitly injected
â”‚   â”‚   â”‚  198 â”‚         /// </summary>
â”‚   â”‚   â”‚  199 â”‚         private ILoggingService GetLoggingService()
â”‚   â”‚   â”‚  200 â”‚         {
â”‚   â”‚   â”‚  201 â”‚             try
â”‚   â”‚   â”‚  202 â”‚             {
â”‚   â”‚   â”‚  203 â”‚                 // Try to get the logging service from the global App instance
â”‚   â”‚   â”‚  204 â”‚                 if (Avalonia.Application.Current is App app)
â”‚   â”‚   â”‚  205 â”‚                 {
â”‚   â”‚   â”‚  206 â”‚                     var serviceProvider = GetServiceProvider(app);
â”‚   â”‚   â”‚  207 â”‚                     if (serviceProvider != null)
â”‚   â”‚   â”‚  208 â”‚                     {
â”‚   â”‚   â”‚  209 â”‚                         return serviceProvider.GetService(typeof(ILoggingService)) as ILoggingService;
â”‚   â”‚   â”‚  210 â”‚                     }
â”‚   â”‚   â”‚  211 â”‚                 }
â”‚   â”‚   â”‚  212 â”‚             }
â”‚   â”‚   â”‚  213 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  214 â”‚             {
â”‚   â”‚   â”‚  215 â”‚                 _logger.LogError(ex, "Error getting logging service");
â”‚   â”‚   â”‚  216 â”‚             }
â”‚   â”‚   â”‚  217 â”‚ 
â”‚   â”‚   â”‚  218 â”‚             return null;
â”‚   â”‚   â”‚  219 â”‚         }
â”‚   â”‚   â”‚  220 â”‚ 
â”‚   â”‚   â”‚  221 â”‚         /// <summary>
â”‚   â”‚   â”‚  222 â”‚         /// Gets the service provider from the App instance
â”‚   â”‚   â”‚  223 â”‚         /// </summary>
â”‚   â”‚   â”‚  224 â”‚         private IServiceProvider GetServiceProvider(App app)
â”‚   â”‚   â”‚  225 â”‚         {
â”‚   â”‚   â”‚  226 â”‚             try
â”‚   â”‚   â”‚  227 â”‚             {
â”‚   â”‚   â”‚  228 â”‚                 // Use reflection to access the private _serviceProvider field
â”‚   â”‚   â”‚  229 â”‚                 var field = typeof(App).GetField("_serviceProvider",
â”‚   â”‚   â”‚  230 â”‚                     System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance);
â”‚   â”‚   â”‚  231 â”‚ 
â”‚   â”‚   â”‚  232 â”‚                 return field?.GetValue(app) as IServiceProvider;
â”‚   â”‚   â”‚  233 â”‚             }
â”‚   â”‚   â”‚  234 â”‚             catch (Exception ex)
â”‚   â”‚   â”‚  235 â”‚             {
â”‚   â”‚   â”‚  236 â”‚                 _logger.LogError(ex, "Error getting service provider");
â”‚   â”‚   â”‚  237 â”‚                 return null;
â”‚   â”‚   â”‚  238 â”‚             }
â”‚   â”‚   â”‚  239 â”‚         }
â”‚   â”‚   â”‚  240 â”‚ 
â”‚   â”‚   â”‚  241 â”‚         /// <summary>
â”‚   â”‚   â”‚  242 â”‚         /// Disposes resources
â”‚   â”‚   â”‚  243 â”‚         /// </summary>
â”‚   â”‚   â”‚  244 â”‚         public void Dispose()
â”‚   â”‚   â”‚  245 â”‚         {
â”‚   â”‚   â”‚  246 â”‚             Dispose(true);
â”‚   â”‚   â”‚  247 â”‚             GC.SuppressFinalize(this);
â”‚   â”‚   â”‚  248 â”‚         }
â”‚   â”‚   â”‚  249 â”‚ 
â”‚   â”‚   â”‚  250 â”‚         /// <summary>
â”‚   â”‚   â”‚  251 â”‚         /// Disposes resources
â”‚   â”‚   â”‚  252 â”‚         /// </summary>
â”‚   â”‚   â”‚  253 â”‚         /// <param name="disposing">True if disposing, false if finalizing</param>
â”‚   â”‚   â”‚  254 â”‚         protected virtual void Dispose(bool disposing)
â”‚   â”‚   â”‚  255 â”‚         {
â”‚   â”‚   â”‚  256 â”‚             if (!_disposed)
â”‚   â”‚   â”‚  257 â”‚             {
â”‚   â”‚   â”‚  258 â”‚                 if (disposing)
â”‚   â”‚   â”‚  259 â”‚                 {
â”‚   â”‚   â”‚  260 â”‚                     // Save settings if needed
â”‚   â”‚   â”‚  261 â”‚                     if (_currentSettings.DeleteLogsOnExit)
â”‚   â”‚   â”‚  262 â”‚                     {
â”‚   â”‚   â”‚  263 â”‚                         try
â”‚   â”‚   â”‚  264 â”‚                         {
â”‚   â”‚   â”‚  265 â”‚                             // Logic to delete logs would go here
â”‚   â”‚   â”‚  266 â”‚                             _logger.LogInformation("Cleaning up logs on exit");
â”‚   â”‚   â”‚  267 â”‚                         }
â”‚   â”‚   â”‚  268 â”‚                         catch (Exception ex)
â”‚   â”‚   â”‚  269 â”‚                         {
â”‚   â”‚   â”‚  270 â”‚                             _logger.LogError(ex, "Error cleaning up logs");
â”‚   â”‚   â”‚  271 â”‚                         }
â”‚   â”‚   â”‚  272 â”‚                     }
â”‚   â”‚   â”‚  273 â”‚                 }
â”‚   â”‚   â”‚  274 â”‚ 
â”‚   â”‚   â”‚  275 â”‚                 _disposed = true;
â”‚   â”‚   â”‚  276 â”‚             }
â”‚   â”‚   â”‚  277 â”‚         }
â”‚   â”‚   â”‚  278 â”‚     }
â”‚   â”‚   â”‚  279 â”‚ }
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â””â”€â”€ ğŸ“„ SukiThemeExtensions.cs (2.27 KB, 2025-03-12 12:50:28)
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚ FILE CONTENT: SukiThemeExtensions.cs
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚       â”‚    1 â”‚ ï»¿using Avalonia.Styling;
â”‚       â”‚    2 â”‚ using SukiUI;
â”‚       â”‚    3 â”‚ using SukiUI.Theme;
â”‚       â”‚    4 â”‚ using System;
â”‚       â”‚    5 â”‚ 
â”‚       â”‚    6 â”‚ namespace test.Infrastructure
â”‚       â”‚    7 â”‚ {
â”‚       â”‚    8 â”‚     /// <summary>
â”‚       â”‚    9 â”‚     /// Extension methods for SukiTheme to make theme operations more robust
â”‚       â”‚   10 â”‚     /// </summary>
â”‚       â”‚   11 â”‚     public static class SukiThemeExtensions
â”‚       â”‚   12 â”‚     {
â”‚       â”‚   13 â”‚         /// <summary>
â”‚       â”‚   14 â”‚         /// Applies a theme change at both SukiTheme and application levels
â”‚       â”‚   15 â”‚         /// </summary>
â”‚       â”‚   16 â”‚         /// <param name="theme">The SukiTheme instance</param>
â”‚       â”‚   17 â”‚         /// <param name="isLightTheme">Whether to use light theme</param>
â”‚       â”‚   18 â”‚         public static void ApplyThemeChange(this SukiTheme theme, bool isLightTheme)
â”‚       â”‚   19 â”‚         {
â”‚       â”‚   20 â”‚             if (theme == null) return;
â”‚       â”‚   21 â”‚ 
â”‚       â”‚   22 â”‚             // First apply at SukiTheme level
â”‚       â”‚   23 â”‚             theme.ChangeBaseTheme(isLightTheme ? ThemeVariant.Light : ThemeVariant.Dark);
â”‚       â”‚   24 â”‚ 
â”‚       â”‚   25 â”‚             // Also apply at application level for consistent theming
â”‚       â”‚   26 â”‚             if (Avalonia.Application.Current != null)
â”‚       â”‚   27 â”‚             {
â”‚       â”‚   28 â”‚                 Avalonia.Application.Current.RequestedThemeVariant =
â”‚       â”‚   29 â”‚                     isLightTheme ? ThemeVariant.Light : ThemeVariant.Dark;
â”‚       â”‚   30 â”‚             }
â”‚       â”‚   31 â”‚         }
â”‚       â”‚   32 â”‚ 
â”‚       â”‚   33 â”‚         /// <summary>
â”‚       â”‚   34 â”‚         /// Gets the current theme setting as a boolean
â”‚       â”‚   35 â”‚         /// </summary>
â”‚       â”‚   36 â”‚         /// <param name="theme">The SukiTheme instance</param>
â”‚       â”‚   37 â”‚         /// <returns>True if light theme, false if dark theme</returns>
â”‚       â”‚   38 â”‚         public static bool IsLightTheme(this SukiTheme theme)
â”‚       â”‚   39 â”‚         {
â”‚       â”‚   40 â”‚             return theme?.ActiveBaseTheme == ThemeVariant.Light;
â”‚       â”‚   41 â”‚         }
â”‚       â”‚   42 â”‚ 
â”‚       â”‚   43 â”‚         /// <summary>
â”‚       â”‚   44 â”‚         /// Force applies the current application theme to SukiTheme
â”‚       â”‚   45 â”‚         /// </summary>
â”‚       â”‚   46 â”‚         /// <param name="theme">The SukiTheme instance</param>
â”‚       â”‚   47 â”‚         public static void SyncWithApplicationTheme(this SukiTheme theme)
â”‚       â”‚   48 â”‚         {
â”‚       â”‚   49 â”‚             if (theme == null || Avalonia.Application.Current == null) return;
â”‚       â”‚   50 â”‚ 
â”‚       â”‚   51 â”‚             var appTheme = Avalonia.Application.Current.RequestedThemeVariant ?? ThemeVariant.Default;
â”‚       â”‚   52 â”‚ 
â”‚       â”‚   53 â”‚             // If app theme is default, don't change anything
â”‚       â”‚   54 â”‚             if (appTheme == ThemeVariant.Default) return;
â”‚       â”‚   55 â”‚ 
â”‚       â”‚   56 â”‚             // Apply the app theme to SukiTheme if different
â”‚       â”‚   57 â”‚             if (theme.ActiveBaseTheme != appTheme)
â”‚       â”‚   58 â”‚             {
â”‚       â”‚   59 â”‚                 theme.ChangeBaseTheme(appTheme);
â”‚       â”‚   60 â”‚             }
â”‚       â”‚   61 â”‚         }
â”‚       â”‚   62 â”‚     }
â”‚       â”‚   63 â”‚ }
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ ğŸ“„ App.axaml (1.44 KB, 2025-03-12 07:53:50)
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ FILE CONTENT: App.axaml
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚    1 â”‚ <Application
â”‚   â”‚    2 â”‚     x:Class="test.App"
â”‚   â”‚    3 â”‚     xmlns="https://github.com/avaloniaui"
â”‚   â”‚    4 â”‚     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
â”‚   â”‚    5 â”‚     xmlns:converters="clr-namespace:test.Infrastructure.UI.Converters"
â”‚   â”‚    6 â”‚     xmlns:local="clr-namespace:test"
â”‚   â”‚    7 â”‚     xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
â”‚   â”‚    8 â”‚     xmlns:suki="using:SukiUI"
â”‚   â”‚    9 â”‚     xmlns:sukiUi="clr-namespace:SukiUI;assembly=SukiUI"
â”‚   â”‚   10 â”‚     xmlns:svg="clr-namespace:Avalonia.Svg.Skia;assembly=Avalonia.Svg.Skia"
â”‚   â”‚   11 â”‚     xmlns:vm="clr-namespace:test.ViewModels"
â”‚   â”‚   12 â”‚     RequestedThemeVariant="Default">
â”‚   â”‚   13 â”‚ 
â”‚   â”‚   14 â”‚     <Application.Resources>
â”‚   â”‚   15 â”‚         <local:ViewLocator x:Key="ViewLocator" />
â”‚   â”‚   16 â”‚     </Application.Resources>
â”‚   â”‚   17 â”‚ 
â”‚   â”‚   18 â”‚     <Application.DataTemplates>
â”‚   â”‚   19 â”‚         <DataTemplate DataType="{x:Type vm:ViewModelBase}">
â”‚   â”‚   20 â”‚             <ContentControl Content="{Binding}">
â”‚   â”‚   21 â”‚                 <ContentControl.ContentTemplate>
â”‚   â”‚   22 â”‚                     <StaticResource ResourceKey="ViewLocator" />
â”‚   â”‚   23 â”‚                 </ContentControl.ContentTemplate>
â”‚   â”‚   24 â”‚             </ContentControl>
â”‚   â”‚   25 â”‚         </DataTemplate>
â”‚   â”‚   26 â”‚     </Application.DataTemplates>
â”‚   â”‚   27 â”‚ 
â”‚   â”‚   28 â”‚     <Application.Styles>
â”‚   â”‚   29 â”‚         <materialIcons:MaterialIconStyles />
â”‚   â”‚   30 â”‚         <suki:SukiTheme ThemeColor="Orange" />
â”‚   â”‚   31 â”‚ 
â”‚   â”‚   32 â”‚         <!--  Add default padding to all UserControls in the Views namespace  -->
â”‚   â”‚   33 â”‚         <Style Selector="UserControl">
â”‚   â”‚   34 â”‚             <Setter Property="Padding" Value="20" />
â”‚   â”‚   35 â”‚         </Style>
â”‚   â”‚   36 â”‚     </Application.Styles>
â”‚   â”‚   37 â”‚ </Application>
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ ğŸ“„ App.axaml.cs (4.96 KB, 2025-03-12 15:18:44)
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ FILE CONTENT: App.axaml.cs
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚    1 â”‚ using Avalonia;
â”‚   â”‚    2 â”‚ using Avalonia.Controls.ApplicationLifetimes;
â”‚   â”‚    3 â”‚ using Avalonia.Markup.Xaml;
â”‚   â”‚    4 â”‚ using Microsoft.Extensions.DependencyInjection;
â”‚   â”‚    5 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚    6 â”‚ using System;
â”‚   â”‚    7 â”‚ using Avalonia.Styling;
â”‚   â”‚    8 â”‚ using System.Diagnostics;
â”‚   â”‚    9 â”‚ using test.Infrastructure;
â”‚   â”‚   10 â”‚ using test.ViewModels;
â”‚   â”‚   11 â”‚ using test.Views;
â”‚   â”‚   12 â”‚ using SukiUI;
â”‚   â”‚   13 â”‚ using test.Application.Services;
â”‚   â”‚   14 â”‚ using SukiUI.Theme;
â”‚   â”‚   15 â”‚ using SukiUI.Dialogs;
â”‚   â”‚   16 â”‚ using test.Application;
â”‚   â”‚   17 â”‚ using test.Core.Interfaces;
â”‚   â”‚   18 â”‚ 
â”‚   â”‚   19 â”‚ namespace test
â”‚   â”‚   20 â”‚ {
â”‚   â”‚   21 â”‚     public partial class App : Avalonia.Application
â”‚   â”‚   22 â”‚     {
â”‚   â”‚   23 â”‚         private IServiceProvider? _serviceProvider;
â”‚   â”‚   24 â”‚ 
â”‚   â”‚   25 â”‚         public override void Initialize()
â”‚   â”‚   26 â”‚         {
â”‚   â”‚   27 â”‚             AvaloniaXamlLoader.Load(this);
â”‚   â”‚   28 â”‚         }
â”‚   â”‚   29 â”‚ 
â”‚   â”‚   30 â”‚         public override void OnFrameworkInitializationCompleted()
â”‚   â”‚   31 â”‚         {
â”‚   â”‚   32 â”‚             if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
â”‚   â”‚   33 â”‚             {
â”‚   â”‚   34 â”‚                 try
â”‚   â”‚   35 â”‚                 {
â”‚   â”‚   36 â”‚                     Trace.WriteLine("Creating main window");
â”‚   â”‚   37 â”‚ 
â”‚   â”‚   38 â”‚                     // Create temporary window for bootstrapping
â”‚   â”‚   39 â”‚                     var tempWindow = new MainWindow();
â”‚   â”‚   40 â”‚ 
â”‚   â”‚   41 â”‚                     // Create application bootstrapper with the temporary window
â”‚   â”‚   42 â”‚                     var bootstrapper = new AppBootstrapper(tempWindow);
â”‚   â”‚   43 â”‚                     _serviceProvider = bootstrapper.ServiceProvider;
â”‚   â”‚   44 â”‚ 
â”‚   â”‚   45 â”‚                     // Initialize logging explicitly at startup
â”‚   â”‚   46 â”‚                     var loggingService = _serviceProvider.GetRequiredService<ILoggingService>();
â”‚   â”‚   47 â”‚                     loggingService.EnableLogging(true);
â”‚   â”‚   48 â”‚ 
â”‚   â”‚   49 â”‚                     // Log application startup
â”‚   â”‚   50 â”‚                     var logger = _serviceProvider.GetRequiredService<ILogger<App>>();
â”‚   â”‚   51 â”‚                     logger.LogInformation("Application starting up");
â”‚   â”‚   52 â”‚ 
â”‚   â”‚   53 â”‚                     // Initialize theme BEFORE creating MainWindow DataContext
â”‚   â”‚   54 â”‚                     InitializeTheme();
â”‚   â”‚   55 â”‚ 
â”‚   â”‚   56 â”‚                     // Get MainViewModel from service provider
â”‚   â”‚   57 â”‚                     var mainViewModel = _serviceProvider.GetRequiredService<MainViewModel>();
â”‚   â”‚   58 â”‚                     logger.LogInformation("Created MainViewModel: {ViewModel}",
â”‚   â”‚   59 â”‚                         mainViewModel != null ? "Success" : "Failed");
â”‚   â”‚   60 â”‚ 
â”‚   â”‚   61 â”‚                     // Create the main window
â”‚   â”‚   62 â”‚                     desktop.MainWindow = new MainWindow(
â”‚   â”‚   63 â”‚                         _serviceProvider.GetService<ILogger<MainWindow>>())
â”‚   â”‚   64 â”‚                     {
â”‚   â”‚   65 â”‚                         DataContext = mainViewModel
â”‚   â”‚   66 â”‚                     };
â”‚   â”‚   67 â”‚ 
â”‚   â”‚   68 â”‚                     logger.LogInformation("Main window created with ViewModel");
â”‚   â”‚   69 â”‚ 
â”‚   â”‚   70 â”‚                     desktop.Exit += OnApplicationExit;
â”‚   â”‚   71 â”‚                 }
â”‚   â”‚   72 â”‚                 catch (Exception ex)
â”‚   â”‚   73 â”‚                 {
â”‚   â”‚   74 â”‚                     Trace.WriteLine($"Error in application initialization: {ex}");
â”‚   â”‚   75 â”‚ 
â”‚   â”‚   76 â”‚                     // Create a minimal main window if initialization fails
â”‚   â”‚   77 â”‚                     if (desktop.MainWindow == null)
â”‚   â”‚   78 â”‚                     {
â”‚   â”‚   79 â”‚                         desktop.MainWindow = new MainWindow();
â”‚   â”‚   80 â”‚                     }
â”‚   â”‚   81 â”‚                 }
â”‚   â”‚   82 â”‚             }
â”‚   â”‚   83 â”‚ 
â”‚   â”‚   84 â”‚             base.OnFrameworkInitializationCompleted();
â”‚   â”‚   85 â”‚             Trace.WriteLine("App initialized");
â”‚   â”‚   86 â”‚         }
â”‚   â”‚   87 â”‚ 
â”‚   â”‚   88 â”‚         private void InitializeTheme()
â”‚   â”‚   89 â”‚         {
â”‚   â”‚   90 â”‚             try
â”‚   â”‚   91 â”‚             {
â”‚   â”‚   92 â”‚                 var settingsManager = _serviceProvider?.GetService<ISettingsManager>();
â”‚   â”‚   93 â”‚                 if (settingsManager != null)
â”‚   â”‚   94 â”‚                 {
â”‚   â”‚   95 â”‚                     var settings = settingsManager.GetCurrentSettings();
â”‚   â”‚   96 â”‚                     var theme = SukiTheme.GetInstance();
â”‚   â”‚   97 â”‚ 
â”‚   â”‚   98 â”‚                     Trace.WriteLine($"Initializing Theme: IsLightTheme={settings.IsLightTheme}");
â”‚   â”‚   99 â”‚ 
â”‚   â”‚  100 â”‚                     // Force theme change
â”‚   â”‚  101 â”‚                     theme.ChangeBaseTheme(settings.IsLightTheme ? ThemeVariant.Light : ThemeVariant.Dark);
â”‚   â”‚  102 â”‚ 
â”‚   â”‚  103 â”‚                     // Ensure theme change is applied
â”‚   â”‚  104 â”‚                     Current.RequestedThemeVariant = settings.IsLightTheme ? ThemeVariant.Light : ThemeVariant.Dark;
â”‚   â”‚  105 â”‚                 }
â”‚   â”‚  106 â”‚                 else
â”‚   â”‚  107 â”‚                 {
â”‚   â”‚  108 â”‚                     Trace.WriteLine("Warning: SettingsManager not available during theme initialization");
â”‚   â”‚  109 â”‚                 }
â”‚   â”‚  110 â”‚             }
â”‚   â”‚  111 â”‚             catch (Exception ex)
â”‚   â”‚  112 â”‚             {
â”‚   â”‚  113 â”‚                 Trace.WriteLine($"Error initializing theme: {ex}");
â”‚   â”‚  114 â”‚             }
â”‚   â”‚  115 â”‚         }
â”‚   â”‚  116 â”‚ 
â”‚   â”‚  117 â”‚         private void OnApplicationExit(object? sender, ControlledApplicationLifetimeExitEventArgs e)
â”‚   â”‚  118 â”‚         {
â”‚   â”‚  119 â”‚             if (_serviceProvider != null)
â”‚   â”‚  120 â”‚             {
â”‚   â”‚  121 â”‚                 var settingsManager = _serviceProvider.GetService<ISettingsManager>();
â”‚   â”‚  122 â”‚                 if (settingsManager is IDisposable disposable)
â”‚   â”‚  123 â”‚                 {
â”‚   â”‚  124 â”‚                     disposable.Dispose();
â”‚   â”‚  125 â”‚                 }
â”‚   â”‚  126 â”‚ 
â”‚   â”‚  127 â”‚                 // Also dispose logging service
â”‚   â”‚  128 â”‚                 var loggingService = _serviceProvider.GetService<ILoggingService>();
â”‚   â”‚  129 â”‚                 if (loggingService is IDisposable loggingDisposable)
â”‚   â”‚  130 â”‚                 {
â”‚   â”‚  131 â”‚                     loggingDisposable.Dispose();
â”‚   â”‚  132 â”‚                 }
â”‚   â”‚  133 â”‚             }
â”‚   â”‚  134 â”‚         }
â”‚   â”‚  135 â”‚     }
â”‚   â”‚  136 â”‚ 
â”‚   â”‚  137 â”‚ }
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ ğŸ“„ MainWindow.axaml (7.02 KB, 2025-03-12 15:11:51)
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ FILE CONTENT: MainWindow.axaml
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚    1 â”‚ <sukiUi:SukiWindow
â”‚   â”‚    2 â”‚     x:Class="test.MainWindow"
â”‚   â”‚    3 â”‚     xmlns="https://github.com/avaloniaui"
â”‚   â”‚    4 â”‚     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
â”‚   â”‚    5 â”‚     xmlns:converters="clr-namespace:test.Infrastructure.UI.Converters"
â”‚   â”‚    6 â”‚     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
â”‚   â”‚    7 â”‚     xmlns:materialIcons="using:Material.Icons.Avalonia"
â”‚   â”‚    8 â”‚     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
â”‚   â”‚    9 â”‚     xmlns:models="using:test.Core.Domain"
â”‚   â”‚   10 â”‚     xmlns:suki="using:SukiUI.Controls"
â”‚   â”‚   11 â”‚     xmlns:sukiUi="using:SukiUI.Controls"
â”‚   â”‚   12 â”‚     xmlns:vm="using:test.ViewModels"
â”‚   â”‚   13 â”‚     Title="Paape Conversion Kit"
â”‚   â”‚   14 â”‚     Width="1200"
â”‚   â”‚   15 â”‚     Height="900"
â”‚   â”‚   16 â”‚     d:DesignHeight="800"
â”‚   â”‚   17 â”‚     d:DesignWidth="1200"
â”‚   â”‚   18 â”‚     x:DataType="vm:MainViewModel"
â”‚   â”‚   19 â”‚     ExtendClientAreaToDecorationsHint="True"
â”‚   â”‚   20 â”‚     WindowStartupLocation="CenterScreen"
â”‚   â”‚   21 â”‚     mc:Ignorable="d">
â”‚   â”‚   22 â”‚     <Window.Resources>
â”‚   â”‚   23 â”‚         <!--  We'll create the converter below  -->
â”‚   â”‚   24 â”‚         <converters:BoolToMarginConverter x:Key="BoolToMarginConverter" />
â”‚   â”‚   25 â”‚     </Window.Resources>
â”‚   â”‚   26 â”‚ 
â”‚   â”‚   27 â”‚     <sukiUi:SukiWindow.Hosts>
â”‚   â”‚   28 â”‚         <sukiUi:SukiDialogHost Name="DialogHost" />
â”‚   â”‚   29 â”‚     </sukiUi:SukiWindow.Hosts>
â”‚   â”‚   30 â”‚ 
â”‚   â”‚   31 â”‚     <sukiUi:SukiWindow.LogoContent>
â”‚   â”‚   32 â”‚         <Viewbox
â”‚   â”‚   33 â”‚             Width="24"
â”‚   â”‚   34 â”‚             Height="24"
â”‚   â”‚   35 â”‚             VerticalAlignment="Center">
â”‚   â”‚   36 â”‚             <Canvas Width="200" Height="168">
â”‚   â”‚   37 â”‚                 <Path Data="M 90.662158 22.881994 A 89.771187 68.461014 0 0 0 0.89110804 91.342931 A 89.771187 68.461014 0 0 0 56.259029 154.43882 A 89.771187 68.461014 0 0 1 43.333252 145.43627 L 145.64053 145.43627 A 89.771187 68.461014 0 0 1 90.662158 159.80387 A 89.771187 68.461014 0 0 1 56.2590...
â”‚   â”‚   38 â”‚                     <Path.Transitions>
â”‚   â”‚   39 â”‚                         <Transitions>
â”‚   â”‚   40 â”‚                             <BrushTransition Property="Fill" Duration="{DynamicResource ShortAnimationDuration}" />
â”‚   â”‚   41 â”‚                         </Transitions>
â”‚   â”‚   42 â”‚                     </Path.Transitions>
â”‚   â”‚   43 â”‚                 </Path>
â”‚   â”‚   44 â”‚             </Canvas>
â”‚   â”‚   45 â”‚         </Viewbox>
â”‚   â”‚   46 â”‚     </sukiUi:SukiWindow.LogoContent>
â”‚   â”‚   47 â”‚     <Grid>
â”‚   â”‚   48 â”‚         <suki:SukiSideMenu
â”‚   â”‚   49 â”‚             x:Name="SideMenu"
â”‚   â”‚   50 â”‚             IsSearchEnabled="False"
â”‚   â”‚   51 â”‚             IsSelectedItemContentMovable="True"
â”‚   â”‚   52 â”‚             IsToggleButtonVisible="True"
â”‚   â”‚   53 â”‚             ItemsSource="{Binding MenuItems}"
â”‚   â”‚   54 â”‚             OpenPaneLength="250"
â”‚   â”‚   55 â”‚             SelectedItem="{Binding SelectedMenuItem, Mode=TwoWay}"
â”‚   â”‚   56 â”‚             SelectionChanged="SukiSideMenu_SelectionChanged">
â”‚   â”‚   57 â”‚ 
â”‚   â”‚   58 â”‚             <suki:SukiSideMenu.ItemTemplate>
â”‚   â”‚   59 â”‚                 <DataTemplate>
â”‚   â”‚   60 â”‚                     <suki:SukiSideMenuItem
â”‚   â”‚   61 â”‚                         Classes="Compact"
â”‚   â”‚   62 â”‚                         Header="{Binding Header}"
â”‚   â”‚   63 â”‚                         IsTopMenuExpanded="True"
â”‚   â”‚   64 â”‚                         ToolTip.Tip="{Binding Header}">
â”‚   â”‚   65 â”‚                         <suki:SukiSideMenuItem.Icon>
â”‚   â”‚   66 â”‚                             <materialIcons:MaterialIcon Kind="{Binding Icon}" />
â”‚   â”‚   67 â”‚                         </suki:SukiSideMenuItem.Icon>
â”‚   â”‚   68 â”‚                     </suki:SukiSideMenuItem>
â”‚   â”‚   69 â”‚                 </DataTemplate>
â”‚   â”‚   70 â”‚             </suki:SukiSideMenu.ItemTemplate>
â”‚   â”‚   71 â”‚ 
â”‚   â”‚   72 â”‚             <suki:SukiSideMenu.HeaderContent>
â”‚   â”‚   73 â”‚                 <StackPanel Margin="30,20" HorizontalAlignment="Center">
â”‚   â”‚   74 â”‚                     <Grid>
â”‚   â”‚   75 â”‚                         <Ellipse
â”‚   â”‚   76 â”‚                             Width="120"
â”‚   â”‚   77 â”‚                             Height="120"
â”‚   â”‚   78 â”‚                             Opacity="0.1">
â”‚   â”‚   79 â”‚                             <Ellipse.Fill>
â”‚   â”‚   80 â”‚                                 <RadialGradientBrush>
â”‚   â”‚   81 â”‚                                     <GradientStop Offset="0" Color="{DynamicResource SukiPrimaryColor}" />
â”‚   â”‚   82 â”‚                                     <GradientStop Offset="1" Color="Transparent" />
â”‚   â”‚   83 â”‚                                 </RadialGradientBrush>
â”‚   â”‚   84 â”‚                             </Ellipse.Fill>
â”‚   â”‚   85 â”‚                             <Ellipse.Effect>
â”‚   â”‚   86 â”‚                                 <BlurEffect Radius="8" />
â”‚   â”‚   87 â”‚                             </Ellipse.Effect>
â”‚   â”‚   88 â”‚                             <Ellipse.Transitions>
â”‚   â”‚   89 â”‚                                 <Transitions>
â”‚   â”‚   90 â”‚                                     <BrushTransition Property="Fill" Duration="{DynamicResource ShortAnimationDuration}" />
â”‚   â”‚   91 â”‚                                 </Transitions>
â”‚   â”‚   92 â”‚                             </Ellipse.Transitions>
â”‚   â”‚   93 â”‚                         </Ellipse>
â”‚   â”‚   94 â”‚                         <TextBlock
â”‚   â”‚   95 â”‚                             HorizontalAlignment="Center"
â”‚   â”‚   96 â”‚                             VerticalAlignment="Center"
â”‚   â”‚   97 â”‚                             FontSize="42"
â”‚   â”‚   98 â”‚                             FontWeight="Bold"
â”‚   â”‚   99 â”‚                             Foreground="{DynamicResource SukiPrimaryColor}"
â”‚   â”‚  100 â”‚                             Text="PCK" />
â”‚   â”‚  101 â”‚                     </Grid>
â”‚   â”‚  102 â”‚                     <TextBlock
â”‚   â”‚  103 â”‚                         Margin="0,10,0,0"
â”‚   â”‚  104 â”‚                         HorizontalAlignment="Center"
â”‚   â”‚  105 â”‚                         FontSize="16"
â”‚   â”‚  106 â”‚                         Text="Paape Tools" />
â”‚   â”‚  107 â”‚                 </StackPanel>
â”‚   â”‚  108 â”‚             </suki:SukiSideMenu.HeaderContent>
â”‚   â”‚  109 â”‚ 
â”‚   â”‚  110 â”‚             <suki:SukiSideMenu.FooterContent>
â”‚   â”‚  111 â”‚                 <StackPanel
â”‚   â”‚  112 â”‚                     Margin="0,10"
â”‚   â”‚  113 â”‚                     HorizontalAlignment="Center"
â”‚   â”‚  114 â”‚                     Orientation="Horizontal"
â”‚   â”‚  115 â”‚                     Spacing="10">
â”‚   â”‚  116 â”‚                     <Button Classes="Basic">
â”‚   â”‚  117 â”‚                         <materialIcons:MaterialIcon Kind="Settings" />
â”‚   â”‚  118 â”‚                     </Button>
â”‚   â”‚  119 â”‚                     <Button Classes="Basic">
â”‚   â”‚  120 â”‚                         <materialIcons:MaterialIcon Kind="Help" />
â”‚   â”‚  121 â”‚                     </Button>
â”‚   â”‚  122 â”‚                 </StackPanel>
â”‚   â”‚  123 â”‚             </suki:SukiSideMenu.FooterContent>
â”‚   â”‚  124 â”‚         </suki:SukiSideMenu>
â”‚   â”‚  125 â”‚ 
â”‚   â”‚  126 â”‚         <ContentControl
â”‚   â”‚  127 â”‚             x:Name="MainContent"
â”‚   â”‚  128 â”‚             Grid.Column="1"
â”‚   â”‚  129 â”‚             Margin="{Binding ElementName=SideMenu, Path=IsMenuExpanded, Converter={StaticResource BoolToMarginConverter}}">
â”‚   â”‚  130 â”‚             <ContentControl.Transitions>
â”‚   â”‚  131 â”‚                 <Transitions>
â”‚   â”‚  132 â”‚                     <ThicknessTransition
â”‚   â”‚  133 â”‚                         Easing="QuadraticEaseInOut"
â”‚   â”‚  134 â”‚                         Property="Margin"
â”‚   â”‚  135 â”‚                         Duration="0:0:0.2" />
â”‚   â”‚  136 â”‚                 </Transitions>
â”‚   â”‚  137 â”‚             </ContentControl.Transitions>
â”‚   â”‚  138 â”‚         </ContentControl>
â”‚   â”‚  139 â”‚     </Grid>
â”‚   â”‚  140 â”‚ </sukiUi:SukiWindow>
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ ğŸ“„ MainWindow.axaml.cs (7.88 KB, 2025-03-12 15:18:53)
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ FILE CONTENT: MainWindow.axaml.cs
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚    1 â”‚ using Avalonia;
â”‚   â”‚    2 â”‚ using Avalonia.Controls;
â”‚   â”‚    3 â”‚ using Avalonia.Markup.Xaml;
â”‚   â”‚    4 â”‚ using test.ViewModels;
â”‚   â”‚    5 â”‚ using SukiUI.Controls;
â”‚   â”‚    6 â”‚ using SukiUI.Theme;
â”‚   â”‚    7 â”‚ using SukiUI;
â”‚   â”‚    8 â”‚ using System;
â”‚   â”‚    9 â”‚ using Microsoft.Extensions.Logging;
â”‚   â”‚   10 â”‚ 
â”‚   â”‚   11 â”‚ namespace test
â”‚   â”‚   12 â”‚ {
â”‚   â”‚   13 â”‚     public partial class MainWindow : SukiWindow
â”‚   â”‚   14 â”‚     {
â”‚   â”‚   15 â”‚         private readonly ILogger<MainWindow> _logger;
â”‚   â”‚   16 â”‚ 
â”‚   â”‚   17 â”‚         // Add parameterless constructor for design-time
â”‚   â”‚   18 â”‚         public MainWindow()
â”‚   â”‚   19 â”‚         {
â”‚   â”‚   20 â”‚             InitializeComponent();
â”‚   â”‚   21 â”‚ #if DEBUG
â”‚   â”‚   22 â”‚             this.AttachDevTools();
â”‚   â”‚   23 â”‚ #endif
â”‚   â”‚   24 â”‚             if (Design.IsDesignMode)
â”‚   â”‚   25 â”‚             {
â”‚   â”‚   26 â”‚                 // Set design-time DataContext
â”‚   â”‚   27 â”‚                 DataContext = new MainViewModel();
â”‚   â”‚   28 â”‚             }
â”‚   â”‚   29 â”‚ 
â”‚   â”‚   30 â”‚             // Initialize theme
â”‚   â”‚   31 â”‚             SukiTheme.GetInstance().SwitchBaseTheme();
â”‚   â”‚   32 â”‚         }
â”‚   â”‚   33 â”‚ 
â”‚   â”‚   34 â”‚         // Constructor that can accept a logger if available
â”‚   â”‚   35 â”‚         public MainWindow(ILogger<MainWindow> logger = null)
â”‚   â”‚   36 â”‚         {
â”‚   â”‚   37 â”‚             _logger = logger;
â”‚   â”‚   38 â”‚ 
â”‚   â”‚   39 â”‚             try
â”‚   â”‚   40 â”‚             {
â”‚   â”‚   41 â”‚                 InitializeComponent();
â”‚   â”‚   42 â”‚ #if DEBUG
â”‚   â”‚   43 â”‚                 this.AttachDevTools();
â”‚   â”‚   44 â”‚ #endif
â”‚   â”‚   45 â”‚                 // Initialize theme
â”‚   â”‚   46 â”‚                 SukiTheme.GetInstance().SwitchBaseTheme();
â”‚   â”‚   47 â”‚ 
â”‚   â”‚   48 â”‚                 // Log that the window was initialized
â”‚   â”‚   49 â”‚                 _logger?.LogInformation("MainWindow initialized");
â”‚   â”‚   50 â”‚ 
â”‚   â”‚   51 â”‚                 // Ensure ApplicationLifetime is initialized before calling TestSettingsView
â”‚   â”‚   52 â”‚                 if (App.Current?.ApplicationLifetime != null)
â”‚   â”‚   53 â”‚                 {
â”‚   â”‚   54 â”‚                     TestSettingsView();  // Uncomment this line to test
â”‚   â”‚   55 â”‚                 }
â”‚   â”‚   56 â”‚                 else
â”‚   â”‚   57 â”‚                 {
â”‚   â”‚   58 â”‚                     _logger?.LogError("ApplicationLifetime is not initialized!");
â”‚   â”‚   59 â”‚                 }
â”‚   â”‚   60 â”‚             }
â”‚   â”‚   61 â”‚             catch (Exception ex)
â”‚   â”‚   62 â”‚             {
â”‚   â”‚   63 â”‚                 _logger?.LogError(ex, "Error initializing MainWindow");
â”‚   â”‚   64 â”‚             }
â”‚   â”‚   65 â”‚         }
â”‚   â”‚   66 â”‚ 
â”‚   â”‚   67 â”‚ 
â”‚   â”‚   68 â”‚         protected override void OnDataContextChanged(EventArgs e)
â”‚   â”‚   69 â”‚         {
â”‚   â”‚   70 â”‚             base.OnDataContextChanged(e);
â”‚   â”‚   71 â”‚             _logger?.LogInformation("MainWindow DataContext changed to: {Type}",
â”‚   â”‚   72 â”‚                 DataContext?.GetType().Name ?? "null");
â”‚   â”‚   73 â”‚         }
â”‚   â”‚   74 â”‚ 
â”‚   â”‚   75 â”‚         private void SukiSideMenu_SelectionChanged(object? sender, SelectionChangedEventArgs e)
â”‚   â”‚   76 â”‚         {
â”‚   â”‚   77 â”‚             try
â”‚   â”‚   78 â”‚             {
â”‚   â”‚   79 â”‚                 var viewModel = DataContext as MainViewModel;
â”‚   â”‚   80 â”‚                 _logger?.LogDebug("SukiSideMenu_SelectionChanged event triggered. ViewModel: {ViewModel}",
â”‚   â”‚   81 â”‚                     viewModel != null ? "Available" : "Null");
â”‚   â”‚   82 â”‚ 
â”‚   â”‚   83 â”‚                 if (viewModel?.MenuItemSelectedCommand != null && e.AddedItems.Count > 0)
â”‚   â”‚   84 â”‚                 {
â”‚   â”‚   85 â”‚                     _logger?.LogDebug("Executing MenuItemSelectedCommand with {Item}", e.AddedItems[0]);
â”‚   â”‚   86 â”‚                     viewModel.MenuItemSelectedCommand.Execute(e.AddedItems[0]);
â”‚   â”‚   87 â”‚                 }
â”‚   â”‚   88 â”‚                 else
â”‚   â”‚   89 â”‚                 {
â”‚   â”‚   90 â”‚                     _logger?.LogWarning("Could not execute MenuItemSelectedCommand: {Reason}",
â”‚   â”‚   91 â”‚                         viewModel == null ? "ViewModel is null" :
â”‚   â”‚   92 â”‚                         viewModel.MenuItemSelectedCommand == null ? "Command is null" :
â”‚   â”‚   93 â”‚                         e.AddedItems.Count == 0 ? "No items selected" : "Unknown reason");
â”‚   â”‚   94 â”‚                 }
â”‚   â”‚   95 â”‚             }
â”‚   â”‚   96 â”‚             catch (Exception ex)
â”‚   â”‚   97 â”‚             {
â”‚   â”‚   98 â”‚                 _logger?.LogError(ex, "Error in SukiSideMenu_SelectionChanged");
â”‚   â”‚   99 â”‚             }
â”‚   â”‚  100 â”‚         }
â”‚   â”‚  101 â”‚ 
â”‚   â”‚  102 â”‚         private void InitializeComponent()
â”‚   â”‚  103 â”‚         {
â”‚   â”‚  104 â”‚             try
â”‚   â”‚  105 â”‚             {
â”‚   â”‚  106 â”‚                 AvaloniaXamlLoader.Load(this);
â”‚   â”‚  107 â”‚                 _logger?.LogDebug("MainWindow component initialized successfully");
â”‚   â”‚  108 â”‚ 
â”‚   â”‚  109 â”‚                 // Check if MainContent was found
â”‚   â”‚  110 â”‚                 var mainContent = this.FindControl<ContentControl>("MainContent");
â”‚   â”‚  111 â”‚                 _logger?.LogInformation("MainContent control {Status}",
â”‚   â”‚  112 â”‚                     mainContent != null ? "found" : "not found");
â”‚   â”‚  113 â”‚ 
â”‚   â”‚  114 â”‚                 // Check if SideMenu was found
â”‚   â”‚  115 â”‚                 var sideMenu = this.FindControl<SukiUI.Controls.SukiSideMenu>("SideMenu");
â”‚   â”‚  116 â”‚                 _logger?.LogInformation("SideMenu control {Status}",
â”‚   â”‚  117 â”‚                     sideMenu != null ? "found" : "not found");
â”‚   â”‚  118 â”‚ 
â”‚   â”‚  119 â”‚                 // If we have a side menu, check its binding
â”‚   â”‚  120 â”‚                 if (sideMenu != null)
â”‚   â”‚  121 â”‚                 {
â”‚   â”‚  122 â”‚                     _logger?.LogDebug("SideMenu ItemsSource binding {Status}",
â”‚   â”‚  123 â”‚                         sideMenu.ItemsSource != null ? "present" : "missing");
â”‚   â”‚  124 â”‚                 }
â”‚   â”‚  125 â”‚             }
â”‚   â”‚  126 â”‚             catch (Exception ex)
â”‚   â”‚  127 â”‚             {
â”‚   â”‚  128 â”‚                 _logger?.LogError(ex, "Error in InitializeComponent");
â”‚   â”‚  129 â”‚             }
â”‚   â”‚  130 â”‚         }
â”‚   â”‚  131 â”‚         private void TestMainContent()
â”‚   â”‚  132 â”‚         {
â”‚   â”‚  133 â”‚             try
â”‚   â”‚  134 â”‚             {
â”‚   â”‚  135 â”‚                 // Find the MainContent control
â”‚   â”‚  136 â”‚                 var mainContent = this.FindControl<ContentControl>("MainContent");
â”‚   â”‚  137 â”‚ 
â”‚   â”‚  138 â”‚                 if (mainContent != null)
â”‚   â”‚  139 â”‚                 {
â”‚   â”‚  140 â”‚                     _logger?.LogInformation("MainContent control found, setting test content");
â”‚   â”‚  141 â”‚ 
â”‚   â”‚  142 â”‚                     // Create a simple test panel with obvious content
â”‚   â”‚  143 â”‚                     var testPanel = new StackPanel();
â”‚   â”‚  144 â”‚                     testPanel.Children.Add(new TextBlock
â”‚   â”‚  145 â”‚                     {
â”‚   â”‚  146 â”‚                         Text = "TEST CONTENT - If you can see this, the ContentControl is working",
â”‚   â”‚  147 â”‚                         FontSize = 24,
â”‚   â”‚  148 â”‚                         Foreground = Avalonia.Media.Brushes.Red,
â”‚   â”‚  149 â”‚                         TextWrapping = Avalonia.Media.TextWrapping.Wrap
â”‚   â”‚  150 â”‚                     });
â”‚   â”‚  151 â”‚ 
â”‚   â”‚  152 â”‚                     // Set it directly to the MainContent
â”‚   â”‚  153 â”‚                     mainContent.Content = testPanel;
â”‚   â”‚  154 â”‚ 
â”‚   â”‚  155 â”‚                     _logger?.LogInformation("Test content has been set to MainContent");
â”‚   â”‚  156 â”‚                 }
â”‚   â”‚  157 â”‚                 else
â”‚   â”‚  158 â”‚                 {
â”‚   â”‚  159 â”‚                     _logger?.LogError("MainContent control was not found!");
â”‚   â”‚  160 â”‚                 }
â”‚   â”‚  161 â”‚             }
â”‚   â”‚  162 â”‚             catch (Exception ex)
â”‚   â”‚  163 â”‚             {
â”‚   â”‚  164 â”‚                 _logger?.LogError(ex, "Error in TestMainContent");
â”‚   â”‚  165 â”‚             }
â”‚   â”‚  166 â”‚         }
â”‚   â”‚  167 â”‚         private void TestSettingsView()
â”‚   â”‚  168 â”‚         {
â”‚   â”‚  169 â”‚             try
â”‚   â”‚  170 â”‚             {
â”‚   â”‚  171 â”‚                 _logger?.LogInformation("Creating SettingsView directly");
â”‚   â”‚  172 â”‚ 
â”‚   â”‚  173 â”‚                 // Get the MainContent control
â”‚   â”‚  174 â”‚                 var mainContent = this.FindControl<ContentControl>("MainContent");
â”‚   â”‚  175 â”‚ 
â”‚   â”‚  176 â”‚                 if (mainContent != null)
â”‚   â”‚  177 â”‚                 {
â”‚   â”‚  178 â”‚                     // Create a SettingsView directly
â”‚   â”‚  179 â”‚                     var settingsView = new Views.SettingsView();
â”‚   â”‚  180 â”‚ 
â”‚   â”‚  181 â”‚                     // Create a SettingsViewModel (which is needed by the SettingsView)
â”‚   â”‚  182 â”‚                     var serviceProvider = App.Current.ApplicationLifetime
â”‚   â”‚  183 â”‚                         .GetType()
â”‚   â”‚  184 â”‚                         .GetProperty("Services")
â”‚   â”‚  185 â”‚                         .GetValue(App.Current.ApplicationLifetime) as IServiceProvider;
â”‚   â”‚  186 â”‚ 
â”‚   â”‚  187 â”‚                     if (serviceProvider != null)
â”‚   â”‚  188 â”‚                     {
â”‚   â”‚  189 â”‚                         var settingsManager = serviceProvider.GetService(typeof(test.Infrastructure.ISettingsManager)) as test.Infrastructure.ISettingsManager;
â”‚   â”‚  190 â”‚                         var settingsViewModel = new ViewModels.SettingsViewModel(settingsManager);
â”‚   â”‚  191 â”‚ 
â”‚   â”‚  192 â”‚                         // Set the DataContext
â”‚   â”‚  193 â”‚                         settingsView.DataContext = settingsViewModel;
â”‚   â”‚  194 â”‚ 
â”‚   â”‚  195 â”‚                         // Set it as the content
â”‚   â”‚  196 â”‚                         mainContent.Content = settingsView;
â”‚   â”‚  197 â”‚ 
â”‚   â”‚  198 â”‚                         _logger?.LogInformation("SettingsView directly set as content");
â”‚   â”‚  199 â”‚                     }
â”‚   â”‚  200 â”‚                     else
â”‚   â”‚  201 â”‚                     {
â”‚   â”‚  202 â”‚                         _logger?.LogError("ServiceProvider is null!");
â”‚   â”‚  203 â”‚                     }
â”‚   â”‚  204 â”‚                 }
â”‚   â”‚  205 â”‚                 else
â”‚   â”‚  206 â”‚                 {
â”‚   â”‚  207 â”‚                     _logger?.LogError("MainContent control was not found!");
â”‚   â”‚  208 â”‚                 }
â”‚   â”‚  209 â”‚             }
â”‚   â”‚  210 â”‚             catch (Exception ex)
â”‚   â”‚  211 â”‚             {
â”‚   â”‚  212 â”‚                 _logger?.LogError(ex, "Error in TestSettingsView");
â”‚   â”‚  213 â”‚             }
â”‚   â”‚  214 â”‚         }
â”‚   â”‚  215 â”‚     }
â”‚   â”‚  216 â”‚ }
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ ğŸ“„ Program.cs (676.00 B, 2025-03-11 09:48:27)
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ FILE CONTENT: Program.cs
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚    1 â”‚ ï»¿using Avalonia;
â”‚   â”‚    2 â”‚ using System;
â”‚   â”‚    3 â”‚ 
â”‚   â”‚    4 â”‚ namespace test;
â”‚   â”‚    5 â”‚ 
â”‚   â”‚    6 â”‚ class Program
â”‚   â”‚    7 â”‚ {
â”‚   â”‚    8 â”‚     // Initialization code. Don't use any Avalonia, third-party APIs or any
â”‚   â”‚    9 â”‚     // SynchronizationContext-reliant code before AppMain is called: things aren't initialized
â”‚   â”‚   10 â”‚     // yet and stuff might break.
â”‚   â”‚   11 â”‚     [STAThread]
â”‚   â”‚   12 â”‚     public static void Main(string[] args) => BuildAvaloniaApp()
â”‚   â”‚   13 â”‚         .StartWithClassicDesktopLifetime(args);
â”‚   â”‚   14 â”‚ 
â”‚   â”‚   15 â”‚     // Avalonia configuration, don't remove; also used by visual designer.
â”‚   â”‚   16 â”‚     public static AppBuilder BuildAvaloniaApp()
â”‚   â”‚   17 â”‚         => AppBuilder.Configure<App>()
â”‚   â”‚   18 â”‚             .UsePlatformDetect()
â”‚   â”‚   19 â”‚             .WithInterFont()
â”‚   â”‚   20 â”‚             .LogToTrace();
â”‚   â”‚   21 â”‚ }
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ ğŸ“„ ViewLocator.cs (798.00 B, 2025-03-12 11:28:27)
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ FILE CONTENT: ViewLocator.cs
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚    1 â”‚ ï»¿using Avalonia.Controls;
â”‚   â”‚    2 â”‚ using Avalonia.Controls.Templates;
â”‚   â”‚    3 â”‚ using System;
â”‚   â”‚    4 â”‚ using test.ViewModels;
â”‚   â”‚    5 â”‚ 
â”‚   â”‚    6 â”‚ namespace test
â”‚   â”‚    7 â”‚ {
â”‚   â”‚    8 â”‚     public class ViewLocator : IDataTemplate
â”‚   â”‚    9 â”‚     {
â”‚   â”‚   10 â”‚         public Control? Build(object? param)
â”‚   â”‚   11 â”‚         {
â”‚   â”‚   12 â”‚             if (param is null)
â”‚   â”‚   13 â”‚                 return null;
â”‚   â”‚   14 â”‚ 
â”‚   â”‚   15 â”‚             var name = param.GetType().FullName!.Replace("ViewModel", "View");
â”‚   â”‚   16 â”‚             var type = Type.GetType(name);
â”‚   â”‚   17 â”‚ 
â”‚   â”‚   18 â”‚             if (type != null)
â”‚   â”‚   19 â”‚             {
â”‚   â”‚   20 â”‚                 return (Control)Activator.CreateInstance(type)!;
â”‚   â”‚   21 â”‚             }
â”‚   â”‚   22 â”‚             else
â”‚   â”‚   23 â”‚             {
â”‚   â”‚   24 â”‚                 return new TextBlock { Text = $"Not Found: {name}" };
â”‚   â”‚   25 â”‚             }
â”‚   â”‚   26 â”‚         }
â”‚   â”‚   27 â”‚ 
â”‚   â”‚   28 â”‚         public bool Match(object? data)
â”‚   â”‚   29 â”‚         {
â”‚   â”‚   30 â”‚             return data is ViewModelBase;
â”‚   â”‚   31 â”‚         }
â”‚   â”‚   32 â”‚     }
â”‚   â”‚   33 â”‚ }
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€â”€ ğŸ“„ test.csproj (3.69 KB, 2025-03-12 15:07:44)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ FILE CONTENT: test.csproj
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚    1 â”‚ ï»¿<Project Sdk="Microsoft.NET.Sdk">
    â”‚    2 â”‚   <PropertyGroup>
    â”‚    3 â”‚     <OutputType>WinExe</OutputType>
    â”‚    4 â”‚     <TargetFramework>net8.0</TargetFramework>
    â”‚    5 â”‚     <Nullable>enable</Nullable>
    â”‚    6 â”‚     <BuiltInComInteropSupport>true</BuiltInComInteropSupport>
    â”‚    7 â”‚     <ApplicationManifest>app.manifest</ApplicationManifest>
    â”‚    8 â”‚     <AvaloniaUseCompiledBindingsByDefault>true</AvaloniaUseCompiledBindingsByDefault>
    â”‚    9 â”‚   </PropertyGroup>
    â”‚   10 â”‚   <ItemGroup>
    â”‚   11 â”‚     <None Remove="Views\SettingsView.xaml" />
    â”‚   12 â”‚   </ItemGroup>
    â”‚   13 â”‚   <ItemGroup>
    â”‚   14 â”‚     <AvaloniaResource Include="Views\ConvertersView.xaml">
    â”‚   15 â”‚       <Generator>MSBuild:Compile</Generator>
    â”‚   16 â”‚     </AvaloniaResource>
    â”‚   17 â”‚     <AvaloniaResource Include="Views\SettingsView.xaml">
    â”‚   18 â”‚       <Generator>MSBuild:Compile</Generator>
    â”‚   19 â”‚     </AvaloniaResource>
    â”‚   20 â”‚   </ItemGroup>
    â”‚   21 â”‚ 
    â”‚   22 â”‚   <ItemGroup>
    â”‚   23 â”‚     <PackageReference Include="Antlr4.Runtime.Standard" Version="4.13.1" />
    â”‚   24 â”‚     <PackageReference Include="Antlr4BuildTasks" Version="12.10.0" />
    â”‚   25 â”‚     <PackageReference Include="Avalonia" Version="11.2.5" />
    â”‚   26 â”‚     <PackageReference Include="Avalonia.AvaloniaEdit" Version="11.1.0" />
    â”‚   27 â”‚     <PackageReference Include="Avalonia.Desktop" Version="11.2.5" />
    â”‚   28 â”‚     <PackageReference Include="Avalonia.ReactiveUI" Version="11.2.5" />
    â”‚   29 â”‚     <PackageReference Include="Avalonia.Skia" Version="11.2.5" />
    â”‚   30 â”‚     <PackageReference Include="Avalonia.Svg.Skia" Version="11.2.0.2" />
    â”‚   31 â”‚     <PackageReference Include="Avalonia.Themes.Fluent" Version="11.2.5" />
    â”‚   32 â”‚     <PackageReference Include="Avalonia.Fonts.Inter" Version="11.2.5" />
    â”‚   33 â”‚     <!--Condition below is needed to remove Avalonia.Diagnostics package from build output in Release configuration.-->
    â”‚   34 â”‚     <PackageReference Condition="'$(Configuration)' == 'Debug'" Include="Avalonia.Diagnostics" Version="11.2.5" />
    â”‚   35 â”‚     <PackageReference Include="Avalonia.Xaml.Behaviors" Version="11.2.0.14" />
    â”‚   36 â”‚     <PackageReference Include="Avalonia.Xaml.Interactions" Version="11.2.0.14" />
    â”‚   37 â”‚     <PackageReference Include="Avalonia.Xaml.Interactivity" Version="11.2.0.14" />
    â”‚   38 â”‚     <PackageReference Include="AvaloniaEdit.TextMate" Version="11.1.0" />
    â”‚   39 â”‚     <PackageReference Include="AvaloniaEdit.TextMate.Grammars" Version="0.10.12" />
    â”‚   40 â”‚     <PackageReference Include="ClosedXML" Version="0.104.2" />
    â”‚   41 â”‚     <PackageReference Include="CommunityToolkit.Mvvm" Version="8.4.0" />
    â”‚   42 â”‚     <PackageReference Include="DiffPlex" Version="1.7.2" />
    â”‚   43 â”‚     <PackageReference Include="Irony" Version="1.5.3" />
    â”‚   44 â”‚     <PackageReference Include="Material.Icons.Avalonia" Version="2.3.1" />
    â”‚   45 â”‚     <PackageReference Include="Microsoft.EntityFrameworkCore" Version="9.0.3" />
    â”‚   46 â”‚     <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="9.0.3" />
    â”‚   47 â”‚     <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite.Core" Version="9.0.3" />
    â”‚   48 â”‚     <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="9.0.3" />
    â”‚   49 â”‚     <PackageReference Include="Microsoft.Extensions.Logging" Version="9.0.3" />
    â”‚   50 â”‚     <PackageReference Include="NETStandard.Library" Version="2.0.3" />
    â”‚   51 â”‚     <PackageReference Include="NUlid" Version="1.7.2" />
    â”‚   52 â”‚     <PackageReference Include="ReactiveUI" Version="20.1.63" />
    â”‚   53 â”‚     <PackageReference Include="Serilog" Version="4.2.0" />
    â”‚   54 â”‚     <PackageReference Include="Serilog.Extensions.Logging" Version="9.0.0" />
    â”‚   55 â”‚     <PackageReference Include="Serilog.Formatting.Compact" Version="3.0.0" />
    â”‚   56 â”‚     <PackageReference Include="Serilog.Settings.Configuration" Version="9.0.0" />
    â”‚   57 â”‚     <PackageReference Include="Serilog.Sinks.Console" Version="6.0.0" />
    â”‚   58 â”‚     <PackageReference Include="Serilog.Sinks.Debug" Version="3.0.0" />
    â”‚   59 â”‚     <PackageReference Include="Serilog.Sinks.File" Version="6.0.0" />
    â”‚   60 â”‚     <PackageReference Include="SukiUI" Version="6.0.1" />
    â”‚   61 â”‚     <PackageReference Include="Ulid" Version="1.3.4" />
    â”‚   62 â”‚   </ItemGroup>
    â”‚   63 â”‚ </Project>
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€